<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 8, revision: 1, date: new Date("June 23, 2013"), extensions: {}};

//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Jeremy Ruston 2004-2007
Copyright (c) UnaMesa Association 2007-2012

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.

" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> TiddlyTiddlyTiddly - steve's web notebook </title>
<style id="styleArea" type="text/css">
.header { display:none;}
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2011 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>

</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
    <div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;
</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;
</pre>
</div>
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]
</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' role='banner' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' role='navigation' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' role='navigation' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' role='complementary' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea' role='main'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected {color:[[ColorPalette::PrimaryDark]];
    background:[[ColorPalette::TertiaryPale]];
    border-left:1px solid [[ColorPalette::TertiaryLight]];
    border-top:1px solid [[ColorPalette::TertiaryLight]];
    border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
    border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
    border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
    border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
    #mainMenu .tiddlyLinkNonExisting,
    #sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0; top:0;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0 3px 0 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0; padding-bottom:0;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/
</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' role='navigation' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>

</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="1 August 2015" creator="Steve" modifier="Steve" created="201508020055" tags="journal" changecount="1">
<pre>Professional development - week of July 27

!!! Html5 canvas
It's been interesting and somewhat challenging to get all this stuff running.  I don't feel like I've really improved my skill much, but I have definitely increased the breadth of my knowledge.  Not bad for a guy who couldn't really grok GWT a few years ago.

!!! Simplify and Explain
Enjoyed Beyer's session on the quick hit and getting the big idea out there.  Good advice I can use, like shut up after talking.  And I've latched onto this idea of trying to get other people to finish my sentences.  Too often I put all the words I can out there, like the best thing  the conversation can use is a &quot;yup&quot; or &quot;that's pretty much it&quot;.

!!! Crucial conversations
Read ch8 and ch9.  The book has gotten much better.  Actionable things I can try - great!

!!! Deep Dive apprenticeship
Good session pulling the interviews into a cohesive framework.  Here are the &quot;phases&quot; and here's the goals for each.  Looking forward to next week when we try it out on Nick and Nicole's memory of past deep dives.</pre>
</div>
<div title="12 July 2015" creator="Steve" modifier="Steve" created="201507121359" modified="201508020050" tags="journal pd" changecount="3">
<pre>Professional Development:  Week of July 5

!!! Two stack overflow answers
http://programmers.stackexchange.com/questions/288990/do-objects-in-oop-have-to-represent-an-entity/289013#289013
http://programmers.stackexchange.com/questions/289401/is-there-a-practical-way-to-manage-a-physical-task-board-if-one-or-more-scrum-te/289425#289425

Felt good to share some knowledge - mostly concerned that I spend a lot of time talking, far less time doing.

!!! Crucial conversations
Read ch4 and ch5.  Some of it really resonates, but most of it doesn't.

!!! Met with Euler
Enjoyed the conversation, but not sure what the goal is.  I'm sure I could use mentoring in the things Bill is good at.  How do I practice?


!!! Deep dive apprenticeship
Our current concern is understanding the flow and when to transition between stages of the deep dive.  This is somewhat frustrating because it seems  intuitive, so how can it be taught.  Additionally we're skipping over the easy productive work of making a playbook and focusing on the deeper issues which don't have clear solutions.  I'm going to concentrate on the pattern matching theory with regards to intuituion.  I feel like the right answer here is interviewing Nick and Nicole and getting them to focus a bit more on when they know enough is enough.  Our homework for this week was to think about the stages of a deep dive, which I think I have a handle on, but honestly have never paid much attention to.

Current frustration - how do I find more opportunities to practice?
</pre>
</div>
<div title="12 October 2013" creator="Steve" modifier="Steve" created="201310121149" modified="201310121153" tags="journal" changecount="3">
<pre>!! What did I accomplish?
* Can't think of anything

!! What did I want to work on, but didn't?
* Just a vague desire to do something.  I've been wasting a lot of time lately.

!! What is still important?
* Hmmmm....

!! What did I waste time on?
*imgur, questionable content, twitter stalking.  Nothing useful.

!! What Did I Learn?
* My completionist tendencies are dangerous
* Started reading Thinking Fast and Slow.  Not sure I've learned anything yet, maybe I'm not paying attention?

!! Next week's experiment
* WIP limit on a project list?  So things move back and forth to someday maybe?
* Need some sort of heartbeat rule as well.  I don't want to fill a slot with somehing important but never worked on.
* I think there's something I'm missing.  Like my next action is too big?  Can I get to a 5 minute next action?  Then If I limit to 3 projects, that's 15 minutes a week.

!! What if?
* Thinking about talk ideas.  Don't feel like I have the experience to put it together.</pre>
</div>
<div title="18 September 2013" creator="Steve" modifier="Steve" created="201309181928" modified="201309181929" tags="journal" changecount="2">
<pre>!! What did I accomplish?
* Gave my vagrant talk!
* Met new people, got introduced to some new things
* Really excited about how awesome the conference was.  Great crowd, enjoyed talking to almost everyone.  Feel great.

!! What did I want to work on, but didn't?
* Pretty stoked that my talk got done.  Not much else to complain about.

!! What is still important?
* Need to upload my slides and tweet them out

!! What did I waste time on?
*Besides avoiding my talk for two months?

!! What Did I Learn?
* All sorts of cool stuff.  Hoping to come back and write much better cukes that are declarative and focused.  Want to play with the browser tools and cucumber.pro.  Maybe learn some cucumber-elixr?

!! Next week's experiment
* Maybe setup a projects list like David Allen talks about (note:  Find GTD book)

!! What if?
* I'm back to the place where giving talks sounds like a great thing.  But I know I still don't love putting them together.  So how can I make that less painful?</pre>
</div>
<div title="21 July 2013" creator="Steve" modifier="Steve" created="201307211631" modified="201309132058" tags="journal" changecount="12">
<pre>First try at weekly journaling.
!! What did I accomplish?
''How big should an accomplishment be?''
* Sorted out test data cleanup and got regressions back on track
* Started exercism.io - did three exercises

!! What did I want to work on, but didn't?
I'm really disappointed about GiveCamp.  I wasn't assigned to a team and failed to find a way that I could be valuable (other than gofer).  I was hoping to give back or at least learn something.  All I really learned is that my skills don't translate well to throw up a webpage in 12 hours.  The worst part is I don't have any real interest in learning those skills - I don't care about static content and hosting.  I know I can contribute to open source, but at some level I want something I can point people to and say - 'I built that'.

I'm also not sure how to balance all the stuff I want to do.  I'd like to:

* Work out
* Get home early and play with Alec
* Let Laura sleep past 6am
* Have a productive day at work
* Learn something new
* Work on finances app (or other gem)
* Mentor someone
* Catch up on all the cool stuff other people are talking about
* Play basketball
* Do my other chores

That's like a 20 hour day.  And I want to do these things every day.  Oh and maybe do something mindless every once in a while

!! What is still important?
I really need to find a way to workout regularly.  It doesn't seem like it should be that hard to find 20mins a day to do a little cardio.

I also need to start on my vagrant talk.

!! What did I waste time on?
I tried to catch up on a number of internet things I had tagged to follow up on.  The javascript koans were largely a waste, as well as venkat's polyglot talk.  I'm really disappointed with screencasts and conf talks because they take up an hour where I have to pay pretty close information and I might get 5 mins of knowledge.  But I don't know until I put the time in and I'm such a completionist....I just don't know what to do.

!! What Did I Learn?
* PHP basics
** PHP isn't very interesting.  I shouldn't be afraid to jump into it, but given that people weren't knocking it out in 30 seconds, there's probably some subletly I don't understand.  Or my experience with other server-side scripting just makes it uninteresting?
* Intro to AntiFragile
** This is very cool.  Not sure what to do with it, as I'm tempted to draw conclusions that may or may not be the point.  Like tying TechSafety to AntiFragile - is a focus on safety the same thing as adapting to adversity?
* Intro to TechSafety
** Nice idea.  Not sure how to tie it back to the lean ux focused principles I'm also learning.  When is making quality the key driving focus useful for a startup situation?  I think some quality requires more strategic thinking than may be appropriate for a biz that needs to survive to next week.

* Tried exercism.io
* function_module or module_function for static helpers

!! Next week's experiment
* Do 20 mins of cardio after work M-W.

!! What if?
What if I knew what to ask about?</pre>
</div>
<div title="29 June 2013" creator="Steve" modifier="Steve" created="201307211702" modified="201307211705" tags="journal" changecount="3">
<pre>Back fill off of notecard
!! What did I accomplish?
* First deep dive
* CleAg workshop
* Lightning talk

!! What did I want to work on, but didn't?
Better lightning talk.

!! What is still important?

!! What did I waste time on?
* TV
* Workshop slides

!! What Did I Learn?
* Talks take a lot of time
* I'm still scared of estimating
* Scared of making architecture decisions without trying things out

!! Next week's experiment
* Experiment with remote work

!! What if?
What if I could  work effectively from anywhere?</pre>
</div>
<div title="3 BDD Case Studies" creator="Steve" modifier="Steve" created="201410011649" tags="#cukeup" changecount="1">
<pre>Mary Thorn

!! Case 1: Greenfield
Before:
* New project
After:
* Made automation part of done
* PO wrote gherkin
* Dev/QA pair to get cuke ready before work started
* PO wanted to see cuke go green before accepting

!! Case 2: Backward Implementation
Before:
* Team was not building the correct thing
* Lots of rework
* No idea what QA was testing
After:
* QA wrote gherkin
* QA sent feature files to DEV/PO to verify assumptions (probably not read)
* Developers write unit tests from feature files
* Manual testing of feature files
* Eventually got PO involved upfront (lots of begging)

!! Case 3:  Hybrid
Before:
* Waterfall project
* No colaboration
* Ineffective communication
* Crazy requirement specs
* No test automation
* Lots of issues
After:
* BA wrote Acceptance Tests
* Discussion with Dev + QA
* Estimation based on feature file
* Devs code and handover
* Manual testing of cukes
* Decreased bugs SIGNIFICANTLY</pre>
</div>
<div title="5 Things Cucumber is Bad at (&amp; why that's a good thing)" creator="Steve" modifier="Steve" created="201410011417" modified="201410011420" tags="#cukeup" changecount="2">
<pre>Richard Lawrence

There are 2 kinds of weaknesses - opportunities for improvement, and those that teach us what the thing IS (what it is good for)

!!! Weaknesses
1.  Gherkin isn't a powerful language (No macros or loops)
* Good!  These things make for bad expressions (Cukes are meant to be read).
2.  I have to describe things in two places (Why can't I just put the english with the code - rspec)
* Separate things to TALK about vs implementation details
3. Step defs are global
* Forces you to use ubiquitous language
4. Regular expressions
* It's not that hard!
5. My stakeholders won't write feature files
* Don't let customers throw things over the wall</pre>
</div>
<div title="5 Tips for Cultivating Emotional Intelligence in the Workplace" creator="Steve" modifier="Steve" created="201701121648" modified="201701121730" tags="#codemash 2017" changecount="10">
<pre>Christina Aldan
@luckygirliegirl
  #5TIPS4EQ

!! 5 tips
# Create space - Pause
# Shift Perspective
** If you can't see it from someone else's perspective, you are holding yourself back.
# Get curious
# Make a List
# Be engage-y

Starts with you - self-reflection
&quot;You still have to show up&quot;
Not talking about disconnecting - &quot;I tried fake it or make it, it only works for two months.  You can't contain that crazy&quot;

!!! Self assessment

!!! Behavioral Self Control

4 superpowers
Thoughts
Emotions
Words
Actions

//sounds like think feel act//

!!! Integrity
* How you behave when no one is watching.  How you do one thing is how you do anything.

</pre>
</div>
<div title="7 October 2013" creator="Steve" modifier="Steve" created="201310071131" modified="201310081120" tags="journal" changecount="2">
<pre>Two thoughts:

Looking for an idol:  Realizes code is writing, good at empathy, codes 90% of the time while still being an influential and useful person, realizes coding is usually the least important thing, but has managed to get everything else right so that coding is joy.  Understands that being part of a team is teaching and knows how to present information in such a way that it's understood and need not be repeated.

Coding analogy

Eggs, steel blocks / rocket precision machinery, legos, new</pre>
</div>
<div title="A Critical Step towards #NoEstimates" creator="Steve" modifier="Steve" created="201405141635" tags="estimates" changecount="1">
<pre>http://www.jbrains.ca/permalink/a-critical-step-towards-noestimates

Change language to one of budgets:  //I can afford to spend 2-3 days on this task//

* Parkinson's Law
** work expands so as to fill the time allotted
** &quot;we need something in 2 days&quot; leads to conversations about options

* Task -&gt; Outcome
** Tasks in a plan usually lose sight of the desired outcome
** If we can't get done with this task in 3 days, &quot;what can I give you instead?&quot;
** Lets not argue over the fact that we're lousy at estimating

* Cost -&gt; Value
* Estimates focus on cost and when they turn out to be wrong we focus on &quot;broken commitments&quot; rather than the value of doing this in the first place
* &quot;If you always knew that this task would cost 2 weeks (revised estimate), would you have invested in it anyway?
</pre>
</div>
<div title="A Manager's FAQ" creator="YourName" modifier="YourName" created="201607052208" modified="201607052210" changecount="3">
<pre>Henry Ward - CEO eshares

!! How do I get employees to perform better?
Tell them what they are doing well
* Don't minimize their bad work, maximize their great work.
* Positivity creates more positivity

!! How do I give negative feedback?
By being curious
- Assume you hired rational human beings that want to do a good job - what's keeping them from doing it?
- Have a true curiosity for this - why did you do x?

!! How do I decide what to delegate?
Delegate the work you want to do
// I hate this, but realize it's the correct answer//

!! How should I prioritize?
Fix problems.  Then prevent problems.
&quot;Sprint to the fires&quot;

!! How should I grade employees?
Dont.  Teach them to self-evaluate.
Scoring is easy for orgs to sort and filter, but does the employees no-good.
Ask them how they think they're doing and then offer feedback on that.

!! When do I fire somebody?
When you know they can't succeed
- Do not build a case for firing (perf improvement plans)
- Do it swiftly and humanely

!! How do I fire somebody?
By apologizing for our failures
&quot;Unless you were lied to, it is your fault you're firing him&quot;.  You either hired incorrectly or didn't support him, either way it's your fault.

!! Why can't I just tell people what to do?
Because the more responsibility you have, the less authority you have.
Employees don't have loyalty to you, they have loyalty to their immediate manager.
You need to work on influencing rather than commanding.

!! How do I know if I am a good manager?
Employees ask you for advice

!! How do I know if I have a good management team?
Shit rolls uphill.
If you delegate all the work you want to do, all you're left with is the stuff no one else wants to do.</pre>
</div>
<div title="A Rare Peek Into The Massive Scale of AWS" creator="Steve" modifier="Steve" created="201502101731" changecount="1">
<pre>http://www.enterprisetech.com/2014/11/14/rare-peek-massive-scale-aws/

&lt;&lt;&lt;
The above shows the US East region in Ashburn, Virginia. It has five availability zones, and these are protected areas that are isolated from each other by a couple of kilometers and linked by high-speed, low-latency networks where synchronous replication is possible but there is enough geographic isolation that the odds of two availability zones (housing multiple copies of your data and applications) are very small. The AZ units are connected by optical fibers that use dense wavelength division multiplexing (DWDM) to transport packets between the AZs in the region, and in the case of US East, there are 82,864 fiber strands. The AZs are usually under 1 millisecond apart in terms of latency and are always less than 2 milliseconds apart; this speed is what allows for synchronous data replication, since committing data to a solid state drive takes 㠷ait for it 㠢etween 1 and 2 milliseconds.
&lt;&lt;&lt;

&lt;&lt;&lt;
Now, drill down into one availability zone. The datacenters inside the availability zones in US East are about a quarter of a millisecond apart on the network, and no datacenter spans more than one zone. In fact, as noted above, an AZ can have multiple datacenters, and in fact, US East appears to have ten datacenters even though the chart above says some AZs have as many as six DCs. There are redundant transit centers into the availability zones. So Amazon can lose a transit center and multiple AZs and everything keeps working.
&lt;&lt;&lt;

&lt;&lt;&lt;
A single datacenter has up to 102 Tb/sec of bandwidth allocated to come into it 㠦our times the aggregate inter-AZ bandwidth across the US East region, and Hamilton adds that the bandwidth inside the datacenter is 췩ldly higher�han this 102 Tb/sec.
&lt;&lt;&lt;</pre>
</div>
<div title="AdvancedRubyConcurrency" creator="Steve" modifier="Steve" created="201401101942" tags="#codemash 2014" changecount="1">
<pre>Jerry D'Antonio
@jerrydantonio
github.com/jdantonio

!! From Clojure
* Future
* Agent
** Queues up operations against a value

* hamster gem
** high-perf data structure - immutable

*thread_safe library
** threadsafe agent and hash.  Not immutable.

!! From javascript
* Promise

!! From java
** ScheduledExecutorService
** TimerTask

!! From erlang/scala
** Actor

!! From F#
** Functional actor style

!! From Erlang
** Supervisor

!! Concurrent gem
** has future
*** takes observer
** has agent
*** takes observer
** has promise
** has ScheduledTask
*** Written like a future / same API
** TimerTask
*** takes observer
** Actor
***Actor pools sharing a mailbox
** Channel
*** Functional actor
** Supervisor
*** Can add actors and timer tasks</pre>
</div>
<div title="Adventures in Pair Programming" creator="Steve" modifier="Steve" created="201503061740" changecount="1">
<pre>Even after 15 years, there's a lot of zealotry around pair programming.  Opinions range from &quot;I'd never work on a project that didn't pair&quot; to &quot;Pair programming?  You mean cluster disaster?&quot;.


</pre>
</div>
<div title="AgileApprentice" creator="Steve" modifier="Steve" created="201310012153" changecount="1">
<pre>!!! Issues
* Expert Beginner trap?
* Finding Mentors?

!!! Questions
* How do you know when you've &quot;graduated from an apprenticeship?&quot;
** Smooth transition to full-time work
** Consistently giving back and living up to it
** No longer focused on learning

* Where do I start?
** A fear / personality trait of knowing the whole thing
** Pick one!
** Control your curiosity

* Right tool for the job?
** Don't be afraid to experiment</pre>
</div>
<div title="Akka Actors" creator="Steve" modifier="Steve" created="201306011922" modified="201306012022" tags="pghtechfest scala" changecount="2">
<pre>Josh Sureth - Typesafe

Add more actors - fragment - to specialize information (scatter phase)
Gather phase - re-aggregate back up the heirarchical tree

It's cheap to make an actor - create a new actor to handle results (gatherer actor)

Scala - Akka - create lots of layers of actors to handle recovery and keep the core functional

Akka clustering - works a lot like Riak
 - Supports automatic cluster membership

Weird code
{{{
context.actorFor(rootactorpath(a) / &quot;user&quot; / &quot;singleton&quot; /&quot;search-tree&quot; )
}}}

Clustered routing options
Metrics based routing

Recap:
- Partition state of the system into small pieces - improve concurrency
- Communicate with immutable messages
- Spawn new actors to track temporary state or do dangerous things - keeps the parent safe
- Design app as a topology
- Partition threads on the topoology
 ** Can do the same thing with roles - these 10 nodes are for incoming requests, these 20 nodes are for data processing, etc
 * Bubble errors on the topoloyg
* Keep singleton actors on the leader
* Avoid excessive inter-node messaging
 ** Use statistics based routing
 ** Fragment in 'large pieces'
* Allow time for cluster convergence and fault detection
 ** new nodes think they're the leader until they find out otherwise

Key Point - Design a system that can recover from failure (and be concurrent)
 * auto healing, auto

'' Links ''
github.com/jsuereth/intro-to-actors
Example code (clusters branch)
akka.io</pre>
</div>
<div title="All the little things" creator="Steve" modifier="Steve" created="201505271639" modified="201505271648" changecount="3">
<pre>Sandi Metz - Ruby on Ales 2014

!! Squint test
* change in shape - conditionals
* change in color - multiple levels of abstraction

!! Making changes
Novices feel like they're not allowed to make classes

Feel like you can't create a 20 line class if there is already a 5000 line active record model.  Can you break the pattern without feeling bad?

Procedures are hard to change because there are no seams
- make a seam

!! Duplication is cheaper than the wrong abstraction
The 43 line if statement exists because someone picked an abstraction and got it wrong.  Don't reach too soon for an abstraction.
-- Don't DRY it up as soon as you see it

!! When Inheritance
Shallow and narrow
child uses all the parts of the parent
objects are leaves in the graph
&quot;Duplication is far cheaper than the wrong abstraction&quot;

</pre>
</div>
<div title="Angular2 in plain javascript" creator="Steve" modifier="Steve" created="201601071815" modified="201601081358" tags="#codemash 2016" changecount="2">
<pre>@Theotherzach

http://theotherzach.com/writes/2016/1/7/angular-2-in-plain-javascript
https://github.com/theotherzach/codemash2016-ng2-js</pre>
</div>
<div title="AngularDirectives:Demystified" creator="Steve" modifier="Steve" created="201401101546" modified="201401101641" tags="#codemash 2014" changecount="4">
<pre>http://directivesdemystified.herokuapp.com/#/slides/0
@BrianGenisio
github.com/BrianGenisio/directives
Another directives presentation:  https://www.youtube.com/watch?v=WqmeI5fZcho

* Supporting IE7 in production!

Types of directives
* Behavioral
* Component

!! Component (templates)
ui-codemirror - angular directive to show code snippet in text area

{{{
 App.directive('hello', function() {
  return {
    template: 'hello!'
  };
});
}}}

* Element based directives need a hack in IE8 earlier

* Use templateURL property instead of template to point to an html file
* Angular has a templateCache - used to avoid fetching templates.  Could also override the options.
* Uses grunt task that stringifies/minifies templates and puts it in the templateCache
* App.run runs before compile time

!! Behavior

* The directives are using the same scope as the view
** You usually don't want this

!!! Isolate your scope
{{{
    App.directive('hampsterDanceIsolate', function() {
  return {
    restrict: 'EA',

    scope: {},

    controller: function($scope) {
      $scope.toggle = function() {
        $scope.animated = !$scope.animated;
      };
    },

    templateUrl: '/app/directives/hampster-dance.html'
  };
});
}}}

* You can pass parameters to the isolated scopes
** This is object binding (two-way)
** use '='
{{{
App.directive('hampsterDanceIsolate2', function() {
  return {
    restrict: 'EA',

    scope: {
      animated: '='
    },

    controller: function($scope) {
      $scope.toggle = function() {
        $scope.animated = !$scope.animated;
      }
    },

    templateUrl: '/app/directives/hampster-dance.html'
  };
});
}}}
{{{
&lt;input type=&quot;checkbox&quot; ng-model=&quot;dance&quot; /&gt;

&lt;hampster-dance-isolate2 animated=&quot;dance&quot;&gt;&lt;/hampster-dance-isolate2&gt;
}}}

* Isolate scope string binding
** One way
** Use '@'
{{{
App.directive('interesting', function() {
  return {
    restrict: 'AE',

    scope: {
      'header': '@',
      'footer': '@'
    },

    templateUrl: '/app/directives/interesting.html'
  };
});
}}}

{{{
&lt;div class=&quot;interesting-man&quot;&gt;
  &lt;img src=&quot;/img/man.jpg&quot;&gt;
  &lt;div class=&quot;header&quot;&gt;{{header}}&lt;/div&gt;
  &lt;div class=&quot;footer&quot;&gt;{{footer}}&lt;/div&gt;
&lt;/div&gt;
}}}

{{{
&lt;interesting
  header=&quot;I don't always write directives&quot;
  footer=&quot;But when I do, I isolate my scope&quot;&gt;
&lt;/interesting&gt;
}}}

* Isolate Scope Function Binding
** Directive callsback
** Use '&amp;'

* You can do optional and aliased bindings

!! Lifecycle
* ng-app triggers a &quot;compile&quot;  Go through the DOM and look for interesting directives
* You can override compile and link behavior in directives
* Compiling a directive happens once (and has a link function)
** Run-time modifications to a template
* Linking happens every time the directive is used
** On-load - modify elements and attributes

* This knowledge is important in testing
{{{
describe(&quot;hello directive&quot;, function() {
  var element, scope;

  function bootstrap($rootScope, $compile) {
    var html = &quot;&lt;div hello&gt;&lt;/div&gt;&quot;;
    element = angular.element(html);

    var compositeLink = $compile(element);

    scope = $rootScope.$new();

    compositeLink(scope);

    scope.$digest();
  }

  beforeEach(module('SlidePlayer'));
  beforeEach(inject(function($rootScope, $compile) {
    bootstrap($rootScope, $compile);
  }));

  it(&quot;says hello&quot;, function() {
    expect(element.text()).toBe(&quot;hello!&quot;);
  });
});
}}}

* This is essentially what ng-app does

* $digest
** Processes all of the watchers of the current scope (and it's children)
*** Has this expression changed?

* Angular knows that there's only 4-ish ways to change a page
** After a click for instance, angular calls apply

* $apply
$apply() pseudocode:
{{{
function $apply(expr) {
  try {
    return $eval(expr);
  } catch (e) {
    $exceptionHandler(e);
  } finally {
    $root.$digest();
  }
}
}}}

** You use apply when you know something has changed (outside of angular) and angular needs to figure itself out
*** Say we get/cause an event?
{{{
App.directive('whatDoesTheFoxSay', function() {
  return {
    restrict: 'AE',

    link: function(scope, element, attrs) {
      scope.message = &quot;What does the fox say?&quot;;

      element.click(function() {

        scope.$apply(function() {
          scope.message = &quot;Wa-pa-pa-pa-pa-pa-pow!&quot;;
        });

      });
    },

    template: '&lt;span&gt;{{message}}&lt;/span&gt;'
  };
});
}}}

scope.$apply tells the watcher on the template to update

!! Recursion
* By default you can use recursive tags in a directive - stack overflow!
{{{
App.directive('tree', function(recursionHelper) {
  return {
    restrict: 'AE',
    scope: {
      nodes: '='
    },

    compile: function(tElement) {
      return recursionHelper.compile(tElement);
    },

    templateUrl: '/app/directives/tree.html'
  };
});
}}}
{{{
&lt;ul&gt;
  &lt;li ng-repeat=&quot;(key, value) in nodes&quot;&gt;
    &lt;a ng-click=&quot;hide = !hide&quot;&gt;{{key}}&lt;/a&gt;
    &lt;tree nodes=&quot;value&quot; ng-hide=&quot;hide&quot;&gt;&lt;/tree&gt;
  &lt;/li&gt;
&lt;/ul&gt;
}}}
{{{
// Mark Lagendijk
// http://stackoverflow.com/questions/14430655/recursion-in-angular-directives
App.factory('recursionHelper', function($compile){
  return {
    compile: function(templateElement){

      var contents = templateElement.contents().remove();
      var compiledContents;

      return function(scope, element){
        if(!compiledContents){
          compiledContents = $compile(contents);
        }

        compiledContents(scope, function(clone){
          element.append(clone);
        });
      };
    }
  };
});
}}}

!! Transclusion
* Put my content in the directive
{{{
App.directive('panel', function() {
  return {
    restrict: 'AE',
    transclude: true,
    scope: {
      heading: '@'
    },
    templateUrl: '/app/directives/panel.html'
  };
});
}}}
{{{
&lt;div class=&quot;panel panel-primary&quot;&gt;

  &lt;div class=&quot;panel-heading&quot; ng-if=&quot;heading&quot;&gt;
    &lt;h3 class=&quot;panel-title&quot;&gt;{{heading}}&lt;/h3&gt;
  &lt;/div&gt;

  &lt;div class=&quot;panel-body&quot;&gt;
    &lt;div ng-transclude&gt;&lt;/div&gt;
  &lt;/div&gt;

&lt;/div&gt;
}}}
{{{
&lt;panel heading=&quot;Chuck Norris Facts&quot;&gt;

  &lt;ul&gt;
      &lt;li&gt;First program was `kill -9`&lt;/li&gt;
      &lt;li&gt;Throws exceptions across the room&lt;/li&gt;
      &lt;li&gt;Can divide by zero&lt;/li&gt;
      &lt;li&gt;Writes self-optimizing code&lt;/li&gt;
  &lt;/ul&gt;

&lt;/panel&gt;

}}}

!! Dependncies
!!! Dependent Directives
{{{
&lt;tabs&gt;
  &lt;tab title=&quot;Double Rainbow&quot;&gt;
    &lt;img src=&quot;/img/double-rainbow.jpg&quot; /&gt;
  &lt;/tab&gt;
  &lt;tab title=&quot;Star Wars Kid&quot;&gt;
    &lt;img src=&quot;/img/starwars-kid.jpg&quot; /&gt;
  &lt;/tab&gt;
  &lt;tab title=&quot;Chocolate Rain&quot;&gt;
      &lt;img src=&quot;/img/chocolate-rain.gif&quot; /&gt;
  &lt;/tab&gt;
&lt;/tabs&gt;
}}}

*Tabs need to tell a tab it's selected
* Tab needs to register itself with Tabs

!!!! Tabs
{{{
App.directive('tabs', function() {
  return {
    restrict: 'AE',
    transclude: true,
    scope: {},
    controller: function($scope) {
      $scope.tabs = [];

      $scope.select = function(selected) {
        angular.forEach($scope.tabs, function(tab) {
          tab.selected = tab === selected;
        });
      }

      this.register = function(tab) {
          $scope.tabs.push(tab);
          $scope.select($scope.tabs[0]);
      }
    },
    templateUrl:
      '/app/directives/tabs.html'
  };
});
}}}
{{{
&lt;div class=&quot;tab-list&quot;&gt;
  &lt;ul class=&quot;nav nav-tabs&quot;&gt;
    &lt;li ng-repeat=&quot;tab in tabs&quot; ng-class=&quot;{active:tab.selected}&quot;&gt;
      &lt;a href=&quot;&quot; ng-click=&quot;select(tab);&quot;&gt;
        {{tab.title}}
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
  &lt;div class=&quot;tab-content&quot; ng-transclude&gt;&lt;/div&gt;
&lt;/div&gt;
}}}
{{{
App.directive('tab', function() {
  return {
    require: '^tabs',
    restrict: 'AE',
    transclude: true,
    scope: {
      title: '@'
    },
    link: function(scope, el, attr, tabsCtrl) {
      tabsCtrl.register(scope);
    },
    replace: true,
    templateUrl: '/app/directives/tab.html'
  };
});
}}}
{{{
&lt;div class=&quot;tab-pane&quot;
     ng-class=&quot;{active:selected}&quot;
     ng-transclude&gt;
&lt;/div&gt;
}}}</pre>
</div>
<div title="AngularJS" creator="Steve" modifier="Steve" created="201301170226" modified="201310012326" tags="AngularJS javascript" changecount="5">
<pre>John Lindquite jetbrains http://egghead.io/

Recommends putting properties inside models to avoid wiping out references (model.bacon, avengers.cast)

{{{
  $scope.myMethod = function(param) {
    alert(param)
  }
}}}

!!! ng-repeat
ng-repeat allows pipes to add filters (filter, orderby, limitBy etc)
pipes can be stacked
map a text-field input to a property and pipe into filters
you can add your own filters


{{{
  &lt;ul&gt;
    &lt;li ng-repeat=&quot;member in avengers.cast&quot;&gt;{{member.name}}&lt;/li&gt;
  &lt;/ul&gt;
}}}



!!! ng-app
ties to ng-app &quot;baconApp&quot;

{{{

var app = angular.module= (&quot;baconApp&quot;, [])

app.controller(&quot;BaconCtrl&quot;, function() {
};

}}}


!!! debugging

{{{
  //$0 is the currently selected element
  var s = angular.element($0)
}}}

!!!Services
Services treated as Singletons
{{{

app.service(&quot;AvengersService&quot;, function() {
  this.cast = data
});
}}}

!!! Resources
http://angularjs.org/
http://jsfiddle.net/

!!! Directives
allow to create tags based off templates
</pre>
</div>
<div title="AngularJSLinks" creator="Steve" modifier="Steve" created="201302270257" modified="201310012326" tags="AngularJS javascript" changecount="2">
<pre>May not be useful, but been holding them for awhile

http://docs.angularjs.org/tutorial/the_end
http://localhost:8000/app/index.html#/phones
http://localhost:8000/test/e2e/runner.html
http://jsfiddle.net/vojtajina/js64b/14/</pre>
</div>
<div title="AngularJSLunchAndLearn" creator="Steve" modifier="Steve" created="201302101501" modified="201310012326" tags="AngularJS javascript" changecount="5">
<pre>To show:

repeater
filter
order by
e2e runner

Scenario:
List of devs with skills.  Skills are rated by aptitude and enthusiasm.
How to handle currently booked?  What-if scenarios?

http://localhost:8000/test/e2e/runner.html
http://jsfiddle.net/e9DXU/
http://jsfiddle.net/VX5LE/224/
http://jsfiddle.net/9PHdf/1/</pre>
</div>
<div title="Anti-fragile and feedback" creator="Steve" modifier="Steve" created="201508020134" modified="201508022247" tags="#grows #toread" changecount="12">
<pre>https://vimeo.com/131410262 - Andy Hunt

Agile is not a sprint (series of sprints) or marathon - It's an obstacle course


!!Training for software obstacle course
!!! Grow Skills
* Learn a new programming language a year
* Write same program/function 3 different ways
* Strengthen where you are weak

!!! Develop Awareness
* Standup, Flow, Value
* Keep the conversation ALIVE
* Don't rely on static communication (documentation, backlog)

!!! Disposable Software (React to Change)
* Stop treating software as precious
* Wasting effort in maintainable, extensible, reusable - you can't predict this
* Put effort into making it replaceable
* Helps coupling, cohesion, encapsulation

''If you can't rip out every piece of the software easily, then the design sucks''

!! The principles are more important
But beginner's can't apply principles
They need to do the practices and follow the fine print to learn the principles
Following the fine print is hard, and seems to be pointless until you understand the principle

!! The problem
* One size DOES NOT fit all!
* Misunderstanding the practices and principles
* Little support for beginners
* No method for continuous learning (evolving the practices)
* Anyone who isn't a dev is ignored
* ''Agile methods haven't changed or adapted''

&lt;&lt;&lt;
A development method is just a way of figuring out how to work together.  Everyone.
&lt;&lt;&lt;
&lt;&lt;&lt;
When is it ok to go beyond the rules?
When is a practice good?
&lt;&lt;&lt;
&lt;&lt;&lt;
Practice ''is different'' depending on your skill level.
No one else's experience is the same as yours.
&lt;&lt;&lt;

!!! New method
* Be empirical
* Need different levels
** Beginners cannot self-reflect
* Sensitive to our cognitive limits
* Be inclusive and integrated (no us and them)

!! Pillars of Grows
# Skills Model
# Directed Empirical
# Inclusive (execs, users, etc)
# Self-determined (you decide what works)

!!! Skills Model (Dreyfus)
* Novice
** No experience
** Just want to accomplish a goal
** Just follow the rules
** Novices need steps
* Advanced Beginner
** Don't want the big picture
** Want small, frequent rewards
** Still based on rules
* Competent
** Building models
** Can troubleshoot
* Proficient
** Want to understand the big picture
** Don't like oversimplified explanations
** Looking for patterns
** Can now reflect and self-correct
* Expert
** Source of knowledge
** Work from intuition
** Performance is degraded if they actually follow the rules
** Knows what details are relevant and irrelevant
** Usually bad at explaining how they arrived at a decision

&lt;&lt;&lt;
Skills model is not per person
&lt;&lt;&lt;
** Novice at software development, expert at management, advanced beginner at process

!!! Directed Empiricism
* Make decisions and answer questions based on outcomes
** beware proxies(graphs), theories, estimates
* Feedback loops!
** Intentional, short, real-world, iterative, incremental, anti-fragile
* Don't change or adopt =&gt; experiment and adapt
** Need to put your egg in
** It's just an experiment
* Experiments should be:
** Cheap
** short-term (few weeks at most!)
** generate specific, measurable outcomes
** Conditions and outcomes must be agreed to by the team (all)
** No failures, just learning =&gt; data has been generated.

!!!! The key to writing software:  Is To Write Software
*''This is how to answer questions''
**Try a few and prototype
**Try a few and extrapoloate
**Stick it in front of users

{{{
Pick a tech stack:
We have three competing javascript frameworks.
Let's write hello world in each in one week and see which one we like.
Oh we can't do that.  #2 will take that long to set up.
That's a data point.
}}}


!!! Working on GROWS Method practices
* A playbook (Practices of an Agile Developer ?)</pre>
</div>
<div title="AntiFragile" creator="Steve" modifier="Steve" created="201306301425" modified="201308112305" changecount="9">
<pre>Testing clustring and DR software
If it hurts - do it HARDER
exercise, nutrition, healthcare
science vs engineers

Failure as a non-event
 - Risk + consequences

GameDays - google and amazon
Chaos Monkey, Chaos Gorilla, Latency Monkey

Evolve - discover weaknesses and adapt

Failure as an opportunity to learn
Blameless culture - Fear to innovate - if we're constantly changing and improving, we should fail alot, or we're not doing interesting experiments.

Antifragile talk - rather than trying to make arguments, how about posing hypotheses as questions?

TDD makes failure predictable.  DebugLaterProgramming is expensive and wasteful.  Which system is antifragile?  (Anti-fragile vs robust).

Unit tests as change enablers (vs quality control)
* Feedback
* No fear

!! Links
http://www.goodreads.com/review/show/464463848
http://www.goodreads.com/work/quotes/19092611-antifragile-things-that-gain-from-disorder
http://www.amazon.com/Antifragile-Things-That-Gain-Disorder/dp/1400067820
http://www.amazon.com/The-Black-Swan-Improbable-Robustness/dp/081297381X
http://www.industriallogic.com/blog/why-are-most-agile-adoptions-failing/</pre>
</div>
<div title="Apprentice Review 10 December 2014" creator="Steve" modifier="Steve" created="201412111512" tags="apprentice_review" changecount="1">
<pre>Past:  speakerdeck.smetz

''Mentor TODOs''
* New blog posts
* Nitpick exercism
* Kata Roman Numeral
* Sit down on website

''Think about''
* How do we build confidence in our tools?

''Accomplishments''
* Pull request
* Nitpicks
* Building frontend

''Questions''
* Masonry vs other grid systems - Will took this one

''Feeling''
* Unsure about tool selection</pre>
</div>
<div title="Apprentice Review 10 March 2015" creator="Steve" modifier="Steve" created="201503111227" changecount="1">
<pre>Deploying is a great experience
 * Feelings about going live:  nervous
 * Forgot things (links to pdfs from the old site) - had to scramble and fix

Dealing with frustration - sink or swim, being overwhelmed

Feelings on pairing more
 * Don't like working alone
 * It's hard to externalize thoughts

Preferred &quot;owning&quot; a &quot;real&quot; project to pairing more - wouldn't have changed anything</pre>
</div>
<div title="Apprentice Review 19 December 2014" creator="Steve" modifier="Steve" created="201412191915" modified="201412191917" changecount="5">
<pre>'' Mentor TODOs

'' Accomplishments

* OhioLink Deep Dive

'' Questions

'' Feeling</pre>
</div>
<div title="BDD cross-platform" creator="Steve" modifier="Steve" created="201410011423" modified="201410011424" tags="#cukeup" changecount="8">
<pre>Juan Delgado
@wadus

Driving mobile apps with BDD

Mocked Backend
* Sinatra on a hook
* Data in tag
* Assert against the app

{{{
               Gherkin
Ruby Steps                 Java steps
        |                        |
Calabash            Instrumentation/Robotium
        |                        |
      iOS                   Android
}}}
</pre>
</div>
<div title="Backlog grooming" creator="Steve" modifier="Steve" created="201306011751" modified="201306011921" tags="pghtechfest" changecount="2">
<pre>Backlog stages
 - Freezer, Fridge, Ready to Cook

Backlog metrics
 - Group by types:  Features, Bugs, Technical

Account for all work - technical &quot;stories&quot; should be first class citizens
Backlog grooming is a three amigos type stuff:  Group of people pick apart a story
 - Starts with prioritized, well-defined work

Story:  Along with token for future conversation - A check for understanding

No predetermined roles in grooming meeting</pre>
</div>
<div title="Balanced Team" creator="Steve" modifier="Steve" created="201507211747" changecount="1">
<pre>Nicole and Paolo

muti-disciplinary collaboration
iterative delivery
focused on value

Deep dive - what does success look like writing exercise

Optimizely - A/B testing

Balancing with Clients presentation



</pre>
</div>
<div title="Better Product Definition with Lean UX and Design Thinking" creator="Steve" modifier="Steve" created="201307092046" modified="201307092113" tags="ux" changecount="19">
<pre>* LeanStartup

!! Cornerstones
* How do we measure success?
* Learning over short-term value
* Customer feedback is king
* Experimentation/Feedback drives from the outside
* Experimentation/Collaboration drives from the inside

!! Customer Facing
* Reduce Requirements and Assumptions to Experiments
* Experiment _with_ customers to discover what they want
* Learning is more valuable than customers/revenue/growth - e.g. A/B pricing tests
** Testing/Action/Risk vs Analysis Paralysis/Arguing/Inaction
*Design Thinking = empathy + creativity + rationality
*User Stories as Market Validation Stories (Hypotheses)
** Reqt to Conversation:  Move from &quot;system shall&quot; to &quot;we believe&quot; to &quot;as a, I want, so that&quot;

{{{
  We believe that
        [building this feature]
        [for these people]
        will achieve [this outcome].

   We will know we are successful when we see
        [this signal from the market].
}}}

!! Team Focus
*Emphasis on Shared Understanding vs Deliverables
*Move from delivery of features (output) to business value (outcome)
** Focus teams on outcomes over impact
** Outcomes are less binary (not done/done vs &quot;close enough&quot;)
* Work together / ignore roles
* Test Ideas Ruthlessly

!! Look out for
* Quality is defined by the  ''customer'' not the dev/engineer
** ComplexityInTheServiceOfQuality
*Vanity metrics vs actual use
** Does signing up for a service count as success?  Are they using it?  Will they spend money on it?

!! Product definition assumptions
* Who is our customer?
* What pain points do they have related to our product/service?
* What features are important?
* What is our differentiation?
* What is our business model?</pre>
</div>
<div title="Beyond BDD" creator="Steve" modifier="Steve" created="201410011652" modified="201410011701" tags="#cukeup" changecount="4">
<pre>Matt Wynne @mattwynne

!! Stage 1:  Burned Toast
# Programmers write bugs
# Testers find bugs
# PM prioritize bugs
# Prog fix bugs
# Goto 1

!! Stage 2: Auto Burned Toast
# Programmers write bugs
# Write automated tests
# Tests find bugs
# PM prioritize bugs
# Prog fix bugs
# Goto 1

!! Stage 3: 3 Amigos
# Team defines behavior
# Programmers write bugs
# Write automated tests
# Tests find bugs
# PM prioritize bugs
# Prog fix bugs
# Goto 2

!! Stage 4: Test First
# Team defines behavior
# Automated test for behavior
# Programmers make the tests pass
# Testers find missing scenarios
# Goto 2

''Now you're at BDD''

!! Stage 5:  Disillusionment
# Lots of scenarios
# Build takes ages
# Build normally broken
# Some scenarios flicker
# Poor/mixed readability
# I hate cucumber

** Test value peaks at the time the test is written and drops sharply thereafter
** You don't have to test at the UI - use hexagonal architecture
** Turn testing pyramid 90 degrees and expose more area to test
** Acceptance Tests do NOT have to be full-stack tests

!! Stage 6:  Transcendence
# Problem Domain is well understood by the team
# Solution models the problem well
# Clear architectural boundaries
# Fewer end-to-end tests
# Scenarios are readable
# More Fun!</pre>
</div>
<div title="Big Data Visualization" creator="Steve" modifier="Steve" created="201501082110" modified="201501082145" tags="#codemash" changecount="2">
<pre>David Girard (MSFT evangilist)

What does it mean to say &quot;Best way to display data&quot;?

'The visual display of quantitative information' - Tufte

Brain prefers light to dark better than red to green or whatever.

!!! Graphical Integrity
* Don't lie (Fox news!)
Lie Factor = Size of effect shown in graph / Size of effect in the data
14.8 = 783% / 53%

Be careful using 2d or 3d objects to represent 1d of data.  If the data increases 30% and you change the height of a 2D object by 30% you also grow it's width, making it a 900% change.

* Keep things proportion
* Use real dollars
* Provide context

!!! Data-Ink
* Bar charts tend to use a lot of ink to display very little data
* Remove metadata, lighten what is left.
* SHOW THE DATA
* Iterate, removing things and see if it's &quot;better&quot;

!!! Data Density
* Don't be afraid of density
* small multiples
* spark lines
</pre>
</div>
<div title="Binary Elixir" creator="Steve" modifier="Steve" created="201701121338" modified="201701170157" changecount="5">
<pre>Ole Michaelis
@codestars

https://github.com/nesQuick/elixir-hpack

Writing a parser almost entirely via function defintions.  Look, ma, no ifs!
Writing a binary parser in elixir is a perfect match! -
dnsimple/com/o/ole - free month of dnsimple


!!HPACK
* Compression protocol for headers

static table + dynamic table of columns (keys) to values
2 = method: GET
19 = path (key only) then encode the value:  huffman('/resource')

dynamic table starts at 62
62 = user-agent:Mozilla/5.0

!!! dynamic table
* The dynamic table share between request cycles in a &quot;connection&quot;
* Also shared by streams in the connection
* This makes requests &quot;un-stateless&quot;

!!! pattern matching
x = 1
Looks like assignment
Is actually a pattern match
1 = x

!!! Binaries &amp; Strings
* Strings are binaries
{{{
 defp parse(&lt;&lt; 1::1, rest::bitstring &gt;&gt;, headers, table) do
    { index, rest } = parse_int7(rest)
    hdr = Table.lookup(index, table)
    parse(rest, [hdr | headers], table)
end
}}}

This pattern matches a bye that starts with 1.  So this method handles all bytes that start with 1 (or maybe a byte stream since it's recursive)

{{{
# Figure 7: Literal Header Field with Incremental Indexing — New Name
  defp parse(&lt;&lt; 0::1, 1::1, 0::6, rest::binary&gt;&gt;, headers, table) do
    { name, rest } = parse_string(rest)
    { value, more_headers } = parse_string(rest)
    Table.add({name, value}, table)
    parse(more_headers, [{name, value} | headers], table)
end
}}}

This handles bytes that start with 01 (or maybe a byte stream since it's recursive)

----
{{{
defp parse(&lt;&lt; &gt;&gt;, headers, _), do: Enum.reverse(headers)
}}}

Ok, out of characters.  Reverse the memo to get the headers in the right order
(Pre-pending is faster than appending because lists are linked lists in elixir)

----

Look ma, no ifs!  Strings that start with 1 are huffman encoded.
{{{
  defp parse_string(&lt;&lt; 0::1, rest::bitstring &gt;&gt;) do
    { length, rest } = parse_int7(rest)
    &lt;&lt; value::binary - size(length), rest::binary &gt;&gt; = rest
    { value, rest }
  end

  defp parse_string(&lt;&lt; 1::1, rest::bitstring &gt;&gt;) do
    { length, rest } = parse_int7(rest)
    &lt;&lt; value::binary - size(length), rest::binary &gt;&gt; = rest
    { Huffman.decode(value), rest }
end

}}}

----</pre>
</div>
<div title="Blocked on I/O" creator="Steve" modifier="Steve" created="201703091931" modified="201703091957" tags="#confoo" changecount="4">
<pre>@gergdotca
Don't Block the Event Loop!

Not necessarily IO!


* CPU - 100MB JSON serialization took seconds, crashed the system.
* Deadlock - 2 requests tried to grab a DB connection from the pool (Momoko)
** No stacktrace available
* Out of connections

Real life advice from @gergdotca - If your boss won't give you time to refactor/upgrade, just arrange for that old software to cause a critical production outage.

Beware the hidden non-functional requirement.  We never built the websocket client that needed all this async I/O. </pre>
</div>
<div title="Bower" creator="Steve" modifier="Steve" created="201310012325" tags="javascript" changecount="1">
<pre>* Package manager for the browser
* Can be anything, not just javascript
* can be retrieved via git or http (joe fiorini using S3)
* Semantic versioning via tags</pre>
</div>
<div title="Bringing up our future" creator="Steve" modifier="Steve" created="201601071554" modified="201601071620" tags="#codemash 2016" changecount="10">
<pre>@sadukie

!! Finding mentors
* Within a company
* User Groups
*MentorNet
*mentoring.org

!! Have multiple mentors
* Multiple expertise, multiple perspective

!! Lessons learned
&lt;&lt;&lt;
Leadership is responsibility, not privilege, action, not position, guidance, not knowledge, and outcome, not disposition.
&lt;&lt;&lt;
survivingtheworld.net

* Trust and respect, until burned - be honest with them if they burn you
* Separate opinions from fact
* Demystify questions - use examples, not definitions
* Encourage their curiosity - admit what you don't know
* Learn their strengths and weaknesses
* Do lunch
* Encourage questions - don't use words to impress
* Say I don't know - encourage mentees to say I don't know
* Push them out of their comfort zone
* Encourage personal development
* Respect career paths
* Discourage Imposter Syndrome
* Analysis Paralysis - They don't have the why - take the the time to explain it
* Gender Concerns

&lt;&lt;&lt;
Our mission is to empower every person and every organization on the planet to achieve more
&lt;&lt;&lt;
Microsoft

</pre>
</div>
<div title="Building &quot;serverless&quot; software with AWS Lambda" creator="Steve" modifier="Steve" created="201701121818" modified="201701121848" tags="#codemash 2017" changecount="7">
<pre>@cc_jonknapp
http://whatdoeslambdasupport.com

&quot;People are coming to us with ideas of things that don't exist and they say 'Make it So'&quot;
&quot;I personally would like to be responsible for as little as possible.  Did I mention I'll be a father, soon?&quot;

serverless - js framework

&quot;Serverless is a mindset&quot;  - Relying on amazing work by other people to build your own amazing things.

!!! Objectives
* Get data from 3rd party
* Make it searchable
* Provide search interface

!!! Hidden objectives
* Work with a terrible 3rd party apis
* no tech team to maintain
* unknown load
* small focused codebase
* easy to maintain

!!! New and Shiny!
* Environment variables
* Lambda dead letter queues
* API gateway supports ANY and star routes
* Modify cloud front headers on requests at endpoint
* Upgraded node
* SAM file (Serverless Application Model)
* KMS integration to encrypt/decrypt env values

!!! Lessons Learned
* Log vigorously
* Use error notification service
* API gateway is not great for complicated things (run your own tests)
* API gateway works with Swagger (kind of) - http://swagger.io/
* Think of your app in discrete parts
* Learn IAM roles</pre>
</div>
<div title="Building DSLs in Javascript and Coffeescript" creator="Steve" modifier="Steve" created="201501091959" modified="201501151424" tags="#codemash" changecount="4">
<pre>Dave Mosher @dmosher
https://speakerdeck.com/dmosher/building-dsls-with-javascript-and-coffeescript
https://bitly.com/bundles/dmosher/8

extend.js + Namespacing
- creates or appends for a namespage/object string


{{{
extend('app.views.config', {})
}}}

vs
{{{
app.views.config = {}
}}}



! Why should I care
*Meaningful semantics
*Extend erd party
*web components

&quot;KendoUI has a wrapper for angular&quot;

ng-directive example:  bitly.com/bundles/dmosher/8</pre>
</div>
<div title="Business rails docker" creator="Steve" modifier="Steve" created="201501081558" modified="201501081805" tags="#codemash" changecount="3">
<pre>Michael Danko
@mikedanko

registry, containers, images

docker handles deployment, no god, monit, capistrano

fig - links stuff?

very fast

ubuntu core - 100MB, autoupdates

Mesosphere - manage containers

Can replace vagrant - this docker image is the same thing as production

matrix builds

flynn, deis - mini PaaS
dokku - micro PaaS (single instance)


!!! Questions
compare against packer
kernel level changes?</pre>
</div>
<div title="CAS Links" creator="Steve" modifier="Steve" created="201306291657" modified="201306291700" tags="cas" changecount="3">
<pre>java audit framework - Google Search
https://www.google.com/search?q=java+audit+framework&amp;oq=java+audit+&amp;aqs=chrome.1.57j0l3j62l2.4830j0&amp;sourceid=chrome&amp;ie=UTF-8

Eclipse BIRT and JasperReports | My Tech Tip
http://www.mytechtip.com/2011/04/eclipse-birt-and-jasperreports_6325.html

Experience is might!: BIRT vs JasperReports comparison
http://xmight.blogspot.com/2012/03/birt-vs-jasperreports-comparison.html

Birt Queries: Birt vs Jasper
http://birtgrip.blogspot.com/2012/10/birt-vs-jasper.html

CFR - Code of Federal Regulations Title 21
http://www.accessdata.fda.gov/scripts/cdrh/cfdocs/cfCFR/CFRSearch.cfm?CFRPart=11&amp;showFR=1

URL List from Saturday, Jun. 29 2013 12:57 PM

To copy this list, type [Ctrl] A, then type [Ctrl] C.

airblade/paper_trail נGitHub
https://github.com/airblade/paper_trail

Overview (Spring Data JPA 1.3.2.RELEASE API)
http://static.springsource.org/spring-data/data-jpa/docs/1.3.2.RELEASE/api/

Inspektr Auditing נdima767/inspektr Wiki
https://github.com/dima767/inspektr/wiki/Inspektr-Auditing

java - Business Audit log - recommended library or approach? - Stack Overflow
http://stackoverflow.com/questions/3778281/business-audit-log-recommended-library-or-approach

License
http://logback.qos.ch/license.html

Logback-Audit Manual
http://audit.qos.ch/manual/index.html

Chapter 1: Introduction
http://audit.qos.ch/manual/introduction.html

Chapter 2: Server
http://audit.qos.ch/manual/Running_the_Server.html

Chapter 3: The Contents of Audit Messages
http://audit.qos.ch/manual/Invoking_lba.html

LOGBACK-AUDIT FAQ
http://audit.qos.ch/faq.html</pre>
</div>
<div title="CAS spike" creator="Steve" modifier="Steve" created="201306291700" modified="201306291700" tags="cas" changecount="2">
<pre>Use appfuse to set up spring/hibernate app and try to plug in audit framework</pre>
</div>
<div title="CSS lunch and learn nexia" creator="Steve" modifier="Steve" created="201709121415" modified="201709121417" changecount="5">
<pre>Jacob Smith 0025 and Stephen Scott

glitch
&lt;ul&gt; whenever you have the same thing repeated

so 
{{{ &lt;ul&gt;&lt;li /&gt;&lt;li /&gt;&lt;li /&gt;&lt;/li /&gt;&lt;/ul&gt; }}} to show 4 side-by-side boxes (instead of floated &lt;div&gt;)

Double underscore or hyphen to show the difference between location and a type
{{{ panel-block__title }}}
{{{ panel-block__header }}}

 {{{ overflow: hidden }}} lets you do clearfix on the parent, whereas {{{ clear: both }}} is for a sibling (that you might add just to make the styles work)</pre>
</div>
<div title="Can Flat Orgs scale?" creator="Steve" modifier="Steve" created="201601071951" modified="201601081358" tags="#codemash 2016" changecount="2">
<pre>Careevolution
- No

90  - 70 software devs, 20 clinical specialists
Distributed org - 30 in Ann Arbor

!!! Structure
1.  Single Owner
1.  89 non-owners

Only flat because it works for them.
Minimal Viable Process - is this actually a problem or a one-off thing?
&quot;Controlled Chaos&quot; - embrace that somethings will be ad hoc / informal

!!! HR
* Have to be careful hiring
* Look for people comfortable with ambiguity and have a bias towards action
* Use partner/mentor system to help new hires</pre>
</div>
<div title="Carl goes to SOLID" creator="Steve" modifier="Steve" created="201507161641" changecount="1">
<pre>Takeaways
* We're doing things right


Automatic - car diagnostic and tracking
nascent object - send CAD get object with circuits embedded
</pre>
</div>
<div title="Cheap web hosting" creator="Steve" modifier="Steve" created="201407062028" tags="givecamp" changecount="1">
<pre>smallorange - starting at $3/month - very limited, lots of tiers
squarespace - $8/month - comes with e-commerce, reasonable limits
mediatemple - $20/month shared/grid, $30/month for wordpress specific
digital ocean - start at $5/month very limited, $10/month reasonable - a Virtual private server, not a web host
</pre>
</div>
<div title="Chipping away at the monolith with Go" creator="Steve" modifier="Steve" created="201701121422" modified="201701121501" tags="#codemash 2017" changecount="4">
<pre>Aaron Salvo
https://twitter.com/naunga

16 year old service with 4.1 million lines of code

!!!Interfaces
Interface = List of 0 or more functions
Implemented implicitly
Empty interface types accept any type - 0 functions satisfy the interface!

{{{
  type capitalized interface {
    Capitalize() string
  }
}}}

!! Go Kit

Toolkit to solve common problems in distributed systems
* logging
* instrumentation
* transport layers
* rate limiting
* service discovery

GoKit - opinionated that requests should look like RPC - requests have a structure, need to be decoded, responses are encoded


!!! How Go applies to microservices
* Concurrent programming
* Runtime reflection
* GC
* End up with a single statically binary

!!! Drawbacks
* Go get doesn't have a good dependency management system.  Semantic versioning is a problem.
* Does have vendored libraries


</pre>
</div>
<div title="Church of Interruption" creator="Steve" modifier="Steve" created="201508072001" modified="201508072004" changecount="4">
<pre>http://diiq.org/#/blog/church-of-interruption?page=the_church_of_interruption

||I Interrupt | I wait for you to finish |
|I Let You Interrupt| Church of Interruption | The Meek |
|I will say my piece no matter what | Barkers | The Church of Strong Civility |

THE HOLY CREEDO OF THE CHURCH OF INTERRUPTION:
# Thou shalt interrupt when thou understand鳴.
# Thou shalt speak until I interrupt.
# Thou shalt use physical cues to indicate when I ought continue talking.

DOCTRINES OF THE CHURCH OF STRONG CIVILITY
# Thou shalt not interrupt.
# Thou shalt speak briefly.
# Thou shalt use physical cues to indicate your understanding and desire to speak.

Interruptors will interrupt to indicated understanding and use physical cues to keep you talking.
Civility will never interrupt and will use physical cues to indicate you should stop talking.</pre>
</div>
<div title="Circuit Breakers" creator="Steve" modifier="Steve" created="201703091608" modified="201703091608" tags="#confoo" changecount="3">
<pre>@scott_triglia
https://www.slideshare.net/ScottTriglia/protect-your-users-with-circuit-breakers-72991406

Feature flag are just manual circuit breakers</pre>
</div>
<div title="Code Change Complexity" creator="Steve" modifier="Steve" created="201404091640" tags="TechDebt" changecount="1">
<pre>https://michaelfeathers.silvrback.com/code-change-complexity

Algorithmic complexity as a metaphor for code change.
O(1) - only one file has to change
O(n)  - changing from SQL to NoSql in a badly encapuslated code base

Label code changes between O(1) and O(n)</pre>
</div>
<div title="Code:  Debugging the Gender Gap" creator="Steve" modifier="Steve" created="201611111555" modified="201611120110" changecount="5">
<pre>11/11/2017 - @Hyland, with @Tech_Elevator

Gisted:  https://gist.github.com/stevenjackson/89834917efdf1aa0fcfd0cc7412b42db

&quot;The jobs are here, we don't have the workers to fill them&quot;

!! Review

* It was good, I'm glad I saw it.  I'm not sure who the intended audience was, sometimes young women, sometimes corporate leaders?
* The first half of it didn't keep my attention, but it's a nice intro if you don't understand why this is important and the importance of women to the field.
* The second half was much more powerful to me, more current examples of women trying to fight &quot;the man&quot; and why it's hard.
* They touched lightly on solutions, but it was kinda disappointing.  Fight stereotypes, create more role models.
* The only solution presented for a company:  Spend lots of money, recruit out of bootcamps, grow talent, fight to retain.
* http://shescoding.org/ for more.


!! Outline

* Everyone should know something about CS
** Code is everywhere
** Teaches problem solving skills, need to be precise and creative

* Role Models are important
** Unfortunately most female role models are historical
** Need more Grace Hoppers

* Women were the first programmers -&gt; Now there are few
** In the 50s companies started filtering out woman by marketing programmers as &quot;conquerers of the electronic machine&quot;
** Hacker culture took this a step farther:  young, male, antisocial, slobs, focused on domination and anarchy
** Brogrammer culture ratcheted it up a few more notches

* Pipeline is the problem
** We need to reach everyone with the talent and give them the skills

* Raising boys and girls differently changes the way their brains function
** Has nothing to do with innate ability
** CS should be required curriculum (it is in 5 countries and emphasized in a dozen more)
** Not enough teachers in US

* We need more diversity on teams to build solutions that positively impact people
** (other than white men)
** Airbags killed a lot of woman and children because there were designed based on the engineering team's physicality

* Grace Hopper was awesome

* Stereotypes are holding us back
** &quot;Girls are bad at math&quot;
** Normal frustrations caused by the work cause you to &quot;feel&quot; the stereotype a bit more.  You waste energy trying to fight through that.
** Girls are conditioned to appear &quot;average&quot; at math and science starting in high school
** College is worse, more active discouragment: &quot;You won't like this&quot;

* Hard for women to be encouraging
** Please join this field where you will certainly be belittled and sexually harassed!
** Death by 1000 cuts - unconscious bias
** Women leave tech because they don't want to be &quot;that woman&quot; who speaks up about sexist behavior
** Being excellent isn't good enough
</pre>
</div>
<div title="CodeMash" creator="Steve" modifier="Steve" created="201301170215" modified="201301170302" changecount="16">
<pre>http://icodemash.com/
Jan 10-11 2013

Neal Ford - Evolutionary Architecture and Emergent Design (Devworks)

IntroToAndroid

ParseApp

PizzaAndHelicopters

TheCaseForNovices

''Functional Superiority With Clojure''
* OOP/D is good for GUIs - a button is a natural for inheritence, it sends messages, has behavior, etc.
* It's not good for everything else - shared data, object graphs, etc add complexity, and are difficult to parallelize.

ScalaAsABetterJava

GettingYourCustomerToWriteAcceptanceTests

''Scala/Play hack''  https://github.com/jamesward/seminarmash

AngularJS</pre>
</div>
<div title="CodeMash 2.0.1.4" creator="Steve" modifier="Steve" created="201401151742" modified="201401181701" tags="#codemash 2014" changecount="3">
<pre>https://github.com/TechConf/CodeMash2014

Leon Gersing's Speaking pre-compiler was a great experience.  This was a hands-on session with opportunities to practice speaking and get immediate coaching on things like diction, energy, and projection.  It was structured as a master class, where the attendee presents material and Leon repeatedly stopped the presentation to make suggestions for dramatic and subtle improvements.  Leon guided presenters through identifying their narrative structure and building a better talk.

The Elixir pre-compiler was an interesting look at a newer functional language that's rapidly gaining interest.  Elixir is a dynamic language built on-top of the Erlang Virtual Machine and is designed to build distributed fault-tolerant applications.  Ryan Cromwell and Chris McCord spent the morning leading the class through the syntax and structure of an elixir program.  In the afternoon, the focus shifted to making a distributed application, using all the attendees, to perform a DDoS/build a tweet aggregator.  Here the power of Erlang and OTP mixed with the simplicity of Elixir to make a compelling case for the language.  Nodes were brought on-line and integrated into the mesh with very little ceremony.  The Erlang/Elixir philosophy of error handling blew some minds: just let it die and configure your program to start a new process.  With the ability to create several thousand processes per application, one can quickly grasp how distributed, concurrent and fault-tolerant a system built in this way could become.

Jeremy Edberg of Netflix gave an interesting talk about how Netflix is architected.  This talk went deeper than just talking about pieces and parts; Jeremy made a compelling argument for the culture of Netflix and how they value responsibility and independence over carefully gated processes and unified architecture.  Their culture assumes everything is automated, redundant and repeatable.  They recognize that blame is pointless and have built the famous Netflix Simian Army to take down nodes and services - in production - and actively find problems to resolve.  Jeremy also talked about some of the challenges Netflix has had scaling with Amazon and a number of cool tools they've built.  Many are open-sourced and will continue to be.  [link: https://github.com/Netflix].  Their build process was particularly interesting as they've taken continuous delivery to an interesting end - every commit spins up a new amazon cluster with the latest image and directs traffic to it.

The Secrets of Clojure Web Development was a fast-paced ride through the bleeding edge of web development in clojure.  Clinton Dreisbach's enthusiasm for this language and its ecosystem was infectious.  He compared a number of tools to rails equivalents and made it easy to understand how the tools are used and why they might be attractive.  Liberator was very interesting, Clinton managed to build a fully compliant REST API in a handful of lines of clojure.  The demonstration of HTTP Kit was also impressive.  The combination of a functional language and streaming over web sockets seemed very attractive for those scenarios where there is a lot of data to move and HTTP is the least painful way to get it there.

There were also some more advanced sessions that were attended.  Brian Genisio gave an in-depth overview of AngularJS directives that was well done.  Directives are a difficult concept to grasp and Brian did a nice job of working through all the options and presenting some entertaining examples that kept the audience engaged.  With directives a developer can essentially extend html and create semantic or domain-specific tags that can be re-used through the application.  An intuitively functional &lt;tab&gt; html element in a &lt;tabs&gt; container is a common example that most web developers would love to have.  Jerry D'Antonio gave an interesting talk on ruby concurrency and explained examples of concurrency constructs from other languages like clojure, javascript, erlang, scala, and F#.  He &quot;concurrently&quot; presented the same abstraction re-written in ruby using the ruby-concurrency gem.  This provides an interesting alternative for building those applications that would benefit from concurrent constructs.

A possible highlight of the conference was the lightning talks.  Corey Haines did a magnificent job hosting in what appeared to be a crushed velvet dinner jacket.  Most of the talks were good to great, but Gary Bernhardt stole the show with &quot;Useing You're Type's Good&quot; [link: https://www.destroyallsoftware.com/talks/useing-youre-types-good]</pre>
</div>
<div title="CodeRules" creator="Steve" modifier="Steve" created="201309221804" changecount="1">
<pre>http://www.bennadel.com/resources/uploads/2012/ObjectCalisthenics.pdf

Rules 1-4 are pretty pragmatic:
1. One level of indentation per method
2. Don鴠use the ELSE keyword
3. Wrap all primitives and Strings
4. First class collections


http://blog.crisp.se/2013/07/12/henrikkniberg/the-solution-to-technical-debt</pre>
</div>
<div title="Cohesion and Coupling" creator="Steve" modifier="Steve" created="201307231550" modified="201307281736" changecount="5">
<pre>http://www.youtube.com/watch?v=hd0v72pD1MI
High cohesion
* easy to find where a change needs to occur
* limits scope of the change
Low coupling - easy to make a change

Cohesion as explict coupling

!! Cohesion as coupling within a shell:

*Two methods that need to change together are coupled, but the class that contains them is cohesive - for instance readConfig and writeConfig

*What story is your method telling - what story is your class telling?

* If something is stable (rarely changes) can we take advantage of that and use it to couple things together?
** How do you know it won't change?

* Coupling only matters when things change - so something that's tightly coupled might be ok - it's a potential energy vs kinetic energy concern.

!! Detecting coupling
* Detect coupling by looking at diffs (see the trends of things changing together)
* Turbulence, NDepend
* Look at when a file was created vs when it was last changed.  Churning files vs encapsulated ones.
* Things should be easy to name and easy to find - fiddling with cohesion/coupling should help

!! Cohesion vs Coupling - Which is more important
* In general, I've worried about coupling because I have so much battle damage from dealing with code that's hard to change
* Dale Emery:  Focusing on cohesion means you have to improve the names, coupling does not force that
* JB - it seems like one feeds off the other.  So it's more of a question of which you should start with
* Kent - theoretically everything can be coupled to everything else.  So by focusing on cohesion I can limit my scope and avoid thinking about all those potential connections.
* Dale - There are many ways to detect coupling - I just have to be aware of the pain of change and address it then.  Our tools don't help us with cohesion.
</pre>
</div>
<div title="CollaborativeEnvironment" creator="Steve" modifier="Steve" created="201310012311" modified="201310012314" tags="agile coaching" changecount="5">
<pre>Cutting an Agile Groove - David Hussman   http://devjam.com/2013/07/12/cutting-an-agile-groove-overview/

!!! Dude's Law
Value = WHY / HOW

Do you  start with why on a given practice?

!!! WHY
Why Collaborative Environment?  Visualize, Create, Inform, Fun, Build Community

!!! Environment Checklist
* Do you have real information radiating?
* Connecting Remote Teams?
* Space for Design?
**Table over whiteboard
{{{
      3D       2D
}}}
* Do your tools serve you?
** Test-drive your tools

!!! Key Questions
* How much time should we take to figure out where we're going?</pre>
</div>
<div title="Combinatory Logic" creator="Steve" modifier="Steve" created="201303311148" changecount="1">
<pre>Combinatory Logic was invented by Moses Sch殦inkel and Haskell Curry to to eliminate the need for variables in mathematical logic.  A combinator is a higher-order function that uses only function application and earlier defined combinators to define a result from its arguments.

This elminates the need for temporary variables and procedural logic.  Instead it provides a way of thinking about common problems in terms of functions.

Combinatory Logic is a building block for good functional programming.  Reginald Braithwaite wrote a series of posts and an e-book to explain using combinators in ruby or JS.  The idea is to pick a language you're comfortable with and stretch it to learn functional paradigms, rather than learning a language and FP at the same time.  He uses songbird metaphors to describe each combinator.

https://leanpub.com/combinators
https://github.com/raganwald/homoiconic/blob/master/2008-10-31/songs_of_the_cardinal.markdown#readme</pre>
</div>
<div title="ComplexityInTheServiceOfQuality" creator="Steve" modifier="Steve" created="201307092053" modified="201307092053" tags="Antifragile" changecount="2">
<pre>* Architecture is dependent on a world view for a customer use case.  Change the use case and all that architecture becomes debt.
* Do root cause analysis (5 Why's) on every &quot;mistake&quot;.  Learn about your system and how customers ''actually'' use it.  Optimize __that__ quality.
*Go fast with discipline</pre>
</div>
<div title="Component-Based Javascript using Flight.js" creator="Steve" modifier="Steve" created="201601081634" modified="201601082132" tags="#codemash 2016" changecount="4">
<pre>Joel

http://flightjs.github.io/
Not MV*

Component:  js has reference to DOM node and can manipulate that DOM.  Can listen to and trigger events using that DOM node, so it's easy to integrate with existing js.
Attributes:  &quot;member&quot; variables for the component
Inititalizer:  Used for setup

Attaches to each match of the selector.

Can only talk to it via events after it's initialized.
Attributes can be defaulted and overridden, or required.

Mixins - work like modules in ruby, add functions to `this`

Advice - Like aspects or hooks.  Gives you before and after hooks for your functions.</pre>
</div>
<div title="Control Computer With Your Brain" creator="Steve" modifier="Steve" created="201501091442" modified="201501091542" tags="#codemash" changecount="4">
<pre>Dan Kacenjar @kacenjar

! OpenBCI
openbci.com
* Org
* $499 for 8 bit board
* EEG(brain), EMG(muscle), ECG (heart)
* Based on arduino uno

!! BCI is hard
* Variable per person
* small signals in a noisy environment (low SNR)
* signal theory, cognitive science, neuroscience

!! Board components
* TI ADS1299
** low noise 8 channel, 24bit analog for bio measurements
** SPI provides i/o to arduino
* LIS3DH 3 axis accelerometer
* ATmega328P microcontroller
** arduino compatible
*** don't need an arduino
* RFduino
** BTLE (4.0)

* OBCI USB dongle
** RFDuino
** connects BCI to PC
** requires FTDI VCP (virtual comm port) driver

board &lt;-- BLE --&gt; dongle &lt;-- serial --&gt; PC

!! Block diagram
3 bytes of data per channel
2 bytes for each axis in the accelerometer (xyz)


!! Programming
* Can use Arduino IDE
* Showed example using Processing (http://playground.arduino.cc/Interfacing/Processing)

!! OpenBCI client software
* has it's own client

</pre>
</div>
<div title="Conversational patterns in BDD" creator="Steve" modifier="Steve" created="201409141250" changecount="1">
<pre>http://lizkeogh.com/2011/09/22/conversational-patterns-in-bdd/

!! Context Questioning
* 쉳 there any other context which, when this event happens, will produce a different outcome?튪 What do we do when &quot;Given&quot; isn't true

!! Outcome Questioning
* 쇩ven this context, when this event happens, is there another outcome that鳠important? Something we missed, perhaps?튪 If pixies were doing this instead of software, would it be enough? Or do they need to do something else, too?튊</pre>
</div>
<div title="Corey Haines - 4 rules of simple design (Ruby Rogues)" creator="YourName" modifier="YourName" created="201607052030" changecount="1">
<pre>!!! Indirection
&quot;Indirection should add meaning, not hide it&quot; - Jessica Kerr

!!! Naming
&quot;Name objects for what they're responsible for&quot; - Corey

eg. ProcessesPayment
C# - IDoSomething =&gt; ITranslateToSoftwareDeliverySystem =&gt; class TranslatesToSMS implments ITranslateToSoftwareDeliverySystem

!!! Testing Pain
If you're doing test first, you change the tests
If you're test-driven, you change the design

</pre>
</div>
<div title="Corey Haines BAWCH #1" creator="Steve" modifier="Steve" created="201301170257" changecount="1">
<pre>Determining business value vs Dispelling ignorance
 - Determining most valuable feature is usually a hand-waving exercise of varied opinions.  Instead equate &quot;providing value&quot; to &quot;providing knowledge about the system to build&quot;

Why a pentagon for needed CR features?
 - So you can draw arrows from below
 - Feature support diagrams
Ask questions about the features and figure out what other features can determine the answers to those questions
 - The feature that answers the most questions and has the fewest questions about it shows the highest amount of value (core feature)
----

Corey likes to start on the simplest case when writing cukes - the degenerate case.  (0th case)

Meat based automation - after the cukes are written but you ned lots of changes at the integration level to get those passing - just use the refresh button and verify by eye - then verify the cukes pass

----

Use cucumber setup steps to drive out the behavior a controller or some integration layer needs
 - Move code from the tests to the views to the controller (and keep going).  Start with hardcoded data until you get it down to the point where it makes sense to introduce retrieval

Feature support diagram -&gt; Cuke -&gt; hard coded view -&gt; hard coded controller -&gt; ...
</pre>
</div>
<div title="Cost/Benefit of Test Automation" creator="Steve" modifier="Steve" created="201312142212" changecount="1">
<pre>http://blog.mattwynne.net/2013/11/18/costs-and-benefits-of-test-automation/

&quot;It鳠important for each test to justify its existence in your test suite.&quot; - Does it have more value than it's cost?

Benefits:
* Thorough analysis of a requirement
* Confidence to refactor (regression protection)
* Fast feedback
* Repeatable test
* Living documentation
* Less manual testing
* Time for exploratory testing
* Team collaboration (ATDD)

Costs
* Time spent learning how to write test
* Time spent writing test
* Time waiting for test to run
* Maintenance time
* False sense of security while tests are passing
</pre>
</div>
<div title="Crucial Conversations" creator="Steve" modifier="Steve" created="201507172010" modified="201701051558" tags="#bookclub" changecount="9">
<pre>!!! Successful conversators

1)  Know what they want
2) Don't make either/or choices

* How would I behave if I really want this?
* What do I want for everyone?
* What don't I want?
* How can I get what I want and not what I don't want?

! Book notes

!! Chapter 2 The Power of Dialog
* Be 100% honest and 100% kind
* Find a way to get all the relevant information into the open

//Because of a shared understanding people willingly act on decisions with conviction//
//You buy in when you understand//

!! Chapter 3 Start with Heart
(Know what you want)
* Start high-risk conversations with the right motives.  Stay focused.
* &quot;What do I want here?&quot;
* &quot;How would I behave if I wanted that&quot;

!! Chapter 4 - Learn to Look
(Is it safe for people to be honest?)

* How do people feel?
* Are they holding back?

How do I know I'm in a crucial conversation?  - Look for people who are afraid.

!! Chapter 5  Make it Safe
//There's this undercurrent of &quot;don't pay attention to the content&quot;, or at least &quot;pay more attention to the conditions&quot;.  Which is how I talk to my children and it's exhausting.//
* &quot;What is our mutual purpose&quot;
* &quot;Do others believe I care about their goals?&quot;
* &quot;Do they trust my motives?&quot;
* &quot;Do they believe I respect them?&quot;

!!! Making it safe again
(after screwing up)
* Apologize sincerely
** Only if you're really sorry you did and it's appropriate - don't apologize because some over-reacted
* Contrasting
** &quot;I don't want to say/come across/imply x.  I do think y&quot;



!! Chapter 6 Master my Stories
Something happens (Observable Fact) -&gt; Tell yourself a story about it -&gt; Feel -&gt; Act
Cody doesn't text me back -&gt; He obviously doesn't really want to come see me -&gt; Disappointed, angry -&gt; Ignore him

* Am I pretending not to notice my role in the problem?
* What do I want?  What would I do right now if I really wanted that?

!! Chapter 7 STATE My path

* Pause for 4 seconds
* EXPLICIT purpose of conversation
** We're explicitly here to come together, not for one party to win
** //You only need to be explicit during crucial conversations?//

!!! When something that makes me feel bad happens
* Think about what I really want
* Think of possible explanations for their behavior - try to get in a place where they're not the worst person in the world
* Start dialog - Confirm your impression before starting a confrontation.  There's time for confrontation later if they are, in fact, the worst person in the world.

!! Chapter 8 Explore Others Paths
(Help them get to dialog as well)

* Ask for their view
* Mirror - Acknowledge the way they feel
* Paraphrase - Show you are listening and that you're trying to understand
* Prime - If nothing else works, offer a guess about how they might be feeling/thinking

* Agree - Be sure to agree when you share common ground
* Build - If you agree, but feel like something is being left out, agree and then add your thing
* Compare - If you disagree, don't say they're wrong.  Present the two views and acknowledge that there is a disagreement here.

!! Chapter 9 Move to Action
Dialog is not decision making

*Command
*Consult
*Vote
*Consensus

//Orgs use consensus on things that don't matter and command-style on those that do//

!!! How to choose
1) Who cares?  Don't involve people who don't care.
2) Who knows?  Find the experts.  Don't involve people who contribute no new information.
3) Who must agree?  Whose cooperation/authority/influence do we need?
4) How many people do we need?  Fewer is better.  Do we have enough people to make a good choice?  Do we need others to get their commitment?

//The goal of a leader is to be completely informed and *choose* to not impose their opinion in most situations.//

!!! Assignments

* Saying a group will do the work is foolish (our problem, not my problem)
* Someone must be assigned to keep everyone accountable

</pre>
</div>
<div title="Crystal" creator="Steve" modifier="Steve" created="201611042102" tags="hangout jerry" changecount="1">
<pre>TD hangout: Oct 19

Crystal - statically compiled to be syntactically similar to ruby

* perf improvement in sidekiq
* Uses macros for metaprogramming
* Only use crystal at mac and linux (llvm)

!!! types
nil is a type (check for nil at compile time)
Union types
(string|nil)

!!! cool stuff
go like channels (not parallel, but non-blocking)
c bindings

!!! Distribution story kinda sucks
It's ok for dependency (can specify github repos)</pre>
</div>
<div title="Cucumber for embedded" creator="Steve" modifier="Steve" created="201410011721" tags="#cukeup" changecount="1">
<pre>Itamar Hasin @itababy

Relies entirely on Wire protocol (Cucumber Recipe #15)

!!! Remote control
Off board cuke -&gt; Wire -&gt; Listener -&gt; Network -&gt; Target
Pro:  Target untouched
Con: All APIs must be exposed to the network


!!! IN-SITU
Cucumber -&gt; Network -&gt; Listener -&gt; Target
 (Listener is on-board)

Pro:  No APIs exposed
Con: Server part of codebase
Con: Need memory for wire listener

!!! Gateway
Cucumber -&gt; Gateway -&gt; Multiple devices
Orchestrates/Switchboard to multiple devices

Implements wire protcol and dispatches either to another wire protocol listener (in-situ) or translates wire protocol to network or serial commands against the  target.</pre>
</div>
<div title="CucumberFutureAslak" creator="Steve" modifier="Steve" created="201309171428" tags="cukeup" changecount="1">
<pre>Cucumber2 - rewrite of ruby version
Gherkin3
cucumber-android - built on cucumber-jvm

!! cucumber-ltd/cucumber.pro
* Online collaborative cukes
* Backed by github, bitpucket, dropbox
* Tight integration with travis-ci
* Runs cukes
* Realtime synced collaboratin - as you type
* Doesn't run cukes, mostly ties to CI jobs and shows report
* Free for open source

share.js - used for the real-time piece
</pre>
</div>
<div title="CukeupNYC 2014" creator="Steve" modifier="Steve" created="201410011413" modified="201410011651" tags="#cukeup" changecount="12">
<pre>Aslak:
BDD = Let's have a conversation -&gt; Examples
Important for examples to be concrete
* Foundation for exploring
* Concrete examples are easier to automate

----
Daniel Wellman @wellman
Alternate step for same gherkin - use ENV variables

----
 ** Please use cucumber pro - we need feedback **
</pre>
</div>
<div title="CukeupRandom" creator="Steve" modifier="Steve" created="201309181745" modified="201309191441" tags="#cukeup" changecount="4">
<pre>!!! Ian Dees @undees - Testing embedded

* Mongoose - C Web server - small mostly compatible
* White - Win32 API testing
* rxtx.jar

!!! Richard Lawrence @rslawrence - Story workshop

* Data Personas - Clumps of data that seem to get passed around
** A clump or search criteria
** Personas file to store the data in - like datamagic.yml I guess
Might be a good solution if you have more than one default dataset

!!! Oscar Rieken

* 2700 cukes in 7-10 minutes
* 400 nodes
* Looking at MogoTest and Narcissus for browser testing


!!! Ian Dees @undees - Elixr, Cucumberl

Q:  Can you run erlang in elixr?  Port cucubmerl to elixr - run every scenario in a process - massive multithreading
</pre>
</div>
<div title="DARPA Challenge" creator="Steve" modifier="Steve" created="201507172030" changecount="1">
<pre>Dr. Wayne Newman - CWRU

* Uses planar selection to tell the Atlas robot where walls and surfaces are //Shared understanding//
* Teleoperation is out - takes forever.
* Compliant Motion Control - teach the robot skills it can apply
* Ask the robot what it ''can'' do
** Lots of rejected commands
** &quot;If you ask for the impossible you rarely get something desirable&quot;</pre>
</div>
<div title="Data Viz With D3" creator="Steve" modifier="Steve" created="201701101334" modified="201701161437" tags="#codemash 2017" changecount="11">
<pre>@dshultz
@doug_mair
Mike Bobcock - Inventor of D3
presentation - http://codepen.io/team/Dan/pen/JbbBGq


!!! TODO
Play with meteorite strike example, fix states example

http://codepen.io/team/Dan/pen/GrRJoZ
http://codepen.io/stevenjackson/pen/qRbqaV/
http://codepen.io/team/Dan/pen/qqzONY
http://codepen.io/team/Dan/pen/qRWpWY
http://codepen.io/team/Dan/pen/JbbBGq



!!! What do you want to show?
Relationship - scatter, bubble (correlation)
Composition - Pie, stacked columns
* Stacked bar chart better than 50 pie charts with 7 wedges
Comparison - Column, line (versus)
Distribution - histogram (column, line)

http://www.datavizcatalogue.com/

!!! Manipulating data
* Map/Reduce using emojii
http://www.globalnerdy.com/2016/06/23/map-filter-and-reduce-explained-using-emoji/
https://twitter.com/steveluscher/status/741089564329054208?ref_src=twsrc%5Etfw

* Data Details vs Data Size (have to leave stuff out in order to make sense of the data)

!! D3
https://github.com/d3/d3/wiki/gallery

Find an example viz to start from here


enter - update - exit
d3 essentially iterates over your data passing it to the chained functions
You can think of it sort of like sql, for these rows (which might be scalars), do this thing (append, attr, etc).

d3 supports divs, svg, and canvas

!!! Support functions
* d3.csv  - load csv from service
* renderlets
* scales - convert from the domain data (1 to 100000) to the chart range (1-100)
** www.dashingd3js.com/d3js-scales
* domains
* ranges
* axes


!!!! Cool tools
https://svg-edit.github.io/svgedit/releases/svg-edit-2.8.1/svg-editor.html

!! Crossfilter
http://square.github.io/crossfilter

!! Chloropleth
Topojson -&gt; GeoJson -&gt; svg geopath -&gt; d3 projection

!! dc.js
fluent interface for d3 charts</pre>
</div>
<div title="Data-driven refactoring" creator="Steve" modifier="Steve" created="201501081424" modified="201501081506" tags="#codemash" changecount="2">
<pre>@coralineada

&quot;combing a wookie&quot;

bugs = holes in our mental model

test-driven refactoring - write tests to throw away - document your assumptions on how the codebase works.

Capture the old method in a lambda and then compare it against the new.

mutant - less about code coverage, more about finding methods that do too much
approval_tests - reports when ''results'' have changed - useful for apis

!!! Metrics
time the test suite (should not get slower)
feature to bug ratio (per iteration)
code complexity metrics
code smells (reek)
ask your developers

!!! Tools
churn - how many times has this file changed
rake notes - finds TODOs
fukuzatsu - reports cyclomatic complexity
society - reports how tightly coupled different classes are
pandometer - in progress - can report which commits add complexity, coupling, etc

!!!
* Store your results in a database so you can see trends

!!! Questions
Any ideas for testing where the only tests you can think to write are going to constrain your refactoring in a difrection you don't want it to go?
Do you keep these integration tests?  Test every edge?
What's the lifetime on these tests you throw away? - as long as needed for assumption checking


noun project</pre>
</div>
<div title="Dealing with System failure" creator="Steve" modifier="Steve" created="201701131741" modified="201701131742" changecount="2">
<pre>@arethoseclams

https://github.com/Netflix/Hystrix
https://github.com/Netflix/Hystrix/wiki
http://techblog.netflix.com/2011/12/making-netflix-api-more-resilient.html

!!! Circuit Breaker pattern
* Release It!
!!!! Closed
* request succeed -&gt; failures = 0
* request falis -&gt; failures++
* failures = threshold -&gt; trip breaker
(Or measure latency, absolute failures, %  error rate)


!!!! Open
*
!!!! Half-open
* How to recover?  Retry window?

!!! Pros
* Fail fast
!!! Cons
* Overhead (stat tracking)


!! Bulkheads (thread pools)
</pre>
</div>
<div title="Death By Specification" creator="Steve" modifier="Steve" created="201405071715" modified="201407031203" changecount="3">
<pre>Overspecifying cards during estimation sessions
Avoiding dev/product interaction

Solution:  3 amigos during kickoff

&quot;We talk about people over process and then actively go out of our way to create a repeatable process where people don't have to interact more than a bare minimum.

&quot;I find it much more important to go for that elusive Metaphor, and find a common language that all stakeholders can understand. Whether you automate some of that understanding and how, is less important.&quot;
&quot; The customers wanted to know the calculations that went in to the acceptance tests. We ended up writing acceptance tests in Clojure, with a small support library to keep the tests clean and readable.&quot;
&quot;When embarking on something new, try to understand how you are working, where your feedback is coming from. Then understand where the 讥w頴hing is coming from. While trying the new thing out, keep reflecting and check your understanding against your experiences.&quot;

 Willem van den Ende  (http://blog.johanneslink.net/2014/05/22/veterans-of-tdd-willem-van-den-ende/)
</pre>
</div>
<div title="Deep Work" creator="Steve" modifier="Steve" created="201709281159" modified="201709281251" changecount="13">
<pre>!! Perspective
This is a good book if you feel like you're not ever getting anything done.  My chief criticism is that the end goal for Newport's Deep Work seems to be create solo-uninterruptable blocks of time.  I don't think software development will improve if we work harder at keeping developers in sensory-deprivation silos.  I do think there's a number of nuggets to glean from here - especially around the psychology of distraction and the power of ritual.  I'd like a take on this topic that was focused on high-performing collaborative teams doing &quot;deep work&quot;.  Newport touches on this idea in a few places (two people in front of the whiteboard caught my interest) - but it's mostly lost with the primary perspective of publishing more papers/books = better work.

!! Takeaways
1) Distractions are a problem for me, not because of &quot;deep work avoidance&quot; - I don't have trouble focusing or refocusing.  The issue is this idea of residual attention.  Seeing the thing I can't deal with right now starts using part of my processing power.  This is similar to the psych behind GTD.

2)  I should experiment with planning my leisure time.  This is kind of frustrating because I usually have a never-ending TODO list, I just don't always want to refer to it when I plop down brain-dead on the couch at 9pm.  But I definitely see the value in saying - do I really want to spend the next 45 minutes &quot;catching up&quot; on twitter?  As the book quotes in the 4DX section &quot;I know what I need to do. I just don’t know how to do it.&quot;

3) I should experiment with a scoreboard.  The issue is I have trouble identifying value accrued.  I know it's not cards delivered or hours on task - I've measured both of those and they create awful feedback loops.

4) I think I could benefit from a shutdown ritual.  I just don't know how to implement one in my current environment.  My client works 2 hours later than I can realistically work.  As an &quot;async&quot; person on the team, I'm easier to ignore, so it's almost always the case that by the time they're ready to address my concerns it's the end of my day.  That means I'm always trying to cram one more thing in while I have the opportunity to talk to them.  Additionally my work day almost always ends abruptly with my wife running out the door or needing me to start dinner or a child is desperate for attention.  One idea I'm thinking about is shutting my day down pre-emptively and creating the &quot;resume plan&quot; and then immediately resuming?  Like if I got good at doing that, could I be efficient enough to employ it every hour?  I did something very similar when I was working all spare hours of the day trying to keep all my projects afloat.

5) I've started experimenting with schedule blocks.  It feels somewhat nice to have the plan.  I haven't ascertained any other benefits yet.  I'm also not blocking off anything that wasn't already in my work stream.

6) The core problem I have isn't solved by this book.  I have no trouble getting high-quality work done with tons of distractions.  My problems are twofold: 

A) I'm reluctant to throw low-priority tasks away.  Sometimes this is beneficial - my code isn't done until it's repeatedly deployable.  Other times it's I can't start this obviously valuable thing because I'm still bothered we didn't quite cover that one cataclysmic edge-case.

B) I want to figure out how to get more done in my day.  Not do &quot;better&quot; work - more &quot;better&quot; work.  I'm already highly productive, but I want to figure out how to do a 6 month high-quality project in 48 hours.  I want it to be ok to clock in for four highly productive hours of business-value and leave more time for crazy experimentation.



!! Highlights
Highlight (Yellow) | Location 148
To remain valuable in our economy, therefore, you must master the art of quickly learning complicated things.
-----

Highlight (Yellow) and Note | Location 264
Once the talent market is made universally accessible, those at the peak of the market thrive while the rest suffer.
//is this true given the enormous demand for devs?//
-----
Highlight (Yellow) | Location 268
talent is not a commodity you can buy in bulk and combine to reach the needed levels: There’s a premium to
being the best.
----
Highlight (Yellow) | Location 293
In this new economy, three groups will have a particular advantage: those who can work well and creatively
with intelligent machines, those who are the best at what they do, and those with access to capital.
----
Highlight (Yellow) | Location 305
Two Core Abilities for Thriving in the New Economy 1. The ability to quickly master hard things. 2. The ability
to produce at an elite level, in terms of both quality and speed.
----
Highlight (Yellow) | Location 327
this process of mastering hard things never ends: You must be able to do it quickly, again and again.
----
Highlight (Yellow) | Location 341
If you don’t produce, you won’t thrive—no matter how skilled or talented you are.
----
Highlight (Yellow) | Location 416
By batching his teaching in the fall, Grant can then turn his attention fully to research in the spring and summer,
and tackle this work with less distraction.
----
Highlight (Yellow) | Location 422
it’s important to enforce strict isolation until he completes the task at hand.
----
Highlight (Yellow) and Note | Location 423
My guess is that Adam Grant doesn’t work substantially more hours than the average professor at an elite
research institution (generally speaking, this is a group prone to workaholism),
//hmmm//
----
Highlight (Yellow) | Location 437
attention residue.
''OH YES''
----
Highlight (Yellow) | Location 439
it was more common to find people working on multiple projects sequentially:
----
Highlight (Yellow) | Location 452
minimizes the negative impact of attention residue
----
Highlight (Yellow) | Location 460
by seeing messages that you cannot deal with at the moment (which is almost always the case), you’ll be forced to turn back to the primary task with a secondary task left unfinished. The attention residue left by such unresolved switches dampens your performance.
----
Highlight (Yellow) | Location 482
If deep work is so important, why are there distracted people who do well?
----
Highlight (Yellow) | Location 500
There are, we must continually remember, certain corners of our economy where depth is not valued.
----
Highlight (Yellow) | Location 613
client that each member of her team would be off one day a week.”
Instead, the consultants found more enjoyment in their work, better communication among themselves, more
learning (as we might have predicted, given the connection between depth and skill development highlighted in
the last chapter), and perhaps most important, “a better product delivered to the client.”
//batch slack time//
----
Highlight (Yellow) | Location 622
cultures of connectivity persist, the answer, according to our principle, is because it’s easier.
----
Highlight (Yellow) | Location 623
If you work in an environment where you can get an answer to a question or a specific piece of information
immediately when the need arises, this makes your life easier
----
Highlight (Yellow) and Note | Location 625
you’d instead have to do more advance planning for your work, be more organized, and be prepared to put
things aside for a while and turn your attention elsewhere while waiting for what you requested.
//isnt this the same as doing multiple projects sequentially? Its somehow ok if you plan for it?//
----
Highlight (Yellow) | Location 630
it becomes acceptable to run your day out of your inbox—responding
----
Highlight (Yellow) | Location 674
The feeling of taking a broken machine, struggling with it, then eventually enjoying a tangible indication that he
had succeeded (the bike driving out of the shop under its own power) provides a concrete sense of accomplishment he struggled to replicate when his day revolved vaguely around reports and communications
strategies.
----
Highlight (Yellow) | Location 686
Busyness as Proxy for Productivity: In the absence of clear indicators of what it means to be productive and
valuable in their jobs, many knowledge workers turn back toward an industrial indicator of productivity: doing
lots of stuff in a visible manner.
----
Highlight (Yellow) and Note | Location 764
Having just established that there’s nothing fundamentally flawed about deep work and nothing fundamentally
necessary about the distracting behaviors that displace it, you
//when did this happen exactly?//
----
Highlight (Yellow) | Location 829
Our brains instead construct our worldview based on what we pay attention to.
----
Highlight (Yellow) | Location 901
“The best moments usually occur when a person’s body or mind is stretched to its limits in a voluntary effort to
accomplish something difficult and worthwhile.”
----
Highlight (Yellow) and Note | Location 905
Ironically, jobs are actually easier to enjoy than free time, because like flow activities they have built-in goals,
feedback rules, and challenges, all of which encourage one to become involved in one’s work, to concentrate
and lose oneself in it. Free time, on the other hand, is unstructured, and requires much greater effort to be shaped into something that can be enjoyed.
''omg''
----
Highlight (Yellow) | Location 910
Human beings, it seems, are at their best when immersed deeply in something challenging.
----
Highlight (Yellow) | Location 919
flow generates happiness.
----
Highlight (Yellow) | Location 950
“is not to generate meaning, but rather to cultivate in himself the skill of discerning the meanings that are
already there.”
----
Highlight (Yellow) | Location 1276
waiting for inspiration to strike is a terrible, terrible plan. In fact, perhaps the single best piece of advice I can
offer to anyone trying to do creative work is to ignore inspiration.
----
Highlight (Yellow) | Location 1319
the grand gesture. The concept is simple: By leveraging a radical change to your normal environment, coupled
perhaps with a significant investment of effort or money, all dedicated toward supporting a deep work task, you
increase the perceived importance of the task. This boost in importance reduces your mind’s instinct to
procrastinate and delivers an injection of motivation and energy.
----
Highlight (Yellow) | Location 1370
“We encourage people to stay out in the open because we believe in serendipity—and people walking by each
other teaching new things.” For the sake of discussion, let’s call this principle—that when you allow people to
bump into each other smart collaborations and new ideas emerge—the theory of serendipitous creativity.
----
Highlight (Yellow) and Note | Location 1416
The professors at MIT—some of the most innovative technologists in the world—wanted nothing to do with an
open-office-style workspace. They instead demanded the ability to close themselves off.
//so what? how does this prove anything? everyone else was wrong because some professors wanted
special treatment?//
----
Highlight (Yellow) | Location 1425
We can, therefore, still dismiss the depth-destroying open office concept without dismissing the innovation-producing theory of serendipitous creativity. The key is to maintain both in a hub-and-spoke-style arrangement:
Expose yourself to ideas in hubs on a regular basis, but maintain a spoke in which to work deeply on what you
encounter.
----
Highlight (Yellow) and Note | Location 1440
the whiteboard effect. For some types of problems, working with someone else at the proverbial shared
whiteboard can push you deeper than if you were working alone. The presence of the other party waiting for
your next insight—be it someone physically in the same room or collaborating with you virtually—can shortcircuit
the natural instinct to avoid depth.
//hmmm..pairing works the same way. So maybe open space without pairing is too distracting to work.//
----
Highlight (Yellow) | Location 1444
Indeed, their example indicates that for many types of work—especially when pursuing innovation—
collaborative deep work can yield better results. This strategy, therefore, asks that you consider this option in
contemplating how best to integrate depth into your professional life.
----
Highlight (Yellow) and Note | Location 1447
First, distraction remains a destroyer of depth.
//aha....and pairs are difficult to distract.//
----
Highlight (Yellow) | Location 1464
I asked you how to do it, and you told me what I should do. I know what I need to do. I just don’t know how to
do it.”
----
Highlight (Yellow) | Location 1477
Discipline #1: Focus on the Wildly Important
----
Highlight (Yellow) | Location 1488
Discipline #2: Act on the Lead Measures
----
Highlight (Yellow) | Location 1497
For an individual focused on deep work, it’s easy to identify the relevant lead measure: time spent in a state of
deep work dedicated toward your wildly important goal.
----
Highlight (Yellow) | Location 1502
Discipline #3: Keep a Compelling Scoreboard
----
Highlight (Yellow) | Location 1513
To maximize the motivation generated by this scoreboard, whenever I reached an important milestone in an
academic paper (e.g., solving a key proof), I would circle the tally mark corresponding to the hour where I
finished the result.* This served two purposes. First, it allowed me to connect, at a visceral level, accumulated
deep work hours and tangible results. Second, it helped calibrate my expectations for how many hours of deep
work were needed per result.
----
Highlight (Yellow) | Location 1517
Discipline #4: Create a Cadence of Accountability
----
Highlight (Yellow) | Location 1524
During my experiments with 4DX, I used a weekly review to look over my scoreboard to celebrate good weeks,
help understand what led to bad weeks, and most important, figure out how to ensure a good score for the days
ahead.
----
Highlight (Yellow) | Location 1558
I want to suggest a more applicable but still quite powerful heuristic: At the end of the workday, shut down your
consideration of work issues until the next morning
----
Highlight (Yellow) | Location 1565
Reason #1: Downtime Aids Insights
----
Highlight (Yellow) | Location 1572
Dijksterhuis’s team isolated this effect by giving subjects the information needed for a complex decision
regarding a car purchase. Half the subjects were told to think through the information and then make the best
decision. The other half were distracted by easy puzzles after they read the information, and were then put on the
spot to make a decision without having had time to consciously deliberate. The distracted group ended up
performing better.
----
Highlight (Yellow) | Location 1584
The implication of this line of research is that providing your conscious brain time to rest enables your
unconscious mind to take a shift sorting through your most complex professional challenges. A shutdown habit,
therefore, is not necessarily reducing the amount of time you’re engaged in productive work, but is instead
diversifying the type of work you deploy.
----
Highlight (Yellow) | Location 1587
Reason #2: Downtime Helps Recharge the Energy Needed to Work Deeply
----
Highlight (Yellow) | Location 1619
Put another way, trying to squeeze a little more work out of your evenings might reduce your effectiveness the
next day enough that you end up getting less done than if you had instead respected a shutdown.
----
Highlight (Yellow) | Location 1643
to support your commitment to shutting down with a strict shutdown ritual that you use at the end of the
workday to maximize the probability that you succeed. In more detail, this ritual should ensure that every
incomplete task, goal, or project has been reviewed and that for each you have confirmed that either (1) you
have a plan you trust for its completion, or (2) it’s captured in a place where it will be revisited when the time is
right. The process should be an algorithm: a series of steps you always conduct, one after another. When you’re
done, have a set phrase you say that indicates completion (to end my own ritual, I say, “Shutdown complete”).
----
Highlight (Yellow) | Location 1658
the Zeigarnik effect. This effect, which is named for the experimental work of the early-twentieth-century
psychologist Bluma Zeigarnik, describes the ability of incomplete tasks to dominate our attention.
----
Highlight (Yellow) | Location 1665
In this study, the two researchers began by replicating the Zeigarnik effect in their subjects (in this case, the
researchers assigned a task and then cruelly engineered interruptions), but then found that they could
significantly reduce the effect’s impact by asking the subjects, soon after the interruption, to make a plan for
how they would later complete the incomplete task. To quote the paper: “Committing to a specific plan for a
goal may therefore not only facilitate attainment of the goal but may also free cognitive resources for other
pursuits.”
----
Highlight (Yellow) | Location 1677
Decades of work from multiple different subfields within psychology all point toward the conclusion that
regularly resting your brain improves the quality of your deep work. When you work, work hard. When you’re
done, be done.
----
Highlight (Yellow) | Location 1761
The idea motivating this strategy is that the use of a distracting service does not, by itself, reduce your brain’s
ability to focus. It’s instead the constant switching from low-stimuli/high-value activities to high-stimuli/lowvalue
activities, at the slightest hint of boredom or cognitive challenge,
----
Highlight (Yellow) | Location 1807
To summarize, to succeed with deep work you must rewire your brain to be comfortable resisting distracting
stimuli. This doesn’t mean that you have to eliminate distracting behaviors; it’s sufficient that you instead
eliminate the ability of such behaviors to hijack your attention.
----
Highlight (Yellow) | Location 1831
In particular, identify a deep task (that is, something that requires deep work to complete) that’s high on your
priority list. Estimate how long you’d normally put aside for an obligation of this type, then give yourself a hard
deadline that drastically reduces this time.
----
Highlight (Yellow) | Location 1835
At this point, there should be only one possible way to get the deep task done in time: working with great
intensity—no e-mail breaks, no daydreaming, no Facebook browsing, no repeated trips to the coffee machine.
----
Highlight (Yellow) | Location 1839
Remember, however, to always keep your self-imposed deadlines right at the edge of feasibility. You should be
able to consistently beat the buzzer (or at least be close), but to do so should require teeth-gritting concentration.
----
Highlight (Yellow) | Location 1841
The main motivation for this strategy is straightforward. Deep work requires levels of concentration well beyond
where most knowledge workers are comfortable.
----
Highlight (Yellow) | Location 1859
The goal of productive meditation is to take a period in which you’re occupied physically but not mentally—
walking, jogging, driving, showering—and focus your attention on a single well-defined professional problem.
Depending on your profession, this problem might be outlining an article, writing a talk, making progress on a
proof, or attempting to sharpen a business strategy. As in mindfulness meditation, you must continue to bring
your attention back to the problem at hand when it wanders or stalls.
----
Highlight (Yellow) | Location 1900
This cycle of reviewing and storing variables, identifying and tackling the next-step question, then consolidating
your gains is like an intense workout routine for your concentration ability.
----
Highlight (Yellow) and Note | Location 1923
it was instead his quest to improve this memory that (incidentally) gave him the deep work edge needed to thrive
academically.
//leaping to conclusions again!//
----
Highlight (Yellow) | Location 2084
I call it the craftsman approach to tool selection, a name that emphasizes that tools are ultimately aids to the
larger goals of one’s craft. The Craftsman Approach to Tool Selection: Identify the core factors that determine
success and happiness in your professional and personal life. Adopt a tool only if its positive impacts on these
factors substantially outweigh its negative impacts.
----
Highlight (Yellow) | Location 2314
But the logical foundation of his proposal, that you both should and can make deliberate use of your time outside
work, remains relevant today—especially with respect to the goal of this rule, which is to reduce the impact of
network tools on your ability to perform deep work.
----
Highlight (Yellow) | Location 2330
Put more thought into your leisure time. In other words, this strategy suggests that when it comes to your
relaxation, don’t default to whatever catches your attention at the moment, but instead dedicate some advance
thinking to the question of how you want to spend your “day within a day.”
----
Highlight (Yellow) | Location 2333
websites of the type mentioned previously thrive in a vacuum: If you haven’t given yourself something to do in a
given moment, they’ll always beckon as an appealing option. If you instead fill this free time with something of
more quality, their grip on your attention will loosen.
----
Highlight (Yellow) | Location 2350
if you want to eliminate the addictive pull of entertainment sites on your time and attention, give your brain a
quality alternative.
----
Highlight (Yellow) | Location 2442
Down the left-hand side of the page, mark every other line with an hour of the day, covering the full set of hours
you typically work. Now comes the important part: Divide the hours of your workday into blocks and assign
activities to the blocks.
----
Highlight (Yellow) | Location 2459
Your goal is not to stick to a given schedule at all costs; it’s instead to maintain, at all times, a thoughtful say in
what you’re doing with your time going forward—even if these decisions are reworked again and again as the
day unfolds.
----
Highlight (Yellow) | Location 2484
Joseph’s critique is driven by the mistaken idea that the goal of a schedule is to force your behavior into a rigid
plan. This type of scheduling, however, isn’t about constraint—it’s instead about thoughtfulness. It’s a simple
habit that forces you to continually take a moment throughout your day and ask: “What makes sense for me to
do with the time that remains?” It’s the habit of asking that returns results, not your unyielding fidelity to the
answer.
----
Highlight (Yellow) | Location 2515
How long would it take (in months) to train a smart recent college graduate with no specialized training in my
field to complete this task?
----
Highlight (Yellow) | Location 2580
because when considered in isolation, to say no to any one of these activities seems like you’re being lazy. By
instead picking and sticking with a shallow-to-deep ratio, you can replace this guilt-driven unconditional
acceptance with the more healthy habit of trying to get the most out of the time you put aside for shallow work
----
Highlight (Yellow) | Location 2682
I call this approach a sender filter, as I’m asking my correspondents to filter themselves before attempting to
contact me.
----
Highlight (Yellow) | Location 2721
I will do a good deed for some random stranger if Antonio responds within 23 hours.
----
Highlight (Yellow) | Location 2742
I suggest, therefore, that the right strategy when faced with a question of this type is to pause a moment before
replying and take the time to answer the following key prompt: What is the project represented by this message,
and what is the most efficient (in terms of messages generated) process for bringing this project to a successful
conclusion?
----
Highlight (Yellow) | Location 2773
Second, to steal terminology from David Allen, a good process-centric message immediately “closes the loop”
with respect to the project at hand. When a project is initiated by an e-mail that you send or receive, it squats in
your mental landscape—becoming something that’s “on your plate” in the sense that it has been brought to your
attention and eventually needs to be addressed. This method closes this open loop as soon as it forms. By
working through the whole process, adding to your task lists and calendar any relevant commitments on your
part, and bringing the other party up to speed, your mind can reclaim the mental real estate
----</pre>
</div>
<div title="DefaultTiddlers" creator="Steve" modifier="Steve" created="201301170300" changecount="1">
<pre>[[TabTimeline]]</pre>
</div>
<div title="Deriving Gherkin from Real Conversations" creator="Steve" modifier="Steve" created="201409141304" modified="201409141306" changecount="4">
<pre>http://lizkeogh.com/2014/09/01/deriving-gherkin-from-real-conversations/

* Get examples by asking for them
** If the answer is tautological - &quot;When I select text and make it italic it should be italic&quot; - drive into specifics

!! Conversational Tricks
* people use 쩦�here Gherkin uses 짩ven튪 or they use 쌥t鳠say this happened杊* or say 췥ll, if I鶥 already done X杊* people use 촨en�nstead of 취en�when they鲥 talking about an event they鲥 performing
* people often skip 촨en�ltogether when they鲥 talking about an outcome, and occasionally skip 취en�
!! Success vs. failure
* Don't make success and failure look the same.  Assume success
&lt;&lt;&lt;
 Given I鶥 submitted my application
&lt;&lt;&lt;
vs
&lt;&lt;&lt;
Given I tried to submit my application
But it was audited and rejected
&lt;&lt;&lt;

!! It's OK to have steps that don't execute code
Given I lost my dog</pre>
</div>
<div title="Developer Anarchy" creator="YourName" modifier="YourName" created="201607052059" modified="201607052111" changecount="9">
<pre>SE radio - Fred George
! Definition
Anarchy = Self-organization
Developers are not managed by anyone, including the business

!! Basic idea
* Time to market is paramount
* PO doesn't have time to guide developers
* Fast feedback is required
* Good for solving problems where the solution is fuzzy (&quot;Make more money&quot;)
* Developers experiment quickly (several a day, in production) to find better solutions

!!! Anarchy
* = Self-organization
* Attention grabbing &quot;Marketing&quot; like extreme programming

!!! P.O role
* Describe business goals
* Give developers metrics to &quot;game&quot; (google hits, $ earned per minute, search ranking, etc)
* Educate developers on business
&lt;&lt;&lt;
&quot;Customer now educates programmer on business domain, rather than picking what story to play next&quot;
&lt;&lt;&lt;
* Stay out of the way

!!! Caveats
* Requires high-trust relationship
** You pay these people a lot of money, vaguely describe what you want for that money, give up authority on how they spend that money, and in return you get fast results
* Non-prescriptive results
* Has to &quot;sold&quot; to C-level and forced down throats (like agile).  Social/culture change.
* Managers/Architects/QA etc must adapt or leave
** At Daily Mail, most managers left rather than become coders.  25%+ left in first six months.
** Most architects became coders
** Had no trouble filling those positions with people who really wanted to work in this environment (leaving banks, google, etc)
* Have to leave the developers alone (judge on merits alone)
** Team chose to rewrite the same service 3-4 times (Managers would never allow this!).  Ended up being the right call.
* Best suited for internal tools?
* Only really works so far with microservices

!!! Innovation
* You have to want it
* Understand that innovation means failing
* Rules will be bent, ignored, and broken

!!! Gaming
* We measure the wrong things for developers (story points, cards per iteration, lines of code).
* Measure money made, improving google results, KPIs.
* Developers identify metrics to game and do so.

!!! No management
* Let programmers vote each other off the island
* There are management like roles
** Mentor - usually senior dev
** Feedback - 360 reviews
** Ambassador - represent team to rest of company (still a programmer)
** Concierge - handle the things the team needs (skills, lan adapters, deal with &quot;fired&quot; programmers) - probably not a programmer

!!! Skills / Pay scale / title
* Competent in a tech - Developer
* Expert in tech - Expert - Senior Developer
* Competent in 5-7 techs - Expert - System Developer
* Expert in 5+ techs - Uber Expert - Master Developer

!!! Is it agile?
Yes,
* Value Communication
* Value Feedback
* Value working software

but...
* No stories
* No iterations
* No retros
* No standups
(The feedback loop on all of these things is too large if you're deploying multiple times a day)

* No refactoring
* No unit testing
* No QA
(microservices make this waste, just spend another hour and spin up a replacement microservice)
* Deploy it to production and measure the feedback there
* Requires instrumentation
&lt;&lt;&lt;
Could lose $300/minute if there was an error, but could produce $1000s per day with an alogrithm update.
&lt;&lt;&lt;

!!! Key question
&quot;How much do you value time to market?&quot;

!! Microservices
* Microservices and rapid development leads towards Programmer Anarchy
* Microservices work well when success is very fuzzy and in degrees.
** &quot;Can I tweak just this piece of the feature and have 2-3 versions competing in production?

!!! How big?
* &lt; 100 lines of code (java, C#)
* 15-20 lines of javascript
* Forward had 300 microservices
* Netflix had 800 microservices

!!! Services are scripts
* Logic is simple
* Pull in input
* Make 1-2 decisions
* Produce output

//this rang home with me, I don't TDD most of my scripts - it's hard to mock out IO, wire up a test harness, etc when I'm writing a bash script to move files around //

!!! microservices @forward
* Ruby front-end
* Clojure for heavy lifting
* Node for traffic monitoring
* R for analytics

!!! Duplication
Didn't worry about it.  2 hours to write a new service shorter than maintaining the documentation and library for knowing another service already exists.

!!! Logging, monitoring, deployment
* Logging is just another event on the event bus (if doing async architecture)
* Each service announces it's presence/disconnect, does heartbeat (like MQTT).  Another microservice does monitoring.
* Use the cloud for deployment
** Cloud costs cheaper than programmer costs

!!! My Questions
1)  Does this work for customers who don't want to learn tech?  Will we naturally mask the costs they are deferring by ignoring tests, refactoring, docs, etc?
2)  What's the worth of creating an environment where developers get to write code as much as possible?  Can we abandon the desire to prevent building the wrong thing the first time?



</pre>
</div>
<div title="Developer Outlier" creator="Steve" modifier="Steve" created="201401102138" modified="201401102138" tags="#codemash 2014" changecount="3">
<pre>Cory House
@housecor

* Luck Surface Area
* Find what scares you and run at it
* &quot;You are the average of the five people you spend the most time with&quot;
* Consistently do things that people want</pre>
</div>
<div title="Distilling the Essence" creator="Steve" modifier="Steve" created="201410011417" modified="201410011418" tags="#cukeup" changecount="3">
<pre>George Dunwiddie

&quot;Express all the details that matter and none that don't matter&quot; - Dale Emery

Clue:  Big setup
Clue:  Big Expectation
Clue:  Run on scenario (when and then when then when then)

Essence of a cooking timer
hour glass, wind up, digital

Clue:  Does the cuke change when we change the workflow?
minute button vs 1-0 keypad for entering minutes

Clue:  Does the cuke change when we change the UI?
Start button vs Go button
1, 2, 3, vs -, --, ---

WARNING:  Don't eliminate all the details - stay away from tautological

Is your essence (of this test) domain or workflow?  Depends on the test.  Should we run/group these tests together?  Or maybe accept slower feedback on workflow tests.</pre>
</div>
<div title="Distributed Agile Tradeoffs" creator="Steve" modifier="Steve" created="201705051658" modified="201705051834" tags="#aab17" changecount="6">
<pre>@jeffhoover
@schmonz

Chzy suggested a doc from pivotal about remote pairing - FIND IT
https://schmonz.com/2017/05/05/aab-2017-best-team-anywhere/

Scatterspoke</pre>
</div>
<div title="Docker For Fun and Profit" creator="Steve" modifier="Steve" created="201506131723" modified="201506151035" tags="#pghtechfest" changecount="4">
<pre>Kel Cecil
@praisechaos

http://github.com/kelcecil/docker-techfest15

!!! docker hub vs quay.io
* prefers quay
* better for teams
* quay has an easier &quot;build image from commit&quot; feature

kubernetes - linux like process application over multiple boxes.
deis -  heroku-like abstraction
containership.io - abstracts away the providers (digital ocean -&gt; aws)

!!! Ideas
* Pull the CI env to a dev machine to fix/play
* Take someone's dotfiles for a spin

Takeaway:  simply uses docker the way I use vagrant</pre>
</div>
<div title="Docs for Devs" creator="Steve" modifier="Steve" created="201703101623" modified="201703101800" tags="#confoo" changecount="2">
<pre>Most asked questions follow a normal 
Every page is page 1 - You need to tell users where they are because they come in from anywhere
Give orders
Write a unit test (make the user do something that verify they set it all up correctly).  
If you can't check that it worked, it's not a task.
What's next -&gt; add a pointer to the next step.  If you don't say anything they're not sure if they're done or not.  Reduce uncertainity.
Get out of the way -&gt; People have other stuff to do.</pre>
</div>
<div title="Drones" creator="Steve" modifier="Steve" created="201308171457" modified="201308171502" tags="scrc13" changecount="3">
<pre>AR Parrot Drone
argus - gem
CFields - module -&gt; Convert C style headers to ruby class</pre>
</div>
<div title="EarnedBusinessValue" creator="Steve" modifier="Steve" created="201311181857" changecount="1">
<pre>Ratscheller?

Pulling the Value Forward - most valuable first
Amount of value for each story goes down, so second iteration is less valuable than the first
At some point the value of a sprint becomes negligible (when you get to the nice-to-haves)
It costs the same amount to do the first iteration as the 10th
There should be a point where we notice that we've spent half the money and gotten 80% of the value
ROI - Sooner?
How does this approach compare to the all or nothing comparision?</pre>
</div>
<div title="Elixir" creator="Steve" modifier="Steve" created="201401081916" modified="201401092043" tags="#codemash 2014" changecount="3">
<pre>https://github.com/cromwellryan/sweetelixir

Ryan Cromwell
Chris Mccord

IRC: elixir-lang on freenode
http://elixir-lang.org
----

What do you do when there's no match? - Throws error, let it die?

Uses guard to load exs files into iex to help with playing (don't have to re-write whole modules in iex)

quote shows the AST for any expression

cond do
  conditions...
end

// would you assign this to something?

#iex:break

Elixr is tail call optimized

Processes are used like Objects in the sense that you give them work and wait for a result - thousands per machine is normal

* Messages are non-durable - so we assume messages are not delivered by default?
* Servers are OTP naming convention for a process that stays alive

* ''Tests are falining for genserver_stack

* iex pry</pre>
</div>
<div title="Elm and Elixir made for each other" creator="Steve" modifier="Steve" created="201705191739" modified="201705201306" tags="#selfconf17" changecount="4">
<pre>@mudetroit
https://github.com/mudetroit/elm-and-elixir-made-for-each-other


!!! Undirectional data flows
* Undirectional data flows push us towards time being a first class  //I don't get it//
* No longer think about what a model is -&gt; just what it looks like afterwards
* Moving towards streams

!!! Time as a first class citizen
* Pushes us to think about the system as a state machine in a moment of time.  
* Think of all the bugs that have been caused because we obsess over the output of the state machine but aren't good at thinking about what the internals look like.
* //Replay//

</pre>
</div>
<div title="EmbeddedLinuxDistro" creator="Steve" modifier="Steve" created="201506101706" modified="201506101708" changecount="4">
<pre>Eric Hankinson

Deb bootstrap - take major version of debian, ABI (cpu arch) - knows how to copy files to a block (virtual file system) and make a minimal debian
uboot - point here to launch the OS
* Tfttp here to get the kernel

Ran qemu-arm-static to compile &quot;AS ARM&quot; in a VM (rather than doing a true cross-compile)

MAKEDEV - makes things in the /dev folder

sfdisk - scriptable fdisk

use {{{pv}}} to record pipe progress
{{{
zcat | pv | dd
}}}</pre>
</div>
<div title="Embrace Chaos" creator="Steve" modifier="Steve" created="201308171500" modified="201308171503" tags="scrc13" changecount="3">
<pre>- Build an architecture to scale first, be efficient second

12 year old aaron (''find github account'') contributing to travis pulled in by first accepted pull request.

github.com/rkh</pre>
</div>
<div title="Embrace the Suck" creator="Steve" modifier="Steve" created="201705192050" tags="#selfconf17" changecount="1">
<pre>@medyyoulook
Perseverance, Grit, Growth Mindset

Embrace the Suck -&gt; There's stuff that's got to be done, it's not going away.  Putting if off doesn't make it any less sucky.
The longer you procrastinate the harder it is to get started.  Acknowledge it sucks, get it over with.

Zen horse metaphor:

I'm on my zen horse I can do anything, little problems don't knock me off.  Xcode crashes, whatever.
My horse ran away, can't find it
Can see my horse, not there yet
Not going to get back on today
</pre>
</div>
<div title="Enterprise learning can be fun" creator="Steve" modifier="Steve" created="201703101903" tags="#confoo" changecount="1">
<pre>@_toch

!!! X-talk
* 30 mins talk, 30 mins discussion - 1 night a month
* Drawback: passive

!!! Group Code Review
* Homework - review this and send comments
* Activity - discuss reviews
* Drawback:  Too many languages

!!! Code Retreat

!!! Hands-on-workshop
* Based on Junior questions
* Drawbacks:  Takes a lot of time to build

!!! Legacy Code Retreat
* Used Gilded Rose Kata
* Topics/Challenges
** Fix a bug
** Add a feature
** Introduce DI
** Extract Methods

!!! Open Forum
* Round table suggest topics
* Top 3 discussed 20 mins each</pre>
</div>
<div title="Erlang, or How I Learned to Stop Worrying and Let Things Fail" creator="Steve" modifier="Steve" created="201601081957" modified="201601082132" tags="#codemash 2016" changecount="5">
<pre>John Daily
@macintux
https://gist.github.com/macintux

x=x+1 -&gt; you're doing it wrong!

&quot;If this is the kind of code you want to write for the rest of your life, you are wrong.&quot;
&quot;Crashing is not the worst thing that can happen when you have an exception, silently swallowing an exception is&quot;.

Rebootable code - How often has rebooting failed to fix your computer problem?  Rebooting is an awesome feature.

If you're already in an error state, can you trust &quot;yourself&quot; to clean and restore state?

&quot;Why do computers stop and what can we do about it?&quot; - Jim Gray

!!! Tandem Computers
* Fail fast modules: do the right thing or STOP.  Why carry corrupted behavior forward
* Detect module faults quickly
* Configure extra modules for rapid failover

!!! Tandem's Software
* 4 million lines of code
* Several thousand bugs
* Estimated mean time between failure - 50 years




!! Things we need
!!! Isolation
*Erlang module is a process
* No shared memory
* Need messages to transfer data
* Async messaging is better (sync message is fragile)

!!! Supervision
* Should have as little code as possible
* Lazy edge case handling by default - why spend all that time tracking down weird bugs?

!!! Fast Reboot
* Processes are itty-bitty small.  Like 1200 bytes.

!!! Network transparency
* We tried to pretend for years that network calls didn't exist (RPC, CORBA, etc)

!!! State management
* OOP encourages you to keep your state intertwined with your code.  Functional encourages you to separate that.

!! Nice to have
* Hot code loading / REPL
* Garbage collection (lots of little processes to clean up)
* OTP - best practices for Erlang
* Pattern matching (parsing messages)
* Symbolic debugging

!! Resources
learnyousomeerlang.com
tinyurl.com/cm-erlang
worrydream.com/TheFutureOfProgramming - Must watch video
</pre>
</div>
<div title="EvaluatingRails" creator="Steve" modifier="Steve" created="201309181801" changecount="1">
<pre>* Where is prod?
* Look at Gemfile
* Look at database.yml
* tools - simplecov, turbulence, etc
* Installed DB from heroku (db:pull)
</pre>
</div>
<div title="Expand Your Network" creator="Steve" modifier="Steve" created="201705041523" changecount="1">
<pre>@crebma

!!! Self Awareness
* Who do you interact with?
* Who do you follow on twitter?
* Do the people you admire in the community all look the same?

!!! Expand Your Network
* Say hello to new people
* Don't recruit out of homogenous network
* Your job posting has &quot;Straight White Dude&quot; written on it
* Care publicly when a public figure says something weird
* HIre diversity consultant
* Sponsors groups and conferences that promote diversity
* Support continued learning - make it ok to not know something

!!! Group awareness
* Invite speakers that are under-represented
* Make new people feel welcome
* Have a good of code of conduct that you understand -&gt; shows you've thought about this and you care
** Don't just copy/paste
** Have a contact person/committee to help with code of conduct questions
** Enforce the code
* Reach out to local groups
* Find speakers of different experience levels
* Don't center social hours around alcohol
** I don't feel comfortable being around a bunch of people drinking
** Mocktails, 
** Lower the barrier

!!! Group Awareness in Your Conference
* Have a code of conduct
** Know it, Enforce it
** geekfenimist.com
* Reach out to local diverse groups for CFPs
* Ask for recommendations of speakers to invite
* CallbackWomen, Technically Speaking
* Partner with organizations
* Offer scholarships, free tickets, discount codes
* Always give your speakers and volunteers free tickets
* Cover travel expenses
* Offer child care, closed captioning, signing, quiet room

!!! Do Research
* Don't rely on the one non-&quot;straight white dude&quot; to help you
</pre>
</div>
<div title="Failing Abstract" creator="Steve" modifier="Steve" created="201401131809" modified="201401131810" changecount="2">
<pre>Do you like failure?

In this session we'll talk about why your mind reacts to failure the way it does and what you can do about it.  Using concrete examples, like TDD and Lean Startup, we'll work through some cognitive biases that might hold you back.  We'll talk about failing safely and building environments where failure is encouraged.  Then we'll move on to anti-fragile systems and how focusing on failure pushes a system to thrive on randomness.  We'll close with a discussion on failure-focused strategies that allow us to  build to an ultimate success.</pre>
</div>
<div title="Failing Your Way To Success" creator="Steve" modifier="Steve" created="201401081400" modified="201406231634" tags="#codemash 2014" changecount="14">
<pre>Agile distilled

-Feedback!
 - Why do we care about feedback - learn, grow, etc
-Failing and Learning
 - What lessons are you most likely to learn from?
 - What stories do you remember?
-Regret avoidance
-Practice failure
-ATDD
-Lean startup
-Scientific method applied to ATDD
-Write it down
-Start with a hypothesis
-Try to fail!  Embrace failure

! Post Codemash
* Afraid to show unfinished app to a customer?
* Afraid to let customer drive
* Show and Tell with nothing to show?

* View failure as permanent and success as temporary
** Do your friends let you forget your mistakes?
** Can we create spaces where it's ok to mess up?

* Perfectionism
** Story about my dad
** Very limiting, afraid to try new things

* Distinguish between valid and invalid criticism
** Trusted Advisors / Mentors

* After failing
** Ignore or dismiss the data
*** Ego protection
**** The lifeblood of the ego is fear. Its primary function is to preserve your identity, but it fears your unworthiness. As a result, ego pushes you harder in order to achieve more. Ego communicates to you through &quot;oughts,&quot; &quot;musts,&quot; and &quot;shoulds,&quot; persuading you to believe that by achieving more and more, you must be worthy, right?
** Attribute to a personal defeciency
*** Ego protection
*** Afraid to try again
** Attribute to strategy
*** Creates new ideas

Helen Keller, 샨aracter cannot be developed in ease and quiet. Only through experience of trial and suffering can the soul be strengthened, ambition inspired, and success achieved.튊* Prefer local evidence to theory
** Design patterns, etc

!! Killing your darlings
* Stuff - How does this fit?

!! Practice &quot;when things go wrong&quot;
* http://www.jbrains.ca/permalink/test-driven-development-as-pragmatic-deliberate-practice#fnref:1
** Work in mentions of the quotes here, all very good about teaching yourself to learn


!! Antifragile
* Tie-in - the capability to embrace failure and react to mistakes is useful in random, uncertain environments
*** Avoid Analysis Paralysis
*** Disorder Paralysis
** The ability to quickly reverse small errors makes a person/system antifragile
** Maximize Luck Surface Area
** Innovation depends on tinkering
** If we get good at reversing expected failure we can get good at reversing random failure
*** It's all about reducing fear of a negative effect

** Randomness and Disorder
*** vs attempts to stabiliize the environment (PROCESS) vs stability by embracing change and randomness
** Stress up to a point
** Barbelling (90% cash, 10% high risk, vs 100% medium)

** Things that are antifragile
* Bones and muscle

* Antifragile things are complex and random
** And need complexity (zoo animals)
* Robust things are simple

* Complex systems resist top-down design - emergence
* Instead use minor tweaks (like evolution does)

* Local failure vs Global failure
** Tech safety

&quot;Good systems are set up to have small errors, independent from each other, or negatively correlated to each other, since mistakes lower the odds of future mistakes&quot;

* Debt makes you fragile - vulnerable
* You have to feel the consequences of your actions

* Don't waste time trying to get better at predicting the world or making it more predictable.

&quot;Antifragility is beyond resilience or robustness.  The resilient resists shock and stays the same; the antifragile gets better.  The antifragile loves randomness and uncertainty, which also means - crucially - a love of errors, a certain class of errors.&quot;

* Understand that freedom and accountability are the same thing.
** What does this mean to me?

* Antifragile systems are redundant
** They expect failure of one part

* Redundancy vs Waste
** Antifragile systems are redundant, which looks like waste.  Until the unusual happens.

* CI/Delivery - Antifragile
** Again this comes back to the idea that we try more often, even if that means failing.  Let's keep the failures small and local.


** Balancing act?
*** Antifragile - TechSafety

** Github
*** Jan8 postmortem - one small failure takes down the whole system

!! Closing?
In the end there's nothing significant about success or failure.  What we're looking for is fast feedback for fast improvement.  If you can succeed fast, great!  Please teach me how.  The magic about focusing on failures is that you can still build to a larger success.  With a focus on success, it takes me longer to get that feedback.  I'm also less open to changing tack while I'm succeeding.  All of us take on endeavors that in hindsight, we should have quit very early on.  And in hindsight, the warning signs were there.  But it's  going &quot;well enough&quot;, it doesn't hurt that bad, let's keep going and hope it works out.  </pre>
</div>
<div title="Finally a voice for the enterprise!" creator="Steve" modifier="Steve" created="201601081357" modified="201601081445" tags="#codemash 2016" changecount="2">
<pre>William Klos
@williamklos

github.com/centricconsulting/alexa-framework-go

Bad Voice UI:  Requires a specific order of words, innotation
Alexa Ask MyApp
Alexa Tell MyApp

Conversation:
Keeps a topic open until you &quot;close it&quot; - Is this a timeout thing?
</pre>
</div>
<div title="FixingTheJavaScriptMess" creator="Steve" modifier="Steve" created="201401071436" modified="201401071654" tags="#codemash 2014" changecount="6">
<pre>Steps:
1.  Move all the script in a page to a single block (jquery can help)
1.  Create a namespace for js
1.  Move all script on a page to a js file with the same name.  Use the new namespace
1.  DRY it up
1.  Isolate components
1.  Inject dependencies
1.  Use templates


!!! mockajax library
- Used with spiking out a design with a designer - can build widgets without a server

!!! Wrapping functions
Wrapping function calls in anonymous functions instead of just passing the function (like to jquery) allows you to call functions that you haven't defined on the page yet (because the page loads top to bottom)

{{{
  $('#stuff).on('click' doStuff);

  doStuff = function() {
  }
}}}

'' Undefined ''

!!! Namespaces

* Use namespace as interim step to organize code
* Not a good solution long term if you have collisions with another library - last write wins

----

Why on earth would you add functions to an object that require it to know things outside the function definition?    (Step 6ish)

!!! Templates

Templates allow you to stop sending markup across the wire.  Add rows to a table asynchronously, for instance.

!!! amplify
amplify - allows you to publish events to topics.  You can further decouple components from each other.  Also components from server:

amplify.publish(&quot;needData&quot;)
</pre>
</div>
<div title="From Backbone to Ember and Back(bone) Again" creator="Steve" modifier="Steve" created="201506131844" tags="#pghtechfest" changecount="1">
<pre>Jon Knapp
@Coffeeandcode

</pre>
</div>
<div title="From open to minimum vacation policy" creator="Steve" modifier="Steve" created="201502081837" modified="201502091812" changecount="2">
<pre>http://www.paperplanes.de/2014/12/10/from-open-to-minimum-vacation-policy.html

Open vacation policy was a failure.

* People were unsure how many days were &quot;ok&quot; and no-one wanted to be the slacker.  Forgetful people would just burn themselves out.

&quot;People take less time off, and it's celebrated as a success of giving people more responsibility.&quot;

* People would stay hooked in during vacation, and avoid recharging.

&quot;When someone starts checking in during their vacation, it lowers the bar for others to do it, and it increases the uncertainty of whether or not you should be checking in. &quot;

&quot;A company has to learn how to function when people are on vacation and unavailable, however important their role is.&quot;

Ended up with 25 MINIMUM vacation days for every employee, including founders
</pre>
</div>
<div title="Generative Testing" creator="Steve" modifier="Steve" created="201701122102" modified="201701122116" tags="#codemash 2017" changecount="2">
<pre>@chriskeathley

Property Tests



1.  Generate lots of data
2.  Pass it through a function
3.  Validate the output

How to do it:
1.  Think in properties
...
5.  Models as FSMs.

{{{
test &quot;addition with zero returns the same number&quot; do
  ptest c: int() do
    assert(add(x, 0))
  end
end


def add(x, _y) do
  x
end
}}}

-----

https://github.com/keathley/phoenix_qc_example

How do you think about applications?
Imagine a model.  Think of it as a FSM:

User -&gt; logs in -&gt; logged_in -&gt; vote -&gt; logged_in -&gt; log out -&gt; logged_out

{{{
  test &quot;users votes increase after voting&quot; do
    ptest [commands: gen_commands(&quot;chris&quot;)] do
      VoteCounter.reset()
       [_state, result } = run_commands(commands, client)

    end
  end

  def gen_commands(name) do
    list(of: gen_vote(name), max: 20)
  end
  gen_vote(name) do
    tuple(like: {
      value(:vote),
      value(name),

    )})
  end
}}}


</pre>
</div>
<div title="Genetic Algorithms in Rust" creator="Steve" modifier="Steve" created="201601082127" modified="201601082136" tags="#codemash 2016" changecount="3">
<pre>Raymond Chandler III
@raymondchandler
https://github.com/kitanata/genetics

Fighting borrow checker
```
let v = vec![1,2,3];
let v2 = v;
```

v2 now owns v, v is pretty much worthless.
**Only one pointer can point to a spot in the heap**
Functions can move ownership - calling a function and  passing a ref means it's gone to you.
Primitives are &quot;copied&quot;.
`



You can hand back ownership in a function by returning it
```
fn foo(v1: Vec&lt;i32&gt;) -&gt; vec&lt;i32&gt;, i32 {
  (v1, 5)
}
```
Can also pass refs
```
foo(&amp;v);
fn foo(&amp;Vec&lt;i32&gt;)
```</pre>
</div>
<div title="GettingYourCustomerToWriteAcceptanceTests" creator="Steve" modifier="Steve" created="201301170224" modified="201301170247" changecount="2">
<pre>''Key Question''  Who is it that cares about what you're building?

Using the gherkin as a measure of progress - these features are done, these might not be good tests, this is what we're working on today

Rephrase all conversations as gherkin steps

Whether the gherkin can run or not is not important //to Doug Alcorn//

Writing Acceptance Tests forces a conversation and make expectations explicit.  Gherkin gives us a language that the Whole Team can understand.
Feature = epic
Scenario = story

Rules for communicating status to remote clients
 - If there's not a story for what you're doing, you're doing the wrong thing
 - If your story takes more than a couple days, it's too big
 - You're not really doing anything unless you have a story in progress

Fowler:  (OOPSLA 2000) Because the cost of predicting software is so high, it makes sense to treat it as unpredicatable

Instead of scheduling a meeting, instead start with the question you want answered and encourage a conversation for that.

It's all about talking to your client

!!! Q&amp;A
Psychology of dealing with customers that don't want granular small stories - It's all about the relationship.  To foster breakdowns,  ask questions, do experiments

</pre>
</div>
<div title="Git as a DataStore" creator="Steve" modifier="Steve" created="201601081523" tags="#codemash 2016" changecount="1">
<pre>Kirsten Hunter
@synedra
akamiapibootcamp.com

Git vs Database
DB:
bad at heirarchies, needs infrastructure and maintenance, doesn't do diffs

Git:
lightweight, portable, can use branches to label information, tags to label commits and state.  Logs for free, has grep and diff.</pre>
</div>
<div title="Going Responsive" creator="Steve" modifier="Steve" created="201601071756" modified="201601071756" tags="#codemash 2016" changecount="2">
<pre>Fluid girds
flexible images
media queries

Don't use inline styles, include media query last.</pre>
</div>
<div title="Greatness (video)" creator="Steve" modifier="Steve" created="201709061652" modified="201709061702" changecount="3">
<pre>https://www.youtube.com/watch?v=OqmdLcyES_Q
David Marquet
Turn the Ship Around

! Intent-based leadership

&quot;Who's the Captain here?&quot;

Don't give instructions - given intent
Stop requesting permission - &quot;Captain I intend to submerge the ship&quot;
Moves psychological ownership

! Give control
* Competence - Is it safe?
* Clarity - Is it the right thing to do?

&quot;Captain I intend to submerge the ship&quot;  - it is safe because....It is a good idea because

I don't care how smart you are - 1 person thinking controlling 134 people can't beat 135 people thinking

! Move the authority where the information is
* The software programmer decides when to ship
* The salesman closes the deal

!! This is not chaos
* They make decisions as if the CEO is standing behind them
* Better decisions
* Better execution speed (No delay)
* Feel like they matter
* They are thinking

!! It will feel wrong
* You have been programmed to take control
* You need to give control and create leaders
* Angry at yourself
* Failure -&gt; Go back to the old ways

!! You are creating an environment
GREATNESS</pre>
</div>
<div title="Grow Skills, Grow Code" creator="Steve" modifier="Steve" created="201705041240" modified="201705041346" tags="#aab17" changecount="18">
<pre>Andy Hunt
@PragmaticAndy


!!! Agile development
* Agile development is supposed to be like the Borg.  We will adapt.  Resistance is futile.
* Wrong words - sprint, marathon.  Development is an obstacle course.
* The suck curve - it takes time.

!!! Neuroplasticity
Carla Dweck
- self-modifying brain
- if you think you can't increase intelligence, then you physically can't.  
- growth vs fixed mindset

!!! Pragmatic Learning Plan
# Pick a place and time, What do you want to do next.
** Smart mirror, elm front-end for finances
# SMART goals
# Diversify Topics
** How do you decide when/how to diversify?
** How to take ownership on problems (Extreme Ownership) - //Add to reading list//
# Plan
** Next action
** Year goal
** 5 years, __what will be different__
# Rebalance
** Schedule a re-planning session

!!! Make it stick
* Don't break the chain

!!! Three Track Attack
# Deliver - git stuff dun
# Discover - experiment
# Refine - fine-time and improve

!!! Share the Secret Sauce
* &quot;Good catches&quot; - willing to write down the near-misses if you can take it positively
* What was the thing that made this good catch possible.  What popped in your head?

!!! Shared traffic circle, see if can grab that slide.  Hans Monderman

!!! Iteratoins
* Can''t get it right the first time - don't waste time
* Get it right the last time

!!! Sign your work
* Be proud of it
</pre>
</div>
<div title="Grunt" creator="Steve" modifier="Steve" created="201310012321" modified="201310012321" tags="javascript" changecount="2">
<pre>JS Task Runner (like Rake)
* Joe Fiorini uses it  like guard to run tests

 * chain tasks together for a workflow:  requirejs, copy, qunit, watch</pre>
</div>
<div title="HMAC" creator="Steve" modifier="Steve" created="201501151422" tags="#iot" changecount="1">
<pre>http://en.wikipedia.org/wiki/Hash-based_message_authentication_code

AWS-like security</pre>
</div>
<div title="Hack it before you buy it" creator="Steve" modifier="Steve" created="201501061920" modified="201501062032" tags="#codemash" changecount="3">
<pre>Bill Sempf

* OWASP - has all the tools and stuff

* &quot;Google Hacking&quot; for pentesting

robots.txt - big list of stuff that you don't want people to look at.

Comments should not be revealing, don't hide files, deploy as little as possible.
Services exposed for mobile are ripe for attack
Client objects can be decompiled

Failing to handle exceptions allows the pentester to know TOO much about the system and potentially take the app down.


Research -&gt; Exception -&gt; Source -&gt; Research

Attackers do not use a web browser (they use proxies and scripts)

!! All data is evil
* Incoming data
* Outcoming data
* 3rd party data

!!! Reflected XSS
The error you encountered was: &lt;%= Request.QueryString(&quot;error&quot;) %&gt; for blah.com?error=&lt;haxor code&gt;

!!! Stored XSS
$.post (&quot;insertRecord.php&quot;, { field: &quot;Comment&quot;, data: &quot;&lt;script&gt;haxor code&lt;/script&gt;&quot;})

!!! Preventing XSS
Get Data -&gt; Encode it -&gt; Transfer it

!!! DOM XSS
basically anytime user input is directly executed as javascript (like &quot;hi Steve!&quot;)
</pre>
</div>
<div title="High Performance via Psychological Safety" creator="Steve" modifier="Steve" created="201705041720" modified="201705041844" tags="#aab17" changecount="7">
<pre>Modern Agile
modernagile.org

Heidi Helfand
Joshua Kerievsky

Secure - without fear or care

!! Psychological Safety needs:
Be yourself
Make mistakes
Take risks
raise problems
ask questions
disagree

Amy Edmunson - Teaming
Fear of being seen as
* ignorant, negative, disruptive, incompetent

In Psychological Safety - Silence Kills

!!! Have you changed your behavior to avoid being seen as ignorant, negative, disruptive, incompetent?
* DoD meetings
* When I want the meeting to end
* When I think others want the conversation to end

The leader's job is to drive out fear

!!! The horsemen
Criticism, Contempt, Defensiveness, Stonewalling
What's your &quot;go to&quot;
What shows up in your team?


!!! Empathy Triangle
- my view
- their view (imagine it)
- relationship view (why does this matter)

!!! C.O.I.N
* Context - Neutral 
* Observation - Factual
* Impact - How I felt
* Next Time - How it could be better

-Trying to integrate with an unknown part of the system
- I was struggling and asked for help several times.  
- I felt abandoned.  When I tried to soldier through independently, I found there were a number of bugs in the implementation.  Then I got angry.

!! Psychological Safety in Meetings
* Smarter, Faster, Better -&gt; Book list
* Encourage everyone to contribute
** Keep track of everyone who speaks - tick marks - easy way to see if it's safe for everyone to contribute
** Individual / Pair / Group - breakout activities
** Lean Coffee
** Brainstorm / Stickies
** Set-based design
*** Each individual or small group solves the problem individually.  Then bring them all together to get &quot;best of breed&quot;
* Listen to One Another
** Level 1:  Focused on yourself
** Level 2:  Focused on the other person
** Level 3:  Focused on body language &amp; environment
* Review/Repeat Other People's Points
* Avoid Dominating or Interrupting
** Facilitators can help
** Give feedback privately
* Be Caring, Curious, and Non-Judgemental
** &quot;I'm curious.  Why do you think that?&quot;
** Don't rush through the &quot;Groan Zone&quot;

</pre>
</div>
<div title="Holiday LIght Fight" creator="Steve" modifier="Steve" created="201502181403" changecount="1">
<pre>https://onedrive.live.com/?cid=59d41466dbc75b47&amp;id=59D41466DBC75B47%2141451&amp;ithint=folder,mp4&amp;authkey=!ANVrmMtni6D5uGk

</pre>
</div>
<div title="How Does &quot;Complexity&quot; Change the Game?" creator="Steve" modifier="Steve" created="201705041412" modified="201705191353" tags="#aab17 #selfconf17" changecount="7">
<pre>@geepawhill

! self.conf

!! Software Development Excellency

The Flock and the 3 Flows
* Valued Results - I show it to you, you tell me if you like it
* Geek Joy - when we're in, we're all in
* Courageous Curiosity - Ask real questions and get real answers

!! Complex vs Non-complex

Linear error factor - if you're a little wrong in the guess you're a little wrong in the result - this is a sign on non-complex system
complex system - any error mean any result - can be off by an order of magnitude, or be completely impossible.

Make small changes and then reset.  Start from zero.  Radically revise your approach.  Don't assume you can do the same thing twice.

Every practice has to prove itself in every practice.  It has to be working in practice.


!! Optimize for collaboration 
* It backs us when you follow a change and revise methodology
* Frequent Focused Direct Dialog

1) Thinking outside your head
* Power of expression forcing thinking
2) Energy Balancing
* Constant change is very draining
* More peaks because our energy curves are not perfectly in sync
3) Shock Absorption
* When the thing we're centered on jerks around it's a shock to each individual
* complexity exists in 100% deterministic systems (no randomness)
* with collaboration, our relations cushion us when the center moves
4) Domain Bridging for Ideas
* Most ideas come from other domain
* More people = More domains = more ideas
* Insights per hour

!! Activities
* Coding to Target - I know what I want to do, I just need to execute
* Coding to Experiment - Have an idea, need to feel out the solution

!! Dependencies
Help make things work - especially early on
* Physical space
* Permission - Mental space
* Inception - Encourage alot early on.
* Technique &amp; Practice - This isn't &quot;natural&quot;, real skills need practice
* Voluntarism - you need to be deciding, teaching, or learning
* Inclusion - invite everyone
* Acceptance - no one can do all the things well.  Every strength is a weakness.  Every weakness is a strength.

!! Is it working?
Buzz, whiteboards churing, tight standups
Not working:  forced engagement, conflict suppression, room elephants, long process discussions, 

! aab17

!! Software Development Excellency

The Flock and the 3 Flows
* Valued Results -&gt; Where are we going?
* Geek Joy -&gt; How will we get there?
* Courageous Curiosity -&gt; Where are we now?

//Suspect All Systems//

!! Complexity
* The theory is rich, but very little practice


!!! Three difficult ideas
# Intricacy is Not Complexity
* Lots and lots of parts = intricacy
* Not complex -&gt; those parts are often predictable 
* Running software in the browser is intricate, not complex
* Complex things don't need lots of parts (they certainly can)
* The parts have agency -&gt; I don't know how this works.  Not just a black box.  I do the same thing twice and get different results.  It's unpredictable.
# The Predictability Knee
* We think that estimates that are further out are a less accurate.  And the further out, the less accuracy.  It feels linear.
* Predictability is actually a huge drop off.  There is a point where once you get far enough out, accuracy drops to zero.
* I can't choose to be more accurate past the &quot;knee&quot;.  It's not possible.
* The &quot;point of the knee&quot; is difficult to figure out.  The horizon.  
* We don't know how long it will take to get from A to B.  What's worse:  We don't know if it's possible to get there.
# Step Tree vs Step Sequence
* We think if we break into 5 steps from A to B we'll fix it.
* We can't get there in a linear fashion
* We're mostly trying not to step away from to A
* We don't know our &quot;new&quot; small destination is achievable either

!!! Professional software development is all-in, all-the-time, all-around, compexity
* Too many unpredictable agents/actors
* Assume every practice has to justify itself
* Change everything that doesn't work

!!! Optimize for Collaboration
* We have a constant need of ideas (ideas per hour)
* More domains, more ideas, more people
* We need people to give us stability (the problems are ever-changing)
* We need Juice
* Nobody can be on all the time
* Accept peaks and valleys
* Frequent Focused direct dialog (F2D2)</pre>
</div>
<div title="How and Why to have inclusive meetings" creator="Steve" modifier="Steve" created="201705202001" modified="201705202045" tags="#selfconf17" changecount="2">
<pre>@catswetel

Cool idea: a request stack...something goes on, something must come off.
Diversity is being invited to the party, Inclusion is being invited to dance
Watermelon project - green on the outside, red on the inside

Tips: 
* Introduce Participants
** Point out why Sue needs to speak up - Glad you could make it Sue, you can tell us about the mainframe
** A way to assign roles in the meeting

* Schedule the meeting
** You set the agenda
** Can frame roles in the agenda
** Create an enviroment for success

* Set team agreements
** Can we agree that no cell phones / laptops?
** Chatham House Rule - You can share the stories but strip out the identifying information

* 1- 5 exercise
** Do a fist of five, I'm a 5 I can't handle silence, 1 I would rather than do anything but talk in front of a group
** No 3's!

* Lean Coffee  
* End the meeting

The Discipline of Noticing
* Account of the event -&gt; Just make observations, no judgements (Don't account for)

</pre>
</div>
<div title="How to Like People You Can't Stand" creator="Steve" modifier="Steve" created="201705201733" tags="#selfconf17" changecount="1">
<pre>@onealexharms

&quot;To speak up without fear&quot;
&quot;Safety happens one person at a time.  It's an emergent process&quot;

----
Carl Rogers:  People have what they need inside of themselves and he can assist them with finding it.

Conditions for Therapeutic Change:
1. Congruence
2. Empathy
3. Consistent Fondness

!!! Congruence
How I see myself and how I want you to see me is aligned.
No bullshit
Align your values with who you are.  Do the work.

!!! Empathy
The ability to understand what someone else is feeling.
Empathy can be learned.
What needs might this person be trying to meet?

Courageous Curiosity - What's going on inside this person?
Joyful mistake making
</pre>
</div>
<div title="How to Scratch an Itch" creator="Steve" modifier="Steve" created="201709022050" changecount="1">
<pre>@searls
http://blog.testdouble.com/posts/2016-12-01-a-creativity-talk
Creative ideas stress me out -&gt; How will I find time to do them?

Don't cede control of your happiness to someone else
 
1. Inadequacy -&gt; People to imitate
2. Indignation -&gt; Something to say
3. Incompetence -&gt; Always have room to improve

* Recognize when it's safe to make a mess
* Find the smallest thing you can get caremad over
* Working code can sell ideas
* Ideas require no maintenance!
* Popularity without purpose is toxic
* No shame in &quot;hobby-grade&quot;
* Selfish toy-apps can inspire
* Not getting through?  Tweak your message
* Criticism is easier than contribution
* It's okay to build things for fun

What thing bothers you -&gt; Reflect -&gt; Take those ideas and find an outlet</pre>
</div>
<div title="HowNetflixArchitectsForSurvival" creator="Steve" modifier="Steve" created="201401091459" modified="201401092041" tags="#codemash 2014" changecount="9">
<pre>@jedberg

!! Netflix Way
* Built for three - three of everything
* Automated
* Fully automate machine image bakery (no chef or puppet)
* Automated deployment
* Every Independent teams responsible for DEV and OPS
* Redundancy through mult-regiion deployment

!! Freedom and Responsibility
* Hire responsible adults and give them the freedom to do what they think is right
* Things usually don't break
* Manage capacity and autoscaling
* Fix anything that breaks at 4am!

Shared state should be sotred in a shared service - replicate data everywhere

Engr boot camp to teach them how to build in a highy distributed (highly redundant) environment

2B requests per day into the Netflix API
Netflix has all the content stored on a local CDN, rest is on amazon

!! Highly aligned, oosely coupled
* Teams are good at communicating
* Auto-scaling (SOA)
* Effects are narrow

!! All systems choices assume failure is inevitable
* Reliability vs $$
* Chaos Monkey

!! Asgard
Cloud orchestration tool - modifies Amazon - open source
# Push code,
# Launches new cluster with the new software (as an image).
# Load balancer
# Use new cluster
# Delete the old cluster after a day
#  If something goes wrong the balancer can shift some of the traffic back to the old code, or all of it if the new code is SNAFU
* ''Moves granularity from the instance to the cluster''

!! Why Bake?

* Take Base Image
* RPMs
* Jenkins / Yum / Artifactory

* Own your service, own your machine, pick your platform, language, etc, doesn't matter

!! The simian army
* Chaos, Latency
* Everyone knows chaos monkey is coming and builds for it

!! Data
* Cache (memcache)
* Cassandra
* little bit of MySql (fringe)

!! EVCache
* open source
* Wrapper around memcache
* Replicates writes to multiple zones
* Pulls cache data from local zone first (affinity)

!! Cassandra
* Distributes data around the ring
* Horizontal scaling is easy - just add more nodes
* Uses quorum among distributed nodes to determine what will be returned - caller configured
* Prefer availablity over consistency
* Prefer Writes over reads
* Jave-based
* Open-sourced and with commercial support
* Fast negative lookups

!! Going multi-zone
* Loosely connected
* Low latency between zones

!! Leveraging Multi-region
* Claim: 100% uptime is theoretically possible - IF you replicate all your data

!! Acitve/Active
* Data replication challenges
* Cache invalidation
* Misdirected user
* Sudden load increase during failover
* When do you fail over?
* How do you replicate cache?

!! Cache Replication
* Three strategies
** No replication - recommended.  Can you write your software to work without data replication?
** Invalidation only - default mode.  Just re-grab data from the database again when you fail over.
** Full copy - For the teams using memcache as a DB

!! Failover
* Need to scale up
* Need to route misrouted users back &quot;home&quot;
** Mismatch between actual IP and resolver location
* Blog post on netflix (active/active failover)

!! Chronos
* Logging/Event tool

!! Best Practices
* Incident Reviews
** No blame
** What went wrong?
** Detect it sooner?
** Prevent it?
** Prevent this class of problem?
** Improve our reaction to this kind of problem?

!! Circuit Breakers (Hystrix)
* If your dependencies are failing, return a default response
* Gives dependency a chance to recover, rather than hammering it

!! Autoscaling
* Obviously good for peaks
* Good for scaling down too.  Reduces complexity, deployment times, etc
* Leads to renewal of machines as well

!! DDOS
* Believes Amazon has some DDOS protection
* Autoscaling covers peak problems

!!
* No teams share data, all access is through the service
</pre>
</div>
<div title="HowToBeAFunctionalProgrammerWithoutBeingAJerkAboutIt" creator="Steve" modifier="Steve" created="201401101503" modified="201401101533" tags="#codemash 2014" changecount="2">
<pre>@NathanDotz
https://github.com/sleepynate

!! Intro
* Command pattern is same as passing functions

!! Definitions
* A monad is and object that lets you use the object inside it
** Lists are monads

* Functors are stuff you can map over
** Lists are functors

* Applicative functors are stuff you can map over and get a stuff of functions back

* Currying is a function that takes and argument and gives you a function that does the same thing with one less argument
** Special case of applicative functors

!! Crib sheet
* Declare, don't assign
* Calculate, don't mutate
* Pattern match, don't if-else
* recur, don't loop
* pass functions, not structs
* map, filter, reduce</pre>
</div>
<div title="Hypothesis Driven Development" creator="Steve" modifier="Steve" created="201311101900" changecount="1">
<pre>http://barryoreilly.com/2013/10/21/how-to-implement-hypothesis-driven-development/</pre>
</div>
<div title="Idea to Impact" creator="Steve" modifier="Steve" created="201507121428" modified="201507121430" changecount="6">
<pre>https://www.facebook.com/notes/990860537613477/

Kent Beck on how he spreads ideas.

# Adopt personally
# Find the totem
# Repetitively broadcast

!! Adopt personally
Seems obvious, dogfood and work on the theory and mechanics of the idea.

!! Find the Totem
Starts talking one-on-one with the idea that he will fail to explain the idea well.  Focus is on spreading the idea, not convincing everyone that every part of the idea is worthy of consideration.  The idea is to find the hooks that make this resonate.
//This is obviously a problem with my failure talk and how reluctant I was to cut any part//

* Name.
* Motto.
* Metric.
* Mascot.
* Gesture.
* Utopia.
* Abbreviation.
* Diagram.

!! Brute Repetition
This is hard and it sucks.  It takes years and decades of repeating yourself.</pre>
</div>
<div title="Influencing Teams with Psychology" creator="Steve" modifier="Steve" created="201306011824" modified="201306011922" tags="pghtechfest" changecount="4">
<pre>Robert Cialdine Influence - The Psychology of Persuasion
Switch

'' Giving ''
Give gift
Give time
Set a rule - give a pass


''Commitment Consistency ''

After making a commitment you'll work very hard to keep it
 - Get people to make concessions and keep twisting - Chinese army did this to make soldiers look like they were against the US

Standups create commitment consistency by getting people to publicly declare what they will do today

Commitment consistency will cause people to follow through on a commitment even when conditions change and make it a bad idea or impractical or violates the original spirit on the commitment.

Scrum changed from team commitment to team forcasting to allow for teams to change with conditions rather than sticking with bad commitments.

'' Authority ''
 - Can use second hand - &quot;Kent Beck says..&quot;

'' Scarcity ''
Let's do this for a short amount of time
Quantity scarcity, knowledge scarcity

'' Social Proof ''
- If nobody's doing nothing then it must already be taken care of
Vague blanket statements - everyone assumes someone else will do it
Pick someone!  Force action.

'' Liking''
Body language mirroring - miror inflection, speed, temper of the voice - helps make connections.  People like themselves and like people like them.

&quot;I'm one of you, I want to work with you, make it easier for you&quot;

</pre>
</div>
<div title="Innovators" creator="Steve" modifier="Steve" created="201505061637" tags="#bookclub" changecount="1">
<pre>Key concepts of Industrial Revolution:
* Break endeavors into small, easy tasks (assembly line)
* Mechanize some of those steps</pre>
</div>
<div title="InterestingQuestions" creator="Steve" modifier="Steve" created="201401120315" changecount="1">
<pre>* Who do you most admire and why?
* In your last employee review, what areas for improvement were identified?
* Why are you here?
* What is your passion?
* Describe an environment in which you would not thrive.
* If you could do anything, what would be your ideal job? </pre>
</div>
<div title="Interview Questions" creator="Steve" modifier="Steve" created="201307180027" changecount="1">
<pre>Tell me about a problem you solved recently.

Tell me about your most recent project: what was your role?
What kinds of challenges did you have?
Tell me about the problem you solved that you have the most pride in. When was it and what happened?

Tell me what you are learning about these days.
-Books
-Side projects</pre>
</div>
<div title="IntroToAndroid" creator="Steve" modifier="Steve" created="201301170217" modified="201301170233" changecount="2">
<pre>!!Intro to Android
developer.android.com /-- Start here, most popular google hits are out of date :)
Use android support library (selection in SDK)
Create Android Application Project
Create an android virtual device(AVD)
  - Set an SD card
  - Create snapshots (VM style)
Launch AVD from AVDM

Activity - Intent - App  whats the relationship?

Everything in res is autogenerated into R.java
* If this gets out of wack, clean your project

Everything in android is a view - buttons, controls, etc are views
Activity.onSaveInstanceState - used to save everything when user changes orientation, switches app, etc

----
Can I write an app for alec?  Click on letters to spell words?

ABCDE
FGHIJ
KLMNO
PQRST
UVWXYZ

Pick C
filter letter list based on dictionary?

AEHIORUYZ

After finishing a word go grab an image from wikipedia of it?  (hmmmm...could get messy)
----

Intents wrap Activities
An activity can launch another activity by creating an intent.

Hand off loading to Loader (vital if doing network, probably good idea regardless)
Use AndroidHttpClient to execute web requests
Open templates for requests using a resource from the context</pre>
</div>
<div title="Is Pair Programming for Me?" creator="Steve" modifier="Steve" created="201502081834" changecount="1">
<pre>http://arlobelshee.com/is-pair-programming-for-me/

* Pairing is a skill you have to learn
* Mostly communicative norms, like a foreign language
* Arlo converted 198/200 people to pairing (introverts, skeptics, etc)

* If pairing is not working, then it's because the team has taken for granted how hard it is to learn
* 3 weeks to break-even productivity if pairing 100% of the time

!! Cronology
* First two days - this is a good way to collaborate and learn
* End of first week - this is exhausting, too much noise
* 2nd week - same
* End of week 2 - filters are starting to build, still hurts
* Sometime in week 3 - Huge payoff is discovered:  huge bug fixed easily, fewer meetings, pair-thinking, etc
* week 4 - lots of wins, lots of converts

!! Arguments
* What about half-day pairing - probably takes longer.  Approach pairing as an experiment, something the team wants to learn/try.

!! Arlo rules
* Full team must commit
* 4 week commitment
* It's an experiment that can be abandoned
* Team understands it will learn these skills
** Speak in half-sentences (allow the pair to pick up)
** How to talk about unformed ideas safely (accept a low signal-to-noise ratio)
** Establish subconscious filters
** Collaborate creatively
** Collaborative research
** Collaborative analysis and deep thinking


* </pre>
</div>
<div title="It's An Experiment" creator="Steve" modifier="Steve" created="201508020124" modified="201508020132" tags="#grows" changecount="4">
<pre>http://blog.toolshed.com/2015/05/its-an-experiment.html - Andy Hunt

!!! Very few &quot;Agile&quot; teams are actually agile
* Not adhering to a particular methodology
* Continuous Deployment might be the shining indicator of a truly agile team
** &quot; It doesn鴠matter if your design is awesome and you鶥 figured out the customer鳠needs if you can鴠then actually get software out the door consistently, reliably, and automatically.&quot;

!!! No one likes change
&quot;What folks want is new and different results. Preferably for free, without having to change anything significant. But most of all, folks really don鴠like to be changed. For any chance of success at all, change needs to come from one鳠own desire. It鳠like the old joke where the lightbulb has to want to change. &quot;

''What's the upside for me?''

!!! Experiments as a first-class feature of the methodology
* &quot;For novices, the feedback and evaluation are very concrete and unambiguous, with no judgment required. That part comes later.&quot;
* Experiments are time-boxed
** Limit risk, limit the &quot;change&quot; fear
* Everyone participates in the experiment and the evaluation
** Put your egg in
** Participation is KEY

!!! Build feedback loops to advance
* Try it before you &quot;buy&quot; it
* Encouraged to modify and reject experiments



</pre>
</div>
<div title="I’m a woman in tech, and this is what I want in a company" creator="Steve" modifier="Steve" created="201706201129" modified="201706201131" changecount="9">
<pre>https://code.likeagirl.io/i-am-a-woman-in-tech-and-this-is-what-i-want-in-a-company-f6177569a287

!!! Don't talk, show

* See another woman, ideally on the team.  Need to feel safe to ask questions, it is easier to ask a woman
* Meet + chat with members from every team, see how awesome they are

!!! Tell me how you're going to help me grow
I won't ask for promotions, I want to know what the expectations are so that I know when I've leveled up and can move to the next thing

!!! I should forget that I'm a minority, *but* be supported when I remember

&lt;&lt;&lt;
If I tell them I want more women to get into tech I want them to say “So what are you going to do about it?” and know that they will push and support me.
&lt;&lt;&lt;

!!! Help me fight my imposter syndrome

&lt;&lt;&lt;
A lot of people don’t like to brag or bring attention to their accomplishments, that’s why you need to do it for them. Seeing others be supportive of their team mates and brag about other’s accomplishments is a powerful thing. That is an environment you can’t fake, and everyone deserves to be a part of.
&lt;&lt;&lt;</pre>
</div>
<div title="Java8" creator="Steve" modifier="Steve" created="201401092210" changecount="1">
<pre>* Closures
* Interface enhancements
* Bulk collection

shapes.forEach(s -&gt; {
  if(s.get Color() == RED)
    s.setColor(BLUE)
}</pre>
</div>
<div title="Javascript Speech Recognition" creator="Steve" modifier="Steve" created="201703081842" modified="201703091608" tags="#confoo" changecount="2">
<pre>@macdonst
Anyyang - 2K great library
github.com/macdonst
</pre>
</div>
<div title="Leadership Starts With An Invitation" creator="Steve" modifier="Steve" created="201705051251" modified="201705051316" tags="#aab17" changecount="3">
<pre>@docondev

An invitation is not a command or order, it is request or enabler.  Encourage, not mandate.

Both Lord-leader (Command and Control) and Servant-leader are extremes on a spectrum.  

Servant Leadership is a poor model.  The 7 pillars tell us who a leader should be, but not what they should do.

A leader can never answer the question:  &quot;Do I lead with moral authority?&quot;  It can only be given to you by every person you lead.  And it can be ripped away by a single misstep, a single betrayal.
------------------------
Let go of your expectations, let what *is* to emerge.

----
Host Leadership

* Initiator - provides the spark
* Inviter - invites others 
** &quot;What sort of invitations do you send&quot;?
* Space Creator - creates the &quot;right kind&quot; of space.  Sets up the rules for the interaction.
* Gatekeeper - defines and protects the space.  Enforces the rules.
** Reminding team agreements
* Connector - puts people together.  Enable conversation.  Bridge the gaps.  The glue.
* Co-participator - Be a member of the team.  Experience.







</pre>
</div>
<div title="Leading Hackers &amp; Hacking Leaders" creator="Steve" modifier="Steve" created="201701132055" modified="201701132135" tags="#codemash 2017" changecount="2">
<pre>@jonathanpopham

In essence, a community is a collection of relationships.

!!Social capital
* trust, reciprocity, cooperation
* difficult to build, how likely people are to do something for you, how likely you are to help out.  

!!! Trust
* You do the things you say you'll do
* If you know there is a trust boundary, don't get too close to it.  Don't press your luck.

!!! Reciprocity
* Do good things without being asked
* If someone does something good for you, repay that in kind

!!! Cooperation


!!!Positive Conflict Resolution
* Accept conflict, look for good result
* Interested in building relationships (between the parties and between each party and you (relationship-triangle?)

!!! Find Out
1.  What is the main problem?
2.  Who is involved?
3.  When/where did it happen?
4.  Is this dangerous?
</pre>
</div>
<div title="LeanStartup" creator="Steve" modifier="Steve" created="201307092047" tags="ux" changecount="1">
<pre>Lean
* Improve Cycle Time
* Smaller Batches
* High Quality

Startup
* Major disruption environment
* Customer uncertainty
* What do people want?
= __Lean Startup__
* Avoid Building the Wrong thing efficiently
* Find the Right Thing</pre>
</div>
<div title="LeanStartupKids" creator="Steve" modifier="Steve" created="201309181603" changecount="1">
<pre>Strategic:
* Remove barriers to real-world
* Help kids open up
* Push boundaries
* Building empathy

Tactical:
* Mobile apps are the bridge to real-world pitches - Give kids scaffolding
* Change perspective by changing environment
* Get Out - ''Iterate'' - Pivot
* Embrace Failure - Let them fail
* Self eval, Peer eval
* Constant communication creates safety + comfort

Actionable:
* Great Idea gong
* Taught by critique
* No tutorials
</pre>
</div>
<div title="Leandog ideas" creator="Steve" modifier="Steve" created="201501091443" changecount="1">
<pre>IoT client giveaway - neat lamp that lights up when mentioned on twitter

Hackathon every 2 months?

How do we build slack?

</pre>
</div>
<div title="Learning to Fail Fast at DNSimple" creator="Steve" modifier="Steve" created="201705072054" modified="201705072056" changecount="2">
<pre>https://blog.dnsimple.com/2017/02/learning-to-fail-fast-at-dnsimple/

* Fail as Fast as you deploy
* Failing Fast helps avoid Sunk Cost Fallacy
* Stop and figure out what you learned
* Start over with knowledge to avoid failure areas</pre>
</div>
<div title="LegacyCodeRefactoringBlogPost" creator="Steve" modifier="Steve" created="201309221436" changecount="1">
<pre>So I've tried to explain a phenomena to a few people lately and I keep falling flat.  I can only conclude I'm explaining it badly, or it's a solved problem that I haven't seen the solution for.

So imagine some legacy code.  My most recent example was a chunk of a few thousands of lines in a class spread across a handful of methods.  Pretty much status quo for this app, but this was particularly painful because it was a huge chunk of the business rules for various validations.  There was temporal coupling, where half the code was basically ignored under some conditions.  This caused some issues when we'd go to add new checks - it wasn't apparent that this 1200 line chunk was effectively dead code under normal operations, because the coupling was enforced three layers up.

So we did our due diligence and got most it under test coverage.  At least to the point where we felt comfortable pulling at it a bit.

It's hard to describe test-driving a change where the &quot;wrong&quot; solution is already in place.  Here we have 6 years of tweaks and pokes of fairly complicated code all dumped in the middle of an even larger class (this logic is probably 5% of the total class size).  It's a big, awful, mess.  I had two goals in mind:

1)  Make the temporal coupling explicit
2)  Put a fence around this minefield

So here's where I have trouble explaining what happens.  Here I have a chunk of code.  I want to change it safely with small refactorings.  So I make a small change.  Run my tests.  Repeat for hours/days/whatever.  Unfortunately, unlike &quot;normal&quot; TDD - I'm not getting feedback on design direction.  I'm running my tests constantly and staying green, but I have no idea that this idea for trying to pull out a class is a good one.  Or that changing the return value on this method helps in any way.

I think part of the problem in my explanation is that I'm saying &quot;refactor&quot; but I'm really talking about &quot;re-design&quot; in a significant way.  Refactoring a class is easier to think about; hopefully I can wrap my mind around all the relevant parts and keep seeing the simple steps forward.  This is still refactoring in the application sense, I don't want to change it's behavior.  However I do often want to change how several classes work together to simplify the design.  With TDD that's easy (for me), I just listen to the tests.

Normally in TDD I can listen to my tests.  If the setup is excruciating for a test case I can see where it needs to change.  If the assertion is complicated, I can see that I'm probably testing via the wrong method.  If I'm copy/paste/hacking chunks of code around, that's an alarm that I'm making this too hard to understand.  Tests provide great FAST feedback on design decisions.  I detect obvious seams and can see where my classes are taking on too much responsibility.  I can make little experiments very quickly and get that fast feedback where a first class collection worked well here, but introducing this value object didn't clear much up.

With this case - we have a ton of painful tests.  Think about how many unit tests we needed to cover all the conditional complexity in this example.  I'm completely immune to this pain - I just spent days sucking it up to get the code under test.  And I don't want to change these tests - they're now my safety net for future change.

So yes, I make my changes.  I run my tests.  I keep the bar green.  But I'm not getting anywhere.  I might spend hours gradually building the wrapper for this code and plumbing it through the layers.  Just to find that it won't work because X.  Or it's making things worse!  Some abstractions just don't work.  How many code bases have I dumped a new idea into that didn't take off?  Too many code bases are swamps of vestigial tails.

I've only stepped away from one of these sessions twice feeling like I'm now &quot;ok&quot; with this code.  *That* problem won't haunt my dreams forevermore.  The first time I was extremely lucky.  Everything just worked, I focused my chi, I was guided by the Muses - just one of those &quot;zone&quot; experiences that only seem to happen at the rarest of times.  Generally I fail/fumble my way to a solution - I tell myself it's the scientific method.    I have no idea how to reproduce this miracle, I took small refactoring steps as I'd prefer to, I just always picked the right one that led to a simpler solution.

The second time I essentially started test-driving the solution from scratch.  I built the whole thing up again, using the existing tests as my guide.  And then I had a big-bang switchover where I drove the new solution with the old tests before deleting those monstrosities forever.  And that sucked.  First there was the process of doing 4x the work of just getting it under test in the first place and hacking something together.  Then there was the problem that the new solution was completely worthless until it was done.  Then there was the integration step at the end.  Back to the bad ol' days of pulling it all together at the end and wondering why it didn't work.

I've tried to detect places where you can split the big ball of mud and test-drive those into smaller-bang switchovers.  But I seem to pick the wrong splits to keep my old tests working and still move towards a better design.  In this case we were just trying to get it all into a single terrible class.  And we couldn't figure out how to get there from here without breaking everything.  Twice.

Every other time, I've tried what seems like the safe route.  Get it under test.  Refactor the obvious stuff.  Hem, haw, and pontificate.  Get burned out and move on to something else.

There has to be a way to handle this problem.  If not, we're screwed, because code like this isn't going to be wished away.  It's strange that when we build every line of code of a project with an eye to the future,  it doesn't last.  But if we get a few things right, we can pile terrible hacks on top of it for decades and it just keeps plugging along.

Any ideas?</pre>
</div>
<div title="LegacyCodeRetreat" creator="Steve" modifier="Steve" created="201303311231" changecount="1">
<pre>http://legacycoderetreat.typepad.com/blog/2011/11/how-i-run-legacy-code-retreat.html
http://www.github.com/jbrains/trivia</pre>
</div>
<div title="Lessons Learned from a Long Lived Codebase" creator="Steve" modifier="Steve" created="201501091737" modified="201501091814" tags="#codemash" changecount="2">
<pre>Jeremy Miller @jeremydmiller
shadetreedeveloper@gmail.com

First used in production in 2004
Nothing remains but the name.

!! Long lived codebases
* language has evolved
* use cases become obsolete
* new cases become very important
* architecture is obsolete (no xml)
* Tooling evolves
* performance and threading issues due to adoption outside the original case

Need feedback mechanism to evolve

&quot;Crimes against computer science&quot; =  Instead of re-architecting  just bolt it on.
** Used chain of responsibilty to fix a deep copy

!! Architecture cannot be Set in Stone
* Should have done a rearchitecture
** Key question:  Why is this thing I'm trying to do so hard?  Don't get locked into a bad idea.

!! Re-write or Improve in Place?
** Started a re-write, got distracted, bombed.

!! Automated Testing
* You have to do both acceptance and unit level
* Self contained acceptance tests - test inputs should be defined with the setup (no fixtures for acceptance tests!)
** Follow same rule with unit tests - duplication is A-OK

!! The great refactoring
&quot;When we say big refactoring we're lying...It's fine I'm just rewriting the whole data layer&quot;
* Introduce an alternative programmatic configuraiton
* New, better ways to do it
* Tried to shove a bunch of wouldn't it be cool features

!! Don't couple runtime code to configuration
* Aerosmith doesn't setup the stage
* Roadies do configuration

!! Build features for real needs

!! 2004 vs 2015
* 2004 Everything explicit &quot;never surprise me&quot;
* 2015 Try to figure it out &quot;just let it work&quot;

!! API
* Don't let the impl bleed through the API - hard to change
* Be the client first
* Be consistent

!! Diagnostics and Errors
&quot;Here's your error.  And here's what you might do to fix it.&quot;
If you have any magic - provide diagnostics that explain the magic for a given input

!! Documentation
&quot;Do as I say, not as I did....&quot;
&quot;Living&quot; documentaiton - part of your build process. - save yourself the future headache - bad documentation is a constant pain point.
*** DocTest

!! The cost of backward compatibility
* You cannot win
* Take the trash to the curb
* &quot;Python 3000&quot;
* Semantic Versioning</pre>
</div>
<div title="Life after Nil" creator="Steve" modifier="Steve" created="201701121534" modified="201701121608" tags="#codemash 2017" changecount="9">
<pre>@samjonester

!!! Concepts
Forget about nil
declarative modeling
composition
Let the compiler drive

!!! Forget about nil
* &quot;Whats the return type?&quot;
* if nil is involved, it MAYBE will return the correct type
''consistent return type''

Maybe ''will'' go viral =&gt; good thing
Can handle errors at the edges.

!!! Declaratively modeling our domain
WE can't control transitions. Going from creation time to &quot;full valid&quot; object provides a state where a model might be inconsistent.
So we code defensively to keep things from blowing up.

//Interesting observation!//

Haskell forces us (via compiler) to handle all the types of the customer whenever we use a customer.

!!! Composition
* Use domain concepts as things
* Build big things from little things


Change is cheap before the implementation

''Types provide context''
{{{
  type chunks :: [String]
}}}

//I like this idea of types avoiding primitive observation - seems cheaper than a class//


</pre>
</div>
<div title="Magic Mirror" creator="Steve" modifier="Steve" created="201502191344" changecount="1">
<pre>Build a mirror with live data (weather, calendar, notes)

15&quot; LCD with 12&quot;x12&quot; mirror seems the cheapest, materials in the $150 range.

http://www.raspberrypi.org/magic-mirror/
http://michaelteeuw.nl/post/82565319113/magic-mirror-part-iv-install-the-hardware
http://www.eetimes.com/document.asp?doc_id=1278280
http://www.hiddentelevision.com/sample.htm
http://www.hiddentelevision.com/samsungledmirrortv.htm
http://www.hiddentelevision.com/diyframelessmirrortv.htm
http://www.hiddentelevision.com/mirrorpricequote.htm

Or a LCD controller
http://www.ebay.com/usr/e-qstore
http://www.element14.com/community/people/knight_rider1977/blog/2013/11/26/hp-lcd-screen-comes-back-to-life

Or a LCD controller + screen
http://www.sainsmart.com/7-inch-tft-lcd-monitor-for-raspberry-pi-touch-screen-driver-board-hdmi-vga-2av.html</pre>
</div>
<div title="MainMenu" creator="Steve" modifier="Steve" created="201301261658" changecount="1">
<pre>[[TabTimeline]]</pre>
</div>
<div title="ManagingHumans" creator="Steve" modifier="Steve" created="201401111544" modified="201401111753" changecount="4">
<pre>!! Six questions you should know the answer to about your manager
* Where does your manager come from?
* How does your manager compensate for their blind spots?
* How does your manager communicate to the rest of the org?
* How does your manager talk to you?
* Do they do what they say they'll do?
* Do they make things happen?
* What happens when they lose their cool?

!! Freakouts
* Don't pile on
** Listen, nod
* Give the benefit of the doubt
** They've obviously given this a lot of thought and it concerns them
* Ask questions - try to move towards a rational conversation
* Listen for solutions

!! Agenda detection
* Identify Pros
* Identify Cons
* Identify Issue

!! Make a rolodex
* People you respect and would go to war with again

!! Teams
* Incrementalists need Vision
* Completionists need Action
* Pair Incrementalists with Completionists

</pre>
</div>
<div title="Mentally strong" creator="Steve" modifier="Steve" created="201312142217" modified="201401011856" tags="journal" changecount="2">
<pre>http://www.amymorinlcsw.com/mentally-strong-people/

* Don't feel sorry for myself
* Don't blame others for my choices (My boss made me)
* Embrace change, adapt
* Accept that some things are outside of my control, focus on what I can change
* Don't try to please everyone - be kind and fair
* Don't fear calculated risk (CBA)
* Don't dwell on the past - acknowledge past, embrace present, plan for future
* Don't repeat mistakes
* Don't resent others - celebrate their accomplishments
* Use failure to grow and improve
* Don't fear being alone
* Don't feel entitled - try, fail, adapt, try again
* Don't expect immediate results - anything worth doing takes time</pre>
</div>
<div title="Mentoring" creator="Steve" modifier="Steve" created="201308171337" modified="201308171459" tags="scrc13" changecount="8">
<pre>I need a mentor
 (Venkat, Angela, Doc)?
* What do I want?
** Advice on delegation, letting go, finding time
*** Angela on Collaboration, Cooperation, Delegation - consider each person is an autonomous agent.  They have to agree to be delegated to.
* How do I approach it?
* What do I offer?

How to be sociable?
* Canned icebreakers

!! Mentoring
* What is the one thing a student can do to move them forward?
* Encourage Why? And beginner questions.
* Being Geek - Michael Lopp
* How to get an inexperienced mentee engaged with solo experimentation and discovery?
</pre>
</div>
<div title="Minimizing Design Risk wit the Minimum Viable Product" creator="Steve" modifier="Steve" created="201408141851" modified="201408141857" changecount="2">
<pre>Will Evans
@semanticwill

6 Keys to Lean Startup
* Uncover your customer's pain points through research
* Invalidate your assumptions
* Formulate hypotheses
* Experiments, Not Features
* Learning isn't failure
* Amplify what works

Think -&gt; Make -&gt; Check -&gt; Think -&gt; ....
As quickly as possible - start with what you're trying to learn.  What's the smallest thing you can do to get feedback?  1 hour sprints, 1 day sprints.

Lean Startup: Customer Development Process
1)  Problem Solution Fit
Focus:  Validated Learning
Experiments: Pivot
2) Product/Market Fit
Focus:  Validated Learning
Experiments: Pivot
3) Scale
Focus: Growth
Experiments:  Optimizations


!!!Meta-Rules:
1) Clearly articulate &amp; test your assumptions about the customer - &quot;The customer is the person that gives you money&quot;
2)  Get out of the building
3) Fast Think &gt; Make &gt; Check
4) Think in terms of experiements (not features)
5) Iterate
6) Don't sink time into something that hasn't been validated

!!! Minimal viable Product
* Means something different to everyone

In Lean UX - It's the minimal amount of effort you have to do to make one turn of the feedback loop.

&quot;Features based on user stories without customer validation are called guesses&quot;

Maximize:
Solving Customer Problems
Learning

Minimize:
Cycle Time
Waste

The delta between a prediction and the observed outcome is the &quot;amount&quot; you've learned

!!! 4 Kinds of MVPs
* Exploration - investigation with a customer's problems
* Pitch - attempt to sell
* Concierge - Provide the proposed product as a manual service (no software product)
* Wizard of Oz - Small testable model that exists to generate feedback

!!! Vanity Metrics
* Don't lead to action
* Always go up (and to the right)
** hits, followers, etc

!!! Good Metrics
* Actionable
* Accessible
* Auditable

!!! One Metric That Matters
* Capture everything, but focus on the most important team
* Success == THIS ONE THING
* Forces a line in the sand
* Must be a ratio
* Must be actionable
* Must be understandable and auditable

!!! The LeanUX Kata
* Who is the customer?
* What is their problem?
* What do you know and how do you know it?
* What are your assumptions? How will you test them?
* What have you learned and what should you learn next?
* What is your very next experiment?
* How will you measure it?</pre>
</div>
<div title="Mob Programming for Continuous Learning" creator="Steve" modifier="Steve" created="201705041849" modified="201705041945" tags="#aab17" changecount="5">
<pre>@mdclement
blog.softwareontheside.com

Mob Programming where three people were researching and would swap into navigator after doing some research.

Added more people - &gt; too crowded!  Tried to add a remote &quot;viewing&quot; station.  Didn't go well.

!!! Discoveries
* Physical Space is very important
* Bought a keyboard for every developer
* Strong pair typing -&gt; For an idea to go from your head into the computer, it MUST go through someone else's hands
* Start with intent, Move to location, detail -&gt; &quot;hey type this&quot;.  Imagine doing voice command with a brilliant AI, somethings will be easy, others will need lots of hand-holding.
* Mobbing Timer -&gt; Can I use this for pomodoros?
* The hard work is when you're not at the keyboard.  That's when you have to think.  So you need to keep the off-keyboard time short.
* No standups
* Resilient -&gt; vacations, sick time, bus factor, no big deals
* Focused on working on the right thing - more sensitive to waste from side tasks

!!! Downsides
* Less worktime flexibility
* Looks funny from the outside
* Product management.....PM didn't want to participate in the mob

!!! Workshop
One navigator many pairs
One navigator, many mobs
** Table navigator is the buffer between the room navigator and the table driver

github.com/willemlarsen/mobprogrammingrpg - Gives more roles for the mobbers, since it's not clear what they're supposed to be doing

It's fun!

</pre>
</div>
<div title="Mobile Content Delivery" creator="Steve" modifier="Steve" created="201403121833" modified="201403121840" changecount="3">
<pre>* LTE network latency is ~50 ms

!! Big steps
# Distribute Delivery (CDN)
# Store objects closer to the end user (Advanced CDN (pre-cache)), user cache
# Decrease end-to-end time

!!! Dynamic Content Accelerator
* Essentially a private backbone to conquer a geographic constraint (edge-to-edge)

!! Optimize for Mobile
* Deliver mobile content first - Make desktops throw it away
* Mobile browsers have small caches (32M)
* Send the right images (use headers)
* Pre cache based on user's guided experience (interaction diagrams?)

!! Embrace mobile constraints
* Imagine no cache.  How do you conserve power (avoid requests)?
* Assume user will not stay connected.  How will they use the app?
* Avoid Polls
* Group requests and pushes

!! Ideas
* Monitor state of radio and piggyback when its active
* Decouple UI from network calls
* Burst and idle
* Optimize network for bursty traffic like that (TCP window adjustments)</pre>
</div>
<div title="MovingBeyondEstimates" creator="Steve" modifier="Steve" created="201309291430" modified="201309291433" tags="estimates" changecount="3">
<pre>http://www.cio.com/article/739333/How_to_Move_Beyond_Project_Estimates_and_Provide_Better_Value

!!! Fundamental problem with software estimates
* Estimates work well on products - you've done the same thing many times and have a good idea what it takes.
* Software isn't a product, it's design all the way through.
* If you get to the point where you can estimate accurately, you've screwed up.  Since a software product is FREE to duplicate, your estimate should be zero by the time you can estimate it accurately.
* It doesn't matter what you estimate if you build the wrong thing
!!! Flip the question around
* What estimate would change how you approach this problem?  Does it make a difference?
* What's the go/no-go figure?
** Sometimes it's easier to say what can be accomplished on a budget rather than &quot;what's the combined time for everything I might want?&quot;
** Could this drive us to decide when to pull the plug on a project?
* How can we make better decisions?
* Can we prove estimates help us make good decisions?
* Would you prefer to hit the deadline if it means you don't get what you want?
* If we spent the time estimating on building the project, would we learn something useful?
** So rather than spend two months figuring out how big it is, spend two months building it and see if it's worth pursuing further?
!!! What if we could decide when to start and stop projects?
* Focus on modeling values and risk
!!! Why are estimates attractive?
* Estimates are easy.  They make decisions easy
* Should we have confidence in them?
!!! Where could this go?
* What if we could build the top %5 in a week?  Release, measure, iterate
* What if a week of work could fund itself?
* By quickly adding value, increasing efficiency or increasing revenue - we can fund the next piece.
* We stop when something else shows up when there doesn't seem to be additional value of something else seems more valuable
* What if I have to pick between multiple projects?  How about starting them all and figure out which one is most valuable TODAY?</pre>
</div>
<div title="Neil Killick No Estimates Talk" creator="Steve" modifier="Steve" created="201311181400" modified="201311181401" changecount="2">
<pre>Flow
Same size
Slicing Heuristic
 * One acceptance criteria per story
 * others...
Key to the heuristic is that it's something concrete that you know before you start working on the story
More...</pre>
</div>
<div title="New Laptop" creator="Steve" modifier="Steve" created="201306292327" modified="201309221446" changecount="2">
<pre>Steve Klabnik  &quot;I happened to get an X1 Carbon. I was coming from a 13&quot; MacBook Air 13&quot;, and the Carbon is very similar. It鳠14&quot; though, which is a really nice size; it still fits in the same pocket in my bag as the MBA did, but I get a little more screen real estate. A note for those who give presentations: the X1 Carbon uses a MiniDisplay port, so save your Apple connectors!'

Avdi:

Hanselman:  http://www.hanselman.com/blog/ReviewTheLenovoX1CarbonTouchIsMyNewLaptop.aspx</pre>
</div>
<div title="NoEstimates" creator="Steve" modifier="Steve" created="201309210115" modified="201401191259" tags="estimates" changecount="2">
<pre>http://lkuk.uservoice.com/forums/205869-lkuk13-call-for-papers/suggestions/4242723-the-guessing-game-alternatives-to-agile-estimati?utm_campaign=shorturls&amp;utm_source=lkuk.uservoice.com

http://www.infoq.com/news/2008/08/estimates-wasteful

http://dannorth.net/2013/08/08/blink-estimation/?relatedposts_exclude=1018

http://dannorth.net/2013/01/15/accelerating-agile/?relatedposts_exclude=1097</pre>
</div>
<div title="Nobody will train you but you" creator="Steve" modifier="Steve" created="201404271822" modified="201404271829" changecount="2">
<pre>http://www.confreaks.com/videos/2427-railsconf2013-nobody-will-train-you-but-you - Zach Briggs

* Everytime you do a google search - make it your own
** Create an index card - search on one side, answer on the other
** Review those cards

* Memorize a good tutorial.  Treat it like a kata
** Spent 40 hrs on Gary Bernhardt's Suck Rocks screenscasts

* Sentinel Object
** Don't return nil!  They're useless in stacktraces.
** You don't need to go overboard with errors either.  Just do something simple:

{{{
class Scoreboard
  NoScore = Class.new

  def score player
    calculate_score player || NoScore
  end
end
}}}

Leads to stack trace like:
{{{
  NoMethodError: undefined method 'each' for Scoreboard::NoScore
}}}</pre>
</div>
<div title="OKR" creator="Steve" modifier="Steve" created="201512021715" modified="201512030441" changecount="2">
<pre>Public, part of the users 좩ography�n an internal web site.  Includes past OKRs and 짲ades&quot;

Benefits:
* Discipline + Focus
* Communicates accurately (what is important)
* Establishes feedback loop

Hygiene:
* 5 objectives, 4 key results  MAX
* 60%+ objectives come from the bottom-up
* All must mutually agree - no dictating
* One page best
* Not for perf evals
* 60-70% good, 40% bad.  Should be uncomfortable
* Continue with Incomplete Key Results only if they are still important

Grades:
don't really matter other than to talk about direction

Public grading:
Don't get it, why would you want to sit through that?

Impl:
Use google sites
</pre>
</div>
<div title="OO vs FP" creator="Steve" modifier="Steve" created="201502081836" modified="201502101801" changecount="3">
<pre>http://blog.cleancoder.com/uncle-bob/2014/11/24/FPvsOO.html

!! Strawmen refuted
** OO is not state
** All programs are functions bound to data
** FP imposes discipline on assignment
** OO imposes discipline on pointers
** Design patterns are useful regardless of the constructs of your programming language

----
&lt;&lt;&lt;
What benefit does polymorphism have that normal Functional Programs don't have? By the same token, what benefit would OO programmers gain from imposing discipline on assignment?
&lt;&lt;&lt;

!! OO provides polymorphism.  What does that get you?
Polymorphism inverts the source-code vs runtime dependency.  This provides interfaces and makes plugin systems possible.

!! FP provides immutablity.  What does that get you?
Concurrency!
</pre>
</div>
<div title="On Being An Agile Change Agent From The Inside" creator="Steve" modifier="Steve" created="201507121344" changecount="1">
<pre>On Being An Agile Change Agent From The Inside - John Ceglarek
https://www.boxcast.com/show/#/on-being-an-agile-change-agent-from-the-inside-john-ceglarek

* &quot;We sent IT off to learn agile.  We thought agile was a process.  Agile's not a process.  Agile is a culture&quot;
* &quot;The sizing step didn't add any value, so we got rid of it.  We were always wrong anyway&quot;
* If you have to integrate with silo'd teams, you just steal one of their people to pair with you.
* &quot;For every three cards we write, we only end up implementing one...get it into someone's hands and you'll find you don't need it&quot;

!!! How to fund an agile team in a project budget allocation environment

Made the case:  Here's our &quot;contractor&quot; spend year to year
Fund a product roadmap instead - &quot;Eternal funding&quot; for a &quot;product line&quot;
Justification:  &quot;We always need stuff&quot;</pre>
</div>
<div title="On Human Rights and Human Wrongs" creator="Steve" modifier="Steve" created="201705201330" tags="#selfconf17" changecount="1">
<pre>humanutility.org

I was a hacker who gave a damn
We just mechanical turk'd everything together to make a difference.  
This doesn't require a ton of engineering effort.</pre>
</div>
<div title="One Practical Alternative to Estimates" creator="Steve" modifier="Steve" created="201405121004" modified="201405121020" tags="estimates" changecount="7">
<pre>http://www.jbrains.ca/permalink/one-practical-alternative-to-estimates

&lt;&lt;&lt;
Whenever I find myself expressing 졮ti-�houghts I think back to a wonderful trick that I learned from Arlo Belshee and James Shore. They ran a workshop about integrated tests where they asked what benefits they give us, rather than focusing on all the problems that they cause. When they did this, the discussions in the room became so much more constructive than the ones I餠seen online. Not only that, but we (mostly) stopped dwelling on the problems we faced, and instead shared numerous ways that we get those same benefits by other means. It can also help find essential benefits that we don鴠get by other means, and encourage us to look for alternatives.
&lt;&lt;&lt;

What is beneficial about estimates? ''They reveal assumptions''

!!! How do we avoid the trust breakdown?
* PO upset about conservative estimates
* Programmers pulling rank to pick an estimate
* PO pressure when estimates are higher than expected
* Work is already committed so estimate is worthless

When the trust is broken, I'll tell you what I think you want to hear so I can get away from you.

!!! Expiring estimates
* Encourage revisiting estimates - say every 2 weeks
** If we're going to assume estimates go bad quickly, why put any real time into them?

''It seems clear that talking about the estimate is more valuable than the estimate itself''
//Obviously true (to me) shared understanding is the thing//

!! A practical alternative to estimating = BDD
* Task/story-level estimates routinely cause more problems than they solve.
* The act of estimating with people that we trust helps us reveal significant risks in the assumptions we make about the work.
* The act of estimating with people that we don鴠trust leads eventually to ritual, Cargo Cult, whatever you prefer to call it.

</pre>
</div>
<div title="Open source gardener" creator="Steve" modifier="Steve" created="201410011729" modified="201502081410" changecount="2">
<pre>http://words.steveklabnik.com/how-to-be-an-open-source-gardener

Figure out:

* What are issues for? (on this project)
* How to tackle?
** Read all of them (find your bearings, what sort of things are common?)
** Do it again.  Now you can triage.
* What's our triage algorithm?
** Is it a feature request?  Do X
** It is a request for help? Do Y
** Is it potentially stale?  Ask if anyone knows if affects the current version.
** Not enough information to even try reproducting?  Ask for more information - ideally the specific things it needs.
** Enough info to repro?  Try against HEAD.  Leave a comment indicating how that went.
** If reproducable, assign it according to the bugfix policy.
* How will you tend the garden?
** Need a scheduled time to stay current on all the issues.
*** Klabnik used github notify and read the emails every morning - small repeatable chunks

!! Results
* 200 issues were closed during the initial run-through (out of 800)
* After two weeks of no comments, the rails team decided that meant the issue was stale. - Close
** Closing is not permanent.  If someone really cares they can reopen.  Guilty until proven innocent.
* 150 more issues closed this way after 2 months.

!! Side affects
* After 2 months of this, knew enough about Rails to know about every open bug and enough to submit patches or at the least leave dead-simple reproduction instructions for someone else to pick up.
&quot;The only thing better than reproduction instructions are when those instructions say git clone.&quot;

* After stopping the constant tending the issues blew up again.

</pre>
</div>
<div title="Optimizing Change Through Constraint Based Experiment Selection" creator="Steve" modifier="Steve" created="201705052009" modified="201705052052" tags="#aab17" changecount="5">
<pre>@mattbarcomb
Catherine Swetel 

!!! Experiment Outline

We believe that by doing [action / countermeasure]
For
Will achieve [measurable outcome]
And when it succeeds/fails we will [recovery strategy]


We should try ____ because _____
What process / condition are we trying to change?
How often does the condition occur?
Who will be affected?

!!! Measurable Outcome
* Must be falsifiable

!!! Experiments:  Create and Destroy
(create meaningful experiments, destroy the ones that aren't)
* (I tuned out)
* Consider the impossible
* Small
* Impactful
* Keep it succinct -&gt; Look for a short summary we can share

!!! Pitfalls of Experiment Design
* We want to reward experiments that validate hypotheses
* Information Value 

!! How to choose experiments

!!! Theory of Constraints
* Prefer non-local optimization
* Mechanic systems are linear (people are systems are messy webs)
* Seeing local suboptimization in a mechansitc system is easy, it's very visible

!!! Social Systems
* Wildly entangled
* Multiple simultaneous goals
* Need to collaboratively make visual

!!! Measurement
* It might be ok to be fuzzy.  Quantifiable, but maybe hard to measure.
* Prove better happened
* Measure connected things -&gt; are these changes a result of the experiment?
* Use local optimizations to sense - create gravity wells.  If the team suddenly gets blocked, that creates tension and shows the problem is somewhere else.

!!! Optimizing For Change
* Alignment over opportunism
* Simplify - Amplify - Modify - Try
* Set enabling constraints

!!! Find Change Partners
* Innovators, Early Adopters, Early Majority, Late Majority, Laggards

!!! Interest over Impact
Ideally you'd do things that are both, never do things that are neither

!! Pitfalls of Experiment Selection
!!! Misalignment
!!! Bad Planning
- Great experiment, don't have the things we need
!!! Risk analysis
- Is the experiment taking someone else's stuff
- How long until we feel the failure</pre>
</div>
<div title="Packer" creator="Steve" modifier="Steve" created="201309210238" changecount="1">
<pre>Creates images for multiple providers (VM softwares) from a single template.

Think of it as a speedier way to do the initial vagrant install (provider + provisioning)

packer.io</pre>
</div>
<div title="ParseApp" creator="Steve" modifier="Steve" created="201301170218" modified="201301170236" changecount="2">
<pre>Will Dages - https://github.com/willdages

''Parse''
1M pulls and 1M pushes a month for free
Easy to use, lots of options for integrating with other service
Create an app on parse.com, quick start, pick your platform
Parse will autogenerate help text to the SDK and API keys(if using web)

{{{
function saveQuote() {
   var Quote = Parse.Object.extend(&quot;Quote&quot;)
   var quote = new Quote();

   quote.set(&quot;key&quot;, value);
   ...

   quote.save(null, {
     success:  function(quote) {
       console.log(&quot;saved&quot;)
       getQuotes();
       closeModal();
     },
     error: function(quote, error) {
       console.log(error.message);
     }
   }
}

function getQuotes() {
    var Quote = Parse.Object.extend(&quot;Quote&quot;)
    var query = new Parse.Query(Quote);

    query.limit(25);
    query.descending(&quot;createdAt&quot;);

    query.find({

     success: function(results) {
       $ (&quot;#quotelist&quot;).html(&quot;&quot;);
       var template = Handlebars.compiles...

       $(results).each(function(i, e) {
         var q = e.toJSON();
     $(&quot;quoteList&quot;).append(template(q));
       })
     }

     error: function(error) {
       console.log(error.message);
     }
    }
}

}}}
Parse can allow some code to run on their server &quot;CloudCode&quot; - parsing, validation

Do something - creates a &quot;project&quot; on your local file system
 - Looks like JS

{{{
Parse.Cloud.beforeSave(&quot;Quote&quot;, function(request, response) {

 response.error() //-- sends error callback

  request.object.set(&quot;by&quot;, &quot;Anonymous&quot;)
 response.success()
}

}}}
Another command sends the project back to the server.  No need to reload clients, just run the app.
</pre>
</div>
<div title="PizzaAndHelicopters" creator="Steve" modifier="Steve" created="201301170219" modified="201301261437" changecount="4">
<pre>!!!Problem
Provide service to track inbound helicopters to a hospital

!!!Constraints
Needed a cloud based solution (no servers, no IT staff) - cheap hosting for hospital budget
200 records, 20000 read-writes

!!!Solution
heroku, ruby, sinatra, couchdb, redis

Used resque to mock out dispatcher calls

dispatcher -&gt; resque -&gt; couchdb -&gt; hospital

most of the work is just plain ol development, small slices for mobility and cloud

Hospital polls
Hospital has push capability just to request a helicopter

!!! Issues
Heroku assigns blocks, but you cannot request more when load increases.

Creates lots of queues to take that fixed block allotment and assign resources horizontally.

All these queues causes a request to split into multiple transactions (parallelism, right?)

!!! Patterns

* Dynamic scaling
* Colocation - colocating data and processing to cut response times

Async processing is king because data is orthogonal and easy to correlate

* Loose error handling - if it's wrong, don't worry about it

*Receipt pattern Return a receipt for an async call.  Caller can then use that receipt to make another call to check on the real-time status of that operation (like a UPS tracking number/ coat check)

* web api
* pub/sub - uses redis - an in memory database
** redis is a cache that supports 5 data structures (strings, hashes, lists, sets, sorted sets) with the BigO performance you'd expect for each type
**  It has support for pub/sub among many other things.  Supports partitioning, replication, etc.

* async sinatra
** Sinatra::Async allows a request to complete async, sending the response to GET/POST etc later.  Use aget in the sinatra configuration.

server-side caching is good?
!!! Security
 - key based system with known pad challenge
 - All data goes away after flight ends
 - HTTPS

!!! Postmortem
AWS is your weak spot - all systems seem to run on AWS
Cloud developers don't need to know a lot of &quot;cloud&quot; stuff, it's more important to know all the systems and how to put them together (systems engineering)
Use simulators
</pre>
</div>
<div title="PoetsGuideToAcceptanceTests" creator="Steve" modifier="Steve" created="201309181606" modified="201309181607" tags="#cukeup" changecount="2">
<pre>* Use named roles instead on &quot;I&quot; in scenario
* Describe they system instead of what the user should do &quot;I should see&quot;
* Avoid ambiguity

  Given I login as Mary
   When I have a lamb
   And I go to school
   Then a lamb should go to school

Given ''Mary'' had a little lamb
When ''Mary'' goes to school
Then ''her'' lamb ''goes'' to school
</pre>
</div>
<div title="PowerfulQuestions" creator="Steve" modifier="Steve" created="201307281737" changecount="1">
<pre>* What do you like about this evil thing?
Let them answer. Allow for some silence. Let them answer further. Let them notice that they actually like this evil thing more than they think. Now, once they鶥 got that out, ask them:

*What other things can we do to get all these benefits?</pre>
</div>
<div title="Project list" creator="Steve" modifier="Steve" created="201309181931" modified="201407301641" changecount="16">
<pre>* Pinch hitter
** Verify posts

* Clojure
** re-build hot or not
** Something with hobbitses

* Scala
** Rewrite play tutorial test-driven

* Python
** Leandog dashboard

* Stack overflow
** Mind map

* Finances
** Next steps

* Gametel
** Add List View accessor

* Blog
Re-read TDD and live blog it</pre>
</div>
<div title="ProjectEstimates" creator="Steve" modifier="Steve" created="201309191119" tags="teams estimates" changecount="1">
<pre>http://www.jrothman.com/blog/mpd/2013/08/trust-agile-program-management-being-effective.html
http://xprogramming.com/articles/artifacts-are-not-the-problem/

Requests for estimates with a high-level of precision (hours/days) are a sign that management does not trust you.

Build trust by delivering frequently, demoing frequently - basically giving the impression that you get shit done.

Teams need to finish features.  Maybe not at a predictable velocity, but they get to done.

숯w much will this project cost? When will this project be done?� Even with all our expertise, we're giving you a guess.  Are we negotiating a contract or trying to make decisions here?

Better question:  Is this project worth doing?  Given an order of magnitude estimate, would you want this project done?
&quot;If we spend time on this program, will we get something valuable that is releaseable to customers before we鶥 spent all our money?튊If we're not sure, suggest using the time (that order of magnitude) that the estimate could be off by to build a walking skeleton.  Now that it took us this long to get this far, do you still want this?

Embrace change!  If we can release something in x weeks, then you can decide if you want to spend another x weeks working on it.  Or if that release teaches us something we can radically change our direction.

Run to a milestone.  Once we hit this place, what does the situation look like?

If I discover the program is not on track, when would you like to know? As soon as I know; after I鶥 done some remediation work; when I鶥 done everything I can and it鳠a disaster?

Software is about delivering value.  Getting value sooner is better.  Large things are a waste of time, the value is always hidden inside there.  Do the small stuff.  Do the most valuable stuff first.  Everything that is valuable today may not be tomorrow.  These valuable things have to work.  They have to continue to work.
</pre>
</div>
<div title="Prototyping Connected Devices" creator="Steve" modifier="Steve" created="201505161633" changecount="1">
<pre>webinar
Bill Horan - Bressler Group

Get pics from phone</pre>
</div>
<div title="RIOT 㠁 React-like user interface micro-library" creator="Steve" modifier="Steve" created="201601071408" tags="#codemash" changecount="1">
<pre>Mike Ward
@mikeward_aa
https://github.com/mike-ward/talk-riotjs

* Has a virtual DOM like React
* One way data flow
* Does server-side rendering
* Use what you want, plays well with others
* Only has 12 APIs
* 20K

!! Plumbing
* Source the &quot;tags&quot;/components
* Mount the app

In React you start with JS and put HTML in
In Riot you start with HTML and put JS in

!! Style
* You can put your style in the component
* markup, style, js all in one place
* supports sass, less


</pre>
</div>
<div title="React everywhere" creator="Steve" modifier="Steve" created="201701111408" modified="201701112128" tags="#codemash 2017" changecount="9">
<pre>Len Smith
https://twitter.com/ignu
Slides:
https://github.com/ignu/react-everywhere-workshop

https://github.com/ignu/codemash-react-workshop
https://babeljs.io  es6 to es5 viewer
https://lebab.io/try-it

surge - static site on the web:  https://www.npmjs.com/package/surge
npm run build &amp;&amp; npm install surge &amp;&amp; surge

ramda

Can share store between react-web and react-native
In practice the views are quite different so you need two codebases

Skip to the end:
https://github.com/ignu/react-everywhere-web-demo
https://github.com/ignu/react-everywhere-native-demo</pre>
</div>
<div title="Reactive Hypermedia" creator="Steve" modifier="Steve" created="201501081817" modified="201501082029" tags="#codemash" changecount="4">
<pre>Kevin Swiber @kevinswiber
http://www.slideshare.net/kswiber/reactive-hypermedia-apis

Works on Zetta

Zetta hubs connect to devices and local clients.  The zetta hubs have APIs.  Another zetta hub/serer can exist somewhere in a data center and proxy calls between the internet and the other hubs.

!!! Desired Architectural Problems
* Decouple implementations (devices in differnet locations/zones should be able to evolve indepentdently)
* Independent evolution
* Scale
* Load balancing
* Centralize complexity, distribute simplicity (taken from xmpp)
* Reduce latency
* Support event streams
= '' Good fit for REST ''

!!! Hypermedia spec
* http://sirenspec.org

!!! How HTTP streams are done
* Webhooks
** Requires registration
** params can get stale

* Chunked Transfer-Encoding
** Not well supported

* HTTP Pipeling
** Not really used by anyone (keeps socket open - kinda slow)

* Long Polling
** kinda slow, awkward

* Server Sent Events
** Not supported by IE

!!! Other protocols
websocket
mqtt
amqp  (rabbit mq uses this)
wamp
stomp
rss


!!! How it works
* Model responses (future request) based on current state
* Model resources as finite state machine
* Zetta built on nodejs

!!! Reactive clients

Load a url, parse the response, subscribe to a resource.

!!! Producer-Consumer problem
** Consumer can't keep up with producer
*** App crash
*** network throttling
*** server resources

!!! Reactive Stream Control Protocol
*** Consumer controlled streams
*** Runs over websockets
*** Multiplex streams
*** uri scheme definition

</pre>
</div>
<div title="Remote Change of Success" creator="Steve" modifier="Steve" created="201703101802" modified="201703101847" tags="#confoo" changecount="5">
<pre>@vmbrasseur

https://archive.org/details/confoo2017-remote
https://www.zotero.org/groups/remote__distributed_teams/items

&quot;The people that have to be micromanaged need that attention whether they're in the office or not.&quot; @vmbrasseur
Incredibly rich cultures are possible without colocation.  Look at any online community.

Blah - document more so remote can keep up. Ain't doc'd ain't done.

If there are people who cannot work remote because of their position.  You could potentially make it less about the job and more about the tasks they have to do.  If there are certain tasks that must be done &quot;in office&quot; then make that clear, but can you say that other tasks could be done from home.


</pre>
</div>
<div title="Remote pairing" creator="Steve" modifier="Steve" created="201306292332" modified="201401231500" changecount="7">
<pre>Zander on setting up a VPS:  http://www.civet.ws/2013/06/dont-fear-pair-programming-a-guide-to-starting/

Stuff from Zee:

Stuff from Levi:


Tmux woes on OSX:  http://www.economyofeffort.com/2013/07/29/reattach-to-user-namespace-the-fix-for-your-tmux-in-os-x-woes/?utm_source=buffer&amp;utm_campaign=Buffer&amp;utm_content=buffer6208e&amp;utm_medium=twitter

SSH+Tmux pairing on a mac:  http://jjasonclark.com/Remote-Pairing-with-SSH-and-Tmux-on-a-Mac

Madeye.io - google hangout:  http://t.co/wunrtbmeoC

Equipment:  https://speakerdeck.com/rietta/why-and-how-we-remote-pair-program

Zander is using https://www.sococo.com/ for a virtual office where everyone has an office and you can move your avatar to go talk to people.   Pretty awesome idea.</pre>
</div>
<div title="RemoteTeams" creator="Steve" modifier="Steve" created="201307201434" modified="201307201448" changecount="2">
<pre>https://zapier.com/blog/how-manage-remote-team/

*Team
** Doers
** Trustworthy + Trusted
** Can write (much remote communication is asnyc)
** Can handle less social workplace (fewer opps for chit chat and bonding)

*Tools
** Group chat (campfire, hipchat, etc)
** Video chat (skype, hangout, sqwiggle)
** Email, IM
** Trello (light weight work tracking tool)
** DVCS (github)
** iDoneThis or other standup type tool
** LastPass (no need to ask for credentials)
** Collab writing tools (Draft, Google Docs)
** Hello Sign (for signing docs)

* Process
** Explicit shared values and vision (all hands on deck for support, high quality, etc) - 'How Things Work'
** Weekly hangouts
** Weekly Learning
** Monthly One on Ones
** Daily feedback - don't leave people on an island
** Regular in-person team building (culture)
** Automate everything
** Random checkins (try to stay connected with what other teams are working on/good at)</pre>
</div>
<div title="RequireJS" creator="Steve" modifier="Steve" created="201310012317" modified="201310012321" tags="javascript" changecount="2">
<pre>* Tightly scoped
* Explicit Dependencies
* Minifies, Optimizes
</pre>
</div>
<div title="Rider and Elephant" creator="Steve" modifier="Steve" created="201307201158" modified="201307201449" changecount="2">
<pre>Rider is rational mind
Elephant is emotional mind

Put both in a room - who's going to win?

Provide a path to adopting something new - don't just say it's cool - provide a compelling argument of why and HOW to move from x to y (business case).</pre>
</div>
<div title="Ripeness for Refactoring" creator="Steve" modifier="Steve" created="201404091652" modified="201404091653" tags="TechDebt" changecount="2">
<pre>https://michaelfeathers.silvrback.com/ripeness-for-refactoring

Sometimes we shouldn't dive in and refactor.
* What if you can identify lots of potential ways to fix it?
* What if none of them is compelling?
* What if you can't think of a name for an extracted responsibility?

This is sorta similar to Beck's DRY rule.  If you copy it once, cringe a little but do it.  If you copy it twice, start looking really hard to eliminate.  If you do it a third time, it's worth a lot of effort to DRY it up.</pre>
</div>
<div title="Ruby vs Scala" creator="Steve" modifier="Steve" created="201301261415" modified="201301261453" tags="Scala" changecount="2">
<pre>Scala scales - It's performant, supports actors and parallelization.  Has interesting pattern matching feature.

Ruby has more gems, stronger community

Scala can be snuck into a java shop (Eckel)

Both have cleanish syntax, lambdas, implicit types (duck typing), dynamic calls, mixins, testing support


Articles:
http://www.infoq.com/news/2012/11/twitter-ruby-to-java
http://www.slideshare.net/El_Picador/scala-vs-ruby
http://stackoverflow.com/questions/2351433/questions-about-scala-from-a-rubyist
</pre>
</div>
<div title="Rules of Simple Design" creator="Steve" modifier="Steve" created="201309261102" modified="201309261103" changecount="4">
<pre># All the tests pass.
# There is no duplication
# The code expresses the intent of the programmer.
# Classes, and methods are minimized.


Uncle Bob:  http://blog.8thlight.com/uncle-bob/2013/09/23/Test-first.html

We can change Ron's rules for Simple Design, into rules for Simple Tests:

# The test expresses the intent of the programmer
# The test passes.
# The test has no duplication.
# The test has a minimum of classes and methods.

In the TDD cycle, this means that we first write a portion of a test; and before we make it pass, we clean it up to ensure that it says what we mean it to say. We get that tiny portion of the test to express our intent; and then we make it pass.

The red-green-refactor cycle becomes Red -&gt; Clean Test -&gt; Green -&gt; Refactor.</pre>
</div>
<div title="Rust" creator="Steve" modifier="Steve" created="201501081304" modified="201502271331" tags="#codemash" changecount="2">
<pre>Klabnik

cargo is both a package manager and a build system


crate is a module, binary or library.  They are compiled in parallel, though each crate is compiled serially.  So a common pattern is to break a binary into libraries to get a faster compile.

semicolon on each line unless it's the return value for a function (expression-based langauge)

Borrowing vs taking the value (pass by reference).

CHEAT SHEETS:  https://gist.github.com/carols10cents/1f2066f758be72ecf2ab
</pre>
</div>
<div title="S.O.L.I.D. Elixir" creator="Steve" modifier="Steve" created="201701131620" modified="201701131652" tags="#codemash 2017" changecount="6">
<pre>@daveshah
TODO:  http://blog.plataformatec.com.br/2015/10/mocks-and-explicit-contracts/

Controllers deal with the real world - they do the &quot;unclean&quot; stuff.  State, side effects, etc.

SRP: Easiest to talk about, one of the hardest to get right.
OCP:  How do you extend in Elixir?
 {{{ defprotocol }}}
* this is like an abstract &quot;method&quot; that needs to be implemented by implementations.
 {{{ defoverridable }}}
* this allows you to do override an existing implementation when you {{{use}}} a module.
ISP:  Making a commitment to decrease the volatility of a particular area.  These are the things you can depend on.
LSP:  If you say you're going to do something, you should do it.
</pre>
</div>
<div title="SOLID Javascript" creator="Steve" modifier="Steve" created="201401092040" modified="201401092140" tags="#codemash 2014" changecount="3">
<pre>DIP - Caller owns the protocol that the dependency implements.  Ripples only go in one direction - down to the details.
* TDD - Caller wins!

Human beings think in abstractions - not details.  Named abstractions allow us to group details into larger concepts.  This allows us to keep building higher and higher abstractions that can solve bigger problems.</pre>
</div>
<div title="SSH reverse tunnel" creator="YourName" modifier="YourName" created="201608131344" changecount="1">
<pre>Connect to remote machine and tunnel their http access over port 8080 on localhost

!! Cmd line
ssh -v -L 8080:localhost:80 -p 2298 &lt;username&gt;@&lt;remote_ip&gt;


!! .ssh/config
host remotemachine
  Hostname &lt;remote_ip&gt;
  Port 2298
  ForwardAgent no
  ForwardX11 no
  User &lt;username&gt;
  LocalForward 8080 127.0.0.1:80</pre>
</div>
<div title="Saff Squeeze" creator="Steve" modifier="Steve" created="201410011728" modified="201502081356" changecount="2">
<pre>http://www.threeriversinstitute.org/HitEmHighHitEmLow.html

&quot;works by taking a failing test and progressively inlining parts of it until you can't inline further without losing sight of the defect.&quot; \

1.    Inline a non-working method in the test.
1.   Place a (failing) assertion earlier in the test than the existing assertions.
1.    Prune away parts of the test that are no longer relevant.
1.    Repeat.

OR:
1.  Literally replace the method call with the source code IN the test.
1.  Move the assertion into the source code section.
1.  If that fails, you can delete all the code after that.
1.  Move your assertion up another level and keep trying, inling additional methods as you go.


</pre>
</div>
<div title="ScalaAsABetterJava" creator="Steve" modifier="Steve" created="201301170222" modified="201301261454" tags="Scala" changecount="4">
<pre>Bruce Eckel
http://www.atomicscala.com/

- Objects are a good way to structure code
- Scala brings in functions as first class as well(OO + functional)
- Raises the functional level of abstraction on procedural code
- Since scala compiles to .class files, it can be trojan horsed into a company
- Typesafe:  Maintain scala, akka, play

{{{
class Dog(age:Int, val name:String) {
  def indent(id:String) = name + age + id + Dog.dogCounter


  //Note that anything passed into the constructor is automatically a member and accessible throughout the class
}

object Dog { // Companion object
  private var docCounter
  def +(n:Int) = dogCounter += n
}

//Companion objects are utilities (like static methods on a class)

object BasicClasses extends App {
  val dog = new Dog(4, &quot;Comet&quot;)
  Dog + 1 //Dog.+(1)
}
}}}

case class =&gt; Used to do DTO/structs
{{{
case class Person(first:String last:String)
}}}
public members, hashcode, equals, toString do what you'd expect

 * //This talk seems to be mostly about how scala reduces java noise//
 ** //The result is very similar to ruby//

{{{
  s.foreach(x =&gt; x.draw) //closure
  s.foreach(_.draw) // perl like
}}}

passing blocks
parallel collections
futures
{{{
val a = future { pause(&quot;three&quot;, 3) }
val b = future { pause(&quot;one&quot;, 1) }
val c = future { pause(&quot;two&quot;, 2) }

  val result = for {
    three &lt;- a
    one &lt;- b
    two &lt;- c
} yield one + two + three
}}}

Must have scala-library.jar on the classpath when calling scala from java

{{{
(1 to 10).groupBy(_ % 3)
 = Map (2 -&gt; Vector(2, 5, 8),
        1 -&gt; Vector(1, 4, 7, 10),
        0 -&gt; Vector(3, 6, 9)
}}}

atomicscala.com for examples from talk
</pre>
</div>
<div title="ScalaStreams" creator="Steve" modifier="Steve" created="201301261453" modified="201301261453" tags="Scala" changecount="3">
<pre>Scala streams can be passed to other functions to add one more to the stream without recomputing all those that came before.  Calculating sensor offsets seems like a plausible use case.  Another is breaking a search after finding the result, while in the iterator.  So you don't need an interim data structure.

http://stackoverflow.com/questions/2096876/use-cases-for-streams-in-scala
http://www.scala-lang.org/api/current/index.html#scala.collection.immutable.Stream
http://blog.danielwellman.com/2008/03/streams-in-scal.html


</pre>
</div>
<div title="SecretsOfClojureWebDevelopment" creator="Steve" modifier="Steve" created="201401091640" modified="201401092042" tags="#codemash 2014" changecount="5">
<pre>Clinton N. Dreisbach
github.com/cndreisbach

Mind Blown.  @cndreisbach enthusiasm for clojure is contagious.

https://github.com/cndreisbach/clojure-web-dev-workshop/
http://clojurewebdev.com/


!! Tools
Ring is Rack for clojure
 Middleware is manipulating requests (auth, mime-type, routing, etc)

Routing - Compojure
Templating - Hiccup or Selmer
Asset pipeline - Stefon
-Luminus wraps up these libraries as Leiningen tasks.  Get started here

!! Hoplon
* HTML as clojurescript
* Compiles to static files, drop in anywhere

!! Liberator
* Provides resources
* Resources are decision trees
* Every result in liberator is added to ctx (fold back it into the context, call the next one in-line)
* Override the decisions (allowed? authorized? exists?) to inject handlers in the code for that kind of request (200, 404, etc)
* Provides default responses in the representation that the mime-type is asking for - want json?  want csv?, want html?, want xml?  \\This sounds awesome for testing\\

!! HTTP Kit
* Supports web sockets and long polling
* Supports streaming
* SO fast!

!! Resources
* clojure-doc.org
* http://clojurewebdev.com

</pre>
</div>
<div title="Self-improving software" creator="Steve" modifier="Steve" created="201703091959" modified="201703092039" tags="#confoo" changecount="5">
<pre>@bahmutov - Gleb Bahmutov PhD
slides.com/bahmutov

Red flags
* Build time &gt; 15s
* Can't umit test a feature

Software as car assembly:
1. built separately, tested separately, has sku number, shipped to car factory, assembled
12 factor

Single report per app

Relying on human supplied semver is like relying on code comments. - @bahmutov

Relying on human supplied semver is like relying on code comments. @bahmutov -  I'll continue trashing semver tomorrow morning at 10 :laughing: #confoo

Automate dependency upgrade
* run unit tests
* update dependencies
* run tests
* if tests fail, revert

https://github.com/bahmutov/next-update
(manual version of greenkeeper)

next-update-stats
semantic-release-cli
dont-break

</pre>
</div>
<div title="Sequential Design" creator="Steve" modifier="Steve" created="201501091440" tags="#codemash" changecount="1">
<pre>Brad Colbow
bradcolbow.com/codemash.pdf

!! The asthetic
CRAP
!!! Contrast

' I will never make it as a designer because my brain does not work like the common'
What's important, 2nd important
What goes together (subtler)


!!! Repetition
Sets up patterns, used for &quot;scene&quot; changes

!!! Alignment
Grids can keep a page together when one element might break the normal borders and contrast

!!! Proximity
These things grouped together

!!! Hierarchy
Create levels to the design - important stuff at the top

!!! Intent
&quot;Design is the rendering of intent&quot; - Jared Spool

Comics often create a confusing panel order - what's the intended way to read this
Hamburger is not an obvious menu button
Leave the user a scent (like a bloodhound) - how do I get back where I was?

When everything is exciting, nothing is exciting
Simple Rule:  Do the expected in an unexpected way

!!! Interaction
* Wireframes - capture features but don't capture interactions

Found the first few days of the project were the most important</pre>
</div>
<div title="Sharing Secrets in a Container World" creator="Steve" modifier="Steve" created="201703081852" modified="201703091608" tags="#confoo" changecount="7">
<pre>@christainheimes

Secrets:  small, required, radioactive

Best practices:
Encrypted at rest
Encrypted in transit
Audit log
Access Control (single container should not have access to all the secrets)
Identiy - container must be known and addressable so you can assign roles to it
Rollover/Renewal
Least Amount of Privieges
(Don't use orchestration to send secrets)

!!! Don't
Use ENV variables to pass secrets (some config will have a plaintext version)

** Kubernets secrets
*** wouldn't use it, no encryption or access control lists

** Square KeyWhiz 
*** Focused on PKI and LDAP

Secrets and LIE-abilities - blog post.


!!! Common design problem
* either ENV or file system (even TMPFS)

* Vulnerable
** Accidental backup
** Directory traversal attack
** Debug tools 
** Other means

!!! Don't put secrets in the container - Let the application request a secret

! NOW WHAT?
Use unix sockets as auth mechanism - //I guess//

</pre>
</div>
<div title="SiteSubtitle" creator="Steve" modifier="Steve" created="201301261658" changecount="1">
<pre>steve's web notebook</pre>
</div>
<div title="SiteTitle" creator="Steve" modifier="Steve" created="201301261658" changecount="1">
<pre>TiddlyTiddlyTiddly</pre>
</div>
<div title="Software Development Lessons Learned from Industrial Failures in the 1980s" creator="Steve" modifier="Steve" created="201601081740" tags="#codemash 2016" changecount="1">
<pre>Charlotte Chang

</pre>
</div>
<div title="Someday/Maybe" creator="Steve" modifier="Steve" created="201309210118" modified="201310121156" changecount="3">
<pre>* Find a mentor:
Looking for an idol: Realizes code is writing, good at empathy, codes 90% of the time while still being an influential and useful person, realizes coding is usually the least important thing, but has managed to get everything else right so that coding is joy. Understands that being part of a team is teaching and knows how to present information in such a way that it's understood and need not be repeated.

* javascript koans
* xmpfilter
** http://jamie.ideasasylum.com/2013/07/ruby-markers-for-sublime-text/
** http://justincampbell.me/til/annotate-ruby-code-in-vim-with-xmpfilter
* emacs

* Docker as a New Guy bootstrap tool (redo vagrant project)
* pinch_hitter
** Re-investigate issue, try to think of a way to accomodate or build in another gem?


* pretty face history
** Jenkins like history of scenario counts and passing
** Incorporate timings?

* Data Personas
** Stewing


* Take notes
** http://cwd.dhemery.com/2005/05/motivation/
** http://vimeo.com/68375232 - 10 mins in, looks good
** http://arlobelshee.com/post/being-awesome-step-1-stop-making-dumb-choices
** http://www.cio.com/article/739333/How_to_Move_Beyond_Project_Estimates_and_Provide_Better_Value
**

* Blog
** Script + slides from cukeup
** Coding analogy - Eggs, steel blocks / rocket precision machinery, legos, new

* exercism and work on some issues
** Sign in
** Next exercise
** Review 3 exercises
** Look for issue
*** https://github.com/kytrinyx/exercism.io/issues/478</pre>
</div>
<div title="Start with Why" creator="Steve" modifier="Steve" created="201308132102" modified="201308132105" changecount="9">
<pre>Simon Sinek
  * Why? //you get out of bed//
  * How? //you work (values) //
  * What? //you produce//

Seceding vs Replacement</pre>
</div>
<div title="Step Away from the Tools" creator="Steve" modifier="Steve" created="201409141252" modified="201409141255" changecount="5">
<pre>http://lizkeogh.com/2011/03/04/step-away-from-the-tools/

&lt;&lt;&lt;
Start by having conversations, engaging both testers and business stakeholders or their proxies (analysts are good here). If you can鴠have those conversations, stop. You can鴠do BDD. You might be able to write some scenarios or some acceptance tests, but they鲥 likely to be brittle and it鳠unlikely that anyone will be interested. Here鳠why.
&lt;&lt;&lt;

* Focus on Discovery - Deliberate Discovery
* Realize this isn't about testing or tools
* Write fewer scenarios
* Assume you got it wrong
** You never get it right the first time
</pre>
</div>
<div title="TDD Where did it all go wrong" creator="Steve" modifier="Steve" created="201407301649" modified="201505131637" tags="TDD" changecount="6">
<pre>http://vimeo.com/68375232

!!! Two problems to unlearn in TDD
1) Changing Impl details breaks tests.  Lots of tests.
2) More test code than impl code

!!!! ProgrammerAnarchy - Devs work directly with customers and throw the code away after a year.


!!! Where did it all go wrong?
* Not testing behaviors - Dan North
* Coupling impl details to test because of failure to refactor

!!! When do I write my next test?
* NOT when you add a method
* When you add behavior

!!! Test the Surface Area
* Only test the surface area (public API to the module).  Treat it like a box.
* Start with the &quot;Best possible application public interface&quot; Program by wishful thinking


!!! Kent Beck's definition of unit test:  A test that runs in isolation from other tests
* This is different than the rest of the industry - OOPS
* NOT testing a module in isolation
* NOT only one class under test
* YES - no side effects
* Test is isolated, not the system under test
* NOT - mocks everywhere specifying too much impl detail
** Only mock things that keep the test from being isolated, not things that keep the &quot;class under test&quot; isolated.

!!! Red -&gt; Green -&gt; Refactor
* Quick green excuses all sins -&gt; BE SINFUL
** It's difficult to think about both solving the problem and engineering it well
** Don't do engineering yet - you don't know if you're going to SOLVE anything yet
* Refactor -&gt; Now you can be clean
** Refactor to patterns
** Don't write new unit tests!
** You need a new class - Do it!  Don't write tests for it.

!!! Ports and Adapters
* Unit test at the port - Tests are an adapter running the code
* System Tests are at the boundary

!!! Gears
* 5th gear is obvious changes - we can't get to green because this obvious refactoring is distracting us.  Just do it - but don't get carried away here.
* 4th gear - hack your way to green
* Downshifting - Getting sticky here, not sure how to find my way through.
** If I throw away these tests will I miss them - do I still have tests that check the behavior from a port-type level.
** These tests are coupled to the implementation
** Maybe I should leave them to help another programmer find his way through
** Middle ground - maybe comment that these tests are deletable if they get in your way - Feel free to delete these tests.

!!! Mocks
* Don't mock internals, privates or adapters
</pre>
</div>
<div title="TDD is dead!  Love live TDD!" creator="Steve" modifier="Steve" created="201502081838" modified="201502091119" changecount="5">
<pre>http://blog.jessitron.com/2014/09/tdd-is-dead-long-live-tdd.html

&quot;Tests don't enable change. Tests prevent change!&quot;

Mostly we want tests at an interface level (API or UI) but that makes for UGLY tests.

!! Generative Tests
(Or property-based testing)

In generative testing we can't know what the inputs are so we can't specify what the outputs are.  But we can put bounds around them.
&lt;&lt;&lt;
 Maybe, it should be between these values. It should go down as this input value goes up. It should never return more items than requested, that kind of thing.
&lt;&lt;&lt;

!!! What should we end up with?
&lt;&lt;&lt;
This doesn't preclude small tests that drive our class design. Use them, and then delete them. This doesn't preclude example tests for documentation. Example-based, expected == actual tests, are stories, and people think in stories. Give them what they want, and give the computer what it wants: lots of juicy tests in one.
&lt;&lt;&lt;

Points out this is way harder and requires thinking about boundaries that we usually don't worry about.
//I wonder if this would encourage a more failure-resilient thought process?//
</pre>
</div>
<div title="TDD on Waxman (Eric)" creator="YourName" modifier="YourName" created="201605201656" changecount="1">
<pre>Unity - runner
CMock - mock headers
Ceedling - rake tasks to automate - can do things like sub in test headers and what not

Is CMock the tool that lets you auto-magically mock out 21 headers
- it's used for expectations
- Creates a mock version when you add a mock_
- Links in the mock c impl instead of the &quot;standard&quot;.c




</pre>
</div>
<div title="TechDebt" creator="Steve" modifier="Steve" created="201309261105" modified="201407011229" tags="TechDebt" changecount="2">
<pre>http://blog.crisp.se/2013/07/12/henrikkniberg/the-solution-to-technical-debt
* Set aside time for TD - pay down before adding features


The failure to make the program align to the current understood operation of the system - me paraphrasing Ward
* Each disagreement with reality is interest
* Bankruptcy is when you don't trust the code.</pre>
</div>
<div title="TechSafety" creator="Steve" modifier="Steve" created="201307201414" modified="201309291510" tags="techsafety" changecount="4">
<pre>http://www.industriallogic.com/blog/techsafety/

Safety is a keystone habit - this habit grows a culture of excellence.  Keystone habits shift, dislodge and remake other habits.  Like exercising leads to eating healthy, leads to avoiding drugs, leads to work/life balance.

Tech safety is a pathway to excellence - not an end in itself.

Tim Ottinger, a veteran coach at Industrial Logic, said, &quot;It's in the constant, daily decisions that tech safety has meaning. We don't settle for learning to cope with failures, flaws, injuries, irritants, etc. Instead of accepting a poor work system and an unsafe environment, we transform our environment in ways large and small to make it less prone to failures and injuries.&quot;

Tying TechSafety to AntiFragile:  http://www.industriallogic.com/blog/why-are-most-agile-adoptions-failing/
Failure is inherently unsafe and most teams and organizations are not places where we can safely learn from failure.
 * My hypothesis is that embracing failure (vs XPs embracing change) is the way that we can build high quality software fast.  If each failure/injury makes us stronger - is that an antifragile system?

http://samadisy.com/2013/06/05/is-it-safe-to-fail/
Let me explain further. Failure 㠦or most of us 㠩s not an enjoyable experience. However some of us have become good at it. And the major reason behind this is SAFETY. If we feel safe to fail, and are rewarded for it regularly, we can find ways to fail fast and learn quickly.


http://arlobelshee.com/post/being-awesome-step-1-stop-making-dumb-choices
* Making change feel safe = Help people see that others have succeeded + Everyone wants to make the same change + The change is at least as safe as the current approach
* Second-order safety:  We need to see the people that have threatened us for trying to make things better in the past and see that they agree with this change.  You're not on an island, you're going with the group.  Change is the obvious, safe choice.</pre>
</div>
<div title="Test Up Your Internet of Things" creator="Steve" modifier="Steve" created="201601071512" tags="#codemash" changecount="1">
<pre>Ben Rogers
@_ben_rogers

Connectivity is the thing.  Users expect an immediate remote upgrade that will fix the thing or they will return it.

!! Test Rig Basics
* Need loader to load code into a device automatically from ci (can't change a flash card)
* Need to mock IO
* Debug interface is nice

!! Start coding (before picking a processor)
* Uses pi to do prototyping- Pi bootloader https://github.com/dwelch67/raspberrypi
* 1 pi for loader/compiler, 1 pi as SUT

!! Processor chosen, order a devkit
* loader (JTAG)
* SUT (devkit)
* logic analyzer on I/O
* UART for debug

!! During hardware design
* Need to ask for JTAG, UART, pins for logic analyzer

!! We've got hardware
* loader (JTAG)
* SUT (prototype)
* logic analyzer
* UART for debug

!! Better tests
* loader (JTAG)
* SUT (prototype)
* I/O mock (pi)
* logic analyzer for debug

!! Hardware characterization test
* Need tests to replace the datasheet (who's going to remember 1400 pages of low-level detail?)
* Need tests to avoid flaws in the hardware
* Do you want to brick a device because the processor has faultly logic around an instruction?

* Exploration
* Analysis - Did pin analysis to see that a chip was failing to respond within the 100ns (according to spec) - this meant that the recommended clock speed was wrong and needed to be reduced
* Codification
** Make sure you write your tests can be included in your manufaturer's test suite and make sure the devices coming off the line are correct

!! Hardware in the loop (HIL) Test
Acceptance level tests demonstrating the correct integrated system

Uses robot framework to build tests (gherkin-like)
HIL is used ATDD, CI, Manufacturing

!! Unit Tests
* Google Test / Google Mock (C++ only)
* cmocka - simple lightweight C testing

!!! Mocking memory
1. Substitute headers with new #define
1. extern variables that get omcked by the test
1. linker scripts that create global variables

!!! Gotchas
* Be wary of state bleed - RESET YOUR STATE
* Test all your boundaries - write tests until your paranoia turns into boredom

saleae - logic analyzer

!!! Network mocks
</pre>
</div>
<div title="Testing at the Boundaries" creator="Steve" modifier="Steve" created="201701122156" modified="201701122224" tags="#codemash 2017" changecount="7">
<pre>@Fitzoh
https://github.com/Fitzoh/testing-at-the-boundaries
https://docs.pact.io/

Had problems testing service to service interactions

!!! Microservices: Lessons Learned
 :) Faster deployments
 :( Automation is required
 :) Easier to handle (mental model)
 :( Tracing requests
 :) code ownership
 :( code duplication
 :) Speed up tests
 :( Decrease test safety, now need end-to-end tests

!!! Testing Service to Service Interactions
1) Standup the whole world
* Ugh, slow, brittle, black box
2) Mock out dependencies
* You're testing against the version of the API that existed when you wrote the mock
3) Contract Tests


!!! Pact Demo

!!!! Consumer-side
Consumer writes the test
Pact Runs the test, mocking out the provider
It also creates a pact file.  This is the &quot;published&quot; interface the provider should implement.

!!!! Provider-side
The Provider can then pull the pact file (all the pact files for all the Consumer's presumably)
It will create tests for the pact file, run them against the server and verify the assertions defined in the first step.

This probably won't work out of the box because there needs to be setup, but pact provides helper methods or whatever to allow you to put data in the value.

&quot;TDD at the architectural level - crossing services and doing TDD which is cool&quot;

!!!! Making server-side changes:
Introduce new change, keeping backwards compatibility
Run provider tests, should pass (old consumer still works)
Update consumer to new change
Run consumer tests, creates new pact file
Go to provider, delete backwards feature
Run tests - if all consumers have been updated, they will pass, if not you'll know.

''Postel's Law''

!!! Pact features
* Recommended by TW
* Multiple languages
* Can be used with MQ interfaces (service A will put this message, service B will pull it)

</pre>
</div>
<div title="The Art of the Awkward 1:1" creator="Steve" modifier="Steve" created="201612181727" modified="201612181731" changecount="4">
<pre>https://medium.com/@mrabkin/the-art-of-the-awkward-1-1-f4e1dcbd1c5c#.3xhbs7f3g

Hypothesis:  If the 1:1 is not awkward, you're not talking about the real stuff.
&gt;&quot;Change and growth are always awkward - embrace that.&quot;

!!! Two Rules:
1)  Don't talk about any topic you could discuss in the open - If it's safe to be overheard, it's not the right content for a 1:1

2)  Commit to saying one rather awkward thing every 1:1 and get the other person to commit too.  Gives permission and creates peer pressure to be real.

!!! Other Tips:

* Get started by commiting.  That's an awkward conversation and counts for the awkward thing in the first 1:1

* Fix any other communication channels.  If 1:1s are the only channel, they're going to be spent on updates, easy questions, and simple feedback.

* Plan to be awkward.  What would be great to get off your chest?

!!! Awkward stuff
* Meta topics
* Feelings
* Fears
* Trust checks - How would it be easier to share intimate things?
* Extra Honest Feedback
* Are they acting like the best manager/report/partner?
* What have you said or heard said about this person?
* What is everyone neglecting to tell this person?
* Advice Seeking (with humility instead of bragging)
* Growth area advice
* Here's something I complained about, what could I have done differently?
* How can I be better?
* Admit faults and mistakes

</pre>
</div>
<div title="The Cycles of TDD" creator="Steve" modifier="Steve" created="201502081334" tags="UncleBob" changecount="1">
<pre>http://blog.cleancoder.com/uncle-bob/2014/12/17/TheCyclesOfTDD.html

This is one of those articles I'm glad I went back and read a bit more carefully.  I glazed over the section headers and said, yup, yup, yup, but kept it around for some reason.  It's got some nuance in the &quot;stuck&quot; sections and in the idea of consciously drawing boundaries for our system.

Basic outline - TDD as a series of cycles
 - Three Laws of TDD     (several times a minute)
 - Red, Green, Refactor  (every minute)
 - Specific/Generic          (every 10 minutes)
 - Boundaries                  (hourly)

* The Three Laws of TDD are designed to get you the write (and think) about one line of code at a time.
* Specific/Generic - tests get more specific, code gets more generic
** Uncle Bob believes that if you don't generalize your code (because the tests don't make you), then you'll end up getting stuck in your TDD cycle.  You'll have to write a ton of code to get the next test to pass.
* Every hour, stop and look for boundaries we want to control.  We draw the lines and then stick our work for the next cycle in that area.


</pre>
</div>
<div title="The Deep Synergy Between Testability and Good Design" creator="Steve" modifier="Steve" created="201503111640" changecount="1">
<pre>Michael Feathers
https://vimeo.com/15007792</pre>
</div>
<div title="The Failure of Agile" creator="Steve" modifier="Steve" created="201508020117" modified="201508020123" tags="#grows" changecount="4">
<pre>Andy Hunt - http://blog.toolshed.com/2015/05/the-failure-of-agile.html


!! Concrete Rut
* Inspect and Adapt are too abstract for new agile teams to follow
* New agile teams take the practices and follow the rules (or worse a subset of practices and rules)
* Following the rules limits you to a novice (Dreifuss) - following the rules means you can't get the experience to break the rules

''We are stuck in a rut because the practices have not changed in over a decade''

!!GRowing Real-World Oriented Working Systems (GROWS)
* Growth means change
* Real-World means we need to base decisions on evidence
* Working software - of course

//But not at the expense of a working, functional team and overall organization//


* Evidence-based
* Dreyfus Skill Model
* Local Adaptation
* All-Inclusive

growsmethod.com

</pre>
</div>
<div title="The Great API Redesign" creator="Steve" modifier="Steve" created="201701121916" modified="201701121949" tags="#codemash 2017" changecount="2">
<pre>Anthony - founder of dnsimple
@aeden

!! Path based version
* not mime-type based, but could go that way in the future
* Simple transition through minimal changes - picked path-based versioning
* versioned URL is easily visible in the logs
* Easiest implementation for both production and consumption
* Easy to check in a browser

!! New hostname
* Distinguish api calls
* easier to scale
* common error handing
* extract to custom controllers

v0 -&gt; v1 - one month, mostly
simone went out and opened PRs for all open source projects to enable easy API version change.


!! v1 -&gt; v2
* 3 years
* Used Hanami
* Built as a sub application
** Get all that institutional knowledge from years of development
* No longer tightly coupled to the Rails controllers

!!! Conversions to Commands
* Similar to Command design pattern -&gt; &quot;Reusable business logic&quot; -&gt; Encapsulate behavior
** Convert controls to use commands

!!! Remove resource names from parameters
* (don't need them in REST, you know you're dealing with &quot;Zones&quot; for instance from the path)
* It's dangerous to make the response data the top level keys.  Using &quot;data&quot; allows you to support &quot;errors&quot;, &quot;pagination&quot;, &quot;meta&quot; etc.
* Built custom parser to avoid rails serialization in hanami

!!! Error management
* unified error responses
* Use http response codes

!!! Authentication
* Retained HTTP basic auth
** easiest way to get access
** nice for testing
** might get rid of it later
* Access tokens
** Move to Oauth

!!! Pagination
* Add query strings
* using payload
* could be added to the headers later

!!! Sorting and filtering
!!! Throttling
* Used headers
* Why put that in the header?  Users care about pagination, but don't care about rate-limiting
!!! Methods (endpoints)
* Track all the new/changed/removed endpoints
!!! API clients
* Ruby - original:  2010, new: 2016
* Go - 0.15, not yet released
** Nice for design feedback
*** https://slidr.io/weppos
* Node - new: 2016
* Elixir - new: 2016
* Java - unreleased
* PHP - unreleased

</pre>
</div>
<div title="The Power of Secrets" creator="Steve" modifier="Steve" created="201705191658" tags="#selfconf17" changecount="1">
<pre>@geekygirlsarah

Vulnerability helps us build connections.

Empathetic teams are powerful.

</pre>
</div>
<div title="The correct ordering of the 4 Elements of Simple Design" creator="Steve" modifier="Steve" created="201410011732" modified="201502081347" changecount="3">
<pre>J.B http://blog.thecodewhisperer.com/2013/12/07/putting-an-age-old-battle-to-rest/

!!! Kent Beck's version
# Passes tests
# Minimizes duplication
# Reveals its intent
# Has fewer classes/modules/packages

!!! Corey Haine's version
# Passes tests
# Reveal intent
# Don't repeat yourself
# Fewer classes

J.B thinks the difference between 2 and 3 doesn't matter because they form a rapid feedback loop.

&lt;&lt;&lt;
I have noticed over the years that when I try to focus on removing duplication, new, useful structures emerge. I like to say that if the solution wants to be structured a certain way, then removing duplication helps that structure to emerge.2 I have also noticed that when I try to focus on improving names, Feature Envy and its friends become more apparent, and code makes it clearer that it wants to move somewhere else. Similar concepts scattered throughout the system start calling out to each other, hoping for the programmer to unite them in a single module. Crowded, unrelated concepts struggle to get away from one another. Responsibilities gradually move to a more sensible part of the code base. Both of these contribute to higher cohesion.
&lt;&lt;&lt;

Remove duplication -&gt; Structure Emerges
Improve Names -&gt; Redistribute Responsibility

Creating new structures to handle these responsibilities drive these loops.  As we struggle to name this new thing we continually add/remove behavior until it becomes cohesive.  Eventually it settles into an abstraction (the rest of the code treats it as a black box).

So you end up with:

Remove duplication -&gt; structures emerge -&gt; structures need names -&gt; improve names -&gt; abstractions emerge -&gt; higher-level-duplication -&gt; remove duplication

Or you can start with improving names and end up in the same place.

I would probably think about this more as starting with an abstraction (make the change easy) vs removing duplication (make the easy change).</pre>
</div>
<div title="The infinite hows" creator="Steve" modifier="Steve" created="201706210136" modified="201706211452" changecount="8">
<pre>https://www.oreilly.com/ideas/the-infinite-hows

Criticism of 5 whys.  //Why?// is the wrong question because //why?// usually leads to //who?//  Then the focus, even if it is positive, is on how to improve a person, as opposed to improving the system.
&quot;Well what you should have done....&quot;
Human error is a simple and satisfying explanation for everything.

Asking //why?// leads towards looking at failures as linear consequences.  The world isn't that simple.  Our preference is certainly to reject the complex because it's harder to think about.
Asking //how?// invites looking at the context.

Looking at //why?// often leads to a &quot;this was wrong&quot; sort of answer.  But it's only wrong in hindsight.  At the time it seemed perfectly reasonable.  And we lose sight of that once we decide it's ''BAD''.  The only logical way for our brains to move is towards prevention.

When we ask //how?// we're inviting stories/a narrative.  When we ask //why?// we're inviting excuses.
//Why?// -&gt; Who is responsible?  //How?// -&gt; What is responsible?

''DESCRIBE'' vs ''EXPLAIN''</pre>
</div>
<div title="TheCaseForNovices" creator="Steve" modifier="Steve" created="201301170220" modified="201301170242" changecount="6">
<pre>!!! Why novices?

Functional diversity - different backgrounds bring novel approaches to tough problems

Individuals from similar backgrounds identify problems in a similar way(perspective) and similar ways of solving those (heuristic)

//This is basically an exercise in avoiding groupthink//

How do you find novices?
 - avoid internal biases (picking people like you, who are easily available, look nice, etc)

!!! Hungry academy
Very intense training schedule - 24 students, 5 months, 40 hrs/week training, 20-30hrs/week homework
Burned everyone out - idea was to take a person up to the standards where livingsocial would hire them normally
5 months on a salary phasing into normal hire - 24 new hires

!!! Assignments
Choose your own optimization points on an assignment, 8 or 9 axes to grade on with a near impossibility to max out all categories (performance, ux, class design, etc) - helps a new dev figure out what they like/are good at

- Rebuild the same app using a different set of buzzwords (new db, design style, api, etc)

!!! Mentoring
Start with the end in mind - what do you want the newbs to learn?  Design an exercise (experiment), gather results and iterate.  Multiple assessments, fast loops.

Strive to setup devs to be
- autonomy
- mastery
- purpose

Take extra time to teach the devs to increase their mastery and push them towards autonomy.

Tracking tools (pivotal) allow an individual to see their contribution //lencioni idea of transparency//

Have mentors commit to being consistent

!!! Habits
Habit 0:  Each novice should have a technical mentor
Habit 1:  Take nothing for granted.  Set expectations early.
Habit 2:  Design a pairing schedule
Habit 3:  All code reviewed via pull requests - make sure to find positive feedback
Habit 4:  Set dedicated learning time with self-chosen objectives
</pre>
</div>
<div title="Things I think are true" creator="Steve" modifier="Steve" created="201404241029" modified="201404241031" changecount="2">
<pre>* Hard to test = badly designed
* Done is in production - stop screwing with this to make everyone look good in reports.
* Trying to &quot;smooth&quot; the path for developers up front is less efficient than figuring it out as the code is written
** With the caveat that devs hate being jerked around
</pre>
</div>
<div title="Things with which to measure the universe" creator="Steve" modifier="Steve" created="201501082241" tags="#codemash" changecount="1">
<pre>John Van Enk - @sw17ch


* Low precision - high range
** Like all the temperatures in the universe
* High precision - low range

Pull-down resistor - remove noise in analog circuits - default to 0

Circuits:
Reed switch - detects magnet - 1, no magnet = 0
Photo cell - detects light -

analogRead - something between 2.5v and 4.5v with a 10K ohm resistor

temp sensor - transistor


diagram tool:  http://fritzing.org</pre>
</div>
<div title="ThinkingFastAndSlow" creator="Steve" modifier="Steve" created="201401050233" modified="201401052149" changecount="8">
<pre>Daniel Kahneman

!! Two Systems
* System 1  - automatic, intuitive, associative memory, rarely confused
* System 2 - requires effortful attention, makes judgements, lazy, appreciates a coherent story,

!! Econs and Humans
* Econs - rational.  Always makes coherent, careful, consistent decisions and uses all the information at hand.
* Humans - makes contradictory decisions based on biases, laziness, etc.

!! Two Selves
* Remembering Self - Keeps the score.  Often forgets the duration of events and judges goodness of an experience based on the peaks it remembers.  Last part of experience is weighted highest (Bad ending ruins the whole movie)
* Experiencing Self - Does the living.

!! The lazy controller (System 2)
* If an easy answer comes to mind (System 1), System 2 will rarely fact check it.  Although someone may be able to solve a difficult problem by engaging System 2, if a simple answer springs to mind and &quot;seems reasonable&quot; they will &quot;go with it&quot;.
* &quot;Those who avoid the sin of intellectual sloth could be called 'engaged'.  They are more alert, more intellectually active, less willing to be satisfied with superficially attractive answers, more skeptical about their intuitions.
* //Am I less rational (more instinctive) about simple math problems because I've been right so often?  What does that say about getting the right answer quickly? //

!! Causes Trump Statistics
* After learning a surprising statistic, the normal behavior is to ignore it when looking at a specific case.  For instance  you learn that after an accident 90% of observers didn't help an injured person. You later interview one of those observers and they seem very nice and upstanding.  Although you know the vast majority of people didn't help, you'll assume that this nice person was the exception, despite having no real reason to do so.
* Personal experience trumps reality.
* This is how stereotypes are formed - you met one smart Swedish person, therefore all Swedes are smart.  One Indian person was hard to understand, therefore all Indians are difficult to understand.

!! The Illusion of Understanding
* &quot;The core of the illusion is that we believe that we understand the past, which implies that the future also should be knowable, but in fact we understand the past less than we believe we do.&quot;
* The world is unknowable
* We usually don't notice that we were surprised by events because we can create a coherent narrative with hindsight.  With hindsight, the 9/11 attacks were preventable, there was the memo in August, etc.  It was a FAILURE rather than a SURPRISE.  Likewise, we knew football team A would win in hindsight because they were better prepared, had homefield advantage, etc.

!! Outside and Inside View
* Extrapolation (Inside View) vs Base Rate (Outside View)
** This feature will take us 2 more days because we've spent 2 days on it already and we're halfway done
** This feature will take us 4 more days because features usually take 6 days
** Wishful forecasting vs Back of the envelope calculation

* Outside view helps anchor reality before giving optimistic Inside View data
* Outside View is often better at predicting failure
* We will always over-value the Inside View because ''this'' project is different because I'm part of it.
* &quot;It is easier to change directions in a crisis, but this was not a crisis, only some new facts about people we didn't know.  The outside view was much easier to ignore than bad news in our own effort.  I can best describe our state as a form of lethargy - an unwillingness to think about what had happened.&quot;

!! The Engine of Capitalism
* &quot;Optimistic individuals play a disproportionate role in shaping our lives.  Their decisions make a difference; they are the inventors, the entrepreneurs, the political and military leaders.&quot;
** Influential people are optimistic and overconfident.  They take big risks.
* Delusional optimism leads to action.  Small businesses drive innovation even though 65% of them fail in the first 5 years.
* &quot;Overconfidence is another manifestation of WYSIATI: when we estimate a quantity, we rely on information that comes to mind and construct a coherent story in which the estimate makes sense.  Allowing for information that does not come to mind - perhaps because one never knew it - is impossible&quot;
** //Are estimates without a base rate impossible? //
* '&quot;Generally, it is considred a weakness and a sign of vulnerability for clinicians to appear unsure.  Confidence is valued over certainty and there is a prevailing censure against disclosing uncertainty to patients.&quot;  Experts who acknowledge the full extent of their ignorance may expect to be replaced by more confident competitors, who are better able to gain the trust of clients.'
* Humans prefer pretended knowledge to acknowledgement that these are guesses, especially when the stakes are high.

!!! The premortem (Gary Klein)
* Overconfidence cannot be fixed with training
* Prior to committing to a difficult decision
* &quot;Imagine that we are a year into the future.  We implemented the plan as it now exists.  The outcome was a disaster.  Please take 5-10 minutes to write a brief history of  that disaster.&quot;

!! Keeping Score
* The remembering self controls future behavior
* We go to great lengths to avoid regret
* Doing the default option (nothing) will produce less regret than doing something, even if both cause the same effect.
* If we prime ourselves for regret, we will likely feel less of it
** This movie will suck sooooo bad
** EMBRACE FAILURE

!! HDD talk
* TDD, ATDD, Learning Tests, Exploratory Testing
* Meetings - start with success and failure criteria - end the meeting when either is hit
* Overvaluing personal experience / intuition over data
* Learning from failure requires being aware of hindsight bias.  So be &quot;scientific&quot; and record your assumptions beforehand.
* Recording assumptions before you start usually requires at least a trivial amount of imaging and calculation.  You can avoid wishful forecasting by ignoring incomplete data of an in-process task.  Give some thought to failure criteria to avoid wasted work.
* Evolution in planning?  Optimistic External(Waterfall), Extrapolation (Agile), Base Rate anchored (Lean)
* How can we change directions based on data before we we hit a crisis?
** Thought experiment:  Your team is part of an effort to integrate with the next hot consumer good - the iGlass.  Things seem to be going well, you're ahead of schedule and everyone is pumped.  Then you receive the news - your key competitor that you're racing to market is giving up on the iGlass.  They claim it's too flaky to work with in a non-trivial application.  What would your team do?
*** Celebrate that victory is now assured
*** Give up.  After all that other team included half the engineers from the original iGlass team and you're undoubtedly doomed to failure.
*** Re-prioritize the work to stress test the iGlass before moving forward
** Suppose your team was immediately called into the office of the CEO.  How would you advise him to proceed?
* Troubles in being honest about assumptions - most people would prefer to hear pretend knowledge over guesses, especially when the stakes are high.
* The premortem - more research
** Alternative to 6 thinking hats?
** A version of hypothesis-driven development - seek to disprove the hypothesis
* Embrace failure to avoid regret from trying things

!! Quotes
* The acquisition of skills requires a regular environment, an adequate opportunity to practice, and rapid and unequivocal feedback about the correctness of thoughts and actions.

* Our subjects left the choice to their remembering self, preferring to repeat the trial that left the better memory, although it involved more pain...An objective observer making the choice for someone else would undoubtedly choose the short exposure, favoring the sufferer's experiencing self.</pre>
</div>
<div title="Three Steps to a Useful Minimal Feature" creator="Steve" modifier="Steve" created="201409141242" modified="201409141246" tags="agile story-splitting" changecount="3">
<pre>http://www.jbrains.ca/permalink/three-steps-to-a-useful-minimal-feature

# Write out any, and I mean any, meaningful end-to-end scenario in detail with concrete values at every step.
# Now that you鶥 chosen one real scenario, go to each step in that scenario and ask the question, 엨at would I need to assume to eliminate this step?�f you find those assumptions make for a reasonable scenario, then use that assumption to simplify the scenario.
# Repeat step 2 until exhausted or unable to come up with a simplifying assumption with five minutes頴hought.

Part of this process is discovering other requirements and external systems.  We're exposing risk and complexity when we think we're in a &quot;simple&quot; reduction exercise.  Neat!</pre>
</div>
<div title="To Note(8 April 2016)" creator="Steve" modifier="Steve" created="201604081209" modified="201604081226" tags="#toread" changecount="3">
<pre>! Load Testing
https://docs.google.com/document/d/1c2-NsJiUjeLRxqWZHlB40h0FSo_nQp0qCcAyKtaeB28/edit
https://drive.google.com/drive/folders/0ByY-UAEDZpUfRUxFMW9SdGo4VTA
Sometimes a Locust Storm is a Good Thing
http://wunder.schoenaberselten.com/2016/02/16/how-to-prepare-and-write-a-tech-conference-talk/

! Open Source
!! Removing nokogiri
http://ruby-doc.org/stdlib-2.2.3/libdoc/rexml/rdoc/REXML/XPath.html
http://stackoverflow.com/questions/571663/ruby-xpath-to-find-attribute
http://stackoverflow.com/questions/7243486/why-do-you-need-require-bundler-setup
https://github.com/stevenjackson/pinch_hitter/blob/9cb0cb5c917b4de5900c49a4a43d00f35d0b53c5/lib/pinch_hitter/message/xml.rb

! Deep Dive &amp; Process
http://storiesonboard.com
https://docs.google.com/presentation/d/1rXqJUi4OJxy2JACC4ZNZnjlUtDV42chOV9J5a_Z1G1M/edit?pli=1#slide=id.p (Balanced Team Recap)

! Apprenticeship
http://apprentice.at/

! Happiness
https://hbr.org/2015/12/the-two-sides-of-employee-engagement
https://www.linkedin.com/pulse/employee-engagement-isnt-getting-better-gallup-shares-mark-c-crowley
https://www.mercuryapp.com/learn_more
http://www.amazon.com/Reinventing-Organizations-Frederic-Laloux/dp/2960133501
https://www.covermymeds.com/main/what-makes-a-company-succeed/+
http://andycleff.com/2015/05/agile-team-health-check-models/
http://www.happymelly.com/in-the-pursuit-of-happiness/
http://management30.us6.list-manage.com/track/click?u=38f755d573baf4cdcb1d04318&amp;id=713e9b2e7f&amp;e=916821420b

! Failure
http://web.mit.edu/2.75/resources/random/How%20Complex%20Systems%20Fail.pdf

! Nerdiness
https://webtorrent.io
http://codurance.com/2015/06/17/inflection-point/
https://github.com/littlebee
abstractions.io
https://github.com/TechConf/CodeMash2016/tree/master/6-Ways-To-Prevent-Code-Abuse
https://github.com/coryhouse/react-slingshot
https://leanpub.com/4rulesofsimpledesign
http://jakegoulding.com/blog/2016/01/02/rust-on-an-arduino-uno/
https://github.com/kitanata/genetics
https://ifttt.com/recipes/286124-find-my-phone
https://ifttt.com/recipes/303971-find-your-phone-by-setting-an-echo-timer
https://flightjs.github.io/
https://github.com/centricconsulting/alexa-framework-go/
https://github.com/TechConf/CodeMash2016



! WISR
http://django-social-auth.readthedocs.org/en/latest/backends/linkedin.html
https://developer.linkedin.com/docs/oauth2?u=0
https://www.cronofy.com/pricing/
https://developer.linkedin.com/docs/fields/basic-profile?u=0
https://developer.linkedin.com/docs/rest-api?u=0
https://developer.linkedin.com/docs?u=0

</pre>
</div>
<div title="ToNote (June 12, 2015)" creator="Steve" modifier="Steve" created="201506122349" modified="201603241229" tags="#toread" changecount="2">
<pre>https://erikreads.files.wordpress.com/2014/04/thinking-fast-and-slow-book-summary.pdf
http://blog.crisp.se/2014/03/27/henrikkniberg/spotify-engineering-culture-part-1
http://www.industriallogic.com/blog/are-your-development-defenses-dangerous/
http://lifehacker.com/become-a-stronger-leader-by-asking-yourself-these-three-1707550666
https://medium.com/javascript-and-opinions/state-of-the-art-javascript-in-2016-ab67fc68eb0b#.3ktwknxxu</pre>
</div>
<div title="Toaster Heuristic" creator="Steve" modifier="Steve" created="201311101401" tags="estimates" changecount="1">
<pre>http://derailleurconsulting.com/blog/the-toaster-heuristic

* Strive towards standardizing the size of work so you can optimize flow and enable predictability

Toaster Heuristic:  Imagine a software team as a toaster oven.
* The toaster oven is analogous to a work system - it produces a predictable amount of heat when toasting, the only real variables are time and type of bread.
* Usually unhappy with the results - every experience is completely different and the estimates (spots on the dial) are significantly wrong
* What if I just observed the toast and timed how long it took to do a typical piece of bread?
* Provide the toaster oven a small slice of work to do.  Measure the cycle time to where the quality of the end-product is satisfactory.
* Adjust the work to meet this measured result.  (Slice the bread thinner, but always keep the oven set the same way).


Moral of the story:  Use empirical data to inform the amount of work we slice off, rather than guessing at adjustments.  This enables predictabiity and and leads towards a stable work system where the baseline is known.

</pre>
</div>
<div title="Tradeoffs in Coordination Among Teams" creator="YourName" modifier="YourName" created="201607052227" modified="201607062121" changecount="2">
<pre>Jessica Kerr
http://blog.jessitron.com/2016/05/tradeoffs-in-coordination-among-teams.html

Balancing Moving Together vs Moving Forward

!! Moving together
One team of 2-7 people can move fast and get a large interplay of useful ideas.

Two teams will mean more coordination with lots of lines of communication.  Each team gets about half as much done as the first team did by itself (but is tackling problems in parallel).  Both teams are moving in the same direction.

4 teams, different levels of communication, different levels of coordination.  The teams that have more coordination are moving slower, but moving together.  A team that is less connected is moving faster, but is off target.

Coordination costs are now burdensome.  Moving quickly is hard because you might break everyone's stuff.

!! Moving forward

Create boundaries and decouple everything.  Very few coordination pathways, but every team must do more stuff because they can't leverage another team's work without more coordination.  Backwards compatibility and degradation must be built in so the teams can work on different release schedules.

Amazon works this way, every team moves forward with a full set of armor.  You have no idea what anyone else is doing.

Google is the opposite extreme, monorepo and lots of tooling and shared libraries allow integration.   They've built tests, refactoring tools, custom version control and programming languages to support this.  Thousands of engineers work on infrastructure.

!! Balance
Consensus is needed at the business level.  What are our objectives and direction?  Consensus is crippling on the back end.  Agreeing on databases, upgrading  libraries and coordinating releases slows us down.

We should try to share some tools and expertise.  Don't make every team re-invent the wheel.  If it makes sense, create shared service teams that are more like the &quot;full armor&quot; amazon teams and let the &quot;full speed&quot; teams leverage them.

!! Conclusions
* Avoid shared libraries unless you have dedicated support for them
* Avoid shared databases (but create DBMS tools that can be shared)
* Encourage shared ideas
* Reach consensus on what we want to achieve and why we are doing it.  At a high-level, agree on how it will be done.
</pre>
</div>
<div title="UX for devs" creator="Steve" modifier="Steve" created="201501081357" tags="#codemash" changecount="1">
<pre>sadukie

* UX is before, during, and after.  Expectations, beliefs, preferences, emotion.
* Dan Willis - UX umbrella
* Convenience + Design - Cost = UX

* Mind Maps and Site Maps
** Freemind - mind mapping tool - sadukie uses for brainstorming

* Personas
** Crisis persona
* Gherkin
* Wireframes
** Balsalmiq, Pencil
* Focus groups to test
* Heatmaps &amp; analytics
</pre>
</div>
<div title="Ubiquitous Language in Domain Driven Design" creator="Steve" modifier="Steve" created="201410011713" modified="201410011715" tags="#cukeup #ddd" changecount="2">
<pre>Eric Evans @ericevans0

!! Modeling mistakes
* Looking for the 1 true model
* DDD says 4 models in 4 separate contexts is fine.
** Elephant : Tree, Elephant : Wall, Elephant : Snake, Elephant : Rope

!! Translating between models
Rope context - &gt; Translator -&gt; Snake context
Rope.tiedown -&gt; Translator -&gt; Snake.location
Rope.tiedown -&gt; Translator -&gt; GIS Context.address -&gt; GIS Context.geo_loc -&gt; Snake.location

!! What are models for?
* Identifying risk
* Exploring other models

!! Modeling breakthrough!
Parts of a whole:  Elephant : Wall + Tree + Snake + Rope
Now we have 5 models!

!! DDD Whirlpool

# Tell a story
# Flesh it out
# Refocus on hard part
# Refocus on core domain

Describe Scenario -&gt; Define model -&gt; Probe model
Story -&gt; Theory -&gt; Experiment

Get in, swirl around, GET OUT

!! New data

Elephant seems to crush people's feet some of the time
Can we maintain our model with this data?
So Elephant : Tree must hop  = New Hypothesis to test.

This is just an iteration of our original model.  Still have 5 models.

!! Model breakthrough
Elephant is-a animal and has-a trunk
Animal has-a tail and has-a leg (one to many)

Now we have 6 models!

!! Translation is tricky
In Tree Context:  Tree.Trunk -&gt; Translator -&gt; Animal.Leg  (Not Elephant.Trunk)

!! DDD in a nutshell
* Bounded context
* Ubiquitous language (UL is context specific!  So we have 6 languages)
* Model Exploration

''&quot;We'll never get to perfect, perfect is the enemy of the good&quot;''

!! Where to start?
* Start with scenarios that worry the domain experts the most.  They'll want to talk about them and help you model them to mitigate that risk.
* Don't strive for perfect language.  Cut off theorizing at some point and experiment.  Use the language and see where it falls short.</pre>
</div>
<div title="Under Pressure" creator="Steve" modifier="Steve" created="201705042007" modified="201705042043" tags="#aab17" changecount="4">
<pre>@toddkaufman

Stakeholders say add more people, PMs suggest working more hours instead, Devs decide to write fewer tests instead.

Does adding resources to a project that is already late speed it up? - Nope.  Why not?
# Ramp up
# Communication
# Separation of work
# Integration
# Dysfunction

Dysfunction is amplified when you have bigger teams.  Adding people to a dysfunctional software environment makes it even *more* inept.

Nobody in the history of software development has come in at 1/4 of their original estimate!

#noestimates - track cycle time - it's real data!
Quick sizing - just small and large.

#noestimates -&gt; Now the PMs are stakeholders are stressed out.  They have no knobs to turn!  This gets turned on the developers.

Software quality is how easily and safely we can change a codebase.

Left with only this data $150K estimate, they're going to go with it.
We need estimation to help stakeholders make decisions.

Team Level Cycle Time, BUT Changing Teams means Unpredictable Estimates

Stakeholders don't trust that developers will give a reasonably accurate estimates.  Developers don't trust that stakeholders won't beat them with those estimates.

!! How to go faster?
# Remove negativity and waste
# Focus less on stress, more on why
# Be intentional
# Make debt visible
# Pair more

Change the conversation to how predictable we are instead of how fast we are.
</pre>
</div>
<div title="Upgrading Junior Developers" creator="Steve" modifier="Steve" created="201506131508" modified="201506131718" tags="#pghtechfest" changecount="3">
<pre>Christopher Houdeshell
@choudeshell

Had takeaway as early slide - good idea!

Made productive and efficient
Autonomous
Instill Confidence

Tolerate mistakes
Make Time - 8 hours per week
No grunt work - no maintenance apps
Help define their goals - must be attainable, can't be lofty

!! Takeaways
&quot;I am trying to __ so that I can ___ I'm running into ___ .  I've looked at __ and tried ___.&quot;
Add interviewing day - day 2 - what do you do here?


</pre>
</div>
<div title="Using Google Spreadsheet as a simple TDD/BDD environment" creator="Steve" modifier="Steve" created="201404091615" modified="201404091631" changecount="2">
<pre>http://vimeo.com/89909482

Fizzbuzz

Number | Expected | Actual        | Pass/Fail |
&lt;typed&gt; | &lt;typed&gt;   | &lt;function&gt; | expected == actual |

Actual ties to a spreadsheet function</pre>
</div>
<div title="Vagrant talk" creator="Steve" modifier="Steve" created="201306301817" modified="201309150153" changecount="21">
<pre>! TODO
Record time to start from scratch ''23 minutes'' + 20 mins to install virtualbox, vagrant, and java
Record talk again, find 5 minutes to cut
Put slides on memory stick


-----
Start from scratch (vagrant destroy) ''done''
How many steps to get to testing?  ''doc'd''

Test with no wifi ''works fine''

fork play2 - ''done''
 - chown vagrant
 - update default

write cukes - ''done''
test selenium remote ''done''


Slides
 - picture showing vagrant, chef-solo, virtual box, Berkshelf
 - picture showing cukes, app, dev/new tester
 - picture showing cukes, app - new CI box

!! Steps
vagrant up
start selenium
vagrant ssh
cd /vagrant/todolist
play run
'' Need a way to warm up play'' - ''play compile'' in vagrantfile
cd /vagrant
cucumber




!! Issues
 * New tester
 * Multi-project developer
 * Synching CI with prod
 * Shared resources
 * Trying out new envs
 * Envs changing outside of version control
 * works on my machine

!! Outline
 * What is Vagrant
 * magic formula slide
 * Environment as code
 * Problems and Solutions - can I build up to the finale?
 * Ecosystem, plugins, etc
 * Selenium remote

!! Cons
 * VM incompatibilities
 * Slower
 * No UI - Windows users

!!Other

Immutable deployments
AWS demo

Tips:
http://ashedryden.com/blog/what-you-need-to-know-about-speaking-at-conferences
cloud.images.ubuntu.com
https://github.com/mitchellh/vagrant/wiki/Available-Vagrant-Plugins
https://github.com/mitchellh/vagrant/wiki/Available-Vagrant-Boxes
http://www.vagrantbox.es/</pre>
</div>
<div title="Vagrant talk recording 1" creator="Steve" modifier="Steve" created="201309051640" modified="201309082128" changecount="7">
<pre>Intro
Vagrant is a pretty powerful tool that will let you setup virtual machines the same way, everytime automatically.

Formula slide
Providers
  VMWare and Amazon EC2, via their plugin system.
Provisioners
  It has the ability to take a VM provider.  Initially this was just virtualbox, but they've recently added integration with VMWare and Amazon EC2, via their plugin system.
  chef, puppet, ansibile, shell scripting, there are  a ton of plugins out there, - salt

* Env to source code
 - Vagrantfile lives with your source


* Vagrant = How do I run my application?
* Vagrant = Executable Readme?
* Vagrant = Multi-platform setup script
* Vagrant = Environment as Code


* Options!

* 1:  Setup machine that looks like my production server
  Works on my machine!
 * Env changes in source control!
*  Show vagrantfile
* Show vagrant up
* Show vagrant ssh

* 3:  Demo system
   My history - 3 day install process
   Out-of-date
   Build machine as demo box
   Solution:  Vagrant supports multiple VMs networked together with the enviroment up-to-date


*2:  Try new system - new OS, new app server version, etc


* 4:  Perf test
   2 week perf test

* New CI server

*5:  Hate installing stuff
  - Clean machine joy
  - Oracle DB, hard to install, what did I install
  - Use a VM, snapshots, easy to throw away and start over

*6:  Multi-project developer/designer
  - VM for every project

*5: Test isolation

*7:  VM for QA = joy
 - On issue, pause VM, send it over to a dev for on the spot troubleshooting.

*7:  Ruby installs
   - History lots of crappy installs
   - Goal: Make a new user productive in under an hour
   - Examples:  windows, rvm, link headers, missing libraries, homebrew and mac ports

*8:  Shared resources BAD
  -NO time to set him up, lets share some resources
  - Point him at the build machine!
  - Cleanup to a clean state
  - Want to know what the system looks like before we execute tests
  - Why is this test failing
  - False positives
  - Deleting stuff, conflicts
  - New build being pushed

* Browser test on the VM
  - Not ideal, resources
  - Would you install a browser on your prod server?

* How to start from nothing
  - install vagrant
  - install virtualbox
  - install java
  - selenium
  - clone repo

* Finale!


* Drawbacks</pre>
</div>
<div title="We need more bad ideas! An introduction to Contrarian Design for research and concept development" creator="Steve" modifier="Steve" created="201601072158" modified="201601081358" tags="#codemash 2016" changecount="6">
<pre>Katie Quehl
@KatieQuehl

  #ContrarianDesign
http://katiequehl.com/ixda-cincinnati-contrarian-design-presentation/

!! Why
*Encourage creativity
*Overcome being stuck
*Gain perspectives
*Develop empathy
*Explore uncomfortable topics

!! Questions to generate bad ideas
How would I design for the opposite of what I want to accomplish?
How would a kindergartener solve fore this?
What would I suggest if I wanted to kill this project?

!! Examine ideas
* What is bad about this?
* Why is it bad?
* Is there a different context where this would be good?


</pre>
</div>
<div title="Web Developer Resources" creator="Steve" modifier="Steve" created="201308171343" tags="scrc13" changecount="1">
<pre>https://speakerdeck.com/juliepagano/i-am-a-front-end-web-dev-and-so-can-you

Mozilla Developer Network
HTML5 Boiler Plate
Dive into HTML 5
html5rocks.com
caniuse.com
css-tricks.com
A List Apart
modernizer

css - compass
* What does it do?

*What's a css property?
*What's hoisting in javascript?
</pre>
</div>
<div title="Web server tuning" creator="Steve" modifier="Steve" created="201502251727" changecount="1">
<pre>https://support.cloud.engineyard.com/entries/23852283-Worker-Allocation-on-Engine-Yard-Cloud
http://engineering.chartbeat.com/2014/01/02/part-1-lessons-learned-tuning-tcp-and-nginx-in-ec2/
https://rtcamp.com/tutorials/linux/sysctl-conf/
http://tweaked.io/guide/nginx-proxying/
http://unicorn.bogomips.org/TUNING.html
http://engineering.chartbeat.com/2014/02/12/part-2-lessons-learned-tuning-tcp-and-nginx-in-ec2/</pre>
</div>
<div title="WebRTC: Unicorns, Narwhals and The Real- Time Web" creator="Steve" modifier="Steve" created="201506131345" modified="201506131435" tags="#pghtechfest 2015" changecount="7">
<pre>Tian Davis - Respoke developer advocate
@tiandavis
tiandavis.com/talks

WebRTC
 * Video from rep, customer audio only

DataChannel - secure data xfer - p2p
Chunking images
API will converge at 1.1

Firebreadth - &gt; activex and nbap

ICE - framework for browser p2p
STUN - candidate = (ip and firewall (ports?))
Singaling - websocket server- facilitates the STUN connection
TURN - provides for situations when p2p fails
 * (How does that work?)
 * Why is it more reliable?
 ** When STUN fails - can't get through firewall - TURN is the mediator

rfc5766-turn-server (stun and turn server from google free)

Not just websockets - p2p - it's free from a server standpoint.

''what's the story on mobile?'' - not ready
''clojure signaling server''

''lunch and learn - create video to video app''
</pre>
</div>
<div title="When Edge Cases Poke Holes in Your Perfect Solution" creator="Steve" modifier="Steve" created="201501151421" modified="201502101116" changecount="3">
<pre>http://www.justinweiss.com/blog/2015/01/13/when-edge-cases-poke-holes-in-your-perfect-solution/

&lt;&lt;&lt;
You can鴠fight too much cleverness with more cleverness. At least, not directly. Instead, go the other way. Go simple. Go straightforward.
&lt;&lt;&lt;
&lt;&lt;&lt;
Inline the code you were trying to abstract away. Do repeat yourself. Keep your code explicit.
&lt;&lt;&lt;
</pre>
</div>
<div title="Why I left Angular and Knockout for React" creator="Steve" modifier="Steve" created="201601072031" modified="201601081358" tags="#codemash 2016" changecount="7">
<pre>@housecor
Cory House
http://www.bitnative.com/

* HTML should be a projection of app state not a source of truth (//not the system of record//)
* JS and HTML in the same way
* Unidirectional flow is better than two-way binding
* Inline styles are good.

''react-slingshot - open source from Cory''

!!! JSX
* Markup in this middle of your javascript
* Angular, ember, knockout puts js in your html
* In Angular, you write Angular.  In React, you write JavaScript.
* Composing UI in javascript gives you a compile-time error vs runtime

!!! Virtual DOM

!!! Hot reload
Code on the left, browser on the right.  Just make a change and save the code file.

!!! Isomorphic
* Code is rendered on the server and shipped to client as html
`renderToString`
* Performance, Accessibility, Maintainability

!!!Unidrectional Data Flow
* So clean
* React, Action, Dispatcher, Store, React

!!! Angular vs React
* Big names are using react.  Angular has a bigger list, but less humungous players.



</pre>
</div>
<div title="WorkplaceInterview" creator="Steve" modifier="Steve" created="201403051558" changecount="1">
<pre>What's your favorite worktime conversation?
What would you like someone else make happen?
What would you change if you were allowed to?
What decision has upset you the most in the last six months?
What incentive would make you change the way you work?
What's holding you back?</pre>
</div>
<div title="hub" creator="Steve" modifier="Steve" created="201612222228" modified="201612222228" tags="hangout karns" changecount="2">
<pre>@jasonkarns - td hangout dec22
hub clone testdouble/testdouble.js - Get the &quot;github&quot; url for free in any hub command

hub browse -&gt; open a page to github
hub compare v1.0.0...master
hub browse -- issues
hub fork -&gt; fork to my user
hub pull-request -o  -&gt; open github with a pull-request from my current HEAD to origin/master

can checkout PRs directly

hub checkout (url to pr) - &gt; create a local branch with that PR
</pre>
</div>
<div title="react.js" creator="Steve" modifier="Steve" created="201504081620" modified="201504081651" changecount="7">
<pre>Nathan

!!! component based
Focused on components - components take data and spit out html.
 * React figures out how to change the DOM
// Does this mean rendering is atomic?// - ''YES''

!!! jsx
syntax used by facebook to avoid boilerplate - basically can embed html tags in javascript code
{{{
  return &lt;h1&gt; Hello from React &lt;/h1&gt;;
}}}
** Should be precompiled in production

!!! Components

{{{
&lt;TodoItem text=&quot;Code&quot; /&gt;

//elsewhere in TodoItem render() function:
return &lt;li&gt;{this.props.text}&lt;/li&gt;
}}}

!!! Flux
* Events from components are broadcast to a &quot;Dispatcher&quot;
* Dispatcher has listeners that register for interesting things

!!! Wiriing up updates
 getInitialState - first time data
 componentWillMount - called before render (good place to register for listeners)
 setState - refresh widget
</pre>
</div>
<div title="scrc13" creator="Steve" modifier="Steve" created="201308171455" modified="201308171503" tags="scrc13" changecount="2">
<pre>''Find links''

Romans 7

Punished By Rewards - ''Find link''





</pre>
</div>
<div title="scrcFolks" creator="Steve" modifier="Steve" created="201308181606" tags="scrc" changecount="1">
<pre>To tweet:

@avdi
@greggyb
@rubybuddha
@franklinchen and ...  - ML
@TheOtherZach
@justinxreese
@kerrizor
@machuga
@juliepagano
@strand
@jimweirich

To follow:
@tundal45
@thegiftbug
@GavinStark</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->

<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[

//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project repository at https://github.com/TiddlyWiki/tiddlywiki
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//
// JSLint directives
/*global jQuery:false, version:false */
/*jslint bitwise:true, browser:true, confusion:true, eqeq:true, evil:true, forin:true, maxerr:100, plusplus:true, regexp:true, sloppy:true, sub:true, undef:true, unparam:true, vars:true, white:true */
//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
    numRssItems: 20, // Number of items in the RSS feed
    animDuration: 400, // Duration of UI animations in milliseconds
    cascadeFast: 20, // Speed for cascade animations (higher == slower)
    cascadeSlow: 60, // Speed for EasterEgg cascade animations
    cascadeDepth: 5, // Depth of cascade animation
    locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
    messageClose: {},
    dates: {},
    tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
    chkRegExpSearch: false,
    chkCaseSensitiveSearch: false,
    chkIncrementalSearch: true,
    chkAnimate: true,
    chkSaveBackups: true,
    chkAutoSave: false,
    chkGenerateAnRssFeed: false,
    chkSaveEmptyTemplate: false,
    chkOpenInNewWindow: true,
    chkToggleLinks: false,
    chkHttpReadOnly: true,
    chkForceMinorUpdate: false,
    chkConfirmDelete: true,
    chkInsertTabs: false,
    chkUsePreForStorage: true, // Whether to use <pre> format for storage
    chkDisplayInstrumentation: false,
    txtBackupFolder: "",
    txtEditorFocus: "text",
    txtMainTab: "tabTimeline",
    txtMoreTab: "moreTabAll",
    txtMaxEditRows: "30",
    txtFileSystemCharSet: "UTF-8",
    txtTheme: ""
    };
config.optionsDesc = {};

config.optionsSource = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
    1: "ViewTemplate",
    2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
    wikified: {
        tag: {}
    },
    editor: {
        tagChooser: {}
    }
};

// Backstage tasks
config.backstageTasks = ["save","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
    today: {},
    version: {},
    search: {sizeTextbox: 15},
    tiddler: {},
    tag: {},
    tags: {},
    tagging: {},
    timeline: {},
    allTags: {},
    list: {
        all: {},
        missing: {},
        orphans: {},
        shadowed: {},
        touched: {},
        filter: {}
    },
    closeAll: {},
    permaview: {},
    saveChanges: {},
    slider: {},
    option: {},
    options: {},
    newTiddler: {},
    newJournal: {},
    tabs: {},
    gradient: {},
    message: {},
    view: {defaultView: "text"},
    edit: {},
    tagChooser: {},
    toolbar: {},
    plugins: {},
    refreshDisplay: {},
    importTiddlers: {},
    upgrade: {
        source: "http://tiddlywiki-releases.tiddlyspace.com/upgrade",
        backupExtension: "pre.core.upgrade"
    },
    sync: {},
    annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
    closeTiddler: {},
    closeOthers: {},
    editTiddler: {},
    saveTiddler: {hideReadOnly: true},
    cancelTiddler: {},
    deleteTiddler: {hideReadOnly: true},
    permalink: {},
    references: {type: "popup"},
    jump: {type: "popup"},
    syncing: {type: "popup"},
    fields: {type: "popup"}
};

// Control of macro parameter evaluation
config.evaluateMacroParameters = "all";

// Basic regular expressions
config.textPrimitives = {
    upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
    lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
    anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
    anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))) {
    config.textPrimitives = {
        upperLetter: "[A-Z\u00c0-\u00de]",
        lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
        anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
        anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
    };
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
    config.textPrimitives.lowerLetter + "+" +
    config.textPrimitives.upperLetter +
    config.textPrimitives.anyLetter + "*)|(?:" +
    config.textPrimitives.upperLetter + "{2,}" +
    config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
    config.textPrimitives.brackettedLink + ")|(?:" +
    config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
    config.textPrimitives.titledBrackettedLink + ")|(?:" +
    config.textPrimitives.brackettedLink + ")|(?:" +
    config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
    currBrowser: null,
    browsers: [],
    codes: {}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
    StyleSheet: "",
    MarkupPreHead: "",
    MarkupPostHead: "",
    MarkupPreBody: "",
    MarkupPostBody: "",
    TabTimeline: '<<timeline>>',
    TabAll: '<<list all>>',
    TabTags: '<<allTags excludeLists>>',
    TabMoreMissing: '<<list missing>>',
    TabMoreOrphans: '<<list orphans>>',
    TabMoreShadowed: '<<list shadowed>>',
    AdvancedOptions: '<<options>>',
    PluginManager: '<<plugins>>',
    SystemSettings: '',
    ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|',
    WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
    isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
    isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
    ieVersion: /MSIE (\d{1,2}.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
    isSafari: config.userAgent.indexOf("applewebkit") != -1,
    isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
    firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
    isOpera: config.userAgent.indexOf("opera") != -1,
    isChrome: config.userAgent.indexOf('chrome') > -1,
    isLinux: config.userAgent.indexOf("linux") != -1,
    isUnix: config.userAgent.indexOf("x11") != -1,
    isMac: config.userAgent.indexOf("mac") != -1,
    isWindows: config.userAgent.indexOf("win") != -1
};

merge(config.glyphs,{
    browsers: [
        function() {return config.browser.isIE;},
        function() {return true;}
        ],
    codes: {
        downTriangle: ["\u25BC","\u25BE"],
        downArrow: ["\u2193","\u2193"],
        bentArrowLeft: ["\u2190","\u21A9"],
        bentArrowRight: ["\u2192","\u21AA"]
    }
});

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
    txtUserName: "YourName"});

merge(config.tasks,{
    save: {text: "save", tooltip: "Save your changes to this TiddlyWiki"},
    importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
    tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
    upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
    plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
    txtUserName: "Username for signing your edits",
    chkRegExpSearch: "Enable regular expressions for searches",
    chkCaseSensitiveSearch: "Case-sensitive searching",
    chkIncrementalSearch: "Incremental key-by-key searching",
    chkAnimate: "Enable animations",
    chkSaveBackups: "Keep backup file when saving changes",
    chkAutoSave: "Automatically save changes",
    chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
    chkSaveEmptyTemplate: "Generate an empty template when saving changes",
    chkOpenInNewWindow: "Open external links in a new window",
    chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
    chkHttpReadOnly: "Hide editing features when viewed over HTTP",
    chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
    chkConfirmDelete: "Require confirmation before deleting tiddlers",
    chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
    txtBackupFolder: "Name of folder to use for backups",
    txtMaxEditRows: "Maximum number of rows in edit boxes",
    txtTheme: "Name of the theme to use",
    txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
    customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
    pluginError: "Error: %0",
    pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
    pluginForced: "Executed because forced via 'systemConfigForce' tag",
    pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
    nothingSelected: "Nothing is selected. You must select one or more items first",
    savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
    subtitleUnknown: "(unknown)",
    undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
    shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
    tiddlerLinkTooltip: "%0 - %1, %2",
    externalLinkTooltip: "External link to %0",
    noTags: "There are no tagged tiddlers",
    notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
    cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
    invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
    backupSaved: "Backup saved",
    backupFailed: "Failed to save backup file",
    rssSaved: "RSS feed saved",
    rssFailed: "Failed to save RSS feed file",
    emptySaved: "Empty template saved",
    emptyFailed: "Failed to save empty template file",
    mainSaved: "Main TiddlyWiki file saved",
    mainDownload: "Downloading/saving main TiddlyWiki file",
    mainDownloadManual: "RIGHT CLICK HERE to download/save main TiddlyWiki file",
    mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
    macroError: "Error in macro <<%0>>",
    macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
    missingMacro: "No such macro",
    overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
    unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
    confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
    saveInstructions: "SaveChanges",
    unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
    tiddlerSaveError: "Error when saving tiddler '%0'",
    tiddlerLoadError: "Error when loading tiddler '%0'",
    wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
    invalidFieldName: "Invalid field name %0",
    fieldCannotBeChanged: "Field '%0' cannot be changed",
    loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
    upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
    invalidCookie: "Invalid cookie '%0'"});

merge(config.messages.messageClose,{
    text: "close",
    tooltip: "close this message area"});

config.messages.backstage = {
    open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
    close: {text: "close", tooltip: "Close the backstage area"},
    prompt: "backstage: ",
    decal: {
        edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
    }
};

config.messages.listView = {
    tiddlerTooltip: "Click for the full text of this tiddler",
    previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
        "th","th","th","th","th","th","th","th","th","th",
        "st","nd","rd","th","th","th","th","th","th","th",
        "st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
    });

merge(config.views.wikified.tag,{
    labelNoTags: "no tags",
    labelTags: "tags: ",
    openTag: "Open tag '%0'",
    tooltip: "Show tiddlers tagged with '%0'",
    openAllText: "Open all",
    openAllTooltip: "Open all of these tiddlers",
    popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
    defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
    defaultModifier: "(missing)",
    shadowModifier: "(built-in shadow tiddler)",
    dateFormat: "DD MMM YYYY",
    createdPrompt: "created"});

merge(config.views.editor,{
    tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
    defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
    text: "tags",
    tooltip: "Choose existing tags to add to this tiddler",
    popupNone: "There are no tags defined",
    tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
    sizeTemplates:
        [
        {unit: 1024*1024*1024, template: "%0\u00a0GB"},
        {unit: 1024*1024, template: "%0\u00a0MB"},
        {unit: 1024, template: "%0\u00a0KB"},
        {unit: 1, template: "%0\u00a0B"}
        ]});

merge(config.macros.search,{
    label: "search",
    prompt: "Search this TiddlyWiki",
    placeholder: "",
    accessKey: "F",
    successMsg: "%0 tiddlers found matching %1",
    failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
    label: "tagging: ",
    labelNotTag: "not tagging",
    tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
    dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
    tooltip: "Show tiddlers tagged with '%0'",
    noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
    label: "close all",
    prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
    label: "permaview",
    prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
    label: "save changes",
    prompt: "Save all tiddlers to create a new TiddlyWiki",
    accessKey: "S"});

merge(config.macros.newTiddler,{
    label: "new tiddler",
    prompt: "Create a new tiddler",
    title: "New Tiddler",
    accessKey: "N"});

merge(config.macros.newJournal,{
    label: "new journal",
    prompt: "Create a new tiddler from the current date and time",
    accessKey: "J"});

merge(config.macros.options,{
    wizardTitle: "Tweak advanced options",
    step1Title: "These options are saved in cookies in your browser",
    step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
    unknownDescription: "//(unknown)//",
    listViewTemplate: {
        columns: [
            {name: 'Option', field: 'option', title: "Option", type: 'String'},
            {name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
            {name: 'Name', field: 'name', title: "Name", type: 'String'}
            ],
        rowClasses: [
            {className: 'lowlight', field: 'lowlight'}
            ]}
    });

merge(config.macros.plugins,{
    wizardTitle: "Manage plugins",
    step1Title: "Currently loaded plugins",
    step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
    skippedText: "(This plugin has not been executed because it was added since startup)",
    noPluginText: "There are no plugins installed",
    confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
    removeLabel: "remove systemConfig tag",
    removePrompt: "Remove systemConfig tag",
    deleteLabel: "delete",
    deletePrompt: "Delete these tiddlers forever",
    listViewTemplate: {
        columns: [
            {name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
            {name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
            {name: 'Description', field: 'Description', title: "Description", type: 'String'},
            {name: 'Version', field: 'Version', title: "Version", type: 'String'},
            {name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
            {name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
            {name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
            {name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
            {name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
            {name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
            {name: 'Log', field: 'log', title: "Log", type: 'StringList'}
            ],
        rowClasses: [
            {className: 'error', field: 'error'},
            {className: 'warning', field: 'warning'}
            ]},
    listViewTemplateReadOnly: {
        columns: [
            {name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
            {name: 'Description', field: 'Description', title: "Description", type: 'String'},
            {name: 'Version', field: 'Version', title: "Version", type: 'String'},
            {name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
            {name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
            {name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
            {name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
            {name: 'Log', field: 'log', title: "Log", type: 'StringList'}
            ],
        rowClasses: [
            {className: 'error', field: 'error'},
            {className: 'warning', field: 'warning'}
            ]}
    });

merge(config.macros.toolbar,{
    moreLabel: "more",
    morePrompt: "Show additional commands",
    lessLabel: "less",
    lessPrompt: "Hide additional commands",
    separator: "|"
    });

merge(config.macros.refreshDisplay,{
    label: "refresh",
    prompt: "Redraw the entire TiddlyWiki display"
    });

merge(config.macros.importTiddlers,{
    readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
    wizardTitle: "Import tiddlers from another file or server",
    step1Title: "Step 1: Locate the server or TiddlyWiki file",
    step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
    openLabel: "open",
    openPrompt: "Open the connection to this file or server",
    statusOpenHost: "Opening the host",
    statusGetWorkspaceList: "Getting the list of available workspaces",
    step2Title: "Step 2: Choose the workspace",
    step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
    cancelLabel: "cancel",
    cancelPrompt: "Cancel this import",
    statusOpenWorkspace: "Opening the workspace",
    statusGetTiddlerList: "Getting the list of available tiddlers",
    errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
    errorGettingTiddlerListHttp404: "Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.",
    errorGettingTiddlerListHttp: "Error retrieving tiddlers from url, please ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled",
    errorGettingTiddlerListFile: "Error retrieving tiddlers from local file, please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.",
    step3Title: "Step 3: Choose the tiddlers to import",
    step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
    importLabel: "import",
    importPrompt: "Import these tiddlers",
    confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
    step4Title: "Step 4: Importing %0 tiddler(s)",
    step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
    doneLabel: "done",
    donePrompt: "Close this wizard",
    statusDoingImport: "Importing tiddlers",
    statusDoneImport: "All tiddlers imported",
    systemServerNamePattern: "%2 on %1",
    systemServerNamePatternNoWorkspace: "%1",
    confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
    serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
    serverSaveModifier: "(System)",
    listViewTemplate: {
        columns: [
            {name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
            {name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
            {name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
            {name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
            ],
        rowClasses: [
            ]}
    });

merge(config.macros.upgrade,{
    wizardTitle: "Upgrade TiddlyWiki core code",
    step1Title: "Update or repair this TiddlyWiki to the latest release",
    step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
    errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
    errorNotSaved: "You must save changes before you can perform an upgrade",
    step2Title: "Confirm the upgrade details",
    step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
    step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
    step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
    upgradeLabel: "upgrade",
    upgradePrompt: "Prepare for the upgrade process",
    statusPreparingBackup: "Preparing backup",
    statusSavingBackup: "Saving backup file",
    errorSavingBackup: "There was a problem saving the backup file",
    statusLoadingCore: "Loading core code",
    errorLoadingCore: "Error loading the core code",
    errorCoreFormat: "Error with the new core code",
    statusSavingCore: "Saving the new core code",
    statusReloadingCore: "Reloading the new core code",
    startLabel: "start",
    startPrompt: "Start the upgrade process",
    cancelLabel: "cancel",
    cancelPrompt: "Cancel the upgrade process",
    step3Title: "Upgrade cancelled",
    step3Html: "You have cancelled the upgrade process"
    });

merge(config.macros.annotations,{
    });

merge(config.commands.closeTiddler,{
    text: "close",
    tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
    text: "close others",
    tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
    text: "edit",
    tooltip: "Edit this tiddler",
    readOnlyText: "view",
    readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
    text: "done",
    tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
    text: "cancel",
    tooltip: "Undo changes to this tiddler",
    warning: "Are you sure you want to abandon your changes to '%0'?",
    readOnlyText: "done",
    readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
    text: "delete",
    tooltip: "Delete this tiddler",
    warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
    text: "permalink",
    tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
    text: "references",
    tooltip: "Show tiddlers that link to this one",
    popupNone: "No references"});

merge(config.commands.jump,{
    text: "jump",
    tooltip: "Jump to another open tiddler"});

merge(config.commands.fields,{
    text: "fields",
    tooltip: "Show the extended fields of this tiddler",
    emptyText: "There are no extended fields for this tiddler",
    listViewTemplate: {
        columns: [
            {name: 'Field', field: 'field', title: "Field", type: 'String'},
            {name: 'Value', field: 'value', title: "Value", type: 'String'}
            ],
        rowClasses: [
            ],
        buttons: [
            ]}});

merge(config.shadowTiddlers,{
    DefaultTiddlers: "[[GettingStarted]]",
    MainMenu: "[[GettingStarted]]",
    SiteTitle: "My TiddlyWiki",
    SiteSubtitle: "a reusable non-linear personal web notebook",
    SiteUrl: "",
    SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
    SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
    TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
    });

merge(config.annotations,{
    AdvancedOptions: "This shadow tiddler provides access to several advanced options",
    ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
    DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
    EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
    GettingStarted: "This shadow tiddler provides basic usage instructions",
    ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
    MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
    MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
    MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
    MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
    MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
    OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
    PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
    PluginManager: "This shadow tiddler provides access to the plugin manager",
    SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
    SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
    SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
    SiteTitle: "This shadow tiddler is used as the first part of the page title",
    SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
    StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
    StyleSheet: "This tiddler can contain custom CSS definitions",
    StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
    StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
    StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
    SystemSettings: "This tiddler is used to store configuration options for this TiddlyWiki document",
    TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
    TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
    TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
    TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
    TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
    TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
    TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
    ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
    ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
    });
//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether this file can be saved back to the same location [Preemption]
window.allowSave = window.allowSave || function(l)
{
    return true;
}

// Whether this file is being viewed locally
window.isLocal = function()
{
    return (document.location.protocol == "file:");
}

// Whether to use the JavaSaver applet
var useJavaSaver = window.isLocal() && (config.browser.isSafari || config.browser.isOpera);

// Allow preemption code a chance to tweak config and useJavaSaver [Preemption]
if (window.tweakConfig) window.tweakConfig();

if(!window || !window.console) {
    console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

// Starting up
function main()
{
    window.originalHTML=recreateOriginal();

    var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
    startingUp = true;
    var doc = jQuery(document);
    jQuery.noConflict();
    window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
    params = getParameters();
    if(params)
        params = params.parseParams("open",null,false);
    store = new TiddlyWiki({config:config});
    invokeParamifier(params,"oninit");
    story = new Story("tiddlerDisplay","tiddler");
    addEvent(document,"click",Popup.onDocumentClick);
    saveTest();
    var s;
    for(s=0; s<config.notifyTiddlers.length; s++)
        store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
    t1 = new Date();
    loadShadowTiddlers();
    doc.trigger("loadShadows");
    t2 = new Date();
    store.loadFromDiv("storeArea","store",true);
    doc.trigger("loadTiddlers");
    loadOptions();
    t3 = new Date();
    invokeParamifier(params,"onload");
    t4 = new Date();
    readOnly = window.isLocal() ? false : config.options.chkHttpReadOnly;
    var pluginProblem = loadPlugins("systemConfig");
    doc.trigger("loadPlugins");
    t5 = new Date();
    formatter = new Formatter(config.formatters);
    invokeParamifier(params,"onconfig");
    story.switchTheme(config.options.txtTheme);
    showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
    t6 = new Date();
    var m;
    for(m in config.macros) {
        if(config.macros[m].init)
            config.macros[m].init();
    }
    t7 = new Date();
    store.notifyAll();
    t8 = new Date();
    restart();
    refreshDisplay();
    t9 = new Date();
    if(pluginProblem) {
        story.displayTiddler(null,"PluginManager");
        displayMessage(config.messages.customConfigError);
    }
    if(showBackstage)
        backstage.init();
    t10 = new Date();
    if(config.options.chkDisplayInstrumentation) {
        displayMessage("LoadShadows " + (t2-t1) + " ms");
        displayMessage("LoadFromDiv " + (t3-t2) + " ms");
        displayMessage("LoadPlugins " + (t5-t4) + " ms");
        displayMessage("Macro init " + (t7-t6) + " ms");
        displayMessage("Notify " + (t8-t7) + " ms");
        displayMessage("Restart " + (t9-t8) + " ms");
        displayMessage("Total: " + (t10-t0) + " ms");
    }
    startingUp = false;
    doc.trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
    if(window.checkUnsavedChanges)
        checkUnsavedChanges();
    if(window.scrubNodes)
        scrubNodes(document.body);
}

// Restarting
function restart()
{
    invokeParamifier(params,"onstart");
    if(story.isEmpty()) {
        story.displayDefaultTiddlers();
    }
    window.scrollTo(0,0);
}

function saveTest()
{
    var s = document.getElementById("saveTest");
    if(s.hasChildNodes())
        alert(config.messages.savedSnapshotError);
    s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
    var shadows = new TiddlyWiki();
    shadows.loadFromDiv("shadowArea","shadows",true);
    shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
}

function loadPlugins(tag)
{
    if(safeMode)
        return false;
    var tiddlers = store.getTaggedTiddlers(tag);
    tiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : 1);});
    var toLoad = [];
    var nLoaded = 0;
    var map = {};
    var nPlugins = tiddlers.length;
    installedPlugins = [];
    var i;
    for(i=0; i<nPlugins; i++) {
        var p = getPluginInfo(tiddlers[i]);
        installedPlugins[i] = p;
        var n = p.Name || p.title;
        if(n)
            map[n] = p;
        n = p.Source;
        if(n)
            map[n] = p;
    }
    var visit = function(p) {
        if(!p || p.done)
            return;
        p.done = 1;
        var reqs = p.Requires;
        if(reqs) {
            reqs = reqs.readBracketedList();
            var i;
            for(i=0; i<reqs.length; i++)
                visit(map[reqs[i]]);
        }
        toLoad.push(p);
    };
    for(i=0; i<nPlugins; i++)
        visit(installedPlugins[i]);
    for(i=0; i<toLoad.length; i++) {
        p = toLoad[i];
        pluginInfo = p;
        tiddler = p.tiddler;
        if(isPluginExecutable(p)) {
            if(isPluginEnabled(p)) {
                p.executed = true;
                var startTime = new Date();
                try {
                    if(tiddler.text)
                        window.eval(tiddler.text);
                    nLoaded++;
                } catch(ex) {
                    p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
                    p.error = true;
                    if(!console.tiddlywiki) {
                        console.log("error evaluating " + tiddler.title, ex);
                    }
                }
                pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
            } else {
                nPlugins--;
            }
        } else {
            p.warning = true;
        }
    }
    return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
    var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
    p.tiddler = tiddler;
    p.title = tiddler.title;
    p.log = [];
    return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
    if(plugin.tiddler.isTagged("systemConfigForce")) {
        plugin.log.push(config.messages.pluginForced);
        return true;
    }
    if(plugin["CoreVersion"]) {
        var coreVersion = plugin["CoreVersion"].split(".");
        var w = parseInt(coreVersion[0],10) - version.major;
        if(w == 0 && coreVersion[1])
            w = parseInt(coreVersion[1],10) - version.minor;
        if(w == 0 && coreVersion[2])
            w = parseInt(coreVersion[2],10) - version.revision;
        if(w > 0) {
            plugin.log.push(config.messages.pluginVersionError);
            return false;
        }
    }
    return true;
}

function isPluginEnabled(plugin)
{
    if(plugin.tiddler.isTagged("systemConfigDisable")) {
        plugin.log.push(config.messages.pluginDisabled);
        return false;
    }
    return true;
}

//--
//-- Paramifiers
//--

function getParameters()
{
    var p = null;
    if(window.location.hash) {
        p = decodeURIComponent(window.location.hash.substr(1));
        if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
            p = convertUTF8ToUnicode(p);
    }
    return p;
}

function invokeParamifier(params,handler)
{
    if(!params || params.length == undefined || params.length <= 1)
        return;
    var i;
    for(i=1; i<params.length; i++) {
        var p = config.paramifiers[params[i].name];
        if(p && p[handler] instanceof Function)
            p[handler](params[i].value);
        else {
            var h = config.optionHandlers[params[i].name.substr(0,3)];
            if(h && h.set instanceof Function)
                h.set(params[i].name,params[i].value);
        }
    }
}

config.paramifiers = {};

config.paramifiers.start = {
    oninit: function(v) {
        safeMode = v.toLowerCase() == "safe";
    }
};

config.paramifiers.open = {
    onstart: function(v) {
        if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
            story.displayTiddler("bottom",v,null,false,null);
    }
};

config.paramifiers.story = {
    onstart: function(v) {
        var list = store.getTiddlerText(v,"").parseParams("open",null,false);
        invokeParamifier(list,"onstart");
    }
};

config.paramifiers.search = {
    onstart: function(v) {
        story.search(v,false,false);
    }
};

config.paramifiers.searchRegExp = {
    onstart: function(v) {
        story.prototype.search(v,false,true);
    }
};

config.paramifiers.tag = {
    onstart: function(v) {
        story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
    }
};

config.paramifiers.newTiddler = {
    onstart: function(v) {
        var args = v.parseParams("anon", null, null)[0];
        var title = args.title ? args.title[0] : v;
        var customFields = args.fields ? args.fields[0] : null;
        if(!readOnly) {
            story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,customFields);
            story.focusTiddler(title,"text");
            var i,tags = args.tag || [];
            for(i=0;i<tags.length;i++) {
                story.setTiddlerTag(title,tags[i],+1);
            }
        }
    }
};

config.paramifiers.newJournal = {
    onstart: function(v) {
        if(!readOnly) {
            var now = new Date();
            var title = now.formatString(v.trim());
            story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
            story.focusTiddler(title,"text");
        }
    }
};

config.paramifiers.readOnly = {
    onconfig: function(v) {
        var p = v.toLowerCase();
        readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
    }
};

config.paramifiers.theme = {
    onconfig: function(v) {
        story.switchTheme(v);
    }
};

config.paramifiers.upgrade = {
    onstart: function(v) {
        upgradeFrom(v);
    }
};

config.paramifiers.recent= {
    onstart: function(v) {
        var titles=[];
        var i,tiddlers=store.getTiddlers("modified","excludeLists").reverse();
        for(i=0; i<v && i<tiddlers.length; i++)
            titles.push(tiddlers[i].title);
        story.displayTiddlers(null,titles);
    }
};

config.paramifiers.filter = {
    onstart: function(v) {
        story.displayTiddlers(null,store.filterTiddlers(v),null,false);
    }
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
    var n;
    this.formatters = [];
    var pattern = [];
    for(n=0; n<formatters.length; n++) {
        pattern.push("(" + formatters[n].match + ")");
        this.formatters.push(formatters[n]);
    }
    this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

    createElementAndWikify: function(w)
    {
        w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
    },

    inlineCssHelper: function(w)
    {
        var styles = [];
        config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
        var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
        while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
            var s,v;
            if(lookaheadMatch[1]) {
                s = lookaheadMatch[1].unDash();
                v = lookaheadMatch[2];
            } else {
                s = lookaheadMatch[3].unDash();
                v = lookaheadMatch[4];
            }
            if(s=="bgcolor")
                s = "backgroundColor";
            if(s=="float")
                s = "cssFloat";
            styles.push({style: s, value: v});
            w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
            config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
            lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
        }
        return styles;
    },

    applyCssHelper: function(e,styles)
    {
        var t;
        for(t=0; t< styles.length; t++) {
            try {
                e.style[styles[t].style] = styles[t].value;
            } catch (ex) {
            }
        }
    },

    enclosedTextHelper: function(w)
    {
        this.lookaheadRegExp.lastIndex = w.matchStart;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
            var text = lookaheadMatch[1];
            if(config.browser.isIE && (config.browser.ieVersion[1] < 10))
                text = text.replace(/\n/g,"\r");
            createTiddlyElement(w.output,this.element,null,null,text);
            w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
        }
    },

    isExternalLink: function(link)
    {
        if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
            return false;
        }
        var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
        if(urlRegExp.exec(link)) {
            return true;
        }
        if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
            return true;
        }
        return false;
    }

};

//--
//-- Standard formatters
//--

config.formatters = [
{
    name: "table",
    match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
    lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
    rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
    cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
    cellTermRegExp: /((?:\x20*)\|)/mg,
    rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
    handler: function(w)
    {
        var table = createTiddlyElement(w.output,"table",null,"twtable");
        var prevColumns = [];
        var currRowType = null;
        var rowContainer;
        var rowCount = 0;
        var onmouseover = function() {jQuery(this).addClass("hoverRow");};
        var onmouseout = function() {jQuery(this).removeClass("hoverRow");};
        w.nextMatch = w.matchStart;
        this.lookaheadRegExp.lastIndex = w.nextMatch;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
            var nextRowType = lookaheadMatch[2];
            if(nextRowType == "k") {
                table.className = lookaheadMatch[1];
                w.nextMatch += lookaheadMatch[0].length+1;
            } else {
                if(nextRowType != currRowType) {
                    rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
                    currRowType = nextRowType;
                }
                if(currRowType == "c") {
                    // Caption
                    w.nextMatch++;
                    if(rowContainer != table.firstChild)
                        table.insertBefore(rowContainer,table.firstChild);
                    rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
                    w.subWikifyTerm(rowContainer,this.rowTermRegExp);
                } else {
                    var theRow = createTiddlyElement(rowContainer,"tr",null,rowCount%2?"oddRow":"evenRow");
                    theRow.onmouseover = onmouseover;
                    theRow.onmouseout = onmouseout;
                    this.rowHandler(w,theRow,prevColumns);
                    rowCount++;
                }
            }
            this.lookaheadRegExp.lastIndex = w.nextMatch;
            lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        }
    },
    rowHandler: function(w,e,prevColumns)
    {
        var col = 0;
        var colSpanCount = 1;
        var prevCell = null;
        this.cellRegExp.lastIndex = w.nextMatch;
        var cellMatch = this.cellRegExp.exec(w.source);
        while(cellMatch && cellMatch.index == w.nextMatch) {
            if(cellMatch[1] == "~") {
                // Rowspan
                var last = prevColumns[col];
                if(last) {
                    last.rowSpanCount++;
                    last.element.setAttribute("rowspan",last.rowSpanCount);
                    last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
                    last.element.valign = "center";
                    if(colSpanCount > 1) {
                        last.element.setAttribute("colspan",colSpanCount);
                        last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
                        colSpanCount = 1;
                    }
                }
                w.nextMatch = this.cellRegExp.lastIndex-1;
            } else if(cellMatch[1] == ">") {
                // Colspan
                colSpanCount++;
                w.nextMatch = this.cellRegExp.lastIndex-1;
            } else if(cellMatch[2]) {
                // End of row
                if(prevCell && colSpanCount > 1) {
                    prevCell.setAttribute("colspan",colSpanCount);
                    prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
                }
                w.nextMatch = this.cellRegExp.lastIndex;
                break;
            } else {
                // Cell
                w.nextMatch++;
                var styles = config.formatterHelpers.inlineCssHelper(w);
                var spaceLeft = false;
                var chr = w.source.substr(w.nextMatch,1);
                while(chr == " ") {
                    spaceLeft = true;
                    w.nextMatch++;
                    chr = w.source.substr(w.nextMatch,1);
                }
                var cell;
                if(chr == "!") {
                    cell = createTiddlyElement(e,"th");
                    w.nextMatch++;
                } else {
                    cell = createTiddlyElement(e,"td");
                }
                prevCell = cell;
                prevColumns[col] = {rowSpanCount:1,element:cell};
                if(colSpanCount > 1) {
                    cell.setAttribute("colspan",colSpanCount);
                    cell.setAttribute("colSpan",colSpanCount); // Needed for IE
                    colSpanCount = 1;
                }
                config.formatterHelpers.applyCssHelper(cell,styles);
                w.subWikifyTerm(cell,this.cellTermRegExp);
                if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
                    cell.align = spaceLeft ? "center" : "left";
                else if(spaceLeft)
                    cell.align = "right";
                w.nextMatch--;
            }
            col++;
            this.cellRegExp.lastIndex = w.nextMatch;
            cellMatch = this.cellRegExp.exec(w.source);
        }
    }
},

{
    name: "heading",
    match: "^!{1,6}",
    termRegExp: /(\n)/mg,
    handler: function(w)
    {
        w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
    }
},

{
    name: "list",
    match: "^(?:[\\*#;:]+)",
    lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
    termRegExp: /(\n)/mg,
    handler: function(w)
    {
        var stack = [w.output];
        var currLevel = 0, currType = null;
        var listLevel, listType, itemType, baseType;
        w.nextMatch = w.matchStart;
        this.lookaheadRegExp.lastIndex = w.nextMatch;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
            if(lookaheadMatch[1]) {
                listType = "ul";
                itemType = "li";
            } else if(lookaheadMatch[2]) {
                listType = "ol";
                itemType = "li";
            } else if(lookaheadMatch[3]) {
                listType = "dl";
                itemType = "dt";
            } else if(lookaheadMatch[4]) {
                listType = "dl";
                itemType = "dd";
            }
            if(!baseType)
                baseType = listType;
            listLevel = lookaheadMatch[0].length;
            w.nextMatch += lookaheadMatch[0].length;
            var t;
            if(listLevel > currLevel) {
                for(t=currLevel; t<listLevel; t++) {
                    var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
                    stack.push(createTiddlyElement(target,listType));
                }
            } else if(listType!=baseType && listLevel==1) {
                w.nextMatch -= lookaheadMatch[0].length;
                return;
            } else if(listLevel < currLevel) {
                for(t=currLevel; t>listLevel; t--)
                    stack.pop();
            } else if(listLevel == currLevel && listType != currType) {
                stack.pop();
                stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
            }
            currLevel = listLevel;
            currType = listType;
            var e = createTiddlyElement(stack[stack.length-1],itemType);
            w.subWikifyTerm(e,this.termRegExp);
            this.lookaheadRegExp.lastIndex = w.nextMatch;
            lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        }
    }
},

{
    name: "quoteByBlock",
    match: "^<<<\\n",
    termRegExp: /(^<<<(\n|$))/mg,
    element: "blockquote",
    handler: config.formatterHelpers.createElementAndWikify
},

{
    name: "quoteByLine",
    match: "^>+",
    lookaheadRegExp: /^>+/mg,
    termRegExp: /(\n)/mg,
    element: "blockquote",
    handler: function(w)
    {
        var stack = [w.output];
        var currLevel = 0;
        var newLevel = w.matchLength;
        var t,matched;
        do {
            if(newLevel > currLevel) {
                for(t=currLevel; t<newLevel; t++)
                    stack.push(createTiddlyElement(stack[stack.length-1],this.element));
            } else if(newLevel < currLevel) {
                for(t=currLevel; t>newLevel; t--)
                    stack.pop();
            }
            currLevel = newLevel;
            w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
            createTiddlyElement(stack[stack.length-1],"br");
            this.lookaheadRegExp.lastIndex = w.nextMatch;
            var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
            matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
            if(matched) {
                newLevel = lookaheadMatch[0].length;
                w.nextMatch += lookaheadMatch[0].length;
            }
        } while(matched);
    }
},

{
    name: "rule",
    match: "^----+$\\n?|<hr ?/?>\\n?",
    handler: function(w)
    {
        createTiddlyElement(w.output,"hr");
    }
},

{
    name: "monospacedByLine",
    match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
    element: "pre",
    handler: function(w)
    {
        switch(w.matchText) {
        case "/*{{{*/\n": // CSS
            this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
            break;
        case "{{{\n": // monospaced block
            this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
            break;
        case "//{{{\n": // plugin
            this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
            break;
        case "<!--{{{-->\n": //template
            this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
            break;
        default:
            break;
        }
        config.formatterHelpers.enclosedTextHelper.call(this,w);
    }
},

{
    name: "wikifyComment",
    match: "^(?:/\\*\\*\\*|<!---)\\n",
    handler: function(w)
    {
        var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
        w.subWikifyTerm(w.output,termRegExp);
    }
},

{
    name: "macro",
    match: "<<",
    lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
    handler: function(w)
    {
        this.lookaheadRegExp.lastIndex = w.matchStart;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
            w.nextMatch = this.lookaheadRegExp.lastIndex;
            invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
        }
    }
},

{
    name: "prettyLink",
    match: "\\[\\[",
    lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
    handler: function(w)
    {
        this.lookaheadRegExp.lastIndex = w.matchStart;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
            var e;
            var text = lookaheadMatch[1];
            if(lookaheadMatch[3]) {
                // Pretty bracketted link
                var link = lookaheadMatch[3];
                e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
                        createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
            } else {
                // Simple bracketted link
                e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
            }
            createTiddlyText(e,text);
            w.nextMatch = this.lookaheadRegExp.lastIndex;
        }
    }
},

{
    name: "wikiLink",
    match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
    handler: function(w)
    {
        if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
            w.outputText(w.output,w.matchStart+1,w.nextMatch);
            return;
        }
        if(w.matchStart > 0) {
            var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
            preRegExp.lastIndex = w.matchStart-1;
            var preMatch = preRegExp.exec(w.source);
            if(preMatch.index == w.matchStart-1) {
                w.outputText(w.output,w.matchStart,w.nextMatch);
                return;
            }
        }
        if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
            var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
            w.outputText(link,w.matchStart,w.nextMatch);
        } else {
            w.outputText(w.output,w.matchStart,w.nextMatch);
        }
    }
},

{
    name: "urlLink",
    match: config.textPrimitives.urlPattern,
    handler: function(w)
    {
        w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
    }
},

{
    name: "image",
    match: "\\[[<>]?[Ii][Mm][Gg]\\[",
    lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
    handler: function(w)
    {
        this.lookaheadRegExp.lastIndex = w.matchStart;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
            var e = w.output;
            if(lookaheadMatch[5]) {
                var link = lookaheadMatch[5];
                e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
                jQuery(e).addClass("imageLink");
            }
            var img = createTiddlyElement(e,"img");
            if(lookaheadMatch[1])
                img.align = "left";
            else if(lookaheadMatch[2])
                img.align = "right";
            if(lookaheadMatch[3]) {
                img.title = lookaheadMatch[3];
                img.setAttribute("alt",lookaheadMatch[3]);
            }
            img.src = lookaheadMatch[4];
            w.nextMatch = this.lookaheadRegExp.lastIndex;
        }
    }
},

{
    name: "html",
    match: "<[Hh][Tt][Mm][Ll]>",
    lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
    handler: function(w)
    {
        this.lookaheadRegExp.lastIndex = w.matchStart;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
            createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
            w.nextMatch = this.lookaheadRegExp.lastIndex;
        }
    }
},

{
    name: "commentByBlock",
    match: "/%",
    lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
    handler: function(w)
    {
        this.lookaheadRegExp.lastIndex = w.matchStart;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
            w.nextMatch = this.lookaheadRegExp.lastIndex;
    }
},

{
    name: "characterFormat",
    match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
    handler: function(w)
    {
        switch(w.matchText) {
        case "''":
            w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
            break;
        case "//":
            w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
            break;
        case "__":
            w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
            break;
        case "^^":
            w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
            break;
        case "~~":
            w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
            break;
        case "--":
            w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
            break;
        case "{{{":
            var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
            lookaheadRegExp.lastIndex = w.matchStart;
            var lookaheadMatch = lookaheadRegExp.exec(w.source);
            if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
                createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
                w.nextMatch = lookaheadRegExp.lastIndex;
            }
            break;
        }
    }
},

{
    name: "customFormat",
    match: "@@|\\{\\{",
    handler: function(w)
    {
        switch(w.matchText) {
        case "@@":
            var e = createTiddlyElement(w.output,"span");
            var styles = config.formatterHelpers.inlineCssHelper(w);
            if(styles.length == 0)
                e.className = "marked";
            else
                config.formatterHelpers.applyCssHelper(e,styles);
            w.subWikifyTerm(e,/(@@)/mg);
            break;
        case "{{":
            var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
            lookaheadRegExp.lastIndex = w.matchStart;
            var lookaheadMatch = lookaheadRegExp.exec(w.source);
            if(lookaheadMatch) {
                w.nextMatch = lookaheadRegExp.lastIndex;
                e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
                w.subWikifyTerm(e,/(\}\}\})/mg);
            }
            break;
        }
    }
},

{
    name: "mdash",
    match: "--",
    handler: function(w)
    {
        createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
    }
},

{
    name: "lineBreak",
    match: "\\n|<br ?/?>",
    handler: function(w)
    {
        createTiddlyElement(w.output,"br");
    }
},

{
    name: "rawText",
    match: "\"{3}|<nowiki>",
    lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
    handler: function(w)
    {
        this.lookaheadRegExp.lastIndex = w.matchStart;
        var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
        if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
            createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
            w.nextMatch = this.lookaheadRegExp.lastIndex;
        }
    }
},

{
    name: "htmlEntitiesEncoding",
    match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
    handler: function(w)
    {
        createTiddlyElement(w.output,"span").innerHTML = w.matchText;
    }
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
    if(tiddler) {
        if(!format)
            format = tiddler.fields["wikiformat"];
        var i;
        if(format) {
            for(i in config.parsers) {
                if(format == config.parsers[i].format)
                    return config.parsers[i];
            }
        } else {
            for(i in config.parsers) {
                if(tiddler.isTagged(config.parsers[i].formatTag))
                    return config.parsers[i];
            }
        }
    }
    return formatter;
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
    this.source = source;
    this.output = null;
    this.formatter = formatter;
    this.nextMatch = 0;
    this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
    this.highlightRegExp = highlightRegExp;
    this.highlightMatch = null;
    this.isStatic = false;
    if(highlightRegExp) {
        highlightRegExp.lastIndex = 0;
        this.highlightMatch = highlightRegExp.exec(source);
    }
    this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
    var e = createTiddlyElement(document.body,"div");
    e.style.display = "none";
    this.subWikify(e);
    var text = jQuery(e).text();
    jQuery(e).remove();
    return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
    try {
        if(terminator)
            this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
        else
            this.subWikifyUnterm(output);
    } catch(ex) {
        showException(ex);
    }
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
    var oldOutput = this.output;
    this.output = output;
    this.formatter.formatterRegExp.lastIndex = this.nextMatch;
    var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
    while(formatterMatch) {
        // Output any text before the match
        if(formatterMatch.index > this.nextMatch)
            this.outputText(this.output,this.nextMatch,formatterMatch.index);
        // Set the match parameters for the handler
        this.matchStart = formatterMatch.index;
        this.matchLength = formatterMatch[0].length;
        this.matchText = formatterMatch[0];
        this.nextMatch = this.formatter.formatterRegExp.lastIndex;
        var t;
        for(t=1; t<formatterMatch.length; t++) {
            if(formatterMatch[t]) {
                this.formatter.formatters[t-1].handler(this);
                this.formatter.formatterRegExp.lastIndex = this.nextMatch;
                break;
            }
        }
        formatterMatch = this.formatter.formatterRegExp.exec(this.source);
    }
    if(this.nextMatch < this.source.length) {
        this.outputText(this.output,this.nextMatch,this.source.length);
        this.nextMatch = this.source.length;
    }
    this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
    var oldOutput = this.output;
    this.output = output;
    terminatorRegExp.lastIndex = this.nextMatch;
    var terminatorMatch = terminatorRegExp.exec(this.source);
    this.formatter.formatterRegExp.lastIndex = this.nextMatch;
    var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
    while(terminatorMatch || formatterMatch) {
        if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
            if(terminatorMatch.index > this.nextMatch)
                this.outputText(this.output,this.nextMatch,terminatorMatch.index);
            this.matchText = terminatorMatch[1];
            this.matchLength = terminatorMatch[1].length;
            this.matchStart = terminatorMatch.index;
            this.nextMatch = this.matchStart + this.matchLength;
            this.output = oldOutput;
            return;
        }
        if(formatterMatch.index > this.nextMatch)
            this.outputText(this.output,this.nextMatch,formatterMatch.index);
        this.matchStart = formatterMatch.index;
        this.matchLength = formatterMatch[0].length;
        this.matchText = formatterMatch[0];
        this.nextMatch = this.formatter.formatterRegExp.lastIndex;
        var t;
        for(t=1; t<formatterMatch.length; t++) {
            if(formatterMatch[t]) {
                this.formatter.formatters[t-1].handler(this);
                this.formatter.formatterRegExp.lastIndex = this.nextMatch;
                break;
            }
        }
        terminatorRegExp.lastIndex = this.nextMatch;
        terminatorMatch = terminatorRegExp.exec(this.source);
        formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
    }
    if(this.nextMatch < this.source.length) {
        this.outputText(this.output,this.nextMatch,this.source.length);
        this.nextMatch = this.source.length;
    }
    this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
    while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
        if(this.highlightMatch.index > startPos) {
            createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
            startPos = this.highlightMatch.index;
        }
        var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
        createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
        startPos = highlightEnd;
        if(startPos >= this.highlightRegExp.lastIndex)
            this.highlightMatch = this.highlightRegExp.exec(this.source);
    }
    if(startPos < endPos) {
        createTiddlyText(place,this.source.substring(startPos,endPos));
    }
};

function wikify(source,output,highlightRegExp,tiddler)
{
    if(source) {
        var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
        var t0 = new Date();
        wikifier.subWikify(output);
        if(tiddler && config.options.chkDisplayInstrumentation)
            displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
    }
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
    var e = createTiddlyElement(document.body,"pre");
    e.style.display = "none";
    var html = "";
    if(source && source != "") {
        if(!tiddler)
            tiddler = new Tiddler("temp");
        var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
        wikifier.isStatic = true;
        wikifier.subWikify(e);
        html = e.innerHTML;
        jQuery(e).remove();
    }
    return html;
}

function wikifyPlainText(text,limit,tiddler)
{
    if(limit > 0)
        text = text.substr(0,limit);
    var wikifier = new Wikifier(text,formatter,null,tiddler);
    return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
    if(source) {
        var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
        wikifier.outputText(output,0,source.length);
    }
}

//--
//-- Macro definitions
//--

function invokeMacro(place,macro,params,wikifier,tiddler)
{
    try {
        var m = config.macros[macro];
        if(m && m.handler) {
            var tiddlerElem = story.findContainingTiddler(place);
            window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
            window.place = place;
            var allowEval = true;
            if(config.evaluateMacroParameters=="system") {
                if(!tiddler || tiddler.tags.indexOf("systemAllowEval") == -1) {
                    allowEval = false;
                }
            }
            m.handler(place,macro,m.noPreParse?null:params.readMacroParams(!allowEval),wikifier,params,tiddler);
        } else {
            createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
        }
    } catch(ex) {
        createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
    }
}

config.macros.version.handler = function(place)
{
    jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.today.handler = function(place,macroName,params)
{
    var now = new Date();
    var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
    jQuery("<span/>").text(text).appendTo(place);
};

config.macros.list.template = "<<view title link>>";
config.macros.list.handler = function(place,macroName,params,wikifier,paramString)
{
    var list = document.createElement("ul");
    jQuery(list).attr({ refresh: "macro", macroName: macroName }).data("params", paramString);
    place.appendChild(list);
    this.refresh(list);
};

config.macros.list.refresh = function(list) {
    var paramString = jQuery(list).data("params");
    var params = paramString.readMacroParams();
    var args = paramString.parseParams("anon", null, null)[0];
    var type = args.anon ? args.anon[0] : "all";
    jQuery(list).empty().addClass("list list-" + type);
    var template = args.template ? store.getTiddlerText(args.template[0]) : false;
    if(!template) {
        template = config.macros.list.template;
    }
    if(this[type].prompt)
        createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
    var results;
    if(this[type].handler)
        results = this[type].handler(params);
    var t;
    for(t = 0; t < results.length; t++) {
        var li = document.createElement("li");
        list.appendChild(li);
        var tiddler = results[t];
        if(typeof(tiddler) == 'string') { // deal with missing etc..
                tiddler = store.getTiddler(tiddler) || new Tiddler(tiddler);
        }
        wikify(template, li, null, tiddler);
    }
    if(results.length === 0 && args.emptyMessage) {
        jQuery(list).addClass("emptyList");
        jQuery("<li />").text(args.emptyMessage[0]).appendTo(list);
    }
};

config.macros.list.all.handler = function(params)
{
    return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
    return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
    return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
    return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
    return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
    var filter = params[1];
    var results = [];
    if(filter) {
        var tiddlers = store.filterTiddlers(filter);
        var t;
        for(t=0; t<tiddlers.length; t++)
            results.push(tiddlers[t].title);
    }
    return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
    var tags = store.getTags(params[0]);
    var ul = createTiddlyElement(place,"ul");
    if(tags.length == 0)
        createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
    var t;
    for(t=0; t<tags.length; t++) {
        var title = tags[t][0];
        var info = getTiddlyLinkInfo(title);
        var li = createTiddlyElement(ul,"li");
        var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
        btn.setAttribute("tag",title);
        btn.setAttribute("refresh","link");
        btn.setAttribute("tiddlyLink",title);
        if(params[1]) {
            btn.setAttribute("sortby",params[1]);
        }
    }
};

var macro = config.macros.timeline;
merge(macro, {
    handler: function(place,macroName,params, wikifier, paramString, tiddler) {
        var container = jQuery("<div />").attr("params", paramString).
            attr("macroName", macroName).appendTo(place)[0];
        macro.refresh(container);
    },
    refresh: function(container) {
        jQuery(container).attr("refresh", "macro").empty();
        var paramString = jQuery(container).attr("params");
        var args = paramString.parseParams("anon", null, null)[0];
        var params = args.anon || [];

        var field = params[0] || "modified";
        var prefix = field.charAt(0);
        var no_prefix_field = prefix === "-" || prefix === "+" ? field.substr(1, field.length) : field;
        var dateFormat = params[2] || this.dateFormat;
        var groupTemplate = macro.groupTemplate.format(no_prefix_field, dateFormat);
        groupTemplate = args.groupTemplate ? store.getTiddlerText(args.groupTemplate[0]) || groupTemplate :
            groupTemplate;

        var itemTemplate = macro.itemTemplate;
        itemTemplate = args.template ? store.getTiddlerText(args.template[0]) || itemTemplate :
            itemTemplate;

        var tiddlers = args.filter ? store.sortTiddlers(store.filterTiddlers(args.filter[0]), field) :
            store.reverseLookup("tags", "excludeLists", false, field);
        var lastGroup = "", ul;
        var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1],10)) : 0;
        var t;
        for(t=tiddlers.length-1; t>=last; t--) {
            var tiddler = tiddlers[t];
            var theGroup = wikifyPlainText(groupTemplate,0,tiddler);
            if(typeof(ul) == "undefined" || theGroup != lastGroup) {
                ul = document.createElement("ul");
                jQuery(ul).addClass("timeline");
                container.appendChild(ul);
                createTiddlyElement(ul,"li",null,"listTitle",theGroup);
                lastGroup = theGroup;
            }
            var item = createTiddlyElement(ul,"li",null,"listLink");
            wikify(itemTemplate,item,null,tiddler);
        }
    },
    groupTemplate: "<<view %0 date '%1'>>",
    itemTemplate: "<<view title link>>"
});

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    var allowEval = true;
    var stack = config.macros.tiddler.tiddlerStack;
    if(stack.length > 0 && config.evaluateMacroParameters == "system") {
        // included tiddler and "system" evaluation required, so check tiddler tagged appropriately
        var title = stack[stack.length-1];
        var pos = title.indexOf(config.textPrimitives.sectionSeparator);
        if(pos != -1) {
            title = title.substr(0,pos); // get the base tiddler title
        }
        var t = store.getTiddler(title);
        if(!t || t.tags.indexOf("systemAllowEval") == -1) {
            allowEval = false;
        }
    }
    params = paramString.parseParams("name",null,allowEval,false,true);
    var names = params[0]["name"];
    var tiddlerName = names[0];
    var className = names[1] || null;
    var args = params[0]["with"];
    var wrapper = createTiddlyElement(place,"span",null,className,null,{
        refresh: "content", tiddler: tiddlerName
    });
    if(args!==undefined)
        wrapper.setAttribute("args","[["+args.join("]] [[")+"]]");
    this.transclude(wrapper,tiddlerName,args);
};

config.macros.tiddler.transclude = function(wrapper,tiddlerName,args)
{
    var text = store.getTiddlerText(tiddlerName);
    if(!text)
        return;
    var stack = config.macros.tiddler.tiddlerStack;
    if(stack.indexOf(tiddlerName) !== -1)
        return;
    stack.push(tiddlerName);
    try {
        if(typeof args == "string")
            args = args.readBracketedList();
        var n = args ? Math.min(args.length,9) : 0;
        var i;
        for(i=0; i<n; i++) {
            var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
            text = text.replace(placeholderRE,args[i]);
        }
        config.macros.tiddler.renderText(wrapper,text,tiddlerName);
    } finally {
        stack.pop();
    }
};

config.macros.tiddler.renderText = function(place,text,tiddlerName)
{
    wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
    var btn = createTagButton(place,params[0],null,params[1],params[2]);
    if(params[3]) {
        btn.setAttribute('sortby',params[3]);
    }
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    params = paramString.parseParams("anon",null,true,false,false);
    var ul = createTiddlyElement(place,"ul");
    var title = getParam(params,"anon","");
    if(title && store.tiddlerExists(title))
        tiddler = store.getTiddler(title);
    var sep = getParam(params,"sep"," ");
    var lingo = config.views.wikified.tag;
    var label = null;
    var t;
    for(t=0; t<tiddler.tags.length; t++) {
        var tag = store.getTiddler(tiddler.tags[t]);
        if(!tag || !tag.tags.contains("excludeLists")) {
            if(!label)
                label = createTiddlyElement(ul,"li",null,"listTitle",lingo.labelTags.format([tiddler.title]));
            createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
            if(t<tiddler.tags.length-1)
                createTiddlyText(ul,sep);
        }
    }
    if(!label)
        createTiddlyElement(ul,"li",null,"listTitle",lingo.labelNoTags.format([tiddler.title]));
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    params = paramString.parseParams("anon",null,true,false,false);
    var ul = createTiddlyElement(place,"ul");
    var title = getParam(params,"anon","");
    if(title == "" && tiddler instanceof Tiddler)
        title = tiddler.title;
    var sep = getParam(params,"sep"," ");
    ul.setAttribute("title",this.tooltip.format([title]));
    var sortby = getParam(params,"sortBy",false);
    var tagged = store.getTaggedTiddlers(title,sortby);
    var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
    createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
    var t;
    for(t=0; t<tagged.length; t++) {
        createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
        if(t<tagged.length-1)
            createTiddlyText(ul,sep);
    }
};

config.macros.closeAll.handler = function(place)
{
    createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
    story.closeAllTiddlers();
    return false;
};

config.macros.permaview.handler = function(place)
{
    createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
    story.permaView();
    return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
    if(!readOnly)
        createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
    saveChanges();
    return false;
};

config.macros.slider.onClickSlider = function(ev)
{
    var n = this.nextSibling;
    var cookie = n.getAttribute("cookie");
    var isOpen = n.style.display != "none";
    if(config.options.chkAnimate && anim && typeof Slider == "function")
        anim.startAnimating(new Slider(n,!isOpen,null,"none"));
    else
        n.style.display = isOpen ? "none" : "block";
    config.options[cookie] = !isOpen;
    saveOption(cookie);
    return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
    var c = cookie || "";
    createTiddlyButton(place,title,tooltip,this.onClickSlider);
    var panel = createTiddlyElement(null,"div",null,"sliderPanel");
    panel.setAttribute("cookie",c);
    panel.style.display = config.options[c] ? "block" : "none";
    place.appendChild(panel);
    return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
    var panel = this.createSlider(place,params[0],params[2],params[3]);
    var text = store.getTiddlerText(params[1]);
    panel.setAttribute("refresh","content");
    panel.setAttribute("tiddler",params[1]);
    if(text)
        wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
    panel.style.position = "relative";
    panel.style.overflow = "hidden";
    panel.style.zIndex = "0";
    if(wikifier) {
        var styles = config.formatterHelpers.inlineCssHelper(wikifier);
        config.formatterHelpers.applyCssHelper(panel,styles);
    }
    params = paramString.parseParams("color");
    var locolors = [], hicolors = [];
    var t;
    for(t=2; t<params.length; t++) {
        var c = params[t].value;
        if(params[t].name == "snap") {
            hicolors[hicolors.length-1] = c;
        } else {
            locolors.push(c);
            hicolors.push(c);
        }
    }
    drawGradient(panel,params[1].value != "vert",locolors,hicolors);
    if(wikifier)
        wikifier.subWikify(panel,">>");
    if(document.all) {
        panel.style.height = "100%";
        panel.style.width = "100%";
    }
};

config.macros.message.handler = function(place,macroName,params)
{
    if(params[0]) {
        var names = params[0].split(".");
        var lookupMessage = function(root,nameIndex) {
                if(root[names[nameIndex]]) {
                    if(nameIndex < names.length-1)
                        return (lookupMessage(root[names[nameIndex]],nameIndex+1));
                    else
                        return root[names[nameIndex]];
                } else
                    return null;
            };
        var m = lookupMessage(config,0);
        if(m == null)
            m = lookupMessage(window,0);
        createTiddlyText(place,m.toString().format(params.splice(1)));
    }
};


config.macros.view.depth = 0;
config.macros.view.values = [];
config.macros.view.views = {
    text: function(value,place,params,wikifier,paramString,tiddler) {
        highlightify(value,place,highlightHack,tiddler);
    },
    link: function(value,place,params,wikifier,paramString,tiddler) {
        createTiddlyLink(place,value,true);
    },
    wikified: function(value,place,params,wikifier,paramString,tiddler) {
        if(config.macros.view.depth>50)
            return;
        if(config.macros.view.depth>0) {
            if (value==config.macros.view.values[config.macros.view.depth-1]) {
                return;
            }
        }
        config.macros.view.values[config.macros.view.depth] = value;
        config.macros.view.depth++;
        if(params[2])
            value=params[2].unescapeLineBreaks().format([value]);
        wikify(value,place,highlightHack,tiddler);
        config.macros.view.depth--;
        config.macros.view.values[config.macros.view.depth] = null;
    },
    date: function(value,place,params,wikifier,paramString,tiddler) {
        value = Date.convertFromYYYYMMDDHHMM(value);
        createTiddlyText(place,value.formatString(params[2] || config.views.wikified.dateFormat));
    }
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    if((tiddler instanceof Tiddler) && params[0]) {
        var value = store.getValue(tiddler,params[0]);
        if(value) {
            var type = params[1] || config.macros.view.defaultView;
            var handler = config.macros.view.views[type];
            if(handler)
                handler(value,place,params,wikifier,paramString,tiddler);
        }
    }
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    var field = params[0];
    var rows = params[1] || 0;
    var defVal = params[2] || '';
    if((tiddler instanceof Tiddler) && field) {
        story.setDirty(tiddler.title,true);
        var e,v;
        if(field != "text" && !rows) {
            e = createTiddlyElement(null,"input",null,null,null,{
                type: "text", edit: field, size: "40", autocomplete: "off"
            });
            e.value = store.getValue(tiddler,field) || defVal;
            place.appendChild(e);
        } else {
            var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
            var wrapper2 = createTiddlyElement(wrapper1,"div");
            e = createTiddlyElement(wrapper2,"textarea");
            e.value = v = store.getValue(tiddler,field) || defVal;
            rows = rows || 10;
            var lines = v.match(/\n/mg);
            var maxLines = Math.max(parseInt(config.options.txtMaxEditRows,10),5);
            if(lines != null && lines.length > rows)
                rows = lines.length + 5;
            rows = Math.min(rows,maxLines);
            e.setAttribute("rows",rows);
            e.setAttribute("edit",field);
            place.appendChild(wrapper1);
        }
        if(tiddler.isReadOnly()) {
            e.setAttribute("readOnly","readOnly");
            jQuery(e).addClass("readOnly");
        }
        return e;
    }
};

config.macros.tagChooser.onClick = function(ev)
{
    var e = ev || window.event;
    var lingo = config.views.editor.tagChooser;
    var popup = Popup.create(this);
    var tags = store.getTags(this.getAttribute("tags"));
    if(tags.length == 0)
        jQuery("<li/>").text(lingo.popupNone).appendTo(popup);
    var t;
    for(t=0; t<tags.length; t++) {
        var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
        tag.setAttribute("tag",tags[t][0]);
        tag.setAttribute("tiddler",this.getAttribute("tiddler"));
    }
    Popup.show();
    e.cancelBubble = true;
    if(e.stopPropagation) e.stopPropagation();
    return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
    var e = ev || window.event;
    if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
    var tag = this.getAttribute("tag");
    var title = this.getAttribute("tiddler");
    if(!readOnly)
        story.setTiddlerTag(title,tag,0);
    return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    if(tiddler instanceof Tiddler) {
        var lingo = config.views.editor.tagChooser;
        var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
        btn.setAttribute("tiddler",tiddler.title);
        btn.setAttribute("tags",params[0]);
    }
};

config.macros.refreshDisplay.handler = function(place)
{
    createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
    refreshAll();
    return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    var title = tiddler ? tiddler.title : null;
    var a = title ? config.annotations[title] : null;
    if(!tiddler || !title || !a)
        return;
    var text = a.format([title]);
    wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};
//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
    var tags = [];
    var t;
    for(t=1; t<params.length; t++) {
        if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
            tags.push(params[t].value);
    }
    label = getParam(params,"label",label);
    prompt = getParam(params,"prompt",prompt);
    accessKey = getParam(params,"accessKey",accessKey);
    newFocus = getParam(params,"focus",newFocus);
    var customFields = getParam(params,"fields","");
    if(!customFields && !store.isShadowTiddler(title))
        customFields = String.encodeHashMap(config.defaultCustomFields);
    var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
    btn.setAttribute("newTitle",title);
    btn.setAttribute("isJournal",isJournal ? "true" : "false");
    if(tags.length > 0)
        btn.setAttribute("params",tags.join("|"));
    btn.setAttribute("newFocus",newFocus);
    btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
    if(customFields !== "")
        btn.setAttribute("customFields",customFields);
    var text = getParam(params,"text");
    if(text !== undefined)
        btn.setAttribute("newText",text);
    return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
    var title = this.getAttribute("newTitle");
    if(this.getAttribute("isJournal") == "true") {
        title = new Date().formatString(title.trim());
    }
    var params = this.getAttribute("params");
    var tags = params ? params.split("|") : [];
    var focus = this.getAttribute("newFocus");
    var template = this.getAttribute("newTemplate");
    var customFields = this.getAttribute("customFields");
    if(!customFields && !store.isShadowTiddler(title))
        customFields = String.encodeHashMap(config.defaultCustomFields);
    story.displayTiddler(null,title,template,false,null,null);
    var tiddlerElem = story.getTiddler(title);
    if(customFields)
        story.addCustomFields(tiddlerElem,customFields);
    var text = this.getAttribute("newText");
    if(typeof text == "string" && story.getTiddlerField(title,"text"))
        story.getTiddlerField(title,"text").value = text.format([title]);
    var t;
    for(t=0;t<tags.length;t++)
        story.setTiddlerTag(title,tags[t],+1);
    story.focusTiddler(title,focus);
    return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
    if(!readOnly) {
        params = paramString.parseParams("anon",null,true,false,false);
        var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
        title = getParam(params,"title",title);
        this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
    }
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
    if(!readOnly) {
        params = paramString.parseParams("anon",null,true,false,false);
        var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
        title = getParam(params,"title",title);
        config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
    }
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    params = paramString.parseParams("anon",null,false,false,false);
    createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
    var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
    txt.value = getParam(params,"anon","");
    if(config.browser.isSafari) {
        txt.setAttribute("type","search");
        txt.setAttribute("results","5");
    } else {
        txt.setAttribute("type","text");
    }
    place.appendChild(txt);
    txt.onkeyup = this.onKeyPress;
    txt.onfocus = this.onFocus;
    txt.setAttribute("size",this.sizeTextbox);
    txt.setAttribute("accessKey",getParam(params,"accesskey",this.accessKey));
    txt.setAttribute("autocomplete","off");
    txt.setAttribute("lastSearchText","");
    txt.setAttribute("placeholder",getParam(params,"placeholder",this.placeholder));
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
    if(txt.value.length > 0) {
        story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
        txt.setAttribute("lastSearchText",txt.value);
    }
};

config.macros.search.onClick = function(e)
{
    config.macros.search.doSearch(this.nextSibling);
    return false;
};

config.macros.search.onKeyPress = function(ev)
{
    var me = config.macros.search;
    var e = ev || window.event;
    switch(e.keyCode) {
        case 9: // Tab
            return;
        case 13: // Ctrl-Enter
        case 10: // Ctrl-Enter on IE PC
            me.doSearch(this);
            break;
        case 27: // Escape
            this.value = "";
            clearMessage();
            break;
    }
    if(config.options.chkIncrementalSearch) {
        if(this.value.length > 2) {
            if(this.value != this.getAttribute("lastSearchText")) {
                if(me.timeout) {
                    clearTimeout(me.timeout);
                }
                var txt = this;
                me.timeout = setTimeout(function() {me.doSearch(txt);},500);
            }
        } else {
            if(me.timeout) {
                clearTimeout(me.timeout);
            }
        }
    }
};

config.macros.search.onFocus = function(e)
{
    this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
    var cookie = params[0];
    var numTabs = (params.length-1)/3;
    var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
    var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
    tabset.setAttribute("cookie",cookie);
    var validTab = false;
    var t;
    for(t=0; t<numTabs; t++) {
        var label = params[t*3+1];
        var prompt = params[t*3+2];
        var content = params[t*3+3];
        var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
        createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
        tab.setAttribute("tab",label);
        tab.setAttribute("content",content);
        tab.title = prompt;
        if(config.options[cookie] == label)
            validTab = true;
    }
    if(!validTab)
        config.options[cookie] = params[1];
    place.appendChild(wrapper);
    this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
    config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
    return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
    var cookie = tabset.getAttribute("cookie");
    var theTab = null;
    var nodes = tabset.childNodes;
    var t;
    for(t=0; t<nodes.length; t++) {
        if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
            theTab = nodes[t];
            theTab.className = "tab tabSelected";
        } else {
            nodes[t].className = "tab tabUnselected";
        }
    }
    if(theTab) {
        if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
            jQuery(tabset.nextSibling).remove();
        var tabContent = createTiddlyElement(null,"div",null,"tabContents");
        tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
        var contentTitle = theTab.getAttribute("content");
        wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
        if(cookie) {
            config.options[cookie] = tab;
            saveOption(cookie);
        }
    }
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
    if(typeof commandName != "string") {
        var c = null;
        var t;
        for(t in config.commands) {
            if(config.commands[t] == commandName)
                c = t;
        }
        commandName = c;
    }
    if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
        var command = config.commands[commandName];
        if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
            var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
            var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
            var cmd = command.type == "popup" ? this.onClickPopup : this.onClickCommand;
            var btn = createTiddlyButton(null,text,tooltip,cmd);
            btn.setAttribute("commandName",commandName);
            btn.setAttribute("tiddler",tiddler.title);
            jQuery(btn).addClass("command_" + commandName);
            if(className)
                jQuery(btn).addClass(className);
            place.appendChild(btn);
        }
    }
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
    var title = tiddler.title;
    var ro = tiddler.isReadOnly();
    var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
    return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
    return (tiddler.isReadOnly() && command.readOnlyText) || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
    return (tiddler.isReadOnly() && command.readOnlyTooltip) || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
    var e = ev || window.event;
    e.cancelBubble = true;
    if(e.stopPropagation) e.stopPropagation();
    var command = config.commands[this.getAttribute("commandName")];
    return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
    var e = ev || window.event;
    e.cancelBubble = true;
    if(e.stopPropagation) e.stopPropagation();
    var popup = Popup.create(this);
    var command = config.commands[this.getAttribute("commandName")];
    var title = this.getAttribute("tiddler");
    popup.setAttribute("tiddler",title);
    command.handlePopup(popup,title);
    Popup.show();
    return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
    var children = place.getElementsByTagName("a");
    var t;
    for(t=0; t<children.length; t++) {
        var c = children[t];
        if(jQuery(c).hasClass(className) && c.getAttribute && c.getAttribute("commandName")) {
            if(c.onclick instanceof Function)
                c.onclick.call(c,event);
            break;
        }
    }
};

config.macros.toolbar.onClickMore = function(ev)
{
    var e = this.nextSibling;
    e.style.display = "inline";
    this.style.display = "none";
    return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
    var e = this.parentNode;
    var m = e.previousSibling;
    e.style.display = "none";
    m.style.display = "inline";
    return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    var t;
    for(t=0; t<params.length; t++) {
        var btn;
        var c = params[t];
        switch(c) {
        case "!":
            createTiddlyText(place,this.separator);
            break;
        case "*":
            createTiddlyElement(place,"br");
            break;
        case "<":
            btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
            jQuery(btn).addClass("lessCommand");
            break;
        case ">":
            btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
            jQuery(btn).addClass("moreCommand");
            var e = createTiddlyElement(place,"span",null,"moreCommand");
            e.style.display = "none";
            place = e;
            break;
        default:
            var className = "";
            switch(c.substr(0,1)) {
            case "+":
                className = "defaultCommand";
                c = c.substr(1);
                break;
            case "-":
                className = "cancelCommand";
                c = c.substr(1);
                break;
            }
            if(config.commands[c]) {
                this.createCommand(place,c,tiddler,className);
            } else {
                this.customCommand(place,c,wikifier,tiddler);
            }
            break;
        }
    }
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)
{
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
    if(story.isDirty(title) && !readOnly) {
        if(!confirm(config.commands.cancelTiddler.warning.format([title])))
            return false;
    }
    story.setDirty(title,false);
    story.closeTiddler(title,true);
    return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
    story.closeAllTiddlers(title);
    return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
    clearMessage();
    var tiddlerElem = story.getTiddler(title);
    var fields = tiddlerElem.getAttribute("tiddlyFields");
    story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
    var e = story.getTiddlerField(title,config.options.txtEditorFocus||"text");
    if(e) {
        setCaretPosition(e,0);
    }
    return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
    var newTitle = story.saveTiddler(title,event.shiftKey);
    if(newTitle)
        story.displayTiddler(null,newTitle);
    return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
    if(story.hasChanges(title) && !readOnly) {
        if(!confirm(this.warning.format([title])))
            return false;
    }
    story.setDirty(title,false);
    story.displayTiddler(null,title);
    return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
    var deleteIt = true;
    if(config.options.chkConfirmDelete)
        deleteIt = confirm(this.warning.format([title]));
    if(deleteIt) {
        store.removeTiddler(title);
        story.closeTiddler(title,true);
        autoSaveChanges();
    }
    return false;
};

config.commands.permalink.handler = function(event,src,title)
{
    var t = encodeURIComponent(String.encodeTiddlyLink(title));
    if(window.location.hash != t)
        window.location.hash = t;
    return false;
};

config.commands.references.handlePopup = function(popup,title)
{
    var references = store.getReferringTiddlers(title);
    var c = false;
    var r;
    for(r=0; r<references.length; r++) {
        if(references[r].title != title && !references[r].isTagged("excludeLists")) {
            createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
            c = true;
        }
    }
    if(!c)
        createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
    story.forEachTiddler(function(title,element) {
        createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
        });
};

config.commands.fields.handlePopup = function(popup,title)
{
    var tiddler = store.fetchTiddler(title);
    if(!tiddler)
        return;
    var items = [];
    store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
    items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
    if(items.length > 0)
        ListView.create(popup,items,this.listViewTemplate);
    else
        createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
    this.title = title;
    this.text = "";
    this.creator = null;
    this.modifier = null;
    this.created = new Date();
    this.modified = this.created;
    this.links = [];
    this.linksUpdated = false;
    this.tags = [];
    this.fields = {};
    return this;
}

Tiddler.prototype.getLinks = function()
{
    if(this.linksUpdated==false)
        this.changed();
    return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
    var f = {};
    var i;
    for(i in this.fields) {
        if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
            f[i] = this.fields[i];
        }
    }
    return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
    var c = this.fields['changecount'];
    c = c ? parseInt(c,10) : 0;
    this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
    if(this.fields['changecount']) {
        delete this.fields['changecount'];
    }
};

Tiddler.prototype.doNotSave = function()
{
    return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
    var changecount = this.fields.changecount || 0;
    return changecount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)
{
    this.assign(title,text,modifier,modified,tags,created,fields,creator);
    this.changed();
    return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)
{
    if(title != undefined)
        this.title = title;
    if(text != undefined)
        this.text = text;
    if(modifier != undefined)
        this.modifier = modifier;
    if(modified != undefined)
        this.modified = modified;
    if(creator != undefined)
        this.creator = creator;
    if(created != undefined)
        this.created = created;
    if(fields != undefined)
        this.fields = fields;
    if(tags != undefined)
        this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
    else if(this.tags == undefined)
        this.tags = [];
    return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
    return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
    return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
    return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
    return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
    this.links = [];
    var text = this.text;
    // remove 'quoted' text before scanning tiddler source
    text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
        replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
        replace(/"""((?:.|\n)*?)"""/g,"").
        replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").
        replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").
        replace(/<script((?:.|\n)*?)<\/script\>/g,"");
    var t = this.autoLinkWikiWords() ? 0 : 1;
    var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
    tiddlerLinkRegExp.lastIndex = 0;
    var formatMatch = tiddlerLinkRegExp.exec(text);
    while(formatMatch) {
        var lastIndex = tiddlerLinkRegExp.lastIndex;
        if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
            // wikiWordLink
            if(formatMatch.index > 0) {
                var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
                preRegExp.lastIndex = formatMatch.index-1;
                var preMatch = preRegExp.exec(text);
                if(preMatch.index != formatMatch.index-1)
                    this.links.pushUnique(formatMatch[1]);
            } else {
                this.links.pushUnique(formatMatch[1]);
            }
        }
        else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
            this.links.pushUnique(formatMatch[3-t]);
        else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
            this.links.pushUnique(formatMatch[4-t]);
        tiddlerLinkRegExp.lastIndex = lastIndex;
        formatMatch = tiddlerLinkRegExp.exec(text);
    }
    this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
    var modifier = this.modifier;
    if(!modifier)
        modifier = config.messages.subtitleUnknown || "";
    var modified = this.modified;
    if(modified)
        modified = modified.toLocaleString();
    else
        modified = config.messages.subtitleUnknown || "";
    var f = config.messages.tiddlerLinkTooltip || "%0 - %1, %2";
    return f.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
    return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
    return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
    var serverType = null;
    if(this.fields['server.type'])
        serverType = this.fields['server.type'];
    if(!serverType)
        serverType = this.fields['wikiformat'];
    if(serverType && !config.adaptors[serverType])
        serverType = null;
    return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
    var serverType = this.getServerType();
    return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki instance contains TiddlerS
//--

function TiddlyWiki(params)
{
    var tiddlers = {}; // Hashmap by name of tiddlers
    if(params && params.config) {
        this.config = config;
    }
    this.tiddlersUpdated = false;
    this.namedNotifications = []; // Array of {name:,notify:} of notification functions
    this.notificationLevel = 0;
    this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
    this.clear = function() {
        tiddlers = {};
        this.setDirty(false);
    };
    this.fetchTiddler = function(title) {
        var t = tiddlers[title];
        return t instanceof Tiddler ? t : null;
    };
    this.deleteTiddler = function(title) {
        delete this.slices[title];
        delete tiddlers[title];
    };
    this.addTiddler = function(tiddler) {
        delete this.slices[tiddler.title];
        tiddlers[tiddler.title] = tiddler;
    };
    this.forEachTiddler = function(callback) {
        var t;
        for(t in tiddlers) {
            var tiddler = tiddlers[t];
            if(tiddler instanceof Tiddler)
                callback.call(this,t,tiddler);
        }
    };
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
    this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
    return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
    var t = this.fetchTiddler(title);
    return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
    return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.isAvailable = function(title) {
    if (!title)
        return false;
    var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
    if(s!=-1)
        title = title.substr(0,s);
    return this.tiddlerExists(title) || this.isShadowTiddler(title);
};

TiddlyWiki.prototype.createTiddler = function(title)
{
    var tiddler = this.fetchTiddler(title);
    if(!tiddler) {
        tiddler = new Tiddler(title);
        this.addTiddler(tiddler);
        this.setDirty(true);
    }
    return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
    var t = this.fetchTiddler(title);
    if(t != undefined)
        return t;
    else
        return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
    if(typeof config.shadowTiddlers[title] == "string")
        return config.shadowTiddlers[title];
    else
        return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
    if(!title)
        return defaultText;
    var pos = title.indexOf(config.textPrimitives.sectionSeparator);
    var section = null;
    if(pos != -1) {
        section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
        title = title.substr(0,pos);
    }
    pos = title.indexOf(config.textPrimitives.sliceSeparator);
    if(pos != -1) {
        var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
        if(slice)
            return slice;
    }
    var tiddler = this.fetchTiddler(title);
    var text = tiddler ? tiddler.text : null;
    if(!tiddler && this.isShadowTiddler(title)) {
        text = this.getShadowTiddlerText(title);
    }
    if(text) {
        if(!section)
            return text;
        var re = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)","mg");
        re.lastIndex = 0;
        var match = re.exec(text);
        if(match) {
            var t = text.substr(match.index+match[1].length);
            var re2 = /^!/mg;
            re2.lastIndex = 0;
            match = re2.exec(t); //# search for the next heading
            if(match)
                t = t.substr(0,match.index-1);//# don't include final \n
            return t;
        }
        return defaultText;
    }
    if(defaultText != undefined)
        return defaultText;
    return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
    var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
    var text = this.getTiddlerText(title,null);
    if(text == null)
        return defaultText;
    var textOut = [];
    var match,lastPos = 0;
    do {
        match = bracketRegExp.exec(text);
        if(match) {
            textOut.push(text.substr(lastPos,match.index-lastPos));
            if(match[1]) {
                if(depth <= 0)
                    textOut.push(match[1]);
                else
                    textOut.push(this.getRecursiveTiddlerText(match[1],"",depth-1));
            }
            lastPos = match.index + match[0].length;
        } else {
            textOut.push(text.substr(lastPos));
        }
    } while(match);
    return textOut.join("");
};

//TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;
TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]*)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\|\n]*)[\t\x20]*\|$)/gm;
// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
    var slices = {};
    var text = this.getTiddlerText(title,"");
    this.slicesRE.lastIndex = 0;
    var m = this.slicesRE.exec(text);
    while(m) {
        if(m[2])
            slices[m[2]] = m[3];
        else
            slices[m[5]] = m[6];
        m = this.slicesRE.exec(text);
    }
    return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
    var slices = this.slices[title];
    if(!slices) {
        slices = this.calcAllSlices(title);
        this.slices[title] = slices;
    }
    return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
    var t,r = {};
    for(t=0; t<sliceNames.length; t++) {
        var slice = this.getTiddlerSlice(title,sliceNames[t]);
        if(slice)
            r[sliceNames[t]] = slice;
    }
    return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
    this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
    this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
    if(!this.notificationLevel) {
        var t;
        for(t=0; t<this.namedNotifications.length; t++) {
            var n = this.namedNotifications[t];
            if((n.name == null && doBlanket) || (n.name == title))
                n.notify(title);
        }
    }
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
    if(!this.notificationLevel) {
        var t;
        for(t=0; t<this.namedNotifications.length; t++) {
            var n = this.namedNotifications[t];
            if(n.name)
                n.notify(n.name);
        }
    }
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
    var i;
    for(i=0; i<this.namedNotifications.length; i++) {
        if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
            return this;
    }
    this.namedNotifications.push({name: title, notify: fn});
    return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
    var tiddler = this.fetchTiddler(title);
    if(tiddler) {
        this.deleteTiddler(title);
        this.notify(title,true);
        this.setDirty(true);
    }
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
    var tiddler = this.fetchTiddler(title);
    if(tiddler) {
        tiddler.clearChangeCount();
        this.notify(title,true);
        this.setDirty(true);
    }
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
    var tiddler = this.fetchTiddler(title);
    if(tiddler) {
        var t = tiddler.tags.indexOf(tag);
        if(t != -1)
            tiddler.tags.splice(t,1);
        if(status)
            tiddler.tags.push(tag);
        tiddler.changed();
        tiddler.incChangeCount();
        this.notify(title,true);
        this.setDirty(true);
    }
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
    var tiddler = this.fetchTiddler(title);
    if(!tiddler)
        return;
    merge(tiddler.fields,fields);
    tiddler.changed();
    tiddler.incChangeCount();
    this.notify(title,true);
    this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)
{
    var tiddler;
    if(title instanceof Tiddler) {
        tiddler = title;
        tiddler.fields = merge(merge({},tiddler.fields),config.defaultCustomFields,true);
        title = tiddler.title;
        newTitle = title;
    } else {
        tiddler = this.fetchTiddler(title);
        if(tiddler) {
            created = created || tiddler.created; // Preserve created date
            creator = creator || tiddler.creator;
            this.deleteTiddler(title);
        } else {
            created = created || modified;
            tiddler = new Tiddler();
        }
        fields = merge(merge({},fields),config.defaultCustomFields,true);
        tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);
    }
    this.addTiddler(tiddler);
    if(clearChangeCount)
        tiddler.clearChangeCount();
    else
        tiddler.incChangeCount();
    if(title != newTitle)
        this.notify(title,true);
    this.notify(newTitle,true);
    this.setDirty(true);
    return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
    var tiddler = this.fetchTiddler(title);
    if(tiddler)
        tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
    if(!this.loader)
        this.loader = new TW21Loader();
    return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
    if(!this.saver)
        this.saver = new TW21Saver();
    return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
    return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
    this.idPrefix = idPrefix;
    var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
    if(!storeElem)
        return;
    var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
    this.setDirty(false);
    if(!noUpdate) {
        var i;
        for(i = 0;i<tiddlers.length; i++)
            tiddlers[i].changed();
    }
    jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
    var posDiv = locateStoreArea(text);
    if(!posDiv)
        return null;
    var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
    // Create the iframe
    var iframe = document.createElement("iframe");
    iframe.style.display = "none";
    document.body.appendChild(iframe);
    var doc = iframe.document;
    if(iframe.contentDocument)
        doc = iframe.contentDocument; // For NS6
    else if(iframe.contentWindow)
        doc = iframe.contentWindow.document; // For IE5.5 and IE6
    // Put the content in the iframe
    doc.open();
    doc.writeln(content);
    doc.close();
    // Load the content into a TiddlyWiki() object
    var storeArea = doc.getElementById("storeArea");
    this.loadFromDiv(storeArea,"store");
    // Get rid of the iframe
    iframe.parentNode.removeChild(iframe);
    return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
    this.tiddlersUpdated = true;
    this.forEachTiddler(function(title,tiddler) {
        tiddler.changed();
    });
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
    var candidates = this.reverseLookup("tags",excludeTag,!!match);
    var t,results = [];
    for(t=0; t<candidates.length; t++) {
        if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
            results.push(candidates[t]);
    }
    if(!sortField)
        sortField = "title";
    results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
    return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
    var results = [];
    this.forEachTiddler(function(title,tiddler) {
        var g,c;
        for(g=0; g<tiddler.tags.length; g++) {
            var tag = tiddler.tags[g];
            var n = true;
            for(c=0; c<results.length; c++) {
                if(results[c][0] == tag) {
                    n = false;
                    results[c][1]++;
                }
            }
            if(n && excludeTag) {
                var t = this.fetchTiddler(tag);
                if(t && t.isTagged(excludeTag))
                    n = false;
            }
            if(n)
                results.push([tag,1]);
        }
    });
    results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
    return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
    return this.reverseLookup("tags",tag,true,sortField);
};

TiddlyWiki.prototype.getValueTiddlers = function(field,value,sortField)
{
    return this.reverseLookup(field,value,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
    if(!this.tiddlersUpdated)
        this.updateTiddlers();
    return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
    var results = [];
    this.forEachTiddler(function(title,tiddler) {
        var f = !lookupMatch;
        var values;
        if(["links", "tags"].contains(lookupField)) {
            values = tiddler[lookupField];
        } else {
            var accessor = TiddlyWiki.standardFieldAccess[lookupField];
            if(accessor) {
                values = [ accessor.get(tiddler) ];
            } else {
                values = tiddler.fields[lookupField] ? [tiddler.fields[lookupField]] : [];
            }
        }
        var lookup;
        for(lookup=0; lookup<values.length; lookup++) {
            if(values[lookup] == lookupValue)
                f = lookupMatch;
        }
        if(f)
            results.push(tiddler);
    });
    if(!sortField)
        sortField = "title";
    return this.sortTiddlers(results,sortField);
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
    var results = [];
    this.forEachTiddler(function(title,tiddler) {
        if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
            results.push(tiddler);
    });
    if(field)
        results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
    return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function()
{
    if(!this.tiddlersUpdated)
        this.updateTiddlers();
    var results = [];
    this.forEachTiddler(function (title,tiddler) {
        if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
            return;
        var n;
        for(n=0; n<tiddler.links.length;n++) {
            var link = tiddler.links[n];
            if(this.getTiddlerText(link,null) == null && !this.isShadowTiddler(link) && !config.macros[link])
                results.pushUnique(link);
        }
    });
    results.sort();
    return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
    var results = [];
    this.forEachTiddler(function (title,tiddler) {
        if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
            results.push(title);
    });
    results.sort();
    return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
    var t,results = [];
    for(t in config.shadowTiddlers) {
        if(this.isShadowTiddler(t))
            results.push(t);
    }
    results.sort();
    return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
    var results = [];
    this.forEachTiddler(function(title,tiddler) {
        if(tiddler.isTouched())
            results.push(tiddler);
        });
    results.sort();
    return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
    var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
    return t instanceof Tiddler ? t : null;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
    var asc = +1;
    switch(field.substr(0,1)) {
    case "-":
        asc = -1;
        field = field.substr(1);
        break;
    case "+":
        field = field.substr(1);
        break;
    }
    if(TiddlyWiki.standardFieldAccess[field]) {
        if(field=="title") {
            tiddlers.sort(function(a,b) {return a[field].toLowerCase() < b[field].toLowerCase() ? -asc : (a[field].toLowerCase() == b[field].toLowerCase() ? 0 : asc);});
        } else {
            tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
        }
    } else {
        tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
    }
    return tiddlers;
};

//--
//-- Filter a list of tiddlers
//--

config.filters = {
    tiddler: function(results,match) {
        var title = match[1]||match[4];
        var tiddler = this.fetchTiddler(title);
        if(tiddler) {
            results.pushUnique(tiddler);
        } else if(this.isShadowTiddler(title)) {
            tiddler = new Tiddler();
            tiddler.set(title,this.getTiddlerText(title));
            results.pushUnique(tiddler);
        } else {
            results.pushUnique(new Tiddler(title));
        }
        return results;
    },
    tag: function(results,match) {
        var m,matched = this.getTaggedTiddlers(match[3]);
        for(m=0; m<matched.length; m++) {
            results.pushUnique(matched[m]);
        }
        return results;
    },
    sort: function(results,match) {
        return this.sortTiddlers(results,match[3]);
    },
    limit: function(results,match) {
        return results.slice(0,parseInt(match[3],10));
    },
    field: function(results,match) {
        var m,matched = this.getValueTiddlers(match[2],match[3]);
        for (m = 0; m < matched.length; m++) {
            results.pushUnique(matched[m]);
        }
        return results;
    }
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
    var re = /([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;

    var results = [];
    if(filter) {
        var match = re.exec(filter);
        while(match) {
            var handler = (match[1]||match[4])?'tiddler':config.filters[match[2]]?match[2]:'field';
            results = config.filters[handler].call(this,results,match);
            match = re.exec(filter);
        }
    }
    return results;
};
// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
    var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
    return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
    if(!TiddlyWiki.isValidFieldName(name))
        throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
    this.set = readOnly ?
            function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
            function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
    this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
    this.set = function(t,v) {
        var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
        if(d != t[n]) {
            t[n] = d; return true;
        }
    };
    this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
    this.set = function(t,v) {
        var s = (typeof v == "string") ? v.readBracketedList() : v;
        if(s.toString() != t[n].toString()) {
            t[n] = s; return true;
        }
    };
    this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
    // The set functions return true when setting the data has changed the value.
    "title":    new StringFieldAccess("title",true),
    // Handle the "tiddler" field name as the title
    "tiddler":  new StringFieldAccess("title",true),
    "text":     new StringFieldAccess("text"),
    "modifier": new StringFieldAccess("modifier"),
    "modified": new DateFieldAccess("modified"),
    "creator":  new StringFieldAccess("creator"),
    "created":  new DateFieldAccess("created"),
    "tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
    return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
    TiddlyWiki.checkFieldName(fieldName);
    var t = this.resolveTiddler(tiddler);
    if(!t)
        return;
    fieldName = fieldName.toLowerCase();
    var isRemove = (value === undefined) || (value === null);
    var accessor = TiddlyWiki.standardFieldAccess[fieldName];
    if(accessor) {
        if(isRemove)
            // don't remove StandardFields
            return;
        var h = TiddlyWiki.standardFieldAccess[fieldName];
        if(!h.set(t,value))
            return;
    } else {
        var oldValue = t.fields[fieldName];
        if(isRemove) {
            if(oldValue !== undefined) {
                // deletes a single field
                delete t.fields[fieldName];
            } else {
                // no concrete value is defined for the fieldName
                // so we guess this is a namespace path.
                // delete all fields in a namespace
                var re = new RegExp("^"+fieldName+"\\.");
                var dirty = false;
                var n;
                for(n in t.fields) {
                    if(n.match(re)) {
                        delete t.fields[n];
                        dirty = true;
                    }
                }
                if(!dirty)
                    return;
            }
        } else {
            // the "normal" set case. value is defined (not null/undefined)
            // For convenience provide a nicer conversion Date->String
            value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
            if(oldValue == value)
                return;
            t.fields[fieldName] = value;
        }
    }
    // When we are here the tiddler/store really was changed.
    this.notify(t.title,true);
    if(!fieldName.match(/^temp\./))
        this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
    var t = this.resolveTiddler(tiddler);
    if(!t)
        return undefined;
    if(fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 || fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0) {
        var sliceType = fieldName.substr(0, 2);
        var sliceName = fieldName.substring(2);
        return store.getTiddlerText("%0%1%2".format(t.title,sliceType,sliceName));
    } else {
        fieldName = fieldName.toLowerCase();
        var accessor = TiddlyWiki.standardFieldAccess[fieldName];
        if(accessor) {
            return accessor.get(t);
        }
    }
    return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
    var t = this.resolveTiddler(tiddler);
    if(!t)
        return undefined;
    var n,result;
    for(n in t.fields) {
        result = callback(t,n,t.fields[n]);
        if(result)
            return result;
        }
    if(onlyExtendedFields)
        return undefined;
    for(n in TiddlyWiki.standardFieldAccess) {
        if(n != "tiddler") {
            // even though the "title" field can also be referenced through the name "tiddler"
            // we only visit this field once.
            result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
            if(result)
                return result;
        }
    }
    return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
    this.container = containerId;
    this.idPrefix = idPrefix;
    this.highlightRegExp = null;
    this.tiddlerId = function(title) {
        title = title.replace(/_/g, "__").replace(/ /g, "_");
        var id = this.idPrefix + title;
        return id==this.container ? this.idPrefix + "_" + title : id;
    };
    this.containerId = function() {
        return this.container;
    };
}

Story.prototype.getTiddler = function(title)
{
    return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
    return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
    var place = this.getContainer();
    if(!place)
        return;
    var e = place.firstChild;
    while(e) {
        var n = e.nextSibling;
        var title = e.getAttribute("tiddler");
        if(title) {
            fn.call(this,title,e);
        }
        e = n;
    }
};

Story.prototype.displayDefaultTiddlers = function()
{
    this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
    var t;
    for(t = titles.length-1;t>=0;t--)
        this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
    var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
    var tiddlerElem = this.getTiddler(title);
    if(tiddlerElem) {
        if(toggle) {
            if(tiddlerElem.getAttribute("dirty") != "true")
                this.closeTiddler(title,true);
        } else {
            this.refreshTiddler(title,template,false,customFields);
        }
    } else {
        var place = this.getContainer();
        var before = this.positionTiddler(srcElement);
        tiddlerElem = this.createTiddler(place,before,title,template,customFields);
    }
    if(animationSrc && typeof animationSrc !== "string") {
        srcElement = animationSrc;
    }
    if(srcElement && typeof srcElement !== "string") {
        if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
            anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
        else
            window.scrollTo(0,ensureVisible(tiddlerElem));
    }
    return tiddlerElem;
};

Story.prototype.positionTiddler = function(srcElement)
{
    var place = this.getContainer();
    var before = null;
    if(typeof srcElement == "string") {
        switch(srcElement) {
        case "top":
            before = place.firstChild;
            break;
        case "bottom":
            before = null;
            break;
        }
    } else {
        var after = this.findContainingTiddler(srcElement);
        if(after == null) {
            before = place.firstChild;
        } else if(after.nextSibling) {
            before = after.nextSibling;
            if(before.nodeType != 1)
                before = null;
        }
    }
    return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
    var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
    tiddlerElem.setAttribute("refresh","tiddler");
    if(customFields)
        tiddlerElem.setAttribute("tiddlyFields",customFields);
    place.insertBefore(tiddlerElem,before);
    var defaultText = null;
    if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
        defaultText = this.loadMissingTiddler(title,customFields);
    this.refreshTiddler(title,template,false,customFields,defaultText);
    return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,callback)
{
    var getTiddlerCallback = function(context)
    {
        if(context.status) {
            var t = context.tiddler;
            if(!t.created)
                t.created = new Date();
            if(!t.modified)
                t.modified = t.created;
            var dirty = store.isDirty();
            context.tiddler = store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
            if(!window.allowSave())
                store.setDirty(dirty);
            autoSaveChanges();
        } else {
            story.refreshTiddler(context.title,null,true);
        }
        context.adaptor.close();
        if(callback) {
            callback(context);
        }
    };
    var tiddler = new Tiddler(title);
    tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
    var context = {serverType:tiddler.getServerType()};
    if(!context.serverType)
        return "";
    context.host = tiddler.fields['server.host'];
    context.workspace = tiddler.fields['server.workspace'];
    var adaptor = new config.adaptors[context.serverType]();
    adaptor.getTiddler(title,context,null,getTiddlerCallback);
    return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
    if(!template)
        template = DEFAULT_VIEW_TEMPLATE;
    if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
        template = config.tiddlerTemplates[template];
    return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
    return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
    var tiddlerElem = this.getTiddler(title);
    if(tiddlerElem) {
        if(tiddlerElem.getAttribute("dirty") == "true" && !force)
            return tiddlerElem;
        template = this.chooseTemplateForTiddler(title,template);
        var currTemplate = tiddlerElem.getAttribute("template");
        if((template != currTemplate) || force) {
            var tiddler = store.getTiddler(title);
            if(!tiddler) {
                tiddler = new Tiddler();
                if(store.isShadowTiddler(title)) {
                    var tags = [];
                    tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
                } else {
                    var text = template=="EditTemplate" ?
                                config.views.editor.defaultText.format([title]) :
                                config.views.wikified.defaultText.format([title]);
                    text = defaultText || text;
                    var fields = customFields ? customFields.decodeHashMap() : null;
                    tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
                }
            }
            tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
            tiddlerElem.setAttribute("tiddler",title);
            tiddlerElem.setAttribute("template",template);
            tiddlerElem.onmouseover = this.onTiddlerMouseOver;
            tiddlerElem.onmouseout = this.onTiddlerMouseOut;
            tiddlerElem.ondblclick = this.onTiddlerDblClick;
            tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
            tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
            applyHtmlMacros(tiddlerElem,tiddler);
            if(store.getTaggedTiddlers(title).length > 0)
                jQuery(tiddlerElem).addClass("isTag");
            else
                jQuery(tiddlerElem).removeClass("isTag");
            if(store.tiddlerExists(title)) {
                jQuery(tiddlerElem).removeClass("shadow");
                jQuery(tiddlerElem).removeClass("missing");
            } else {
                jQuery(tiddlerElem).addClass(store.isShadowTiddler(title) ? "shadow" : "missing");
            }
            if(customFields)
                this.addCustomFields(tiddlerElem,customFields);
        }
    }
    return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
    var fields = customFields.decodeHashMap();
    var w = createTiddlyElement(place,"div",null,"customFields");
    w.style.display = "none";
    var t;
    for(t in fields) {
        var e = document.createElement("input");
        e.setAttribute("type","text");
        e.setAttribute("value",fields[t]);
        w.appendChild(e);
        e.setAttribute("edit",t);
    }
};

Story.prototype.refreshAllTiddlers = function(force)
{
    var e = this.getContainer().firstChild;
    while(e) {
        var template = e.getAttribute("template");
        if(template && e.getAttribute("dirty") != "true") {
            this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
        }
        e = e.nextSibling;
    }
};

Story.prototype.onTiddlerMouseOver = function(e)
{
    jQuery(this).addClass("selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
    jQuery(this).removeClass("selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
    var e = ev || window.event;
    var target = resolveTarget(e);
    if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
        if(document.selection && document.selection.empty)
            document.selection.empty();
        config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
        e.cancelBubble = true;
        if(e.stopPropagation) e.stopPropagation();
        return true;
    }
    return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
    var e = ev || window.event;
    clearMessage();
    var consume = false;
    var title = this.getAttribute("tiddler");
    var target = resolveTarget(e);
    switch(e.keyCode) {
    case 9: // Tab
        var ed = story.getTiddlerField(title,"text");
        if(target.tagName.toLowerCase() == "input" && ed.value==config.views.editor.defaultText.format([title])) {
            // moving from input field and editor still contains default text, so select it
            ed.focus();
            ed.select();
            consume = true;
        }
        if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
            replaceSelection(target,String.fromCharCode(9));
            consume = true;
        }
        if(config.isOpera) {
            target.onblur = function() {
                this.focus();
                this.onblur = null;
            };
        }
        break;
    case 13: // Ctrl-Enter
    case 10: // Ctrl-Enter on IE PC
    case 77: // Ctrl-Enter is "M" on some platforms
        if(e.ctrlKey) {
            blurElement(this);
            config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
            consume = true;
        }
        break;
    case 27: // Escape
        blurElement(this);
        config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
        consume = true;
        break;
    }
    e.cancelBubble = consume;
    if(consume) {
        if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
        e.returnValue = true; // Cancel The Event in IE
        if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
    }
    return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
    var tiddlerElem = this.getTiddler(title);
    var e = null;
    if(tiddlerElem) {
        var t,children = tiddlerElem.getElementsByTagName("*");
        for(t=0; t<children.length; t++) {
            var c = children[t];
            if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
                if(!e)
                    e = c;
                if(c.getAttribute("edit") == field)
                    e = c;
            }
        }
    }
    return e;
};

Story.prototype.focusTiddler = function(title,field)
{
    var e = this.getTiddlerField(title,field);
    if(e) {
        e.focus();
        e.select();
    }
};

Story.prototype.blurTiddler = function(title)
{
    var tiddlerElem = this.getTiddler(title);
    if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
        tiddlerElem.focus();
        tiddlerElem.blur();
    }
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
    var c = this.getTiddlerField(title,field);
    var tags = c.value.readBracketedList();
    tags.setItem(tag,mode);
    c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
    this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
    var tiddlerElem = this.getTiddler(title);
    if(tiddlerElem) {
        clearMessage();
        this.scrubTiddler(tiddlerElem);
        if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
            anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
        else {
            jQuery(tiddlerElem).remove();
        }
    }
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
    tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
    var tiddlerElem = this.getTiddler(title);
    if(tiddlerElem)
        tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
    var tiddlerElem = this.getTiddler(title);
    if(tiddlerElem)
        return tiddlerElem.getAttribute("dirty") == "true";
    return null;
};

Story.prototype.areAnyDirty = function()
{
    var r = false;
    this.forEachTiddler(function(title,element) {
        if(this.isDirty(title))
            r = true;
    });
    return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
    clearMessage();
    this.forEachTiddler(function(title,element) {
        if((title != exclude) && element.getAttribute("dirty") != "true")
            this.closeTiddler(title);
    });
    window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
    var place = this.getContainer();
    return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
    this.closeAllTiddlers();
    highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
    var matches = store.search(highlightHack,"title","excludeSearch");
    this.displayTiddlers(null,matches);
    highlightHack = null;
    var q = useRegExp ? "/" : "'";
    if(matches.length > 0)
        displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
    else
        displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
    while(e && !jQuery(e).hasClass("tiddler")) {
        e = jQuery(e).hasClass("popup") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;
    }
    return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
    if(e && e.getAttribute) {
        var f = e.getAttribute("edit");
        if(f)
            fields[f] = e.value.replace(/\r/mg,"");
        if(e.hasChildNodes()) {
            var t,c = e.childNodes;
            for(t=0; t<c.length; t++)
                this.gatherSaveFields(c[t],fields);
        }
    }
};

Story.prototype.hasChanges = function(title)
{
    var e = this.getTiddler(title);
    if(e) {
        var fields = {};
        this.gatherSaveFields(e,fields);
        if(store.fetchTiddler(title)) {
            var n;
            for(n in fields) {
                if(store.getValue(title,n) != fields[n]) //# tiddler changed
                    return true;
            }
        } else {
            if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
                return false;
            } else { //# changed shadow or new tiddler
                return true;
            }
        }
    }
    return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
    var tiddlerElem = this.getTiddler(title);
    if(tiddlerElem) {
        var fields = {};
        this.gatherSaveFields(tiddlerElem,fields);
        var newTitle = fields.title || title;
        if(!store.tiddlerExists(newTitle)) {
            newTitle = newTitle.trim();
            var creator = config.options.txtUserName;
        }
        if(store.tiddlerExists(newTitle) && newTitle != title) {
            if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
                return null;
                title = newTitle;
        }
        if(newTitle != title)
            this.closeTiddler(newTitle,false);
        tiddlerElem.id = this.tiddlerId(newTitle);
        tiddlerElem.setAttribute("tiddler",newTitle);
        tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
        tiddlerElem.setAttribute("dirty","false");
        if(config.options.chkForceMinorUpdate)
            minorUpdate = !minorUpdate;
        if(!store.tiddlerExists(newTitle))
            minorUpdate = false;
        var newDate = new Date();
        if(store.tiddlerExists(title)) {
            var t = store.fetchTiddler(title);
            var extendedFields = t.fields;
            creator = t.creator;
        } else {
            extendedFields = merge({},config.defaultCustomFields);
        }
        var n;
        for(n in fields) {
            if(!TiddlyWiki.isStandardField(n))
                extendedFields[n] = fields[n];
        }
        var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);
        autoSaveChanges(null,[tiddler]);
        return newTitle;
    }
    return null;
};

Story.prototype.permaView = function()
{
    var links = [];
    this.forEachTiddler(function(title,element) {
        links.push(String.encodeTiddlyLink(title));
    });
    var t = encodeURIComponent(links.join(" "));
    if(t == "")
        t = "#";
    if(window.location.hash != t)
        window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
    if(safeMode)
        return;

    var getSlice = function(theme,slice) {
        var r;
        if(readOnly)
            r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
        r = r || store.getTiddlerSlice(theme,slice);
        if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
            r = theme + r;
        return store.isAvailable(r) ? r : slice;
    };

    var replaceNotification = function(i,name,theme,slice) {
        var newName = getSlice(theme,slice);
        if(name!=newName && store.namedNotifications[i].name==name) {
            store.namedNotifications[i].name = newName;
            return newName;
        }
        return name;
    };

    var pt = config.refresherData.pageTemplate;
    var vi = DEFAULT_VIEW_TEMPLATE;
    var vt = config.tiddlerTemplates[vi];
    var ei = DEFAULT_EDIT_TEMPLATE;
    var et = config.tiddlerTemplates[ei];

    var i;
    for(i=0; i<config.notifyTiddlers.length; i++) {
        var name = config.notifyTiddlers[i].name;
        switch(name) {
        case "PageTemplate":
            config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
            break;
        case "StyleSheet":
            removeStyleSheet(config.refresherData.styleSheet);
            config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
            break;
        case "ColorPalette":
            config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
            break;
        default:
            break;
        }
    }
    config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
    config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
    if(!startingUp) {
        if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
            refreshAll();
            this.refreshAllTiddlers(true);
        } else {
            setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
        }
        config.options.txtTheme = theme;
        saveOption("txtTheme");
    }
};

//--
//-- Backstage
//--
// Backstage tasks
config.tasks.save.action = saveChanges;

var backstage = {
    area: null,
    toolbar: null,
    button: null,
    showButton: null,
    hideButton: null,
    cloak: null,
    panel: null,
    panelBody: null,
    panelFooter: null,
    currTabName: null,
    currTabElem: null,
    content: null,

    init: function() {
        var cmb = config.messages.backstage;
        this.area = document.getElementById("backstageArea");
        this.toolbar = jQuery("#backstageToolbar").empty()[0];
        this.button = jQuery("#backstageButton").empty()[0];
        this.button.style.display = "block";
        var t = cmb.open.text + " " + glyph("bentArrowLeft");
        this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
                        function(e) {backstage.show(); return false;},null,"backstageShow");
        t = glyph("bentArrowRight") + " " + cmb.close.text;
        this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
                        function(e) {backstage.hide(); return false;},null,"backstageHide");
        this.cloak = document.getElementById("backstageCloak");
        this.panel = document.getElementById("backstagePanel");
        this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
        this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
        this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
        createTiddlyText(this.toolbar,cmb.prompt);
        for(t=0; t<config.backstageTasks.length; t++) {
            var taskName = config.backstageTasks[t];
            var task = config.tasks[taskName];
            var handler = task.action ? this.onClickCommand : this.onClickTab;
            var text = task.text + (task.action ? "" : glyph("downTriangle"));
            var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
            jQuery(btn).addClass(task.action ? "backstageAction" : "backstageTask");
            btn.setAttribute("task", taskName);
            }
        this.content = document.getElementById("contentWrapper");
        if(config.options.chkBackstage)
            this.show();
        else
            this.hide();
    },

    isVisible: function() {
        return this.area ? this.area.style.display == "block" : false;
    },

    show: function() {
        this.area.style.display = "block";
        if(anim && config.options.chkAnimate) {
            backstage.toolbar.style.left = findWindowWidth() + "px";
            var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
            anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
        } else {
            backstage.area.style.left = "0px";
        }
        jQuery(this.showButton).hide();
        jQuery(this.hideButton).show();
        config.options.chkBackstage = true;
        saveOption("chkBackstage");
        jQuery(this.content).addClass("backstageVisible");
    },

    hide: function() {
        if(this.currTabElem) {
            this.switchTab(null);
        } else {
            backstage.toolbar.style.left = "0px";
            if(anim && config.options.chkAnimate) {
                var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
                var c = function(element,properties) {backstage.area.style.display = "none";};
                anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
            } else {
                this.area.style.display = "none";
            }
            this.showButton.style.display = "block";
            this.hideButton.style.display = "none";
            config.options.chkBackstage = false;
            saveOption("chkBackstage");
            jQuery(this.content).removeClass("backstageVisible");
        }
    },

    onClickCommand: function(e) {
        var task = config.tasks[this.getAttribute("task")];
        if(task.action) {
            backstage.switchTab(null);
            task.action();
        }
        return false;
    },

    onClickTab: function(e) {
        backstage.switchTab(this.getAttribute("task"));
        return false;
    },

    // Switch to a given tab, or none if null is passed
    switchTab: function(tabName) {
        var tabElem = null;
        var e = this.toolbar.firstChild;
        while(e) {
            if(e.getAttribute && e.getAttribute("task") == tabName)
                tabElem = e;
            e = e.nextSibling;
        }
        if(tabName == backstage.currTabName) {
            backstage.hidePanel();
            return;
        }
        if(backstage.currTabElem) {
            jQuery(this.currTabElem).removeClass("backstageSelTab");
        }
        if(tabElem && tabName) {
            backstage.preparePanel();
            jQuery(tabElem).addClass("backstageSelTab");
            var task = config.tasks[tabName];
            wikify(task.content,backstage.panelBody,null,null);
            backstage.showPanel();
        } else if(backstage.currTabElem) {
            backstage.hidePanel();
        }
        backstage.currTabName = tabName;
        backstage.currTabElem = tabElem;
    },

    isPanelVisible: function() {
        return backstage.panel ? backstage.panel.style.display == "block" : false;
    },

    preparePanel: function() {
        backstage.cloak.style.height = findDocHeight() + "px";
        backstage.cloak.style.display = "block";
        jQuery(backstage.panelBody).empty();
        return backstage.panelBody;
    },

    showPanel: function() {
        backstage.panel.style.display = "block";
        if(anim && config.options.chkAnimate) {
            backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
            var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
            anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
        } else {
            backstage.panel.style.top = "0px";
        }
        return backstage.panelBody;
    },

    hidePanel: function() {
        if(backstage.currTabElem)
            jQuery(backstage.currTabElem).removeClass("backstageSelTab");
        backstage.currTabElem = null;
        backstage.currTabName = null;
        if(anim && config.options.chkAnimate) {
            var p = [
                {style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
                {style: "display", atEnd: "none"}
            ];
            var c = function(element,properties) {backstage.cloak.style.display = "none";};
            anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
        } else {
            jQuery([backstage.panel,backstage.cloak]).hide();
        }
    }
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
    var backstageTask = config.tasks[params[0]];
    if(backstageTask)
        createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
    if(readOnly) {
        createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
        return;
    }
    var w = new Wizard();
    w.createWizard(place,this.wizardTitle);
    this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
    var wizard = new Wizard(this);
    wizard.clear();
    config.macros.importTiddlers.restart(wizard);
    return false;
};

config.macros.importTiddlers.onClose = function(e)
{
    backstage.hidePanel();
    return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
    var me = config.macros.importTiddlers;
    wizard.addStep(this.step1Title,this.step1Html);
    var t,s = wizard.getElement("selTypes");
    for(t in config.adaptors) {
        var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel || t);
        e.value = t;
    }
    if(config.defaultAdaptor)
        s.value = config.defaultAdaptor;
    s = wizard.getElement("selFeeds");
    var feeds = this.getFeeds();
    for(t in feeds) {
        e = createTiddlyElement(s,"option",null,null,t);
        e.value = t;
    }
    wizard.setValue("feeds",feeds);
    s.onchange = me.onFeedChange;
    var fileInput = wizard.getElement("txtBrowse");
    fileInput.onchange = me.onBrowseChange;
    fileInput.onkeyup = me.onBrowseChange;
    wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);
    wizard.formElem.action = "javascript:;";
    wizard.formElem.onsubmit = function() {
        if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
            this.lastChild.firstChild.onclick();
    };
};

config.macros.importTiddlers.getFeeds = function()
{
    var feeds = {};
    var t,tagged = store.getTaggedTiddlers("systemServer","title");
    for(t=0; t<tagged.length; t++) {
        var title = tagged[t].title;
        var serverType = store.getTiddlerSlice(title,"Type");
        if(!serverType)
            serverType = "file";
        feeds[title] = {title: title,
                        url: store.getTiddlerSlice(title,"URL"),
                        workspace: store.getTiddlerSlice(title,"Workspace"),
                        workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
                        tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
                        serverType: serverType,
                        description: store.getTiddlerSlice(title,"Description")};
    }
    return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
    var wizard = new Wizard(this);
    var selTypes = wizard.getElement("selTypes");
    var fileInput = wizard.getElement("txtPath");
    var feeds = wizard.getValue("feeds");
    var f = feeds[this.value];
    if(f) {
        selTypes.value = f.serverType;
        fileInput.value = f.url;
        wizard.setValue("feedName",f.serverType);
        wizard.setValue("feedHost",f.url);
        wizard.setValue("feedWorkspace",f.workspace);
        wizard.setValue("feedWorkspaceList",f.workspaceList);
        wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
    }
    return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
    var wizard = new Wizard(this);
    var file = this.value;
    file = file.replace(/^C:\\fakepath\\/i,''); // remove fakepath (chrome/opera/safari)
    if(this.files && this.files[0]) {
        try {
            netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
            file = this.files[0].fileName; // REQUIRES PRIVILEGES.. NULL otherwise
        } catch (ex) {
            // non-priv fallback: combine filename with path to current document
            var path=getLocalPath(document.location.href);
            var slashpos=path.lastIndexOf('/'); if (slashpos==-1) slashpos=path.lastIndexOf('\\');
            if (slashpos!=-1) path=path.substr(0,slashpos+1); // remove filename, leave trailing     slash
            file=path+file;
        }
    }
    var fileInput = wizard.getElement("txtPath");
    fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(file);
    var serverType = wizard.getElement("selTypes");
    serverType.value = "file";
    return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
    if(!v || !v.length)
        return v;
    v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
    var u;
    var t = v.split(":");
    var p = t[1] || t[0]; // remove drive letter (if any)
    if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
        u = v;
    } else if(p.substr(0,1)=="/") {
        u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
    } else {
        var c = document.location.href.replace(/\\/g,"/");
        var pos = c.lastIndexOf("/");
        if(pos!=-1)
            c = c.substr(0,pos); // remove filename
        u = c + "/" + p;
    }
    return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
    var me = config.macros.importTiddlers;
    var wizard = new Wizard(this);
    var fileInput = wizard.getElement("txtPath");
    var url = fileInput.value;
    var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
    var adaptor = new config.adaptors[serverType]();
    wizard.setValue("adaptor",adaptor);
    wizard.setValue("serverType",serverType);
    wizard.setValue("host",url);
    adaptor.openHost(url,null,wizard,me.onOpenHost);
    wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);
    return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
    var me = config.macros.importTiddlers;
    var adaptor = wizard.getValue("adaptor");
    if(context.status !== true)
        displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
    adaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);
    wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
    var me = config.macros.importTiddlers;
    if(context.status !== true)
        displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
    wizard.setValue("context",context);
    var workspace = wizard.getValue("feedWorkspace");
    if(!workspace && context.workspaces.length==1)
        workspace = context.workspaces[0].title;
    if(workspace) {
        context.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
        wizard.setValue("workspace",workspace);
        wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
        return;
    }
    wizard.addStep(me.step2Title,me.step2Html);
    var t,s = wizard.getElement("selWorkspace");
    s.onchange = me.onWorkspaceChange;
    for(t=0; t<context.workspaces.length; t++) {
        var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
        e.value = context.workspaces[t].title;
    }
    var workspaceList = wizard.getValue("feedWorkspaceList");
    if(workspaceList) {
        var n,list = workspaceList.parseParams("workspace",null,false,true);
        for(n=1; n<list.length; n++) {
            if(context.workspaces.findByField("title",list[n].value) == null) {
                e = createTiddlyElement(s,"option",null,null,list[n].value);
                e.value = list[n].value;
            }
        }
    }
    if(workspace) {
        t = wizard.getElement("txtWorkspace");
        t.value = workspace;
    }
    wizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
    var wizard = new Wizard(this);
    var t = wizard.getElement("txtWorkspace");
    t.value = this.value;
    this.selectedIndex = 0;
    return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
    var me = config.macros.importTiddlers;
    var wizard = new Wizard(this);
    var adaptor = wizard.getValue("adaptor");
    var workspace = wizard.getElement("txtWorkspace").value;
    wizard.setValue("workspace",workspace);
    var context = wizard.getValue("context");
    adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
    wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
    return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
    var me = config.macros.importTiddlers;
    if(context.status !== true)
        displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
    var adaptor = wizard.getValue("adaptor");
    var browse=wizard.getElement("txtBrowse");
    if (browse.files) context.file=browse.files[0]; // for HTML5 FileReader
    adaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
    wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
    var me = config.macros.importTiddlers;
    if(context.status !== true) {
        var error = context.statusText||me.errorGettingTiddlerList;
        if(context.host.indexOf("file://") === 0) {
            error = me.errorGettingTiddlerListFile;
        } else {
            error = context.xhr && context.xhr.status == 404 ? me.errorGettingTiddlerListHttp404 :
                me.errorGettingTiddlerListHttp;
        }
        wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],"");
        jQuery("span.status", wizard.footerEl).html(error); // so error message can be html
        return;
    }
    // Extract data for the listview
    var listedTiddlers = [];
    if(context.tiddlers) {
        var n;
        for(n=0; n<context.tiddlers.length; n++) {
            var tiddler = context.tiddlers[n];
            listedTiddlers.push({
                title: tiddler.title,
                modified: tiddler.modified,
                modifier: tiddler.modifier,
                text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
                tags: tiddler.tags,
                size: tiddler.text ? tiddler.text.length : 0,
                tiddler: tiddler
            });
        }
    }
    listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
    // Display the listview
    wizard.addStep(me.step3Title,me.step3Html);
    var markList = wizard.getElement("markList");
    var listWrapper = document.createElement("div");
    markList.parentNode.insertBefore(listWrapper,markList);
    var listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);
    wizard.setValue("listView",listView);
    wizard.setValue("context",context);
    var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
    txtSaveTiddler.value = me.generateSystemServerName(wizard);
    wizard.setButtons([
            {caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},
            {caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}
        ]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
    var serverType = wizard.getValue("serverType");
    var host = wizard.getValue("host");
    var workspace = wizard.getValue("workspace");
    var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
    return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
    var me = config.macros.importTiddlers;
    var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
    if(store.tiddlerExists(txtSaveTiddler)) {
        if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
            return;
        store.suspendNotifications();
        store.removeTiddler(txtSaveTiddler);
        store.resumeNotifications();
    }
    var serverType = wizard.getValue("serverType");
    var host = wizard.getValue("host");
    var workspace = wizard.getValue("workspace");
    var text = me.serverSaveTemplate.format([serverType,host,workspace]);
    store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
    var me = config.macros.importTiddlers;
    var wizard = new Wizard(this);
    if(wizard.getElement("chkSave").checked)
        me.saveServerTiddler(wizard);
    var chkSync = wizard.getElement("chkSync").checked;
    wizard.setValue("sync",chkSync);
    var listView = wizard.getValue("listView");
    var rowNames = ListView.getSelectedRows(listView);
    var adaptor = wizard.getValue("adaptor");
    var overwrite = [];
    var t;
    for(t=0; t<rowNames.length; t++) {
        if(store.tiddlerExists(rowNames[t]))
            overwrite.push(rowNames[t]);
    }
    if(overwrite.length > 0) {
        if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
            return false;
    }
    wizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);
    for(t=0; t<rowNames.length; t++) {
        var link = document.createElement("div");
        createTiddlyLink(link,rowNames[t],true);
        var place = wizard.getElement("markReport");
        place.parentNode.insertBefore(link,place);
    }
    wizard.setValue("remainingImports",rowNames.length);
    wizard.setButtons([
            {caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}
        ],me.statusDoingImport);
    var wizardContext = wizard.getValue("context");
    var tiddlers = wizardContext ? wizardContext.tiddlers : [];
    for(t=0; t<rowNames.length; t++) {
        var context = {
            allowSynchronous:true,
            tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
        };
        adaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);
    }
    return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
    var me = config.macros.importTiddlers;
    if(!context.status)
        displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
    var tiddler = context.tiddler;
    store.suspendNotifications();
    store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
    if(!wizard.getValue("sync")) {
        store.setValue(tiddler.title,'server',null);
    }
    store.resumeNotifications();
    if(!context.isSynchronous)
        store.notify(tiddler.title,true);
    var remainingImports = wizard.getValue("remainingImports")-1;
    wizard.setValue("remainingImports",remainingImports);
    if(remainingImports == 0) {
        if(context.isSynchronous) {
            store.notifyAll();
            refreshDisplay();
        }
        wizard.setButtons([
                {caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}
            ],me.statusDoneImport);
        autoSaveChanges();
    }
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
    var w = new Wizard();
    w.createWizard(place,this.wizardTitle);
    w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
    w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
    var me = config.macros.upgrade;
    var w = new Wizard(this);
    if(!window.allowSave()) {
        alert(me.errorCantUpgrade);
        return false;
    }
    if(story.areAnyDirty() || store.isDirty()) {
        alert(me.errorNotSaved);
        return false;
    }
    var localPath = getLocalPath(document.location.toString());
    var backupPath = getBackupPath(localPath,me.backupExtension);
    w.setValue("backupPath",backupPath);
    w.setButtons([],me.statusPreparingBackup);
    var original = loadOriginal(localPath);
    w.setButtons([],me.statusSavingBackup);
    var backup = copyFile(backupPath,localPath);
    if(!backup)
        backup = saveFile(backupPath,original);
    if(!backup) {
        w.setButtons([],me.errorSavingBackup);
        alert(me.errorSavingBackup);
        return false;
    }
    w.setButtons([],me.statusLoadingCore);
    var options = {
        type:"GET",
        url:me.source,
        processData:false,
        success:function(data,textStatus,jqXHR) {
            me.onLoadCore(true,w,jqXHR.responseText,me.source,jqXHR);
        },
        error:function(jqXHR,textStatus,errorThrown) {
            me.onLoadCore(false,w,null,me.source,jqXHR);
        }
    };
    ajaxReq(options);
    return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
    var me = config.macros.upgrade;
    var w = params;
    var errMsg;
    if(!status)
        errMsg = me.errorLoadingCore;
    var newVer = me.extractVersion(responseText);
    if(!newVer)
        errMsg = me.errorCoreFormat;
    if(errMsg) {
        w.setButtons([],errMsg);
        alert(errMsg);
        return;
    }
    var onStartUpgrade = function(e) {
        w.setButtons([],me.statusSavingCore);
        var localPath = getLocalPath(document.location.toString());
        saveFile(localPath,responseText);
        w.setButtons([],me.statusReloadingCore);
        var backupPath = w.getValue("backupPath");
        var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
        window.setTimeout(function () {window.location = newLoc;},10);
    };
    var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
    w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
    w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
    var me = config.macros.upgrade;
    var w = new Wizard(this);
    w.addStep(me.step3Title,me.step3Html);
    w.setButtons([]);
    return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
    var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
    var m = re.exec(upgradeFile);
    return m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
    var importStore = new TiddlyWiki();
    var tw = loadFile(path);
    if(window.netscape !== undefined)
        tw = convertUTF8ToUnicode(tw);
    importStore.importTiddlyWiki(tw);
    importStore.forEachTiddler(function(title,tiddler) {
        if(!store.getTiddler(title)) {
            store.addTiddler(tiddler);
        }
    });
    refreshDisplay();
    saveChanges(); //# To create appropriate Markup* sections
    alert(config.messages.upgradeDone.format([formatVersion()]));
    window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
    var wizard = new Wizard();
    wizard.createWizard(place,this.wizardTitle);
    wizard.addStep(this.step1Title,this.step1Html);
    var markList = wizard.getElement("markList");
    var listWrapper = document.createElement("div");
    markList.parentNode.insertBefore(listWrapper,markList);
    listWrapper.setAttribute("refresh","macro");
    listWrapper.setAttribute("macroName","plugins");
    listWrapper.setAttribute("params",paramString);
    this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
    var me = config.macros.plugins;
    var wizard = new Wizard(listWrapper);
    var selectedRows = [];
    ListView.forEachSelector(listWrapper,function(e,rowName) {
            if(e.checked)
                selectedRows.push(e.getAttribute("rowName"));
        });
    jQuery(listWrapper).empty();
    params = params.parseParams("anon");
    var plugins = installedPlugins.slice(0);
    var t,tiddler,p;
    var configTiddlers = store.getTaggedTiddlers("systemConfig");
    for(t=0; t<configTiddlers.length; t++) {
        tiddler = configTiddlers[t];
        if(plugins.findByField("title",tiddler.title) == null) {
            p = getPluginInfo(tiddler);
            p.executed = false;
            p.log.splice(0,0,this.skippedText);
            plugins.push(p);
        }
    }
    for(t=0; t<plugins.length; t++) {
        p = plugins[t];
        p.size = p.tiddler.text ? p.tiddler.text.length : 0;
        p.forced = p.tiddler.isTagged("systemConfigForce");
        p.disabled = p.tiddler.isTagged("systemConfigDisable");
        p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
    }
    if(plugins.length == 0) {
        createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
        wizard.setButtons([]);
    } else {
        var template = readOnly ? this.listViewTemplateReadOnly : this.listViewTemplate;
        var listView = ListView.create(listWrapper,plugins,template,this.onSelectCommand);
        wizard.setValue("listView",listView);
        if(!readOnly) {
            wizard.setButtons([
                {caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},
                {caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}
            ]);
        }
    }
};

config.macros.plugins.doRemoveTag = function(e)
{
    var wizard = new Wizard(this);
    var listView = wizard.getValue("listView");
    var rowNames = ListView.getSelectedRows(listView);
    if(rowNames.length == 0) {
        alert(config.messages.nothingSelected);
    } else {
        var t;
        for(t=0; t<rowNames.length; t++) {
            store.setTiddlerTag(rowNames[t],false,"systemConfig");
        }
        autoSaveChanges();
    }
};

config.macros.plugins.doDelete = function(e)
{
    var wizard = new Wizard(this);
    var listView = wizard.getValue("listView");
    var rowNames = ListView.getSelectedRows(listView);
    if(rowNames.length == 0) {
        alert(config.messages.nothingSelected);
    } else {
        if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
            var t;
            for(t=0; t<rowNames.length; t++) {
                store.removeTiddler(rowNames[t]);
                story.closeTiddler(rowNames[t],true);
            }
        }
        autoSaveChanges();
    }
};

//--
//-- Message area
//--

function getMessageDiv()
{
    var msgArea = document.getElementById("messageArea");
    if(!msgArea)
        return null;
    if(!msgArea.hasChildNodes())
        createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
            config.messages.messageClose.text,
            config.messages.messageClose.tooltip,
            clearMessage);
    msgArea.style.display = "block";
    return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
    var e = getMessageDiv();
    if(!e) {
        alert(text);
        return;
    }
    if(linkText) {
        var link = createTiddlyElement(e,"a",null,null,text);
        link.href = linkText;
        link.target = "_blank";
    } else {
        e.appendChild(document.createTextNode(text));
    }
}

function clearMessage()
{
    var msgArea = document.getElementById("messageArea");
    if(msgArea) {
        jQuery(msgArea).empty();
        msgArea.style.display = "none";
    }
    return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
    {name: "SystemSettings", notify: onSystemSettingsChange},
    {name: "StyleSheetLayout", notify: refreshStyles},
    {name: "StyleSheetColors", notify: refreshStyles},
    {name: "StyleSheet", notify: refreshStyles},
    {name: "StyleSheetPrint", notify: refreshStyles},
    {name: "PageTemplate", notify: refreshPageTemplate},
    {name: "SiteTitle", notify: refreshPageTitle},
    {name: "SiteSubtitle", notify: refreshPageTitle},
    {name: "WindowTitle", notify: refreshPageTitle},
    {name: "ColorPalette", notify: refreshColorPalette},
    {name: null, notify: refreshDisplay}
];

config.refreshers = {
    link: function(e,changeList)
        {
        var title = e.getAttribute("tiddlyLink");
        refreshTiddlyLink(e,title);
        return true;
        },

    tiddler: function(e,changeList)
        {
        var title = e.getAttribute("tiddler");
        var template = e.getAttribute("template");
        if(changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && !story.isDirty(title))
            story.refreshTiddler(title,template,true);
        else
            refreshElements(e,changeList);
        return true;
        },

    content: function(e,changeList)
        {
        var title = e.getAttribute("tiddler");
        var force = e.getAttribute("force");
        var args = e.getAttribute("args");
        if(force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {
            jQuery(e).empty();
            config.macros.tiddler.transclude(e,title,args);
            return true;
        } else
            return false;
        },

    macro: function(e,changeList)
        {
        var macro = e.getAttribute("macroName");
        var params = e.getAttribute("params");
        if(macro)
            macro = config.macros[macro];
        if(macro && macro.refresh)
            macro.refresh(e,params);
        return true;
        }
};

config.refresherData = {
    styleSheet: "StyleSheet",
    defaultStyleSheet: "StyleSheet",
    pageTemplate: "PageTemplate",
    defaultPageTemplate: "PageTemplate",
    colorPalette: "ColorPalette",
    defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
    var c,nodes = root.childNodes;
    for(c=0; c<nodes.length; c++) {
        var e = nodes[c], type = null;
        if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
            type = e.getAttribute("refresh");
        var refresher = config.refreshers[type];
        var refreshed = false;
        if(refresher != undefined)
            refreshed = refresher(e,changeList);
        if(e.hasChildNodes() && !refreshed)
            refreshElements(e,changeList);
    }
}

function applyHtmlMacros(root,tiddler)
{
    var e = root.firstChild;
    while(e) {
        var nextChild = e.nextSibling;
        if(e.getAttribute) {
            var macro = e.getAttribute("macro");
            if(macro) {
                e.removeAttribute("macro");
                var params = "";
                var p = macro.indexOf(" ");
                if(p != -1) {
                    params = macro.substr(p+1);
                    macro = macro.substr(0,p);
                }
                invokeMacro(e,macro,params,null,tiddler);
            }
        }
        if(e.hasChildNodes())
            applyHtmlMacros(e,tiddler);
        e = nextChild;
    }
}

function refreshPageTemplate(title)
{
    var stash = jQuery("<div/>").appendTo("body").hide()[0];
    var display = story.getContainer();
    var nodes,t;
    if(display) {
        nodes = display.childNodes;
        for(t=nodes.length-1; t>=0; t--)
            stash.appendChild(nodes[t]);
    }
    var wrapper = document.getElementById("contentWrapper");

    if(!title || !store.isAvailable(title))
        title = config.refresherData.pageTemplate;
    if(!store.isAvailable(title))
        title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
    wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
    applyHtmlMacros(wrapper);
    refreshElements(wrapper);
    display = story.getContainer();
    jQuery(display).empty();
    if(!display)
        display = createTiddlyElement(wrapper,"div",story.containerId());
    nodes = stash.childNodes;
    for(t=nodes.length-1; t>=0; t--)
        display.appendChild(nodes[t]);
    jQuery(stash).remove();
}

function refreshDisplay(hint)
{
    if(typeof hint == "string")
        hint = [hint];
    var e = document.getElementById("contentWrapper");
    refreshElements(e,hint);
    if(backstage.isPanelVisible()) {
        e = document.getElementById("backstage");
        refreshElements(e,hint);
    }
}

function refreshPageTitle()
{
    document.title = getPageTitle();
}

function getPageTitle()
{
    return wikifyPlainText(store.getTiddlerText("WindowTitle",""),null,tiddler);
}

function refreshStyles(title,doc)
{
    setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
    if(!startingUp)
        refreshAll();
}

function refreshAll()
{
    refreshPageTemplate();
    refreshDisplay();
    refreshStyles("StyleSheetLayout");
    refreshStyles("StyleSheetColors");
    refreshStyles(config.refresherData.styleSheet);
    refreshStyles("StyleSheetPrint");
}

//--
//-- Option handling
//--

config.optionHandlers = {
    'txt': {
        get: function(name) {return encodeCookie(config.options[name].toString());},
        set: function(name,value) {config.options[name] = decodeCookie(value);}
    },
    'chk': {
        get: function(name) {return config.options[name] ? 'true' : 'false';},
        set: function(name,value) {config.options[name] = value == 'true';}
    }
};

function setOption(name,value)
{
    var optType = name.substr(0,3);
    if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
        config.optionHandlers[optType].set(name,value);
}

// Gets the value of an option as a string. Most code should just read from config.options.* directly
function getOption(name)
{
    var optType = name.substr(0,3);
    return config.optionHandlers[optType] && config.optionHandlers[optType].get ? config.optionHandlers[optType].get(name) : null;
}

function loadOptions()
{
    if(safeMode)
        return;
    loadCookies();
    loadSystemSettings();
}
// @Deprecated; retained for backwards compatibility
var loadOptionsCookie = loadOptions;

function getCookies()
{
    var cookieList = document.cookie.split(';');
    var i,cookies = {};
    for(i=0; i<cookieList.length; i++) {
        var p = cookieList[i].indexOf('=');
        if(p != -1) {
            var name = cookieList[i].substr(0,p).trim();
            var value = cookieList[i].substr(p+1).trim();
            cookies[name] = value;
        }
    }
    return cookies;
}

function loadCookies()
{
    var i,cookies = getCookies();
    if(cookies['TiddlyWiki']) {
        cookies = cookies['TiddlyWiki'].decodeHashMap();
    }
    for(i in cookies) {
        if(config.optionsSource[i] != 'setting') {
            setOption(i,cookies[i]);
        }
    }
}

function loadSystemSettings()
{
    var key,settings = store.calcAllSlices('SystemSettings');
    config.optionsSource = {};
    for(key in settings) {
        setOption(key,settings[key]);
        config.optionsSource[key] = 'setting';
    }
}

function onSystemSettingsChange()
{
    if(!startingUp) {
        loadSystemSettings();
    }
}

function saveOption(name)
{
    if(safeMode)
        return;
    if(name.match(/[()\s]/g, '_')) {
        alert(config.messages.invalidCookie.format([name]));
        return;
    }
    saveCookie(name);
    if(config.optionsSource[name] == 'setting') {
        saveSystemSetting(name,true);
    }
}
// @Deprecated; retained for backwards compatibility
var saveOptionCookie = saveOption;

function removeCookie(name)
{
    document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;';
}

function saveCookie(name)
{
    var key,cookies = {};
    for(key in config.options) {
        var value = getOption(key);
        value = value == null ? 'false' : value;
        cookies[key] = value;
    }
    document.cookie = 'TiddlyWiki=' + String.encodeHashMap(cookies) + '; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/';
    cookies = getCookies();
    var c;
    for(c in cookies) {
        var optType = c.substr(0,3);
        if(config.optionHandlers[optType])
            removeCookie(c);
    }
}

var systemSettingSave;
function commitSystemSettings(storeWasDirty)
{
    if(systemSettingSave) {
        window.clearTimeout(systemSettingSave);
    }
    systemSettingSave = window.setTimeout(function() {
        var tiddler = store.getTiddler('SystemSettings');
        autoSaveChanges(null,[tiddler]);
    }, 1000);
}

function saveSystemSetting(name,saveFile)
{
    var title = 'SystemSettings';
    var slice = store.getTiddlerSlice(title,name);
    if(readOnly || slice === getOption(name)) {
        return; //# don't save if read-only or the option hasn't changed
    }
    var slices = store.calcAllSlices(title);
    var key;
    for(key in config.optionsSource) {
        var value = getOption(key) || '';
        if(slices[key] !== value) {
            slices[key] = value;
        }
    }
    var text = [];
    for(key in slices) {
        text.push('%0: %1'.format([key,slices[key]]));
    }
    text = text.sort().join('\n');
    var storeWasDirty = store.isDirty();
    var tiddler = store.getTiddler(title);
    if(tiddler) {
        tiddler.text = text;
        tiddler = store.saveTiddler(tiddler);
    } else {
        tiddler = store.saveTiddler(title,title,text,'System',new Date(),['excludeLists'],config.defaultCustomFields);
    }
    if(saveFile) {
        commitSystemSettings(storeWasDirty);
    }
}

function encodeCookie(s)
{
    return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
    s = unescape(s);
    var re = /&#[0-9]{1,5};/g;
    return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,'')));});
}

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
    var typeInfo = config.macros.option.types[type];
    var c = document.createElement(typeInfo.elementType);
    if(typeInfo.typeValue)
        c.setAttribute('type',typeInfo.typeValue);
    c[typeInfo.eventName] = typeInfo.onChange;
    c.setAttribute('option',opt);
    c.className = className || typeInfo.className;
    if(config.optionsDesc[opt])
        c.setAttribute('title',config.optionsDesc[opt]);
    place.appendChild(c);
    if(desc != 'no')
        createTiddlyText(place,config.optionsDesc[opt] || opt);
    c[typeInfo.valueField] = config.options[opt];
    return c;
};

config.macros.option.genericOnChange = function(e)
{
    var opt = this.getAttribute('option');
    if(opt) {
        var optType = opt.substr(0,3);
        var handler = config.macros.option.types[optType];
        if(handler.elementType && handler.valueField)
            config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
    }
    return true;
};

config.macros.option.types = {
    'txt': {
        elementType: 'input',
        valueField: 'value',
        eventName: 'onchange',
        className: 'txtOptionInput',
        create: config.macros.option.genericCreate,
        onChange: config.macros.option.genericOnChange
    },
    'chk': {
        elementType: 'input',
        valueField: 'checked',
        eventName: 'onclick',
        className: 'chkOptionInput',
        typeValue: 'checkbox',
        create: config.macros.option.genericCreate,
        onChange: config.macros.option.genericOnChange
    }
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
    config.options[opt] = value;
    saveOption(opt);
    var t,nodes = document.getElementsByTagName(elementType);
    for(t=0; t<nodes.length; t++) {
        var optNode = nodes[t].getAttribute('option');
        if(opt == optNode && nodes[t]!=elem)
            nodes[t][valueField] = value;
    }
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
    params = paramString.parseParams('anon',null,true,false,false);
    var opt = (params[1] && params[1].name == 'anon') ? params[1].value : getParam(params,'name',null);
    var className = (params[2] && params[2].name == 'anon') ? params[2].value : getParam(params,'class',null);
    var desc = getParam(params,'desc','no');
    var type = opt.substr(0,3);
    var h = config.macros.option.types[type];
    if(h && h.create)
        h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
    params = paramString.parseParams('anon',null,true,false,false);
    var showUnknown = getParam(params,'showUnknown','no');
    var wizard = new Wizard();
    wizard.createWizard(place,this.wizardTitle);
    wizard.addStep(this.step1Title,this.step1Html);
    var markList = wizard.getElement('markList');
    var chkUnknown = wizard.getElement('chkUnknown');
    chkUnknown.checked = showUnknown == 'yes';
    chkUnknown.onchange = this.onChangeUnknown;
    var listWrapper = document.createElement('div');
    markList.parentNode.insertBefore(listWrapper,markList);
    wizard.setValue('listWrapper',listWrapper);
    this.refreshOptions(listWrapper,showUnknown == 'yes');
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
    var n,opts = [];
    for(n in config.options) {
        var opt = {};
        opt.option = '';
        opt.name = n;
        opt.lowlight = !config.optionsDesc[n];
        opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
        if(!opt.lowlight || showUnknown)
            opts.push(opt);
    }
    opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
    ListView.create(listWrapper,opts,this.listViewTemplate);
    for(n=0; n<opts.length; n++) {
        var type = opts[n].name.substr(0,3);
        var h = config.macros.option.types[type];
        if(h && h.create) {
            h.create(opts[n].colElements['option'],type,opts[n].name,null,'no');
        }
    }
};

config.macros.options.onChangeUnknown = function(e)
{
    var wizard = new Wizard(this);
    var listWrapper = wizard.getValue('listWrapper');
    jQuery(listWrapper).empty();
    config.macros.options.refreshOptions(listWrapper,this.checked);
    return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var startSaveAreaRE = /<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/; // Used for IE6
var endSaveArea = '</d' + 'iv>';
var endSaveAreaCaps = '</D' + 'IV>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
    hadConfirmExit = true;
    if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
        return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
    if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
        if(confirm(config.messages.unsavedChangesWarning))
            saveChanges();
    }
}

function updateLanguageAttribute(s)
{
    if(config.locale) {
        var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
        var m = mRE.exec(s);
        if(m) {
            var t = m[1];
            if(m[2])
                t += ' xml:lang="' + config.locale + '"';
            if(m[3])
                t += ' lang="' + config.locale + '"';
            t += ">";
            s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
        }
    }
    return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
    return s.replaceChunk(
            "<!--%0-START-->".format([blockName]),
            "<!--%0-END-->".format([blockName]),
            "\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
    if(!posDiv)
        posDiv = locateStoreArea(original);
    if(!posDiv) {
        alert(config.messages.invalidFileError.format([localPath]));
        return null;
    }
    var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
                convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
                original.substr(posDiv[1]);
    var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
    revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
    revised = updateLanguageAttribute(revised);
    revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
    revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
    revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
    revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
    return revised;
}

function locateStoreArea(original)
{
    // Locate the storeArea divs
    if(!original)
        return null;
    var posOpeningDiv = original.search(startSaveAreaRE);
    var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
    if(limitClosingDiv == -1)
        limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
    var start = limitClosingDiv == -1 ? original.length : limitClosingDiv;
    var posClosingDiv = original.lastIndexOf(endSaveArea,start);
    if(posClosingDiv == -1)
        posClosingDiv = original.lastIndexOf(endSaveAreaCaps,start);
    return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
    if(config.options.chkAutoSave)
        saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
    var content=loadFile(localPath);
    if (!content) content=window.originalHTML||recreateOriginal();
    return content;
}

function recreateOriginal()
{
    // construct doctype
    var content = "<!DOCTYPE ";
    var t=document.doctype;
    if (!t)
        content+="html"
    else {
        content+=t.name;
        if      (t.publicId)        content+=' PUBLIC "'+t.publicId+'"';
        else if (t.systemId)        content+=' SYSTEM "'+t.systemId+'"';
    }
    content+=' "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"';
    content+='>\n';

    // append current document content
    content+=document.documentElement.outerHTML;

    content=content.replace(/<div id="saveTest">savetest<\/div>/,'<div id="saveTest"></div>');
    content=content.replace(/script><applet [^\>]*><\/applet>/g,'script>');
    content=content.replace(/><head>/,'>\n<head>');
    content=content.replace(/\n\n<\/body><\/html>$/,'</body>\n</html>\n');
    content=content.replace(/(<(meta) [^\>]*[^\/])>/g,'$1 />');
    content=content.replace(/<noscript>[^\<]*<\/noscript>/,
        function(m){return m.replace(/&lt;/g,'<').replace(/&gt;/g,'>');});
    content=content.replace(/<div id="copyright">[^\<]*<\/div>/,
        function(m){return m.replace(/\xA9/g,'&copy;');});

    return content;
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
    if(onlyIfDirty && !store.isDirty())
        return;
    clearMessage();
    var t0 = new Date();
    var msg = config.messages;
    var originalPath = document.location.toString();
    if(!window.allowSave()) {
        alert(msg.notFileUrlError);
        if(store.tiddlerExists(msg.saveInstructions))
            story.displayTiddler(null,msg.saveInstructions);
        return;
    }
    var localPath = getLocalPath(originalPath);
    var original = loadOriginal(localPath);
    if(original == null) {
        alert(msg.cantSaveError);
        if(store.tiddlerExists(msg.saveInstructions))
            story.displayTiddler(null,msg.saveInstructions);
        return;
    }
    var posDiv = locateStoreArea(original);
    if(!posDiv) {
        alert(msg.invalidFileError.format([localPath]));
        return;
    }
    var co=config.options; //# abbreviation
    config.saveByDownload=false;
    config.saveByManualDownload=false;
    saveMain(localPath,original,posDiv);
    if (!config.saveByDownload && !config.saveByManualDownload) {
        if(co.chkSaveBackups)
            saveBackup(localPath,original);
        if(co.chkSaveEmptyTemplate)
            saveEmpty(localPath,original,posDiv);
        if(co.chkGenerateAnRssFeed && saveRss instanceof Function)
            saveRss(localPath);
    }
    if(co.chkDisplayInstrumentation)
        displayMessage("saveChanges " + (new Date()-t0) + " ms");
}


function saveMain(localPath,original,posDiv)
{
    var save;
    try {
        var revised = updateOriginal(original,posDiv,localPath);
        save = saveFile(localPath,revised);
    } catch (ex) {
        showException(ex);
    }
    if(save) {
        if (!config.saveByManualDownload) {
            if (config.saveByDownload) { //# set by HTML5DownloadSaveFile()
                var link = getDataURI(revised);
                var msg  = config.messages.mainDownload;
            } else {
                var link = "file://" + localPath;
                var msg  = config.messages.mainSaved;
            }
            displayMessage(msg,link);
        }
        store.setDirty(false);
    } else {
        alert(config.messages.mainFailed);
    }
}

function saveBackup(localPath,original)
{
    var backupPath = getBackupPath(localPath);
    var backup = copyFile(backupPath,localPath);
    if(!backup)
        backup = saveFile(backupPath,original);
    if(backup)
        displayMessage(config.messages.backupSaved,"file://" + backupPath);
    else
        alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
    var emptyPath,p;
    if((p = localPath.lastIndexOf("/")) != -1)
        emptyPath = localPath.substr(0,p) + "/";
    else if((p = localPath.lastIndexOf("\\")) != -1)
        emptyPath = localPath.substr(0,p) + "\\";
    else
        emptyPath = localPath + ".";
    emptyPath += "empty.html";
    var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
    var emptySave = saveFile(emptyPath,empty);
    if(emptySave)
        displayMessage(config.messages.emptySaved,"file://" + emptyPath);
    else
        alert(config.messages.emptyFailed);
}

// Translate URL to local path [Preemption]
window.getLocalPath = window.getLocalPath || function(origPath)
{
    var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
    // Remove any location or query part of the URL
    var argPos = originalPath.indexOf("?");
    if(argPos != -1)
        originalPath = originalPath.substr(0,argPos);
    var hashPos = originalPath.indexOf("#");
    if(hashPos != -1)
        originalPath = originalPath.substr(0,hashPos);
    // Convert file://localhost/ to file:///
    if(originalPath.indexOf("file://localhost/") == 0)
        originalPath = "file://" + originalPath.substr(16);
    // Convert to a native file format
    var localPath;
    if(originalPath.charAt(9) == ":") // pc local file
        localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
    else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
        localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
    else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
        localPath = unescape(originalPath.substr(7));
    else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
        localPath = unescape(originalPath.substr(5));
    else // pc network file
        localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
    return localPath;
}

function getBackupPath(localPath,title,extension)
{
    var slash = "\\";
    var dirPathPos = localPath.lastIndexOf("\\");
    if(dirPathPos == -1) {
        dirPathPos = localPath.lastIndexOf("/");
        slash = "/";
    }
    var backupFolder = config.options.txtBackupFolder;
    if(!backupFolder || backupFolder == "")
        backupFolder = ".";
    var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
    backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
    if(title)
        backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
    backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
    return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
    var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
    if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
        displayMessage(config.messages.rssSaved,"file://" + rssPath);
    else
        alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
    var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
    s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
    var i;
    for(i=0; i<tiddler.tags.length; i++)
        s += "<category>" + tiddler.tags[i] + "</category>\n";
    s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
    s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
    return s;
};

function generateRss()
{
    var s = [];
    var d = new Date();
    var u = store.getTiddlerText("SiteUrl");
    // Assemble the header
    s.push("<" + "?xml version=\"1.0\"?" + ">");
    s.push("<rss version=\"2.0\">");
    s.push("<channel>");
    s.push("<title" + ">" + wikifyPlainText(store.getTiddlerText("SiteTitle",""),null,tiddler).htmlEncode() + "</title" + ">");
    if(u)
        s.push("<link>" + u.htmlEncode() + "</link>");
    s.push("<description>" + wikifyPlainText(store.getTiddlerText("SiteSubtitle",""),null,tiddler).htmlEncode() + "</description>");
    s.push("<language>" + config.locale + "</language>");
    s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
    s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
    s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
    s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
    s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
    // The body
    var tiddlers = store.getTiddlers("modified","excludeLists");
    var i,n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
    for(i=tiddlers.length-1; i>=n; i--) {
        s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
    }
    // And footer
    s.push("</channel>");
    s.push("</rss>");
    // Save it all
    return s.join("\n");
}

//--
//-- Filesystem code
//--

// Copy a file in filesystem [Preemption]
window.copyFile = window.copyFile || function(dest,source)
{
    return config.browser.isIE ? ieCopyFile(dest,source) : false;
}


// Save a file in filesystem [Preemption]
window.saveFile = window.saveFile || function(fileUrl,content)
{
    var r = mozillaSaveFile(fileUrl,content);
    if(!r)
        r = ieSaveFile(fileUrl,content);
    if(!r)
        r = javaSaveFile(fileUrl,content);
    if(!r)
        r = HTML5DownloadSaveFile(fileUrl,content);
    if(!r)
        r = manualSaveFile(fileUrl,content);
    return r;
}

// Load a file from filesystem [Preemption]
window.loadFile = window.loadFile || function(fileUrl)
{
    var r = mozillaLoadFile(fileUrl);
    if((r == null) || (r == false))
        r = ieLoadFile(fileUrl);
    if((r == null) || (r == false))
        r = javaLoadFile(fileUrl);
    return r;
}

function ieCreatePath(path)
{
    try {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
    } catch(ex) {
        return null;
    }

    var pos = path.lastIndexOf("\\");
    if(pos==-1)
        pos = path.lastIndexOf("/");
    if(pos!=-1)
        path = path.substring(0,pos+1);

    var scan = [path];
    var parent = fso.GetParentFolderName(path);
    while(parent && !fso.FolderExists(parent)) {
        scan.push(parent);
        parent = fso.GetParentFolderName(parent);
    }

    for(i=scan.length-1;i>=0;i--) {
        if(!fso.FolderExists(scan[i])) {
            fso.CreateFolder(scan[i]);
        }
    }
    return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
    ieCreatePath(filePath);
    try {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
    } catch(ex) {
        return null;
    }
    var file = fso.OpenTextFile(filePath,2,-1,0);
    file.Write(content);
    file.Close();
    return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
    try {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
        var file = fso.OpenTextFile(filePath,1);
        var content = file.ReadAll();
        file.Close();
    } catch(ex) {
        return null;
    }
    return content;
}

function ieCopyFile(dest,source)
{
    ieCreatePath(dest);
    try {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
        fso.GetFile(source).Copy(dest);
    } catch(ex) {
        return false;
    }
    return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
    if(window.Components) {
        try {
            netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
            var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
            file.initWithPath(filePath);
            if(!file.exists())
                file.create(0,0x01B4);// 0x01B4 = 0664
            var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
            out.init(file,0x22,0x04,null);
            out.write(content,content.length);
            out.flush();
            out.close();
            return true;
        } catch(ex) {
            return false;
        }
    }
    return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
    if(window.Components) {
        try {
            netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
            var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
            file.initWithPath(filePath);
            if(!file.exists())
                return null;
            var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
            inputStream.init(file,0x01,0x04,null);
            var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
            sInputStream.init(inputStream);
            var contents = sInputStream.read(sInputStream.available());
            sInputStream.close();
            inputStream.close();
            return contents;
        } catch(ex) {
            return false;
        }
    }
    return null;
}

function javaUrlToFilename(url)
{
    var f = "//localhost";
    if(url.indexOf(f) == 0)
        return url.substring(f.length);
    var i = url.indexOf(":");
    return i > 0 ? url.substring(i-1) : url;
}

/*
 *
 * in between when the applet has been started
 * and the user has given permission to run the applet
 * we get an applet object, but it doesn't have the methods
 * we expect yet.
 *
 */
var LOG_TIDDLYSAVER = true;
function logTiddlySaverException(msg, ex) {
    var applet = document.applets['TiddlySaver'];
    console.log(msg + ": " + ex);
    if (LOG_TIDDLYSAVER && applet) {
        try {
            console.log(msg + ": " + applet.getLastErrorMsg());
            console.log(msg + ": " + applet.getLastErrorStackTrace());
        } catch (ex) {}
    }
}

function javaDebugInformation () {
    var applet = document.applets['TiddlySaver'];
    var what = [
        ["Java Version", applet.getJavaVersion],
        ["Last Exception", applet.getLastErrorMessage],
        ["Last Exception Stack Trace", applet.getLastErrorStackTrace],
        ["System Properties", applet.getSystemProperties] ];

    function formatItem (description, method) {
        try {
             result = String(method.call(applet));
        } catch (ex) {
             result = String(ex)
        }
        return description + ": " + result
    }

    return jQuery.map(what, function (item) { return formatItem.apply(this, item) })
            .join('\n\n')
}

function javaSaveFile(filePath,content)
{
    var applet = document.applets['TiddlySaver'];
    try {
        if (applet && filePath)
            return applet.saveFile(javaUrlToFilename(filePath), "UTF-8", content);
    } catch(ex) {
        logTiddlySaverException("javaSaveFile", ex);
    }
    // is this next block working anywhere ? -- grmble
    try {
        var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
        s.print(content);
        s.close();
    } catch(ex2) {
        return null;
    }
    return true;
}

function javaLoadFile(filePath)
{
    var applet = document.applets['TiddlySaver'];
    try {
        if (applet && filePath) {
            var ret = applet.loadFile(javaUrlToFilename(filePath),"UTF-8");
            if(!ret)
                return null;
            return String(ret);
        }
    } catch(ex) {
        logTiddlySaverException("javaLoadFile", ex);
    }
    // is this next block working anywhere ? -- grmble
    var content = [];
    try {
        var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
        var line;
        while((line = r.readLine()) != null)
            content.push(String(line));
        r.close();
    } catch(ex2) {
        return null;
    }
    return content.join("\n");
}

function HTML5DownloadSaveFile(filePath,content)
{
    if(document.createElement("a").download !== undefined) {
        config.saveByDownload=true;
        var slashpos=filePath.lastIndexOf("/");
        if (slashpos==-1) slashpos=filePath.lastIndexOf("\\");
        var filename=filePath.substr(slashpos+1);
        var uri = getDataURI(content);
        var link = document.createElement("a");
        link.setAttribute("target","_blank");
        link.setAttribute("href",uri);
        link.setAttribute("download",filename);
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
        return true;
    }
    return null;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function manualSaveFile(filePath,content)
{
    // FALLBACK for showing a link to data: URI
    config.saveByManualDownload=true;
    var slashpos=filePath.lastIndexOf("/");
    if (slashpos==-1) slashpos=filePath.lastIndexOf("\\");
    var filename=filePath.substr(slashpos+1);
    var uri = getDataURI(content);
    displayMessage(config.messages.mainDownloadManual,uri);
    return true;
}

// construct data URI (using base64 encoding to preserve multi-byte encodings)
function getDataURI(data) {
    if (config.browser.isIE)
        return "data:text/html,"+encodeURIComponent(data);
    else
        return "data:text/html;base64,"+encodeBase64(data);
}

function encodeBase64(data) {
    if (!data) return "";
    var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
    var out = "";
    var chr1,chr2,chr3="";
    var enc1,enc2,enc3,enc4="";
    for (var count=0,i=0; i<data.length; ) {
        chr1=data.charCodeAt(i++);
        chr2=data.charCodeAt(i++);
        chr3=data.charCodeAt(i++);
        enc1=chr1 >> 2;
        enc2=((chr1 & 3) << 4) | (chr2 >> 4);
        enc3=((chr2 & 15) << 2) | (chr3 >> 6);
        enc4=chr3 & 63;
        if (isNaN(chr2)) enc3=enc4=64;
        else if (isNaN(chr3)) enc4=64;
        out+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);
        chr1=chr2=chr3=enc1=enc2=enc3=enc4="";
    }
    return out;
}//--
//-- Filesystem utilities
//--

function convertUTF8ToUnicode(u)
{
    return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}


function manualConvertUTF8ToUnicode(utf)
{
    var uni = utf;
    var src = 0;
    var dst = 0;
    var b1, b2, b3;
    var c;
    while(src < utf.length) {
        b1 = utf.charCodeAt(src++);
        if(b1 < 0x80) {
            dst++;
        } else if(b1 < 0xE0) {
            b2 = utf.charCodeAt(src++);
            c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
            uni = uni.substring(0,dst++).concat(c,utf.substr(src));
        } else {
            b2 = utf.charCodeAt(src++);
            b3 = utf.charCodeAt(src++);
            c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
            uni = uni.substring(0,dst++).concat(c,utf.substr(src));
        }
    }
    return uni;
}

function mozConvertUTF8ToUnicode(u)
{
    try {
        netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
        var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
        converter.charset = "UTF-8";
    } catch(ex) {
        return manualConvertUTF8ToUnicode(u);
    } // fallback
    var s = converter.ConvertToUnicode(u);
    var fin = converter.Finish();
    return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
    return config.browser.isOpera || !window.netscape ? (config.browser.isIE ? convertUnicodeToHtmlEntities(s) : s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
    var re = /[^\u0000-\u007F]/g;
    return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
    return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
    return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
    try {
        netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
        var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
        converter.charset = "UTF-8";
    } catch(ex) {
        return manualConvertUnicodeToUTF8(s);
    } // fallback
    var u = converter.ConvertFromUnicode(s);
    var fin = converter.Finish();
    return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
    if(window.netscape == undefined || charSet == undefined || charSet == "")
        return uri;
    try {
        netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
        var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
    } catch(ex) {
        return uri;
    }
    return converter.convertURISpecToUTF8(uri,charSet);
}
//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
    this.host = null;
    this.store = null;
    return this;
}

AdaptorBase.prototype.close = function()
{
    return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
    if(!host)
        return '';
    host = host.trim();
    if(!host.match(/:\/\//))
        host = 'http://' + host;
    if(host.substr(host.length-1) == '/')
        host = host.substr(0,host.length-1);
    return host;
};

AdaptorBase.minHostName = function(host)
{
    return host;
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
    if(!context) context = {};
    context.userParams = userParams;
    if(callback) context.callback = callback;
    context.adaptor = this;
    if(!context.host)
        context.host = this.host;
    context.host = this.fullHostName(context.host);
    if(!context.workspace)
        context.workspace = this.workspace;
    return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
    this.host = host;
    context = this.setContext(context,userParams,callback);
    context.status = true;
    if(callback)
        window.setTimeout(function() {context.callback(context,userParams);},10);
    return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
    this.workspace = workspace;
    context = this.setContext(context,userParams,callback);
    context.status = true;
    if(callback)
        window.setTimeout(function() {callback(context,userParams);},10);
    return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiSuccess = function(context,jqXHR)
{
    context.status = true;
    context.adaptor.store = new TiddlyWiki();
    if(!context.adaptor.store.importTiddlyWiki(jqXHR.responseText)) {
        context.statusText = config.messages.invalidFileError.format([context.host]);
        context.status = false;
    }
    context.complete(context,context.userParams);
};

FileAdaptor.loadTiddlyWikiError = function(context,jqXHR)
{
    context.status = false;
    context.statusText = jqXHR.message;
    context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
    context = this.setContext(context,userParams,callback);
    context.workspaces = [{title:"(default)"}];
    context.status = true;
    if(callback)
        window.setTimeout(function() {callback(context,userParams);},10);
    return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
    context = this.setContext(context,userParams,callback);
    if(!context.filter)
        context.filter = filter;
    context.complete = FileAdaptor.getTiddlerListComplete;
    if(this.store) {
        return context.complete(context,context.userParams);
    }
    var options = {
        type:"GET",
        url:context.host,
        file:context.file, // for HTML5 FileReader
        processData:false,
        success:function(data,textStatus,jqXHR) {
            FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
        },
        error:function(jqXHR,textStatus,errorThrown) {
            context.xhr = jqXHR;
            FileAdaptor.loadTiddlyWikiError(context,jqXHR);
        }
    };
    return ajaxReq(options);
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
    if(context.status) {
        if(context.filter) {
            context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
        } else {
            context.tiddlers = [];
            context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
        }
        var i;
        for(i=0; i<context.tiddlers.length; i++) {
            context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
            context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
            context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
        }
        context.status = true;
    }
    if(context.callback) {
        window.setTimeout(function() {context.callback(context,userParams);},10);
    }
    return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
    var info = {};
    info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
    return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
    context = this.setContext(context,userParams,callback);
    context.title = title;
    context.complete = FileAdaptor.getTiddlerComplete;
    if(context.adaptor.store) {
        return context.complete(context,context.userParams);
    }
    var options = {
        type:"GET",
        url:context.host,
        processData:false,
        success:function(data,textStatus,jqXHR) {
            FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
        },
        error:function(jqXHR,textStatus,errorThrown) {
            FileAdaptor.loadTiddlyWikiError(context,jqXHR);
        }
    };
    return ajaxReq(options);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
    var t = context.adaptor.store.fetchTiddler(context.title);
    if(t) {
        t.fields['server.type'] = FileAdaptor.serverType;
        t.fields['server.host'] = AdaptorBase.minHostName(context.host);
        t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
        context.tiddler = t;
        context.status = true;
    } else { //# tiddler does not exist in document
        context.status = false;
    }
    if(context.allowSynchronous) {
        context.isSynchronous = true;
        context.callback(context,userParams);
    } else {
        window.setTimeout(function() {context.callback(context,userParams);},10);
    }
    return true;
};

FileAdaptor.prototype.close = function()
{
    this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
    if (args.file || args.url.startsWith("file"))  // LOCAL FILE
        return localAjax(args);
    return jQuery.ajax(args);
}

function localAjax(args)
{
    var success=function(data)
        { args.success(data,"success",{ responseText:data }); }
    var failure=function(who)
        { args.error({ message:who+": cannot read local file" },"error",0); }

    if (args.file) try { // HTML5 FileReader (Chrome, FF20+, Safari, etc.)
        var reader=new FileReader();
        reader.onload=function(e)  { success(e.target.result); }
        reader.onerror=function(e) { failure("FileReader"); }
        reader.readAsText(args.file);
        return true;
    } catch (ex) { ; }

    try { // local file I/O (IE, FF with TiddlyFox, Chrome/Safari with TiddlySaver, etc.)
        var data=loadFile(getLocalPath(args.url));
        if (data) success(data);
        else failure("loadFile");
        return true;
    } catch (ex) { ; }

    return true;
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
    var httpSuccess = function(xhr) {
        try {
            // IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450
            return (!xhr.status && location.protocol === "file:") ||
                (xhr.status >= 200 && xhr.status < 300) ||
                xhr.status === 304 || xhr.status === 1223;
        } catch(e) {}
        return false;
    };

    var options = {
        type:type,
        url:url,
        processData:false,
        data:data,
        cache:!!allowCache,
        beforeSend: function(xhr) {
            var i;
            for(i in headers)
                xhr.setRequestHeader(i,headers[i]);
        }
    };

    if(callback) {
        options.complete = function(xhr,textStatus) {
            if(httpSuccess(xhr))
                callback(true,params,xhr.responseText,url,xhr);
            else
                callback(false,params,null,url,xhr);
        };
    }
    if(contentType)
        options.contentType = contentType;
    if(username)
        options.username = username;
    if(password)
        options.password = password;
    try {
        if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
            window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
    } catch (ex) {
    }
    return jQuery.ajax(options);
}
//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
    v = v || version;
    return v.major + "." + v.minor + "." + v.revision +
        (v.alpha ? " (alpha " + v.alpha + ")" : "") +
        (v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
    var x1,x2,i,a = ["major","minor","revision"];
    for(i = 0; i<a.length; i++) {
        x1 = v1[a[i]] || 0;
        x2 = v2[a[i]] || 0;
        if(x1<x2)
            return 1;
        if(x1>x2)
            return -1;
    }
    x1 = v1.beta || 9999;
    x2 = v2.beta || 9999;
    if(x1<x2)
        return 1;
    return x1 > x2 ? -1 : 0;
}

function merge(dst,src,preserveExisting)
{
    var i;
    for(i in src) {
        if(!preserveExisting || dst[i] === undefined)
            dst[i] = src[i];
    }
    return dst;
}

// Resolve the target object of an event
function resolveTarget(e)
{
    var obj;
    if(e.target)
        obj = e.target;
    else if(e.srcElement)
        obj = e.srcElement;
    if(obj.nodeType == 3) // defeat Safari bug
        obj = obj.parentNode;
    return obj;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
    var s = e.description || e.toString();
    return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
    alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
    alert(m);
    throw(m);
}

function glyph(name)
{
    var g = config.glyphs;
    var b = g.currBrowser;
    if(b == null) {
        b = 0;
        while(b < g.browsers.length-1 && !g.browsers[b]())
            b++;
        g.currBrowser = b;
    }
    if(!g.codes[name])
        return "";
    return g.codes[name][b];
}

function createTiddlyText(parent,text)
{
    return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
    var cb = document.createElement("input");
    cb.setAttribute("type","checkbox");
    cb.onclick = onChange;
    parent.appendChild(cb);
    cb.checked = checked;
    cb.className = "chkOptionInput";
    if(caption)
        wikify(caption,parent);
    return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
    var n,e = document.createElement(element);
    if(className != null)
        e.className = className;
    if(id != null)
        e.setAttribute("id",id);
    if(text != null)
        e.appendChild(document.createTextNode(text));
    if(attribs) {
        for(n in attribs) {
            e.setAttribute(n,attribs[n]);
        }
    }
    if(parent != null)
        parent.appendChild(e);
    return e;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
    var i,btn = document.createElement("a");
    btn.setAttribute("href","javascript:;");
    if(action) {
        btn.onclick = action;
    }
    if(tooltip)
        btn.setAttribute("title",tooltip);
    if(text)
        btn.appendChild(document.createTextNode(text));
    btn.className = className || "button";
    if(id)
        btn.id = id;
    if(attribs) {
        for(i in attribs) {
            btn.setAttribute(i,attribs[i]);
        }
    }
    if(parent)
        parent.appendChild(btn);
    if(accessKey)
        btn.setAttribute("accessKey",accessKey);
    return btn;
}

function createExternalLink(place,url,label)
{
    var link = document.createElement("a");
    link.className = "externalLink";
    link.href = url;
    var f = config.messages.externalLinkTooltip;
    link.title = f ? f.format([url]) : url;
    if(config.options.chkOpenInNewWindow)
        link.target = "_blank";
    place.appendChild(link);
    if(label)
        createTiddlyText(link, label);
    return link;
}

function getTiddlyLinkInfo(title,currClasses)
{
    var classes = currClasses ? currClasses.split(" ") : [];
    classes.pushUnique("tiddlyLink");
    var tiddler = store.fetchTiddler(title);
    var subTitle;
    if(tiddler) {
        subTitle = tiddler.getSubtitle();
        classes.pushUnique("tiddlyLinkExisting");
        classes.remove("tiddlyLinkNonExisting");
        classes.remove("shadow");
    } else {
        var f;
        classes.remove("tiddlyLinkExisting");
        classes.pushUnique("tiddlyLinkNonExisting");
        if(store.isShadowTiddler(title)) {
            f = config.messages.shadowedTiddlerToolTip;
            classes.pushUnique("shadow");
        } else {
            f = config.messages.undefinedTiddlerToolTip;
            classes.remove("shadow");
        }
        subTitle = f ? f.format([title]) : "";
    }
    if(typeof config.annotations[title]=="string")
        subTitle = config.annotations[title];
    return {classes: classes.join(" "),subTitle: subTitle};
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
    var e = ev || window.event;
    var target = resolveTarget(e);
    var link = target;
    var title = null;
    var fields = null;
    var noToggle = null;
    do {
        title = link.getAttribute("tiddlyLink");
        fields = link.getAttribute("tiddlyFields");
        noToggle = link.getAttribute("noToggle");
        link = link.parentNode;
    } while(title == null && link != null);
    if(!store.isShadowTiddler(title)) {
        var f = fields ? fields.decodeHashMap() : {};
        fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
    }
    if(title) {
        var toggling = e.metaKey || e.ctrlKey;
        if(config.options.chkToggleLinks)
            toggling = !toggling;
        if(noToggle)
            toggling = false;
        if(store.getTiddler(title))
            fields = null;
        story.displayTiddler(target,title,null,true,null,fields,toggling);
    }
    clearMessage();
    return false;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
    var title = jQuery.trim(title);
    var text = includeText ? title : null;
    var i = getTiddlyLinkInfo(title,className);
    var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
    if(isStatic)
        btn.className += ' ' + className;
    btn.setAttribute("refresh","link");
    btn.setAttribute("tiddlyLink",title);
    if(noToggle)
        btn.setAttribute("noToggle","true");
    if(linkedFromTiddler) {
        var fields = linkedFromTiddler.getInheritedFields();
        if(fields)
            btn.setAttribute("tiddlyFields",fields);
    }
    return btn;
}

function refreshTiddlyLink(e,title)
{
    var i = getTiddlyLinkInfo(title,e.className);
    e.className = i.classes;
    e.title = i.subTitle;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
    var sel = createTiddlyElement(place,"select");
    sel.onchange = onchange;
    var t;
    for(t=0; t<options.length; t++) {
        var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
        e.value = options[t].name;
        if(options[t].name == defaultValue)
            e.selected = true;
    }
    return sel;
}

//--
//-- TiddlyWiki-specific popup utility functions
//--

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
    var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
    var sortby = this.getAttribute("sortby");
    if(sortby&&sortby.length) {
        store.sortTiddlers(tiddlers,sortby);
    }
    story.displayTiddlers(this,tiddlers);
    return false;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
    var e = ev || window.event;
    var popup = Popup.create(this);
    jQuery(popup).addClass("taggedTiddlerList");
    var tag = this.getAttribute("tag");
    var title = this.getAttribute("tiddler");
    if(popup && tag) {
        var tagged = tag.indexOf("[")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
        var sortby = this.getAttribute("sortby");
        if(sortby&&sortby.length) {
            store.sortTiddlers(tagged,sortby);
        }
        var titles = [];
        var r;
        for(r=0;r<tagged.length;r++) {
            if(tagged[r].title != title)
                titles.push(tagged[r].title);
        }
        var lingo = config.views.wikified.tag;
        if(titles.length > 0) {
            var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
            openAll.setAttribute("tag",tag);
            openAll.setAttribute("sortby",sortby);
            createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
            for(r=0; r<titles.length; r++) {
                createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
            }
        } else {
            createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
        }
        createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
        var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
        createTiddlyText(h,lingo.openTag.format([tag]));
    }
    Popup.show();
    e.cancelBubble = true;
    if(e.stopPropagation) e.stopPropagation();
    return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
    var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
    btn.setAttribute("tag",tag);
    if(excludeTiddler)
        btn.setAttribute("tiddler",excludeTiddler);
    return btn;
}

function onClickTiddlyPopup(ev)
{
    var e = ev || window.event;
    var tiddler = this.tiddler;
    if(tiddler.text) {
        var popup = Popup.create(this,"div","popupTiddler");
        wikify(tiddler.text,popup,null,tiddler);
        Popup.show();
    }
    if(e) e.cancelBubble = true;
    if(e && e.stopPropagation) e.stopPropagation();
    return false;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
    if(tiddler.text) {
        createTiddlyLink(place,caption,true);
        var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
        btn.tiddler = tiddler;
    } else {
        createTiddlyText(place,caption);
    }
}

function onClickError(ev)
{
    var e = ev || window.event;
    var popup = Popup.create(this);
    var lines = this.getAttribute("errorText").split("\n");
    var t;
    for(t=0; t<lines.length; t++)
        createTiddlyElement(popup,"li",null,null,lines[t]);
    Popup.show();
    e.cancelBubble = true;
    if(e.stopPropagation) e.stopPropagation();
    return false;
}

function createTiddlyError(place,title,text)
{
    var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
    if(text) btn.setAttribute("errorText",text);
}
//-
//- Animation engine
//-

function Animator()
{
    this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
    this.timerID = 0; // ID of the timer used for animating
    this.animations = []; // List of animations in progress
    return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
    var t;
    for(t=0; t<arguments.length; t++)
        this.animations.push(arguments[t]);
    if(this.running == 0) {
        var me = this;
        this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
    }
    this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
    var a = 0;
    while(a < me.animations.length) {
        var animation = me.animations[a];
        if(animation.tick()) {
            a++;
        } else {
            me.animations.splice(a,1);
            if(--me.running == 0)
                window.clearInterval(me.timerID);
        }
    }
};

Animator.slowInSlowOut = function(progress)
{
    return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
    this.element = element;
    this.duration = duration;
    this.properties = properties;
    this.startTime = new Date();
    this.endTime = Number(this.startTime) + duration;
    this.callback = callback;
    this.tick();
    return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
    switch(style) {
    case "-tw-vertScroll":
        window.scrollTo(findScrollX(),value);
        break;
    case "-tw-horizScroll":
        window.scrollTo(value,findScrollY());
        break;
    default:
        element.style[style] = value;
        break;
    }
};

Morpher.prototype.stop = function()
{
    var t;
    for(t=0; t<this.properties.length; t++) {
        var p = this.properties[t];
        if(p.atEnd !== undefined) {
            this.assignStyle(this.element,p.style,p.atEnd);
        }
    }
    if(this.callback)
        this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
    var currTime = Number(new Date());
    var t,progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
    for(t=0; t<this.properties.length; t++) {
        var p = this.properties[t];
        if(p.start !== undefined && p.end !== undefined) {
            var template = p.template || "%0";
            switch(p.format) {
            case undefined:
            case "style":
                var v = p.start + (p.end-p.start) * progress;
                this.assignStyle(this.element,p.style,template.format([v]));
                break;
            case "color":
                break;
            }
        }
    }
    if(currTime >= this.endTime) {
        this.stop();
        return false;
    }
    return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
    var e = createTiddlyElement(document.body,"div",null,"zoomer");
    createTiddlyElement(e,"div",null,null,text);
    var winWidth = findWindowWidth();
    var winHeight = findWindowHeight();
    var p = [
        {style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
        {style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
        {style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
        {style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
        {style: 'fontSize', start: 8, end: 24, template: '%0pt'}
    ];
    var c = function(element,properties) {jQuery(element).remove();};
    return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
    var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
    return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
    element.style.overflow = 'hidden';
    if(opening)
        element.style.height = '0px'; // Resolves a Firefox flashing bug
    element.style.display = 'block';
    var height = element.scrollHeight;
    var p = [];
    var c = null;
    if(opening) {
        p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
        p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
        p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
    } else {
        p.push({style: 'height', start: height, end: 0, template: '%0px'});
        p.push({style: 'display', atEnd: 'none'});
        p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
        p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
        switch(deleteMode) {
        case "all":
            c = function(element,properties) {jQuery(element).remove();};
            break;
        case "children":
            c = function(element,properties) {jQuery(element).empty();};
            break;
        }
    }
    return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
    stack: [] // Array of objects with members root: and popup:
    };

Popup.create = function(root,elem,className)
{
    var stackPosition = this.find(root,"popup");
    Popup.remove(stackPosition+1);
    var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
    popup.stackPosition = stackPosition;
    Popup.stack.push({root: root, popup: popup});
    return popup;
};

Popup.onDocumentClick = function(ev)
{
    var e = ev || window.event;
    if(e.eventPhase == undefined)
        Popup.remove();
    else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
        Popup.remove();
    return true;
};

Popup.show = function(valign,halign,offset)
{
    var curr = Popup.stack[Popup.stack.length-1];
    this.place(curr.root,curr.popup,valign,halign,offset);
    jQuery(curr.root).addClass("highlight");
    if(config.options.chkAnimate && anim && typeof Scroller == "function")
        anim.startAnimating(new Scroller(curr.popup));
    else
        window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
    if(!offset)
        offset = {x:0,y:0};
    if(popup.stackPosition >= 0 && !valign && !halign) {
        offset.x = offset.x + root.offsetWidth;
    } else {
        offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
        offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
    }
    var rootLeft = findPosX(root);
    var rootTop = findPosY(root);
    var popupLeft = rootLeft + offset.x;
    var popupTop = rootTop + offset.y;
    var winWidth = findWindowWidth();
    if(popup.offsetWidth > winWidth*0.75)
        popup.style.width = winWidth*0.75 + "px";
    var popupWidth = popup.offsetWidth;
    var scrollWidth = winWidth - document.body.offsetWidth;
    if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
        if(halign == "right")
            popupLeft = popupLeft - root.offsetWidth - popupWidth;
        else
            popupLeft = winWidth - popupWidth - scrollWidth - 1;
    }
    popup.style.left = popupLeft + "px";
    popup.style.top = popupTop + "px";
    popup.style.display = "block";
};

Popup.find = function(e)
{
    var t,pos = -1;
    for(t=this.stack.length-1; t>=0; t--) {
        if(isDescendant(e,this.stack[t].popup))
            pos = t;
    }
    return pos;
};

Popup.remove = function(pos)
{
    if(!pos) pos = 0;
    if(Popup.stack.length > pos) {
        Popup.removeFrom(pos);
    }
};

Popup.removeFrom = function(from)
{
    var t;
    for(t=Popup.stack.length-1; t>=from; t--) {
        var p = Popup.stack[t];
        jQuery(p.root).removeClass("highlight");
        jQuery(p.popup).remove();
    }
    Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
    if(elem) {
        this.formElem = findRelated(elem,"wizard","className");
        this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
        this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
    } else {
        this.formElem = null;
        this.bodyElem = null;
        this.footElem = null;
    }
}

Wizard.prototype.setValue = function(name,value)
{
    jQuery(this.formElem).data(name, value);
};

Wizard.prototype.getValue = function(name)
{
    return this.formElem ? jQuery(this.formElem).data(name) : null;
};

Wizard.prototype.createWizard = function(place,title)
{
    this.formElem = createTiddlyElement(place,"form",null,"wizard");
    createTiddlyElement(this.formElem,"h1",null,null,title);
    this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
    this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
    return this.formElem;
};

Wizard.prototype.clear = function()
{
    jQuery(this.bodyElem).empty();
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
    jQuery(this.footElem).empty();
    var t;
    for(t=0; t<buttonInfo.length; t++) {
        createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
        insertSpacer(this.footElem);
        }
    if(typeof status == "string") {
        createTiddlyElement(this.footElem,"span",null,"status",status);
    }
};

Wizard.prototype.addStep = function(stepTitle,html)
{
    jQuery(this.bodyElem).empty();
    var w = createTiddlyElement(this.bodyElem,"div");
    createTiddlyElement(w,"h2",null,null,stepTitle);
    var step = createTiddlyElement(w,"div",null,"wizardStep");
    step.innerHTML = html;
    applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
    return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
    var table = createTiddlyElement(place,"table",null,className || "listView twtable");
    var thead = createTiddlyElement(table,"thead");
    var t,r = createTiddlyElement(thead,"tr");
    for(t=0; t<listTemplate.columns.length; t++) {
        var columnTemplate = listTemplate.columns[t];
        var c = createTiddlyElement(r,"th");
        var colType = ListView.columnTypes[columnTemplate.type];
        if(colType && colType.createHeader) {
            colType.createHeader(c,columnTemplate,t);
            if(columnTemplate.className)
                jQuery(c).addClass(columnTemplate.className);
        }
    }
    var rc,tbody = createTiddlyElement(table,"tbody");
    for(rc=0; rc<listObject.length; rc++) {
        var rowObject = listObject[rc];
        r = createTiddlyElement(tbody,"tr");
        for(c=0; c<listTemplate.rowClasses.length; c++) {
            if(rowObject[listTemplate.rowClasses[c].field])
                jQuery(r).addClass(listTemplate.rowClasses[c].className);
        }
        rowObject.rowElement = r;
        rowObject.colElements = {};
        var cc;
        for(cc=0; cc<listTemplate.columns.length; cc++) {
            c = createTiddlyElement(r,"td");
            columnTemplate = listTemplate.columns[cc];
            var field = columnTemplate.field;
            colType = ListView.columnTypes[columnTemplate.type];
            if(colType && colType.createItem) {
                colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
                if(columnTemplate.className)
                    jQuery(c).addClass(columnTemplate.className);
            }
            rowObject.colElements[field] = c;
        }
    }
    if(callback && listTemplate.actions)
        createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
    if(callback && listTemplate.buttons) {
        for(t=0; t<listTemplate.buttons.length; t++) {
            var a = listTemplate.buttons[t];
            if(a && a.name != "")
                createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
        }
    }
    return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
    return function(e) {
        var view = findRelated(this,"TABLE",null,"previousSibling");
        var tiddlers = [];
        ListView.forEachSelector(view,function(e,rowName) {
                    if(e.checked)
                        tiddlers.push(rowName);
                    });
        if(tiddlers.length == 0 && !allowEmptySelection) {
            alert(config.messages.nothingSelected);
        } else {
            if(this.nodeName.toLowerCase() == "select") {
                callback(view,this.value,tiddlers);
                this.selectedIndex = 0;
            } else {
                callback(view,name,tiddlers);
            }
        }
    };
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
    var checkboxes = view.getElementsByTagName("input");
    var t,hadOne = false;
    for(t=0; t<checkboxes.length; t++) {
        var cb = checkboxes[t];
        if(cb.getAttribute("type") == "checkbox") {
            var rn = cb.getAttribute("rowName");
            if(rn) {
                callback(cb,rn);
                hadOne = true;
            }
        }
    }
    return hadOne;
};

ListView.getSelectedRows = function(view)
{
    var rowNames = [];
    ListView.forEachSelector(view,function(e,rowName) {
                if(e.checked)
                    rowNames.push(rowName);
                });
    return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
    createHeader: function(place,columnTemplate,col)
        {
            createTiddlyText(place,columnTemplate.title);
        },
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var v = listObject[field];
            if(v != undefined)
                createTiddlyText(place,v);
        }
};

ListView.columnTypes.WikiText = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var v = listObject[field];
            if(v != undefined)
                wikify(v,place,null,null);
        }
};

ListView.columnTypes.Tiddler = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var v = listObject[field];
            if(v != undefined && v.title)
                createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
        }
};

ListView.columnTypes.Size = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var msg = config.messages.sizeTemplates;
            var v = listObject[field];
            if(v != undefined) {
                var t = 0;
                while(t<msg.length-1 && v<msg[t].unit)
                    t++;
                createTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));
            }
        }
};

ListView.columnTypes.Link = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var v = listObject[field];
            var c = columnTemplate.text;
            if(v != undefined)
                createExternalLink(place,v,c || v);
        }
};

ListView.columnTypes.Date = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var v = listObject[field];
            if(v != undefined)
                createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
        }
};

ListView.columnTypes.StringList = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var v = listObject[field];
            if(v != undefined) {
                var t;
                for(t=0; t<v.length; t++) {
                    createTiddlyText(place,v[t]);
                    createTiddlyElement(place,"br");
                }
            }
        }
};

ListView.columnTypes.Selector = {
    createHeader: function(place,columnTemplate,col)
        {
            createTiddlyCheckbox(place,null,false,this.onHeaderChange);
        },
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var e = createTiddlyCheckbox(place,null,listObject[field],null);
            e.setAttribute("rowName",listObject[columnTemplate.rowName]);
        },
    onHeaderChange: function(e)
        {
            var state = this.checked;
            var view = findRelated(this,"TABLE");
            if(!view)
                return;
            ListView.forEachSelector(view,function(e,rowName) {
                                e.checked = state;
                            });
        }
};

ListView.columnTypes.Tags = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var tags = listObject[field];
            createTiddlyText(place,String.encodeTiddlyLinkList(tags));
        }
};

ListView.columnTypes.Boolean = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            if(listObject[field] == true)
                createTiddlyText(place,columnTemplate.trueText);
            if(listObject[field] == false)
                createTiddlyText(place,columnTemplate.falseText);
        }
};

ListView.columnTypes.TagCheckbox = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
            e.setAttribute("tiddler",listObject.title);
            e.setAttribute("tag",columnTemplate.tag);
        },
    onChange : function(e)
        {
            var tag = this.getAttribute("tag");
            var tiddler = this.getAttribute("tiddler");
            store.setTiddlerTag(tiddler,this.checked,tag);
        }
};

ListView.columnTypes.TiddlerLink = {
    createHeader: ListView.columnTypes.String.createHeader,
    createItem: function(place,listObject,field,columnTemplate,col,row)
        {
            var v = listObject[field];
            if(v != undefined) {
                var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
                createTiddlyText(link,listObject[field]);
            }
        }
};

//--
//-- Augmented methods for the JavaScript Array() object
//--

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
    if(!from)
        from = 0;
    var i;
    for(i=from; i<this.length; i++) {
        if(this[i] === item)
            return i;
    }
    return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
    var t;
    for(t=0; t<this.length; t++) {
        if(this[t][field] === value)
            return t;
    }
    return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
    return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
    var p = this.indexOf(value);
    if(mode == 0)
        mode = (p == -1) ? +1 : -1;
    if(mode == +1) {
        if(p == -1)
            this.push(value);
    } else if(mode == -1) {
        if(p != -1)
            this.splice(p,1);
    }
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
    var i;
    for(i=0; i<items.length; i++) {
        if(this.indexOf(items[i]) != -1)
            return true;
    }
    return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
    var i;
    for(i = 0; i<items.length; i++) {
        if(this.indexOf(items[i]) == -1)
            return false;
    }
    return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
    if(unique === false) {
        this.push(item);
    } else {
        if(this.indexOf(item) == -1)
            this.push(item);
    }
};

Array.prototype.remove = function(item)
{
    var p = this.indexOf(item);
    if(p != -1)
        this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
    var scope = thisObj || window;
    var i,j,a = [];
    for(i=0, j=this.length; i < j; ++i) {
        a.push(fn.call(scope,this[i],i,this));
    }
    return a;
};}

//--
//-- Augmented methods for the JavaScript String() object
//--

// Get characters from the right end of a string
String.prototype.right = function(n)
{
    return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
    return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
    var t,s = this.split("-");
    if(s.length > 1) {
        for(t=1; t<s.length; t++)
            s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
    }
    return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
    var substrings = s && s.constructor == Array ? s : arguments;
    var subRegExp = /(?:%(\d+))/mg;
    var currPos = 0;
    var match,r = [];
    do {
        match = subRegExp.exec(this);
        if(match && match[1]) {
            if(match.index > currPos)
                r.push(this.substring(currPos,match.index));
            r.push(substrings[parseInt(match[1],10)]);
            currPos = subRegExp.lastIndex;
        }
    } while(match);
    if(currPos < this.length)
        r.push(this.substring(currPos,this.length));
    return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
    var s = "\\^$*+?()=!|,{}[].";
    var t,c = this;
    for(t=0; t<s.length; t++)
        c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
    return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
    return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
    return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
    return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
    return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
    var parseToken = function(match,p) {
        var n;
        if(match[p]) // Double quoted
            n = match[p];
        else if(match[p+1]) // Single quoted
            n = match[p+1];
        else if(match[p+2]) // Double-square-bracket quoted
            n = match[p+2];
        else if(match[p+3]) // Double-brace quoted
            try {
                n = match[p+3];
                if(allowEval && config.evaluateMacroParameters != "none") {
                    if(config.evaluateMacroParameters == "restricted") {
                        if(window.restrictedEval) {
                            n = window.restrictedEval(n);
                        }
                    } else {
                        n = window.eval(n);
                    }
                }
            } catch(ex) {
                throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
            }
        else if(match[p+4]) // Unquoted
            n = match[p+4];
        else if(match[p+5]) // empty quote
            n = "";
        return n;
    };
    var r = [{}];
    var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
    var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
    var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
    var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
    var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
    var emptyQuote = "((?:\"\")|(?:''))";
    var skipSpace = "(?:\\s*)";
    var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
    var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
    var match;
    do {
        match = re.exec(this);
        if(match) {
            var n = parseToken(match,1);
            if(noNames) {
                r.push({name:"",value:n});
            } else {
                var v = parseToken(match,8);
                if(v == null && defaultName) {
                    v = n;
                    n = defaultName;
                } else if(v == null && defaultValue) {
                    v = defaultValue;
                }
                r.push({name:n,value:v});
                if(cascadeDefaults) {
                    defaultName = n;
                    defaultValue = v;
                }
            }
        }
    } while(match);
    // Summarise parameters into first element
    var t;
    for(t=1; t<r.length; t++) {
        if(r[0][r[t].name])
            r[0][r[t].name].push(r[t].value);
        else
            r[0][r[t].name] = [r[t].value];
    }
    return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function(notAllowEval)
{
    var p = this.parseParams("list",null,!notAllowEval,true);
    var t,n = [];
    for(t=1; t<p.length; t++)
        n.push(p[t].value);
    return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
    var p = this.parseParams("list",null,false,true);
    var t,n = [];
    for(t=1; t<p.length; t++) {
        if(p[t].value)
            n.pushUnique(p[t].value,unique);
    }
    return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
    var s = this.indexOf(start);
    if(s != -1) {
        s += start.length;
        var e = this.indexOf(end,s);
        if(e != -1)
            return [s,e];
    }
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
    var r = this.getChunkRange(start,end);
    return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
    var r = this.getChunkRange(start,end);
    if(r)
        return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
    return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
    if(list) {
        var t,results = [];
        for(t=0; t<list.length; t++)
            results.push(String.encodeTiddlyLink(list[t]));
        return results.join(" ");
    } else {
        return "";
    }
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
    var fields = this.parseParams("anon","",false);
    var t,r = {};
    for(t=1; t<fields.length; t++)
        r[fields[t].name] = fields[t].value;
    return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
    var t,r = [];
    for(t in hashmap)
        r.push(t + ':"' + hashmap[t] + '"');
    return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
    var s = n.toString();
    if(s.length < d)
        s = "000000000000000000000000000".substr(0,d-s.length) + s;
    return s;
};

String.prototype.startsWith = function(prefix)
{
    return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
    if(!params)
        return defaultValue;
    var p = params[0][name];
    return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
    return !!getParam(params,name,defaultValue);
}

//--
//-- Augmented methods for the JavaScript Date() object
//--

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
    var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
    t = t.replace(/hh12/g,this.getHours12());
    t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
    t = t.replace(/hh/g,this.getHours());
    t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
    t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
    t = t.replace(/mm/g,this.getMinutes());
    t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
    t = t.replace(/ss/g,this.getSeconds());
    t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
    t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
    t = t.replace(/wYYYY/g,this.getYearForWeekNo());
    t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
    t = t.replace(/YYYY/g,this.getFullYear());
    t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
    t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
    t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
    t = t.replace(/MM/g,this.getMonth()+1);
    t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
    t = t.replace(/WW/g,this.getWeek());
    t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
    t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
    t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
    t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
    t = t.replace(/DD/g,this.getDate());
    var tz = this.getTimezoneOffset();
    var atz = Math.abs(tz);
    t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
    t = t.replace(/\\/g,"");
    return t;
};

Date.prototype.getWeek = function()
{
    var dt = new Date(this.getTime());
    var d = dt.getDay();
    if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
    dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
    var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
    return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
    var dt = new Date(this.getTime());
    var d = dt.getDay();
    if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
    dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
    return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
    var h = this.getHours();
    return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
    return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
    return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
    return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
    return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
    return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +"0";
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
    d = d?d.replace(/[^0-9]/g, ""):"";
    return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
    d = d?d.replace(/[^0-9]/g, ""):"";
    return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
    d = d ? d.replace(/[^0-9]/g, "") : "";
    return new Date(Date.UTC(parseInt(d.substr(0,4),10),
            parseInt(d.substr(4,2),10)-1,
            parseInt(d.substr(6,2),10),
            parseInt(d.substr(8,2)||"00",10),
            parseInt(d.substr(10,2)||"00",10),
            parseInt(d.substr(12,2)||"00",10),
            parseInt(d.substr(14,3)||"000",10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
    this.r = 0;
    this.g = 0;
    this.b = 0;
    if(typeof r == "string") {
        if(r.substr(0,1) == "#") {
            if(r.length == 7) {
                this.r = parseInt(r.substr(1,2),16)/255;
                this.g = parseInt(r.substr(3,2),16)/255;
                this.b = parseInt(r.substr(5,2),16)/255;
            } else {
                this.r = parseInt(r.substr(1,1),16)/15;
                this.g = parseInt(r.substr(2,1),16)/15;
                this.b = parseInt(r.substr(3,1),16)/15;
            }
        } else {
            var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
            var c = r.match(rgbPattern);
            if(c) {
                this.r = parseInt(c[1],10)/255;
                this.g = parseInt(c[2],10)/255;
                this.b = parseInt(c[3],10)/255;
            }
        }
    } else {
        this.r = r;
        this.g = g;
        this.b = b;
    }
    return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
    return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
    var clamp = function(x,min,max) {
        return x < min ? min : (x > max ? max : x);
    };
    return "#" +
            ("0" + Math.floor(clamp(this.r,0,1) * 255).toString(16)).right(2) +
            ("0" + Math.floor(clamp(this.g,0,1) * 255).toString(16)).right(2) +
            ("0" + Math.floor(clamp(this.b,0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,locolors,hicolors)
{
    if(!hicolors)
        hicolors = locolors;
    var t;
    for(t=0; t<= 100; t+=2) {
        var bar = document.createElement("div");
        place.appendChild(bar);
        bar.style.position = "absolute";
        bar.style.left = horiz ? t + "%" : 0;
        bar.style.top = horiz ? 0 : t + "%";
        bar.style.width = horiz ? (101-t) + "%" : "100%";
        bar.style.height = horiz ? "100%" : (101-t) + "%";
        bar.style.zIndex = -1;
        var p = t/100*(locolors.length-1);
        var hc = hicolors[Math.floor(p)];
        if(typeof hc == "string")
            hc = new RGB(hc);
        var lc = locolors[Math.ceil(p)];
        if(typeof lc == "string")
            lc = new RGB(lc);
        bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
    }
}

function addEvent(obj,type,fn)
{
    if(obj.attachEvent) {
        obj["e"+type+fn] = fn;
        obj[type+fn] = function(){obj["e"+type+fn](window.event);};
        obj.attachEvent("on"+type,obj[type+fn]);
    } else {
        obj.addEventListener(type,fn,false);
    }
}

function removeEvent(obj,type,fn)
{
    if(obj.detachEvent) {
        obj.detachEvent("on"+type,obj[type+fn]);
        obj[type+fn] = null;
    } else {
        obj.removeEventListener(type,fn,false);
    }
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
    name = name || "tagName";
    relative = relative || "parentNode";
    if(name == "className") {
        while(e && !jQuery(e).hasClass(value)) {
            e = e[relative];
        }
    } else {
        while(e && e[name] != value) {
            e = e[relative];
        }
    }
    return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
    var posTop = findPosY(e);
    var posBot = posTop + e.offsetHeight;
    var winTop = findScrollY();
    var winHeight = findWindowHeight();
    var winBot = winTop + winHeight;
    if(posTop < winTop) {
        return posTop;
    } else if(posBot > winBot) {
        if(e.offsetHeight < winHeight)
            return posTop - (winHeight - e.offsetHeight);
        else
            return posTop;
    } else {
        return winTop;
    }
}

// Get the current width of the display window
function findWindowWidth()
{
    return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
    return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current height of the document
function findDocHeight() {
    var D = document;
    return Math.max(
        Math.max(D.body.scrollHeight, D.documentElement.scrollHeight),
        Math.max(D.body.offsetHeight, D.documentElement.offsetHeight),
        Math.max(D.body.clientHeight, D.documentElement.clientHeight)
    );
}

// Get the current horizontal page scroll position
function findScrollX()
{
    return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
    return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
    var curleft = 0;
    while(obj.offsetParent) {
        curleft += obj.offsetLeft;
        obj = obj.offsetParent;
    }
    return curleft;
}

function findPosY(obj)
{
    var curtop = 0;
    while(obj.offsetParent) {
        curtop += obj.offsetTop;
        obj = obj.offsetParent;
    }
    return curtop;
}

// Blur a particular element
function blurElement(e)
{
    if(e && e.focus && e.blur) {
        e.focus();
        e.blur();
    }
}

// Create a non-breaking space
function insertSpacer(place)
{
    var e = document.createTextNode(String.fromCharCode(160));
    if(place)
        place.appendChild(e);
    return e;
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
    if(e.setSelectionRange) {
        var oldpos = e.selectionStart;
        var isRange = e.selectionEnd > e.selectionStart;
        e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
        e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
        var linecount = e.value.split("\n").length;
        var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
        e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
    } else if(document.selection) {
        var range = document.selection.createRange();
        if(range.parentElement() == e) {
            var isCollapsed = range.text == "";
            range.text = text;
            if(!isCollapsed) {
                range.moveStart("character", -text.length);
                range.select();
            }
        }
    }
}

// Set the caret position in a text area
function setCaretPosition(e,pos)
{
    if(e.selectionStart || e.selectionStart == '0') {
        e.selectionStart = pos;
        e.selectionEnd = pos;
        e.focus();
    } else if(document.selection) {
        // IE support
        e.focus ();
        var sel = document.selection.createRange();
        sel.moveStart('character', -e.value.length);
        sel.moveStart('character',pos);
        sel.moveEnd('character',0);
        sel.select();
    }
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
    var t = "";
    while(e && e.nodeName == "#text") {
        t += e.nodeValue;
        e = e.nextSibling;
    }
    return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
    while(e) {
        if(e === ancestor)
            return true;
        e = e.parentNode;
    }
    return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
    var ev = e || window.event;
    ev.cancelBubble = true;
    if(ev.stopPropagation) ev.stopPropagation();
    return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
    if(!config.browser.isIE)
        return;
    var att = e.attributes;
    if(att) {
        var t;
        for(t=0; t<att.length; t++) {
            var n = att[t].name;
            if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
                try {
                    e[n] = null;
                } catch(ex) {
                }
            }
        }
    }
    var c = e.firstChild;
    while(c) {
        scrubNode(c);
        c = c.nextSibling;
    }
}

function setStylesheet(s,id,doc)
{
    jQuery.twStylesheet(s,{id:id,doc:doc});
}

function removeStyleSheet(id)
{
    jQuery.twStylesheet.remove({id:id});
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
    var title = this.getTitle(store,node);
    if(safeMode && store.isShadowTiddler(title))
        return;
    if(title) {
        var tiddler = store.createTiddler(title);
        this.internalizeTiddler(store,tiddler,title,node);
        tiddlers.push(tiddler);
    }
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
    var t,tiddlers = [];
    for(t = 0; t < nodes.length; t++) {
        try {
            this.loadTiddler(store,nodes[t],tiddlers);
        } catch(ex) {
            showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
        }
    }
    return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
    var results = [];
    var t,tiddlers = store.getTiddlers("title");
    for(t = 0; t < tiddlers.length; t++) {
        if(!tiddlers[t].doNotSave())
            results.push(this.externalizeTiddler(store, tiddlers[t]));
    }
    return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
    var title = null;
    if(node.getAttribute) {
        title = node.getAttribute("title");
        if(!title)
            title = node.getAttribute("tiddler");
    }
    if(!title && node.id) {
        var lenPrefix = store.idPrefix.length;
        if(node.id.substr(0,lenPrefix) == store.idPrefix)
            title = node.id.substr(lenPrefix);
    }
    return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
    var e = node.firstChild;
    var text = null;
    if(node.getAttribute("tiddler")) {
        text = getNodeText(e).unescapeLineBreaks();
    } else {
        while(e.nodeName!="PRE" && e.nodeName!="pre") {
            e = e.nextSibling;
        }
        text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
    }
    var creator = node.getAttribute("creator");
    var modifier = node.getAttribute("modifier");
    var c = node.getAttribute("created");
    var m = node.getAttribute("modified");
    var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
    var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
    var tags = node.getAttribute("tags");
    var fields = {};
    var i,attrs = node.attributes;
    for(i = attrs.length-1; i >= 0; i--) {
        var name = attrs[i].name;
        if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
            fields[name] = attrs[i].value.unescapeLineBreaks();
        }
    }
    tiddler.assign(title,text,modifier,modified,tags,created,fields,creator);
    return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
    try {
        var extendedAttributes = "";
        var usePre = config.options.chkUsePreForStorage;
        store.forEachField(tiddler,
            function(tiddler,fieldName,value) {
                // don't store stuff from the temp namespace
                if(typeof value != "string")
                    value = "";
                if(!fieldName.match(/^temp\./))
                    extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
            },true);
        var created = tiddler.created;
        var modified = tiddler.modified;
        var attributes = tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "";
        attributes += tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
        attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
        attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
        var tags = tiddler.getTags();
        if(!usePre || tags)
            attributes += ' tags="' + tags.htmlEncode() + '"';
        return ('<div %0="%1"%2%3>%4</'+'div>').format([
                usePre ? "title" : "tiddler",
                tiddler.title.htmlEncode(),
                attributes,
                extendedAttributes,
                usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
            ]);
    } catch (ex) {
        throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
    }
};



//]]>
</script>

<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
    return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
    return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
    return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
    return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
    return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
    return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
    w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
    var lookaheadRegExp = new RegExp(this.lookahead,"mg");
    lookaheadRegExp.lastIndex = w.matchStart;
    var lookaheadMatch = lookaheadRegExp.exec(w.source);
    if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
        var text = lookaheadMatch[1];
        if(config.browser.isIE)
            text = text.replace(/\n/g,"\r");
        createTiddlyElement(w.output,"pre",null,null,text);
        w.nextMatch = lookaheadRegExp.lastIndex;
    }
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br = {};
config.macros.br.handler = function(place)
{
    createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
    var i = this.indexOf(item);
    return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
    return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
    return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
    return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
    refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
    story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
    story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

//--
//-- Deprecated FileAdaptor functions
//--

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
    context.status = status;
    if(!status) {
        context.statusText = "Error reading file";
    } else {
        context.adaptor.store = new TiddlyWiki();
        if(!context.adaptor.store.importTiddlyWiki(responseText)) {
            context.statusText = config.messages.invalidFileError.format([url]);
            context.status = false;
        }
    }
    context.complete(context,context.userParams);
};

//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
    return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
    return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
    // Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
    var m = {
        '\b': '\\b',
        '\f': '\\f',
        '\n': '\\n',
        '\r': '\\r',
        '\t': '\\t',
        '"' : '\\"',
        '\\': '\\\\'
        };
    var replaceFn = function(a,b) {
        var c = m[b];
        if(c)
            return c;
        c = b.charCodeAt();
        return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
        };
    if(/["\\\x00-\x1f]/.test(this))
        return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
    return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
    return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
    return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
    return "0x" + Crypto.hexSha1Str(this.text);
};

//--
//-- Deprecated Number functions
//--

// @Deprecated: no direct replacement, since not used in core code
// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
    var c = this;
    if(c < min)
        c = min;
    if(c > max)
        c = max;
    return Number(c);
};

//--
//-- Deprecated utility functions
//-- Use the jQuery functions directly instead
//--

// Remove all children of a node
function removeChildren(e)
{
    jQuery(e).empty();
}

// Remove a node and all it's children
function removeNode(e)
{
    jQuery(e).remove();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
    return jQuery(e).text();
}

function addClass(e,className)
{
    jQuery(e).addClass(className);
}

function removeClass(e,className)
{
    jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
    return jQuery(e).hasClass(className);
}

//--
//-- Deprecated Wikifier code
//--

function wikifyPlain(title,theStore,limit)
{
    if(!theStore)
        theStore = store;
    if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
        return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
    } else {
        return "";
    }
}


//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*! jQuery v1.8.3 jquery.com | jquery.org/license */
(function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(P,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else r=t}return r}function B(e){var t;for(t in e){if(t==="data"&&v.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function et(){return!1}function tt(){return!0}function ut(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t))return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return v.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t))return v.filter(t,r,!n);t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e))return;var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)v.event.add(t,n,u[n][r])}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==="input"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e)return t}return r}function Gt(e,t){return e=t||e,v.css(e,"display")==="none"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style)continue;i[s]=v._data(n,"olddisplay"),t?(!i[s]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&Gt(n)&&(i[s]=v._data(n,"olddisplay",nn(n.nodeName)))):(r=Dt(n,"display"),!i[s]&&r!=="none"&&v._data(n,"olddisplay",r))}for(s=0;s<o;s++){n=e[s];if(!n.style)continue;if(!t||n.style.display==="none"||n.style.display==="")n.style.display=t?i[s]||"":"none"}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function en(e,t,n,r){var i=n===(r?"border":"content")?4:t==="width"?1:0,s=0;for(;i<4;i+=2)n==="margin"&&(s+=v.css(e,n+$t[i],!0)),r?(n==="content"&&(s-=parseFloat(Dt(e,"padding"+$t[i]))||0),n!=="margin"&&(s-=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0)):(s+=parseFloat(Dt(e,"padding"+$t[i]))||0,n!=="padding"&&(s+=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0));return s}function tn(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,"boxSizing")==="border-box";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null)r=e.style[t];if(Ut.test(r))return r;i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?"border":"content"),i)+"px"}function nn(e){if(Wt[e])return Wt[e];var t=v("<"+e+">").appendTo(i.body),n=t.css("display");t.remove();if(n==="none"||n===""){Pt=i.body.appendChild(Pt||v.extend(i.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement)Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write("<!doctype html><html><body>"),Ht.close();t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,"display"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&v.type(t)==="object")for(i in t)fn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Cn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n))for(;u<a;u++)r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[s?"unshift":"push"](n)}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++)u=a[f](n,r,i),typeof u=="string"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));return(c||!u)&&!o["*"]&&(u=kn(e,n,r,i,"*",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]==="*")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=o[++f];)if(i!=="*"){if(u!=="*"&&u!==i){n=a[u+" "+i]||a["* "+i];if(!n)for(r in a){s=r.split(" ");if(s[1]===i){n=a[u+" "+s[0]]||a["* "+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+u+" to "+i}}}u=i}return{state:"success",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++)f.tweens[s].run(i);return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r)return r}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,"display")==="inline"&&v.css(e,"float")==="none"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s==="toggle";if(s===(g?"hide":"show"))continue;m.push(r)}}o=m.length;if(o){u=v._data(e,"fxshow")||v._data(e,"fxshow",{}),"hidden"in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,"fxshow",!0);for(t in d)v.style(e,t,d[t])});for(r=0;r<o;r++)i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=$t[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){return(t+"").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",A,!1),v.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),"slice",l.call(arguments).join(","))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady)return;if(!i.body)return setTimeout(v.ready,1);v.isReady=!0;if(e!==!0&&--v.readyWait>0)return;r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger("ready").off("ready")},isFunction:function(e){return v.type(e)==="function"},isArray:Array.isArray||function(e){return v.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||"object"},isPlainObject:function(e){if(!e||v.type(e)!=="object"||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return!e||typeof e!="string"?null:(typeof t=="boolean"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string")return null;t=v.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(S.test(t.replace(T,"@").replace(N,"]").replace(x,"")))return(new Function("return "+t))();v.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e)if(n.apply(e[i],r)===!1)break}else for(;s<o;)if(n.apply(e[s++],r)===!1)break}else if(u){for(i in e)if(n.call(e[i],i,e[i])===!1)break}else for(;s<o;)if(n.call(e[s],s,e[s++])===!1)break;return e},trim:d&&!d.call("\ufeff\u00a0")?function(e){return e==null?"":d.call(e)}:function(e){return e==null?"":(e+"").replace(b,"")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n==="string"||n==="function"||n==="regexp"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=="number"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f)for(;u<a;u++)i=n(e[u],u,r),i!=null&&(o[o.length]=i);else for(s in e)i=n(e[s],s,r),i!=null&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r=="object"){for(l in r)v.access(e,n,l,r[l],1,o,i);s=1}else if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n)for(;l<c;l++)n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);s=1}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState==="complete")setTimeout(v.ready,1);else if(i.addEventListener)i.addEventListener("DOMContentLoaded",A,!1),e.addEventListener("load",v.ready,!1);else{i.attachEvent("onreadystatechange",A),e.attachEvent("onload",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}v.ready()}}()}}return r.promise(t)},v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value==="on",optSelected:o.selected,getSetAttribute:p.className!=="t",enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",h)),u=i.createElement("input"),u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","checked"),u.setAttribute("name","t"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})f="on"+l,c=f in p,c||(p.setAttribute(f,"return;"),c=typeof p[f]=="function"),t[l+"Bubbles"]=c;return v(function(){var n,r,s,o,u="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=i.getElementsByTagName("body")[0];if(!a)return;n=i.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(n,a.firstChild),r=i.createElement("div"),n.appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=r.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML="",r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:"4px"}).width==="4px",o=i.createElement("div"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width="0",r.style.width="1px",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!="undefined"&&(r.innerHTML="",r.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display="block",r.style.overflow="visible",r.innerHTML="<div></div>",r.firstChild.style.width="5px",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e))return;var s,o,u=v.expando,a=typeof n=="string",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)return;c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n=="object"||typeof n=="function")i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?B:v.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!B(u[a]))return}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf("data-")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));v._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){v.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",v.access(this,function(n){if(n===t)return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=v(this);t.triggerHandler("setData"+i,r),v.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v.removeData(e,t+"queue",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=v._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ");i.className=v.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(" "+i.className+" ").replace(q," ");for(s=0,o=n.length;s<o;s++)while(r.indexOf(" "+n[s]+" ")>=0)r=r.replace(" "+n[s]+" "," ");i.className=e?v.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&v._data(this,"__className__",this.className),this.className=this.className||e===!1?"":v._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(R,""):r==null?"":r);return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":v.isArray(s)&&(s=v.map(s,function(e){return e==null?"":e+""})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,s,"value")===t)this.value=s})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find("option").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(i&&v.isFunction(v.fn[n]))return v(e)[n](r);if(typeof e.getAttribute=="undefined")return v.prop(e,n,r);u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++)i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,""),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode)v.error("type property can't be changed");else if(!v.support.radioValue&&t==="radio"&&v.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return j&&v.nodeName(e,"button")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,"button"))return j.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!=="":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+""}},v.each(["width","height"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===""&&(t="false"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each(["href","src","width","height"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype="encoding"),v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,"mouseenter$1 mouseleave$1")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))return;r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v=="undefined"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(" ");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events))return;t=v.trim(Z(t||"")).split(" ");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h)v.event.remove(e,u+t[s],n,r,!0);continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp("(^|\\.)"+f.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(c=0;c<d.length;c++)m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==="**"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered))return;y.indexOf("!")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(".")>=0&&(b=y.split("."),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y])return;n=typeof n=="object"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=y.indexOf(":")<0?"on"+y:"";if(!s){u=v.cache;for(f in u)u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1)return;m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode)m.push([l,g]),c=l;c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++)l=m[f][0],n.type=m[f][1],d=(v._data(l,"events")||{})[n.type]&&v._data(l,"handle"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=="click"||!v.nodeName(s,"a"))&&v.acceptData(s)&&h&&s[y]&&(y!=="focus"&&y!=="blur"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,"events")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1)return;if(m&&(!n.button||n.type!=="click"))for(s=n.target;s!=this;s=s.parentNode||this)if(s.disabled!==!0||n.type!=="click"){u={},f=[];for(r=0;r<m;r++)c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);f.length&&w.push({elem:s,matches:f})}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando])return e;var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;)n=o[--t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;r&&!v._data(r,"_submit_attached")&&(v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),v._data(r,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")v.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate("change",this,e,!0)});return!1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,"_change_attached")&&(v.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate("change",this.parentNode,e,!0)}),v._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,"._change"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=et;else if(!i)return this;return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return v.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,"lastToggle"+e.guid)||0)%r;return v._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=R.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Z&&t.getElementsByClassName)return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}return vt(e.replace(j,"$1"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ot(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=I.exec(u))s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j," ");for(o in i.filter)(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=w++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=b+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[at(ft(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join("").replace(j,"$1"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++)v(x,m,a,f);if(u){if(y>0)while(w--)!x[w]&&!m[w]&&(m[w]=E.call(l));m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++)nt(e,t[r],n);return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace($,""),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return S.apply(n,x.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},k=C(),L=C(),A=C(),O="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",_=M.replace("w","w#"),D="([*^$|!~]?=)",P="\\["+O+"*("+M+")"+O+"*(?:"+D+O+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+_+")|)|)"+O+"*\\]",H=":("+M+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+P+")|[^:]|\\\\.)*|.*))\\)|)",B=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)",j=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),F=new RegExp("^"+O+"*,"+O+"*"),I=new RegExp("^"+O+"*([\\x20\\t\\r\\n\\f>+~])"+O+"*"),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),NAME:new RegExp("^\\[name=['\"]?("+M+")['\"]?\\]"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+H),POS:new RegExp(B,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),needsContext:new RegExp("^"+O+"*[>+~]|"+B,"i")},K=function(e){var t=g.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length}),G=K(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),Y=K(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Z=K(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,""),e[3]=(e[4]||e[5]||"").replace($,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace($,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace($,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,"$1"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:rt("radio"),checkbox:rt("checkbox"),file:rt("file"),password:rt("password"),image:rt("image"),submit:it("submit"),reset:it("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return ot(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return ot(i[f],s[f]);return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},nt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+" "];if(!s){t||(t=ut(e)),n=t.length;while(n--)s=ht(t[n]),s[d]?r.push(s):i.push(s);s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+O+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),K(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+O+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ut(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=z.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",H)}catch(n){}}),s=new RegExp(s.join("|")),nt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[":"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!="string")return v(e).filter(function(){for(t=0,n=u.length;t<n;t++)if(v.contains(u[t],this))return!0});o=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0)for(i=r;i<o.length;i++)for(s=0;s<r;s++)if(o[s]===o[i]){o.splice(i--,1);break}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1),"not",e)},filter:function(e){return this.pushStack(ft(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!="string"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?typeof e=="string"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return at(e,"nextSibling")},prev:function(e){return at(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r=="string"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(","))}}),v.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ct="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp("<(?:"+ct+")[\\s/>]","i"),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ct=lt(i),kt=Ct.appendChild(i.createElement("div"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,"X<div>","</div>"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),"before",this.selector)}},after:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),"after",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||v.filter(e,[n]).length)!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName("*"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(ht,""):t;if(typeof e=="string"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(dt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),"replaceWith",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f=="string"&&St.test(f))return this.each(function(){v(this).domManip(e,n,r)});if(v.isFunction(f))return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,"tr");for(u=i.cacheable||c-1;a<c;a++)r.call(n&&v.nodeName(this[a],"table")?Lt(this[a],"tbody"):this[a],a===u?o:v.clone(o,!0,!0))}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Tt,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=="string"&&a.length<512&&n===i&&a.charAt(0)==="<"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)return o[t](this[0]),this;for(;i<u;i++)r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s)i[s]&&Ot(r[s],i[s])}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s)At(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment=="undefined")t=i;for(s=0;(u=e[s])!=null;s++){typeof u=="number"&&(u+="");if(!u)continue;if(typeof u=="string")if(!gt.test(u))u=t.createTextNode(u);else{y=y||lt(t),c=t.createElement("div"),y.appendChild(c),u=u.replace(dt,"<$1></$2>"),a=(vt.exec(u)||["",""])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--)c=c.lastChild;if(!v.support.tbody){h=mt.test(u),p=a==="table"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==="<table>"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o)v.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked)for(s=0;(u=b[s])!=null;s++)v.nodeName(u,"input")?_t(u):typeof u.getElementsByTagName!="undefined"&&v.grep(u.getElementsByTagName("input"),_t);if(n){m=function(e){if(!e.type||xt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)};for(s=0;(u=b[s])!=null;s++)if(!v.nodeName(u,"script")||!m(u))n.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(g=v.grep(v.merge([],u.getElementsByTagName("script")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++)if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp("^("+m+")(.*)$","i"),Ut=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),zt=new RegExp("^([-+])=("+m+")","i"),Wt={BODY:"block"},Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:0,fontWeight:400},$t=["Top","Right","Bottom","Left"],Jt=["Webkit","O","Moz","ms"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e=="boolean";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,"opacity");return n===""?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!v.cssNumber[a]&&(r+="px");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==="normal"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];r=n.call(e);for(i in t)e.style[i]=s[i];return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===""&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==="fontSize"?"1em":i,i=s.pixelLeft+"px",s.left=n,r&&(e.runtimeStyle.left=r)),i===""?"auto":i}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&It.test(Dt(e,"display"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,"boxSizing")==="border-box"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=Bt.test(s)?s.replace(Bt,i):s+" "+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:"inline-block"},function(){if(t)return Dt(e,"marginRight")})}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+"px":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,"display"))==="none"},v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+$t[r]+t]=i[r]||i[r-2]||i[0];return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,"\r\n")}}):{name:t.name,value:n.replace(on,"\r\n")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)fn(r,e[r],n,s);return i.join("&").replace(rn,"+")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=["*/"]+["*"];try{cn=s.href}catch(Nn){cn=i.createElement("a"),cn.href="",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!="string"&&En)return En.apply(this,arguments);if(!this.length)return this;var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),v.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v("<div>").append(e.replace(yn,"")).find(i):e)}),this},v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,"script")},getJSON:function(e,t,n){return v.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),o=t,i=a||"",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(v.lastModified[r]=S),S=x.getResponseHeader("Etag"),S&&(v.etag[r]=S)),e===304?(T="notmodified",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);else{b=T;if(!T||e)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger("ajax"+(l?"Success":"Error"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--v.active||v.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks("once memory"),g=c.statusCode||{},b={},w={},E=0,S="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i))s[n[1].toLowerCase()]=n[2]}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2)for(t in e)g[t]=[g[t],e[t]];else t=e[x.status],x.always(t)}return this},c.url=((e||c.url)+"").replace(hn,"").replace(mn,ln[1]+"//"),c.dataTypes=v.trim(c.dataType||"*").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==="http:"?80:443))==(ln[3]||(ln[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2)return x;f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?"&":"?")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,"$1_="+N);c.url=C+(C===c.url?(gn.test(c.url)?"&":"?")+"_="+N:"")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader("If-Modified-Since",v.lastModified[r]),v.etag[r]&&x.setRequestHeader("If-None-Match",v.etag[r])),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in{success:1,error:1,complete:1})x[l](c[l]);o=kn(xn,c,n,x);if(!o)T(-1,"No Transport");else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2))throw k;T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mn.pop()||v.expando+"_"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dn.test(a);if(n.dataTypes[0]==="jsonp"||c||h)return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,"$1"+s):h?n.data=a.replace(Dn,"$1"+s):l&&(n.url+=(_n.test(f)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||v.error(s+" was not called"),u[0]},n.dataTypes[0]="json",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),"script"}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,o){n=i.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn)Hn[e](0,1)}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i)a.readyState!==4&&a.abort();else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),Wn=/queueHooks$/,Xn=[Gn],Vn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?"":"px");if(r!=="px"&&u){u=v.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,v.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r=="boolean"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn("show"),slideUp:Zn("hide"),slideToggle:Zn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e=="object"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c)return;return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!="undefined"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,"marginTop"))||0,n+=parseFloat(v.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,"position");r==="static"&&(e.style.position="relative");var i=v(e),s=i.offset(),o=v.css(e,"top"),u=v.css(e,"left"),a=(r==="absolute"||r==="fixed")&&v.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,"marginTop"))||0,n.left-=parseFloat(v.css(e,"marginLeft"))||0,r.top+=parseFloat(v.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(v.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,"position")==="static")e=e.offsetParent;return e||i.body})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return v})})(window);
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
    $.encoding = {};
    $.extend($.encoding,{
        strToBe32s: function(str) {
            // Convert a string to an array of big-endian 32-bit words
            var be=[];
            var len=Math.floor(str.length/4);
            var i, j;
            for(i=0, j=0; i<len; i++, j+=4) {
                be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
            }
            while(j<str.length) {
                be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
                j++;
            }
            return be;
        },
        be32sToStr: function(be) {
            // Convert an array of big-endian 32-bit words to a string
            var str='';
            for(var i=0;i<be.length*32;i+=8) {
                str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
            }
            return str;
        },
        be32sToHex: function(be) {
            // Convert an array of big-endian 32-bit words to a hex string
            var hex='0123456789ABCDEF';
            var str='';
            for(var i=0;i<be.length*4;i++) {
                str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
            }
            return str;
        }
    });
})(jQuery);


(function($) {

if(!$.encoding.digests)
    $.encoding.digests = {};
    $.extend($.encoding.digests,{
        hexSha1Str: function(str) {
            // Return, in hex, the SHA-1 hash of a string
            return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
        },
        sha1Str: function(str) {
            // Return the SHA-1 hash of a string
            return sha1($.encoding.strToBe32s(str),str.length);
        },
        sha1: function(x,blen) {
            // Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
            return sha1($.encoding.strToBe32s(str),str.length);
        }
    });

    // Private functions.
    function sha1(x,blen) {
        // Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
        function add32(a,b) {
            // Add 32-bit integers, wrapping at 32 bits
            // Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
            var lsw=(a&0xFFFF)+(b&0xFFFF);
            var msw=(a>>16)+(b>>16)+(lsw>>16);
            return (msw<<16)|(lsw&0xFFFF);
        }
        function AA(a,b,c,d,e) {
            // Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
            // Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
            b=(b>>>27)|(b<<5);
            var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
            var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
            return (msw<<16)|(lsw&0xFFFF);
        }
        function RR(w,j) {
            // Cryptographic round helper function.
            var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
            return (n>>>31)|(n<<1);
        }

        var len=blen*8;
        x[len>>5] |= 0x80 << (24-len%32);
        x[((len+64>>9)<<4)+15]=len;
        var w=new Array(80);

        var k1=0x5A827999;
        var k2=0x6ED9EBA1;
        var k3=0x8F1BBCDC;
        var k4=0xCA62C1D6;

        var h0=0x67452301;
        var h1=0xEFCDAB89;
        var h2=0x98BADCFE;
        var h3=0x10325476;
        var h4=0xC3D2E1F0;

        for(var i=0;i<x.length;i+=16) {
            var j=0;
            var t;
            var a=h0;
            var b=h1;
            var c=h2;
            var d=h3;
            var e=h4;
            while(j<16) {
                w[j]=x[i+j];
                t=AA(e,a,d^(b&(c^d)),w[j],k1);
                e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
            }
            while(j<20) {
                w[j]=RR(w,j);
                t=AA(e,a,d^(b&(c^d)),w[j],k1);
                e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
            }
            while(j<40) {
                w[j]=RR(w,j);
                t=AA(e,a,b^c^d,w[j],k2);
                e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
            }
            while(j<60) {
                w[j]=RR(w,j);
                t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
                e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
            }
            while(j<80) {
                w[j]=RR(w,j);
                t=AA(e,a,b^c^d,w[j],k4);
                e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
            }
            h0=add32(h0,a);
            h1=add32(h1,b);
            h2=add32(h2,c);
            h3=add32(h3,d);
            h4=add32(h4,e);
        }
        return [h0,h1,h2,h3,h4];
    }
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
    options = options || {};
    var id = options.id || defaultId;
    var doc = options.doc || document;
    var el = doc.getElementById(id);
    if(doc.createStyleSheet) { // IE-specific handling
        if(el) {
            el.parentNode.removeChild(el);
        }
        doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
            '&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
    } else { // modern browsers
        if(el) {
            el.replaceChild(doc.createTextNode(css), el.firstChild);
        } else {
            el = doc.createElement("style");
            el.type = "text/css";
            el.id = id;
            el.appendChild(doc.createTextNode(css));
            doc.getElementsByTagName("head")[0].appendChild(el);
        }
    }
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
    options = options || {};
    var id = options.id || defaultId;
    var doc = options.doc || document;
    var el = doc.getElementById(id);
    if(el) {
        el.parentNode.removeChild(el);
    }
};

})(jQuery);

//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
    document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
